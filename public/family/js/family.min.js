const isPrivate=!(isDebugging||"false"==window.location.get("private"));var isChecking=!1;const ui={scale:.937,font:{size:{name:15,details:12}},color:{background:isDark?"#202124":"#f3f4f5",node:{background:isDark?"#2f2f2f":"#ffffff",name:isDark?"#fefefe":"#000000",details:isDark?"#bdc1c6":"#222222",nameless:{name:isDark?"#909090":"#bdbdbd",details:isDark?"#929292":"#b0b0b0"}},marker:{background:{default:isDark?"#2f2f2f":"#ffffff",dna:isDark?"#403148":"#f2e6f9",intelligence:isDark?"#323b48":"#e3edfd",software:isDark?"#393939":"#f0f0f0",computer:isDark?"#393939":"#f0f0f0",government:isDark?"#393939":"#f0f0f0",manager:isDark?"#393939":"#f0f0f0",housekeeper:isDark?"#393939":"#f3ede9",cattle:isDark?"#393939":"#f3ede9",investigate:isDark?"#393939":"#f0f0f0",train:isDark?"#393939":"#f0f0f0",church:isDark?"#393939":"#f0f0f0",seaman:isDark?"#393939":"#f0f0f0",manufacturing:isDark?"#46312c":"#fdeee8",buysell:isDark?"#393939":"#f0f0f0",beautician:isDark?"#462c36":"#fde8f0",apparel:isDark?"#46312c":"#fdeee8",housewife:isDark?"#462c36":"#fde8f0",retail:isDark?"#462c36":"#fde8f0",farming:isDark?"#2e4030":"#dff1e0",land:isDark?"#393633":"#f2ebe6",police:isDark?"#323b48":"#e3edfd",military:isDark?"#3e382e":"#fcf3e2",sales:isDark?"#3e382e":"#fcf3e2",prelations:isDark?"#3e382e":"#fcf3e2","male-twin":isDark?"#323b48":"#e3edfd","female-twin":isDark?"#462c36":"#fde8f0",beer:isDark?"#393939":"#f3ede9"},symbol:{default:"white"}},link:isDark?"#7f7f7f":"#afafaf",female:"#ea1a68",male:"#2799fd"},photo:{none:isDark?"data:image/jpeg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wgARCAB9APoDASIAAhEBAxEB/8QAGAABAQEBAQAAAAAAAAAAAAAAAAQDAgX/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/9oADAMBAAIQAxAAAAHwtpxWm2OwAAAAAAAAAAAAASAA71nFafU7AAAAAAAAAAABIAAADvWcVp9TsAAAAAAAAAEgAAAAAO9ZxWn1OwAAAAAAASAAAAAAAA71nFafU7AAAAABIAAAAAAAAADvWcVp9TsAAAEgAAAAAAAAAAAO9ZxWm2OwASAAAAAAAAAAAAAA62nFafU//8QAGBABAQEBAQAAAAAAAAAAAAAAAQIAUBH/2gAIAQEAAQUCFMUcEUxRwRTFHBFMUcEUxRwRTFHBFMUcEUxRwRTFHBFMUcEUxRwSvMUPBK8xQ8EpMUPBKTFDwRTe7//EABQRAQAAAAAAAAAAAAAAAAAAAHD/2gAIAQMBAT8BAP/EABQRAQAAAAAAAAAAAAAAAAAAAHD/2gAIAQIBAT8BAP/EABQQAQAAAAAAAAAAAAAAAAAAAJD/2gAIAQEABj8CAD//xAAZEAACAwEAAAAAAAAAAAAAAAAAAVBhcTH/2gAIAQEAAT8h4nBinA8TgxTgcQYpwOIMU4HEGKcDiDFOBxBinA4gxTgcQYpwOIMU4HEGKcCzBQOBZgoHA2CKBwNgigcDiGT/2gAMAwEAAgADAAAAEDMPPPPPPPPPPPPPPPPDMPPPPPPPPPPPPPPPPHNPPPPPPPPPPPPPPPPHNPPPPPPPPPPPPPPPPHNPPPPPPPPPPPPPPPPHNPPPPPPPPPPPPPPPPHPPPPPPPPPPPPPPPPPPNP/EABQRAQAAAAAAAAAAAAAAAAAAAHD/2gAIAQMBAT8QAP/EABQRAQAAAAAAAAAAAAAAAAAAAHD/2gAIAQIBAT8QAP/EAB8QAQABAwUBAQAAAAAAAAAAAAEhABExUFFxkdFhQf/aAAgBAQABPxDOL7HFRrxOO9BjFfY4qNeJx3oMYN9jio14nHegxg32OKjXicd6DGDfY4qNeJx3oMYN9jio14nHegxg32OKjXicd6DGDfY4qNeJx3oMYN9jio14n3QYwb7HFRrxPugxg32NRq/B90GKG+xqMX4PugxQ32NRi/J90GIH4NRi/B90GIH4NRl/g+6DbAbr8ZoCe6//2Q==":"data:image/jpeg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wgARCAB9APoDASIAAhEBAxEB/8QAGQABAQEBAQEAAAAAAAAAAAAAAAQDAQIG/8QAFAEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEAMQAAAB+5wqEKyczAAAAAAAAAAAAABcADzhSIVmBkAAAAAAAAAAAC4AAAHnCkQrMDIAAAAAAAAAFwAAAAAPOFIhW4GIAAAAAAALgAAAAAAAcwoEK3AxAAAAABcAAAAAAAAADmFAhW4GIAAALgAAAAAAAAAAAcx3EXLcTB3gBcAAAAAAAAAAAAADmO4i5dmf/8QAGhABAAMBAQEAAAAAAAAAAAAAAQACUBESMf/aAAgBAQABBQJqMaJgtRjRMFqMaOCgxo4KDGmCgxpgoMaYKdjTBTsaYKdjTBTsaYKdjTBTsaYP2NMJpheCf//EABQRAQAAAAAAAAAAAAAAAAAAAHD/2gAIAQMBAT8BAP/EABQRAQAAAAAAAAAAAAAAAAAAAHD/2gAIAQIBAT8BAP/EABYQAQEBAAAAAAAAAAAAAAAAACFQcP/aAAgBAQAGPwLKyEQiEQiEQiEQiEQ//8QAHRABAAICAwEBAAAAAAAAAAAAAQAxIVAQEVFx4f/aAAgBAQABPyH7EqMmhuLlRk0NxCVk0N4QlZNDeRis6G0Ix60NoRj1oRsRj1oQsRz1E6vQBYjnqJ1egCxHhOr0AWOMnV6ALHGRHOgQscZEcmgQTJPzxEvQIJmfWf/aAAwDAQACAAMAAAAQ8EAAAAAAAAAAAAAA88MAAAAAAAAAAAAA88888MAAAAAAAAAA8888888gIAAAAAAA88888888MgIAAAAA8888888888csIAAA888888888888sIAA888888888888888A/8QAFBEBAAAAAAAAAAAAAAAAAAAAcP/aAAgBAwEBPxAA/8QAFBEBAAAAAAAAAAAAAAAAAAAAcP/aAAgBAgEBPxAA/8QAIBABAAEEAwEAAwAAAAAAAAAAAREAMVBRIUFhgXGh8P/aAAgBAQABPxDlUjYqQR+K+BsKNipB+K+BsKHZepF+K9PGA2psvUi/NenjhvgBePOy9cvx/ukhhvgDe7ZepdUdd0iMJDgCe7fdcsoa7pEUSHAF8T73UoqGu6RGER04A+Cfe65Bw03pFAR04A+Ca5Bw03pFAR04AaCaBy5NN6RQEdOACgkpDlyaaRwEfcAFBJSErnxqJBH3AGQSV2P41GmH3ARok9q4r6p2Cj7gI0RPa/o1/9k=",female:isDark?"data:image/jpeg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wgARCACgAPoDASIAAhEBAxEB/8QAGwABAAIDAQEAAAAAAAAAAAAAAAYHAgMEBQH/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAAB8YAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABtlpCsrR3xU2VqeOQN28VAAAAAAAAAAANmuTkl6yAAMa6sfwiCigAAAAAAAAAExh0oJeIAAcHf45X/wB+/KAAAAAAAAAASqK2OegIAAeR6+JVTdpoAAAAAAAAB0c4sH1vH9iAAAAOSDTiuzQKAAAAAAAAASSNiy+yDTCOkAwNUd1xsxwKAAAAAAAAAZYWAePKOhAAADHIRqLWdoKvbdVAAAAAAAAddmw2YwAAAAABCI/PIHQAAAH/xAAqEAACAQMDAgQHAQAAAAAAAAACAwQBBUAAIDAREhATFCEiIzEzNDVBcP/aAAgBAQABBQL/AA7up4d1MxSzcyPaVjQFLCmqgJafbI7dS4rYhZCwJrIscIytpDQxnRvSPx7Evqe+9B3QMew/Y3z/AMKn0xrDX4t93/XY9hHgu1OtuxvfrAj+mi7ypQhekozsSOrz3woKovFKjrkrnRPSFh++rdNpKDhlSVxVvab3Yn9i3Uw0iSl+5r1JpJu1NGRMZjU9yj2lrdR0ihfiY0MZFn05bElijSpFHtBV0hKkDvKlCGRaVlqQhkc8KtelLbEpGVxvUD1OXVLsGGvzpnLfA7ZeDY1fN5bunzonD//EABQRAQAAAAAAAAAAAAAAAAAAAHD/2gAIAQMBAT8BIP/EABQRAQAAAAAAAAAAAAAAAAAAAHD/2gAIAQIBAT8BIP/EADMQAAIAAwUFBQcFAAAAAAAAAAECAAMREjAxQEEEIVFScRMgIjJhECMzgZHB0WJwcpKx/9oACAEBAAY/Av2OxjBv6mN+7rnOzkrab/OsV2hu1bhgIoktAOns8SqflFVHZNxWPe70ODjDMrLl+dsIEuX8zx7xVwCpxBiwPhtvQ/bMTpp08IuGbWX4sxN/ncT68hgZfaB0NxO9RTMT26C4nUxArlwAKsdwHGFlnzYt1uCpwMGS+nlPEZVZVoLa1MWhV5vO11YmrXgdRCDtbdr035SoNCN4PCLLUE8Yrx9RdW5p6LqYabM8x04emVBBIIwI0iztK2xzrjHupin0171ZsxV6mKbKto87YQXmsWc6nL2VBZuAgGfSUv1aAiWqfqavcKtgYtbK+/lf8xZnIUPrlgqAsxwAiu0vQcifmKSUC3FlgGXgYrs7dkeGKxZnLSuB0OTrFW+M3mP2vDLmiqmHlNih+uSkppWp+V9LfnWmSmTToLIvqjzS/ELr/8QAKRABAAEBBwQBBAMAAAAAAAAAAREAITAxQEFRYXGBofCRILHB0RBw8f/aAAgBAQABPyH+jrWITxU+5+KQxeCscM2fRr7DdaUcVqGx/ddPBH+Jq1NxU0tfeKIQLFi3Ds5kbJWJYHL0ouedd7v1FVWMA09qNsNtezMEItj9594uB1sD2x8Zj0uC4htKPGy8WlfniPxcOC/0NOOXadOR5sn83DxUwZ0rplrS58PFbVZUccarG4FGShKFK218Gn2yrDNlBThp1pVkBDiRsbXVjkLQsXca3taDABq5SwinQMVvVhFfYYXWsRhYuxXCijA7MraJClEK4oQVtHka9qGtXWUDqfVED/JQh4owOhi128qHBsZeRIGBytIL2HpFJ2zqje79AGKUMMeSiF6wz8YvmvAnj0cty/TTUT8+O/6VCr6oWve4fLGISVPO3foUGncAz0XJza0oWQjO3w4vPsqXyc0n8xJ2aOS3RdtapxvYRwmdTJMnWAvW1vlQ5b9ni6//2gAMAwEAAgADAAAAEPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPLgvPPPPPPPPPPPKHvvjvPPPPPPPPPPLPvvulPPPPPPPPPPIPvvvvPPPPPPPPPPNvvvvgvPPPPPPPPPGNvvinPPPPPPPPPJDvvvvqvPPPPPPPPJvvvvvvvPPPPP/EABQRAQAAAAAAAAAAAAAAAAAAAHD/2gAIAQMBAT8QIP/EABkRAAIDAQAAAAAAAAAAAAAAAAFAABFQIP/aAAgBAgEBPxDHuW6UCqNEc//EACgQAQABAwEIAgIDAAAAAAAAAAERACExQTBAUWFxgZGhscEg8HDh8f/aAAgBAQABPxD+DmZLFkUvgqbcQ4jFNTXAPzihAKEcJrvbYTcDHjB7ag0XJVwDPdQ8agAmKICAA4BRABEM6fVGNcssC83ZoYXIZm0D5rVhvvBJvYw5Qu9jWrLHIOfbX6/KCQwpDmUggRviDK8dHEeTvE/mbukg51kNgWZfMJYUA6pO9JCmd3RHNy84bCZVBeTjFSuZhPjd2GyJ3PgNhOWCfYKUp57uh4k+0RInp22Ev8UMqh+qUWVI3HibtYmseV4H26F6ltdYZUrzsDFJu1EhpLRLCtP4BCMkTruuFd4EiYE3RMdGnLhUEOBLHpnZDpRl+QK4/NFGAQ7PILJKGMu6CO6LwG4P2+KHNl1AfYuGmySwWQ2dGP3gpAQgFSfHIMrqry3Uuad7iiMUIo2DBPH1Xcqk8Wnygwnc/IurMEQrgGVpYKWlc58pB1q3E5bDgY5Bu8gBwi7oVk2IMdkx3snClZrMquKj4IPwWMY1aOYQTqNQWGyul+rV1oWr4T4myd92fv0Bn+g1WxSZOZWVyT6d6tj+PJSu7DCqlk7NSMu8anQz2NB5kY7ezkw7mASYYNXAd1DvRXHoLlucAe2+0G4SEwvRNBo13ZWaT109juStkhnJMwerFKU6bXDJtjXmZ6O5KPNGj/h87aMUJcQw9vFOXY//2Q==":"data:image/jpeg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wgARCACgAPoDASIAAhEBAxEB/8QAGgABAAMBAQEAAAAAAAAAAAAAAAQFBgMCAf/EABUBAQEAAAAAAAAAAAAAAAAAAAAB/9oADAMBAAIQAxAAAAHegAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOVGaLxkPKbNjZhpkSWoAAAAAAAAAADx7qCp5CAANPmLA0QUAAAAAAAAABSXdSUYQABKizzRhQAAAAAAAAAFPb5U4BAAE2ENk49lAAAAAAAAAc+n0yke1qkAAAA96Ol0p9CgAAAAAAAAfYE7wZ6FcVKeAPvz6TLKHbkgKAAAAAAAAA8dMsSqz4QAAACbeZb0bBz6KAAAAAAABwyl7RIAAAAABoLLO6JQAAAP//EACYQAAICAQIEBwEAAAAAAAAAAAIDAQRAADAFEhMgEBEhIjEyNHD/2gAIAQEAAQUC/h/MOo9cxjBULbbC1MzPiuy1ekPF2SZQAMOWH3Vm9ZePxEvb30C8rOPxH7d9X9OPxH6d9H9WPxGdilPlaxpmBh7Oq3v+JS2HBiMmRW1xu2gMgKq0nBiW63LtV0E6YiBjFdWWzR1WjqYmOyPWQrNLSqYDkGQhDbujMjnx+NKuGOluWzGMhWDLhTqfWdhVli9IcLsSy3qt2xmRJZ9ReC8uRO7QLzTg8QL2btI+Ruz/AP/EABQRAQAAAAAAAAAAAAAAAAAAAHD/2gAIAQMBAT8BIP/EABQRAQAAAAAAAAAAAAAAAAAAAHD/2gAIAQIBAT8BIP/EAC4QAAEBBQUHAwUAAAAAAAAAAAECABEhMEADEiJBUSAjMTJSYXEQkaFCcIGC4f/aAAgBAQAGPwL7H86fdoEVl5Z/rYMA+WiSfXmeNFNDCvpqSpXANeVtQ4s88w41FmnWMgDqDqiz8SLPzUWfmQnwaizT+ZCO8KclRckMV+0iHFrw45jSlUpIeRk2Mw0Eq8guLFSwBlDOlK7MYcxpKfwRmWASHAUzxgV2aAvDs0QRsQbld5beYzplUPWoJbcp/Ys9aio99iDbzGPlsKo6GmvLLg27F0fLPMTJc+8nQthgrpNI/wCkQEwKSXEMletEtXacU9Joko7vnOyVCV//xAAnEAEAAQMDAwQDAQEAAAAAAAABEQAhMUBBUTBhcSCBkfCh0fFwwf/aAAgBAQABPyH/AA5IzbzX83UMh4axq7URsGfClU9nf5UjLHK1BxRbFqxHuwoaO4X/ADnU4duXv2p893bg49QoikGErxp/vqIi4S+hwQi1GftLoFY9QN/cR0Dc4T8ai3vXfQGbiWnEUuFaRogbDg6AoKgMjWAw95pY3PnupwbDFoOkTSe5UFmYOkBhkpFLO4/dulnA/wCJURRQGlGMUo+Qwfar6HN+tOwxwkegIAVdiuH+bauC+BTYCwYDbTwpHfPxWx9Hiu44fQFQpEwlWLy2w96228NrGdK4iP57FT53JvRMy8j0YT6TvQ7cN3J5OdGXaRJbLwdSUApGgAtGY4dFy8QPL1vsSOihJlk619YPlt0v/9oADAMBAAIAAwAAABDzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzwdPzzzzzzzzzzzzx/8A/wC9PPPPPPPPPPPP/wD/AP08888888888m//AP79PPPPPPPPPKE//wD/AL78888888888Y//AK0/PPPPPPPPPJL/AP8A/vr088888888n/8A/wD/AP8A3PPPPP/EABcRAQADAAAAAAAAAAAAAAAAABEAUGD/2gAIAQMBAT8Qp2O4/8QAGBEAAwEBAAAAAAAAAAAAAAAAARFQAED/2gAIAQIBAT8QjrKaOU1v/8QAJxABAAECBQIHAQEAAAAAAAAAAREAITFAQVFhMHEggZGhscHR8WD/2gAIAQEAAT8Q/wBe54uwY0hlh5BSDCDs/pS1JwiaRUIjzm7xPYktsPvCocXwLzv+KYsOKlrgelXBSjBGKgiK/tYlRbQJTMm70cY5lj0gBitBytT+LRo0hx4maLKIR3KmIBw99j3+cwiKwPax0Ek4nLtI+pRlyiC4x5noAhVvtsDNOLlyU4GdhJ6E2qIoYZcg7omxget+hIGEXzGPerlnEyw1l0YPt2KchGbp4H30GGBA0S40WhhGv+Lo5U4kTbADHDYvRScYndRvy9KxmLcNk1KIi33Ba20jjKICQlI3VCyrVDX4UIkjJ0RSkohx+V9ihuQ30Pt5yqIUia0KSt073P2KngjVl9VyuT9pe/gWO0ASrwVfZb78caRGheEh31farAAKAQDYMvt8Gd3bE1DMR0G/l+6auFppY2NjjwOVaUojuNPh6Un6nnUWH/E9HypFIETRyoi3RMSrY1aj3bmPo8qepGKyvQijkAWuMdsRR3BZTBuaMmYCYlxabSkdHud3V6i6oZ4jRGgFDsJ6jkoBbj0A+WggDqz43kDgn5MkKB80gW916xLqt7l69L//2Q==",male:isDark?"data:image/jpeg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wgARCACgAPoDASIAAhEBAxEB/8QAGwABAAMBAQEBAAAAAAAAAAAAAAUGBwECAwT/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/aAAwDAQACEAMQAAABhgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAOSN7IH9k8isRF+GU8ttSoAAAAAAAAAAAC6WOr2iAAGV6Zlx6FAAAAAAAAAADheLBGyUAAfkzTVMqAoAAAAAAAAAACQ0PLLSW4Q7yFIKv87QAAAAAAAAAAACRjZ4vQhSbtUiqudoAAAAAAAAAA7cymzd57ELNAA7wRVdu4yvxq8CUZ78UAAAAAAABZblXrDAAAAAAFYp+h55QAAAAAAAGiSfz+kAAAAAAfLKtazM/IKAAA/8QAKBAAAAUDBAEDBQAAAAAAAAAAAQIDBAURIEAAEhMwIRAkMhQiI0Fw/9oACAEBAAEFAv4b+28QXaaKaiBodPTmOXR15ymLUXayLVBG2cb/AG5MEHtbaV0pTlyIE347XB+JuX45EO2FJK10gDlAQ2myI04KMLTGAha7hyGbw7MUzgonZJv+bLhHFkq6+nbgFAyo0aSPrOj7rLhkDndes4icTANcggGUFGLcH03jW6Vzhg3X0tErk0oQ6Q4fkRaRaZAKAFDpHyDmLRUA5TJnwYJIBV7Z1IBRwYMtGfbKF3x+DGF2x/aqG5Ivx76V0mXYn3Oicbno/8QAFBEBAAAAAAAAAAAAAAAAAAAAcP/aAAgBAwEBPwEg/8QAFBEBAAAAAAAAAAAAAAAAAAAAcP/aAAgBAgEBPwEg/8QAMRAAAgADBQUHAwUAAAAAAAAAAQIAAxESICFAYTAxQVFSBBMiIzJx0RQzQmJwcoHB/9oACAEBAAY/Av2NAGLHACK9pYluld0eEMvs0eGdMHvjFU85NN4jEEe4zRWtmWuLn/IHdylFNx43fqgcVwf2zTniXvUOIiZZAC2jSmZnryYG9MfpWBmTNZvugGzyvNJZiqtvpDKd6mmZkkcBS8WbcBWC3Ua5lrItyziUhXX0sKi68iUKSwaM3Vmz2Zv5J8XLKfdmYL8xTNyP7uSh+jOCdZPdIPUeJuS5yKWUCjU4RhmKSlZzoIrMKyhriYqR3rc3+L1Slh+pMI8llmjkcDFJyMh1GUAUVYmgHOLXafMmcuAiigKNNlQio1gmSO6maboZJi2XXeMlNnH8fCu2Sf8AkhsnUZJm6nO2n6CuSkDSu2deYgZCnOFXkKbeao3Wjsf/xAAoEAEAAQIGAQQBBQAAAAAAAAABEQAhIDFAQVFhgTBxkaHBcLHR8PH/2gAIAQEAAT8h/Q3MuRBzWoha34HU71DF+WqBfOhS23aY94pBZDiB1UzYYOfQ7oCd7SflhlloAnLg6ojfkfBiQURLI71LkRuQJ21M21I8mKU9x80I1A2JqTDAAyfziiQBLNTXQlx1qEkSuUR9JbEg0OT0Uz8hSPvqVwblMX5O6SWQJgLsUm9FN47HBq419rr1vgXI+iN6AAyNXaG6PrBJthP3q1AlYKgWIixJxgdqfPdWKASp0+WddbqmqP4X/YUuPHsPwrjrAMNqfZx2PJk1MNJP+yOs6LkjJowTkUt1CwP8nG9GzjYR6RIlwCaLhFZz/cqWso/IdaIGZSdS5+sNIAJybfOi5kZ8W9YxJNn4vRcnQZFWohZvPrdtZ9VMBzCHQeyyUAGReuPLRDyz6P8A/9oADAMBAAIAAwAAABDzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzzz55Tzzzzzzzzzzzxb757zzzzzzzzzzyxb777zzzzzzzzzzzzz67Tzzzzzzzzzzzzz77TzzzzzzzzzyQb7666LTzzzzzzzzb777777Dzzzzzzyh7777777rzzzz/xAAUEQEAAAAAAAAAAAAAAAAAAABw/9oACAEDAQE/ECD/xAAYEQACAwAAAAAAAAAAAAAAAAABQBEgUP/aAAgBAgEBPxDZCAzJrKIQFf/EACcQAQABAwMDBAMBAQAAAAAAAAERACExQEFRIGFxMIGRsaHB4WDw/9oACAEBAAE/EP8AXomRNcK6HZXYArIfD5HZLvXnB8PmaVDl32FT8Iz+8E7lI9318STqo4AbDfYrnYoN43YtlXdXnoLXLNAEiNKpwPCLfka8MnbUjcBR5AD76ginDyDcSknFjDqA7NS74yxzm+uo0wQ8sTCx8pTAcxL5bv3qEIsBLRdbcQLCu6PjqWlNjkDIX7h8U8ohcFUSajvIJTBzCbm5D8Hz1BQabAEtPNl/CS6lr63QgZ9oZ2aIqWnCT/OgIDKxQ6zF8kYOXO7GqKZwQKd34m556GhBOXaveD81MjBBOrRO4+49F1cL8oHVshBusUgyiSFpE8wZcdCzJYyEygvE5dqgwHI6dQKgDKsFXybEoD3cFSsHKWfCw12dfY9v2TS2GAQAQBwG3QgKRNyoTA5h5/QXpgef8GFq9YohIfAs0iAcgyaM2/s2uD+7U1q3X8T8i5oMVQHAe3pL3chIPhqZI0S5sY48U+aYdzsm6yOiNKgHvH5iD1jC3aC4PZBPenOhKARI82D69YAmyphYH8UoOROgWRcBNT4ByOVM+tjRy/dUPs2BZ0DGldybTajHAIFiwHrvr7FCQ9pj0f/Z":"data:image/jpeg;base64,/9j/2wBDAAYEBQYFBAYGBQYHBwYIChAKCgkJChQODwwQFxQYGBcUFhYaHSUfGhsjHBYWICwgIyYnKSopGR8tMC0oMCUoKSj/2wBDAQcHBwoIChMKChMoGhYaKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCj/wgARCACgAPoDASIAAhEBAxEB/8QAGQABAQEBAQEAAAAAAAAAAAAAAAUGBAED/8QAFQEBAQAAAAAAAAAAAAAAAAAAAAH/2gAMAwEAAhADEAAAAd6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA+MAo80olzrzA2fkO4oAAAAAAAAAAAEOTYjoAB7q8nsT0KAAAAAAAAAABEkdfIgAH11eO1p9goAAAAAAAAAAHDnNjESQAfY7dB4UAAAAAAAAAAABzdPIZgIsxrJZCgAAAAAAAAACWVfhneRLcn5gB74KtPLjZ+ZOmtkAAAAAAAAE7PVJaAAAAAAVL2S1y+AAAAAAAHpmeL7fFAAAAAAGxx2pOkKAAB//xAAmEAABAwIFBAMBAAAAAAAAAAADAQIEAEAFERIgMBAhIjETIzNw/9oACAEBAAEFAv4cWY1qpOfSTm0KQMt2YiCY+SV+2AXJ1ziK+e30oVVwbjEU8tyJklxPe124ao0jXa23EpMpO4KaQ3EmP81KmS7IsdX3c8fl1CNSk9JdSe8frh15LXTG64ct08jB0SbRHuI7qnZRzXJQzifbGmIxSHKTiGUg6HNr2ljOIrB8sAml9jiC/dyiXSWxmLnJ5k7pYG/XmjrmDg//xAAUEQEAAAAAAAAAAAAAAAAAAABw/9oACAEDAQE/ASD/xAAUEQEAAAAAAAAAAAAAAAAAAABw/9oACAECAQE/ASD/xAAsEAABAQQIBgIDAAAAAAAAAAABAgARIUADEiAwMUFRYRMiI3GBsTIzQnCR/9oACAEBAAY/Av0c6jFffJooS0aM/wBZwNU6GbrK8DVjFwOQs8NX5YGaQNrTxiyFLioiZo1bOtgaQmQgfJONpKlB4EXMFDAzNJ3toB0mQUwX7Yg4iyla/r9zfFGcDYCB5YAYCbpO1ikM4veFikTnjNc6gNm6afKmesvNh4gW6grb5tBTjoZZ1GKx1ybmXDQXXIshuqnylgQXg5yQSnFXq+4Z+KvckkaC+QdDJL2hfgyK+9+jtc//xAAlEAEAAQMEAgICAwAAAAAAAAABEQAhMSBAQWFRcTCRgfBwoeH/2gAIAQEAAT8h/g5lNHNj8KkX51apFl6o9I9LNImd0vmeA5VGYmiDTKTXTNz43TeON+9QoIguJxT4XBYjc+9LUibGW1dHjcnpi70NTsE2OaLDmTcsB7amlyYO5vEDa+BTGoSHS7CMg5/zSy7qMDb7vnRYEnLwctAAYKA63Zhe2g/1G8ui2LvQU9DcgnFZ5PyaDH7nipZ+7jQkEQwlWoz4WpZR9DSJtM01MWX+pqyIeifF9BWSnmDj9rUIBCkGHZKVFlfmLKeDrZJvmD1utOXfgMX8UuwB2BmlLPn88/5IPw//2gAMAwEAAgADAAAAEPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPNNy3PPPPPPPPPPPPN/wD8fzzzzzzzzzzzxf8A/P8APPPPPPPPPPPG/wDsTzzzzzzzzzzzzxf/AM88888888888X//AL22tPPPPPPPPB//AP8A/wD/APjzzzzzzzhf/wD/AP8A/wDX8888/8QAGBEAAwEBAAAAAAAAAAAAAAAAAUBQESD/2gAIAQMBAT8QshATNWCA5//EABgRAAIDAAAAAAAAAAAAAAAAABFQASBg/9oACAECAQE/EMTKwVCb/8QAKBABAAEDAgUEAgMAAAAAAAAAAREAITFAQSBRYXGBMJGhwbHREHDx/9oACAEBAAE/EP6NBWDNS0xDdHRl70XtPNe9Ksrpr81yAjGuxw9qQsTvqgpuTV+T0ObRioSjAO0581ixj+UnNBK14pQmfR/OqVPYydVf8cT4VEIUYShgwWuX5aljYe1M/fFJgSkO7ahNiLZ0I1LmzEiATE7vEcw6yMuHvUkMAnJO2oM0SCLDPJJOJQK8qtOTkdb/AHqZ5e/Ghdk51LyAuScIlgby4OI2lvSIuW+qfFFDtt8j5OBWbs7J/RUcSOWGNXKW3xJwd1jx5+tYbEIE+5bx4OBwIkAboWY99SigK9Knw7sfgKNMp2/U+6gVliVhyDAcC8xlcI96DP8AYC2aVFrZn74+aEFGHDtpAVBdpI/Qm15B+WKGUT9FbNACwXcvoIJCSdaVsPX8DUIzjDCdXd4qfphZDmaJmE8TcGTzMUAEBY9W6NMlfa740XRF+VfWtaOWxmjBddC89kQPB60sBlT7Vd6b7zkHQQBOJvSRxWWMZ9ZvRFM+TCn69H//2Q=="},measure:{padding:40,genderBand:{width:2.6},marker:{scale:.4,width:22,margin:5},node:{margin:9,padding:10,height:81,width:312}}},bino=(!function(){const v="object"==typeof globalThis&&globalThis||"object"==typeof global&&global.global===global&&global||"object"==typeof self&&self.self===self&&self||{},Yt=(void 0===v.requestAnimationFrame&&(void 0===v.setImmediate?v.requestAnimationFrame=t=>v.setTimeout(t,0):v.requestAnimationFrame=v.setImmediate),{boundsInfoEnabled:!1,drawLocationsEnabled:!1,drawClipEnabled:!1,drawLinkpointsEnabled:!1,nodeInspector:!1,handleMessages:!1,drawFrames:!1,defaultDiagram:null,trace:function(t){v.console&&v.console.log(t)},drawDiagramBounds(t,e,i,s){t.strokeStyle="red",t.fillStyle="red",t.font="8px sans-serif",t.beginPath(),t.moveTo(-10,0),t.lineTo(10,0),t.moveTo(0,-10),t.lineTo(0,10),t.stroke(),t.setTransform(1,0,0,1,0,0),t.scale(i,i),t.transform(e.m11,e.m12,e.m21,e.m22,e.dx,e.dy),t.lineWidth=2,t.beginPath(),t.moveTo(s.left,s.top+20),t.lineTo(s.left,s.top),t.lineTo(s.left+20,s.top),t.moveTo(s.right,s.bottom-20),t.lineTo(s.right,s.bottom),t.lineTo(s.right-20,s.bottom),t.stroke(),t.fillText("DB: "+Math.round(s.x)+", "+Math.round(s.y)+", "+Math.round(s.width)+", "+Math.round(s.height),s.left,s.top-5)},attachReadonlyWarnings:function(t){for(const n in t)if("licenseKey"!==n){var i=t[n];if(void 0!==i.prototype){const r=Object.getOwnPropertyNames(i.prototype);for(let e=0;e<r.length;e++){var s=Object.getOwnPropertyDescriptor(i.prototype,r[e]);void 0!==s.get&&void 0===s.set&&Object.defineProperty(i.prototype,r[e],{set:function(t){throw new Error("Property "+r[e]+" of "+n+" is read-only.")}})}}}}});class Xt{static dr=void 0!==v.navigator&&void 0!==v.navigator.platform&&null!==v.navigator.platform.match(/(iPhone|iPod|iPad|Mac)/i);static Rk(i,s,n){let r=-1;return function(){const t=this,e=arguments;-1!==r&&Xt.Gg(r),r=Xt.Xh(()=>{r=-1,n||i.apply(t,e)},s),n&&!r&&i.apply(t,e)}}static Xh(t,e){return v.setTimeout(t,e)}static Gg(t){v.clearTimeout(t)}static hn(t){return v.document.createElement(t)}static n(t){throw new Error(t)}static O(t,e){let i="The object is frozen, so its properties cannot be set: "+t.toString();void 0!==e&&(i+="  to value: "+e),Xt.n(i)}static s(e,i,s,n){if(!(e instanceof i)){let t=Xt.hu(s);void 0!==n&&(t+="."+n),Xt.Bi(e,i,t)}}static t(e,i,s,n){if(typeof e!==i){let t=Xt.hu(s);void 0!==n&&(t+="."+n),Xt.Bi(e,i,t)}}static r(e,i,s){if("number"!=typeof e||!isFinite(e)){let t=Xt.hu(i);void 0!==s&&(t+="."+s),Xt.n(t+" must be a real number type, and not NaN or Infinity: "+e)}}static it(t,e,i){t in e||Xt.n(t+" is not a valid value in enumeration: "+i)}static Bi(t,e,i,s){e=" value is not an instance of "+Xt.hu(e)+": ";let n=Xt.hu(i);void 0!==s&&(n+="."+s),"string"==typeof t&&(t='"'+t+'"'),Xt.n(n+e+t)}static G(t,e,i,s){let n=Xt.hu(i);void 0!==s&&(n+="."+s),Xt.n(n+" is not in the range "+e+": "+t)}static Ke(t){Xt.n("Collection was modified during iteration: "+t.toString()+`
  Perhaps you should iterate over a copy of the collection,
  or you could collect items to be removed from the collection after the iteration.`)}static gr(t,e){Xt.n("No property to set for this enum value: "+e+" on "+t.toString())}static ft(t){v.console&&v.console.log(t)}static Mt(t){return"object"==typeof t&&null!==t}static Hg(t,e,i){Array.isArray(t)||Xt.Bi(t,"Array",e,i)}static au(t,e,i){Array.isArray(t)?e>=t.length?t.push(i):t.splice(e,0,i):Xt.n("Cannot insert an object into an HTMLCollection or NodeList: "+i+" at "+e)}static rf(t,e){Array.isArray(t)?e>=t.length?t.pop():t.splice(e,1):Xt.n("Cannot remove an object from an HTMLCollection or NodeList at "+e)}static Ik=[];static ct(){var t=Xt.Ik.pop();return void 0===t?[]:t}static ot(t){t.length=0,Xt.Ik.push(t)}static tE=Object.freeze([]);static hu(t){return null===t?"*":"string"==typeof t?t:"function"==typeof t?t.name:""}static an(t){return"function"==typeof t?t.className||t.name:Xt.Mt(t)&&t.constructor?Xt.an(t.constructor):typeof t}static Yh(t,e){return null!=e&&""!==e&&(Xt.Mt(t)&&e in t||t[e])?t[e]:null}static toString(t){let e=t;return Xt.Mt(t)&&(t.text?e=t.text:t.name?e=t.name:void 0!==t.key?e=t.key:void 0!==t.id?e=t.id:t.constructor===Object&&(t.Text?e=t.Text:t.Name?e=t.Name:void 0!==t.Key?e=t.Key:void 0!==t.Id?e=t.Id:void 0!==t.ID&&(e=t.ID))),void 0===e?"undefined":null===e?"null":e.toString()}static yw(t,e){if(t.hasOwnProperty(e))return!0;let i=Object.getPrototypeOf(t);for(;i&&i!==Function;){if(i.hasOwnProperty(e))return!0;var s=i.iE;if(s&&s[e])return!0;i=Object.getPrototypeOf(i)}return!1}static DD(e){var i=[];let s=0;for(s=0;s<256;s++)i[s]=s;let n=0,r=0;for(s=0;s<256;s++)n=(n+i[s]+119)%256,r=i[s],i[s]=i[n],i[n]=r;s=0;let a="";for(let t=n=0;t<e.length;t++)s=(s+1)%256,n=(n+i[s])%256,r=i[s],i[s]=i[n],i[n]=r,a+=String.fromCharCode(e.charCodeAt(t)^i[(i[s]+i[n])%256]);return"GoJS 2.3 evaluation"==a||"(c) 1998-2023 Northwoods Software"==a||"Not for distribution or production use"==a||"gojs.net"==a?"":a}static FD(e){var i="0123456789abcdef",s=[];for(let t=0;t<256;t++)s[i.charAt(t>>4)+i.charAt(15&t)]=String.fromCharCode(t);e.length%2&&(e="0"+e);var n=[];let r=0;for(let t=0;t<e.length;t+=2)n[r++]=s[e.substring(t,t+2)];var t=n.join("");return""===t?"0":t}static Os(t){return Xt.DD(Xt.FD(t))}static color1="@COLOR1";static color2="@COLOR2";static ww="32ab5ff3b26f42dc0ed90f21402913b5"}Xt.vfo="29e646fdb1";class a{Ok;constructor(){this.Ok=[]}toString(){return this.Ok.join("")}add(t){""!==t&&this.Ok.push(t)}}class h{}class o{k;constructor(){this.k=[]}[Symbol.iterator](){return this.k.values()}key;value;get iterator(){return this}reset(){}next(){return!1}hasNext(){return!1}first(){return null}any(){return!1}all(){return!0}each(){return this}map(t){return this}filter(){return this}get count(){return 0}kl(){}toString(){return"EmptyIterator"}static instance=new o}class l{constructor(t){this.key=-1,this.value=t}[Symbol.iterator](){return[this.value].values()}key;value;get iterator(){return this}reset(){this.key=-1}next(){return-1===this.key&&!(this.key=0)}hasNext(){return this.next()}first(){return this.key=0,this.value}any(t){return this.key=-1,t(this.value)}all(t){return this.key=-1,t(this.value)}each(t){return this.key=-1,t(this.value),this}map(t){return new l(t(this.value))}filter(t){return t(this.value)?new l(this.value):o.instance}get count(){return 1}kl(){this.value=null}toString(){return"SingletonIterator("+this.value+")"}}class u{Qt;Es;jt;Vt;constructor(t){this.Qt=t,this.Es=null,t.mr=null,this.jt=t.mt,this.Vt=-1}[Symbol.iterator](){return(null===this.Es?this.Qt.h:this.Qt.h.filter(this.Es)).values()}key;value;get iterator(){return this}get predicate(){return this.Es}set predicate(t){this.Es=t}reset(){var t=this.Qt;t.mr=null,this.jt=t.mt,this.Vt=-1}next(){var t=this.Qt;if(t.mt!==this.jt){if(this.key<0)return!1;Xt.Ke(t)}var e=t.h,i=e.length;let s=++this.Vt;var n=this.Es;if(null!==n)for(;s<i;){var r=e[s];if(n(r))return this.Vt=s,this.key=s,this.value=r,!0;s++}else{if(s<i)return this.key=s,this.value=e[s],!0;this.kl()}return!1}hasNext(){return this.next()}first(){var t=this.Qt,e=(this.jt=t.mt,this.Vt=0,t.h),i=e.length,s=this.Es;if(null===s)return 0<i?(t=e[0],this.key=0,this.value=t):null;{let t=0;for(;t<i;){var n=e[t];if(s(n))return this.Vt=t,this.key=t,this.value=n;t++}return null}}any(e){var i=this.Qt,s=(i.mr=null,i.mt),n=(this.Vt=-1,i.h),r=n.length,a=this.Es;for(let t=0;t<r;t++){var o=n[t];if(null===a||a(o)){if(e(o))return!0;i.mt!==s&&Xt.Ke(i)}}return!1}all(e){var i=this.Qt,s=(i.mr=null,i.mt),n=(this.Vt=-1,i.h),r=n.length,a=this.Es;for(let t=0;t<r;t++){var o=n[t];if(null===a||a(o)){if(!e(o))return!1;i.mt!==s&&Xt.Ke(i)}}return!0}each(e){var i=this.Qt,s=(i.mr=null,i.mt),n=(this.Vt=-1,i.h),r=n.length,a=this.Es;for(let t=0;t<r;t++){var o=n[t];null!==a&&!a(o)||(e(o),i.mt!==s&&Xt.Ke(i))}return this}map(e){var i=this.Qt,s=(i.mr=null,i.mt),n=(this.Vt=-1,[]),r=i.h,a=r.length,o=this.Es;for(let t=0;t<a;t++){var h=r[t];null!==o&&!o(h)||(n.push(e(h)),i.mt!==s&&Xt.Ke(i))}var t=new O;return t.h=n,t.Ue(),t.iterator}filter(e){var i=this.Qt,s=(i.mr=null,i.mt),n=(this.Vt=-1,[]),r=i.h,a=r.length,o=this.Es;for(let t=0;t<a;t++){var h=r[t];null!==o&&!o(h)||(e(h)&&n.push(h),i.mt!==s&&Xt.Ke(i))}var t=new O;return t.h=n,t.Ue(),t.iterator}get count(){var i=this.Es;if(null===i)return this.Qt.h.length;{let e=0;var s=this.Qt.h,n=s.length;for(let t=0;t<n;t++)i(s[t])&&e++;return e}}kl(){this.key=-1,this.value=null,this.jt=-1,this.Es=null,this.Qt.mr=this}toString(){return"ListIterator@"+this.Vt+"/"+this.Qt.count}}class c{Qt;jt;Vt;constructor(t){(this.Qt=t).pr=null,this.jt=t.mt,this.Vt=t.h.length}[Symbol.iterator](){return this.Qt.h.reverse().values()}key;value;get iterator(){return this}reset(){var t=this.Qt;t.pr=null,this.jt=t.mt,this.Vt=t.h.length}next(){var t=this.Qt;if(t.mt!==this.jt){if(this.key<0)return!1;Xt.Ke(t)}var e=--this.Vt;return 0<=e?(this.key=e,this.value=t.h[e],!0):(this.kl(),!1)}hasNext(){return this.next()}first(){var t=this.Qt,t=(this.jt=t.mt,t.h),e=t.length-1;return 0<=(this.Vt=e)?(t=t[e],this.key=e,this.value=t):null}any(e){var i=this.Qt,s=(i.pr=null,i.mt),n=i.h,r=n.length;for(let t=(this.Vt=r)-1;0<=t;t--){if(e(n[t]))return!0;i.mt!==s&&Xt.Ke(i)}return!1}all(e){var i=this.Qt,s=(i.pr=null,i.mt),n=i.h,r=n.length;for(let t=(this.Vt=r)-1;0<=t;t--){if(!e(n[t]))return!1;i.mt!==s&&Xt.Ke(i)}return!0}each(e){var i=this.Qt,s=(i.pr=null,i.mt),n=i.h,r=n.length;for(let t=(this.Vt=r)-1;0<=t;t--)e(n[t]),i.mt!==s&&Xt.Ke(i);return this}map(e){var i=this.Qt,s=(i.pr=null,i.mt),n=[],r=i.h,a=r.length;for(let t=(this.Vt=a)-1;0<=t;t--){var o=r[t];n.push(e(o)),i.mt!==s&&Xt.Ke(i)}a=new O;return a.h=n,a.Ue(),a.iterator}filter(e){var i=this.Qt,s=(i.pr=null,i.mt),n=[],r=i.h,a=r.length;for(let t=(this.Vt=a)-1;0<=t;t--){var o=r[t];e(o)&&n.push(o),i.mt!==s&&Xt.Ke(i)}a=new O;return a.h=n,a.Ue(),a.iterator}get count(){return this.Qt.h.length}kl(){this.key=-1,this.value=null,this.jt=-1,this.Qt.pr=this}toString(){return"ListIteratorBackwards("+this.Vt+"/"+this.Qt.count+")"}}class O{f;h;mt;mr;pr;constructor(t){C.ji(this),this.f=!1,this.h=[],this.mt=0,this.mr=null,this.pr=null,void 0!==t&&this.addAll(t)}[Symbol.iterator](){return this.h.values()}Ue(){let t=this.mt;999999999<++t&&(t=0),this.mt=t}w(){return this.f=!0,this}ut(){return this.f=!1,this}toString(){return"List()#"+C.ps(this)}add(t){return this.f&&Xt.O(this,t),this.h.push(t),this.Ue(),this}push(t){this.add(t)}addAll(e){if(null!==e){this.f&&Xt.O(this);var i=this.h;if(Array.isArray(e)){var s=e.length;for(let t=0;t<s;t++){var n=e[t];i.push(n)}}else for(var t=e.iterator;t.next();){var r=t.value;i.push(r)}this.Ue()}return this}clear(){this.f&&Xt.O(this),this.h.length=0,this.Ue()}contains(t){return null!==t&&-1!==this.h.indexOf(t)}has(t){return this.contains(t)}indexOf(t){return null===t?-1:this.h.indexOf(t)}elt(t){Yt,Xt.r(t,O,"elt:i");var e=this.h;return(t<0||t>=e.length)&&Xt.G(t,"0 <= i < length",O,"elt:i"),e[t]}get(t){return this.elt(t)}setElt(t,e){Yt,Xt.r(t,O,"setElt:i");var i=this.h;(t<0||t>=i.length)&&Xt.G(t,"0 <= i < length",O,"setElt:i"),this.f&&Xt.O(this,t),i[t]=e}set(t,e){this.setElt(t,e)}first(){var t=this.h;return 0===t.length?null:t[0]}last(){var t=this.h,e=t.length;return 0<e?t[e-1]:null}pop(){this.f&&Xt.O(this);var t=this.h;return 0<t.length?t.pop():null}any(e){var i=this.h,s=this.mt,n=i.length;for(let t=0;t<n;t++){if(e(i[t]))return!0;this.mt!==s&&Xt.Ke(this)}return!1}all(e){var i=this.h,s=this.mt,n=i.length;for(let t=0;t<n;t++){if(!e(i[t]))return!1;this.mt!==s&&Xt.Ke(this)}return!0}each(e){var i=this.h,s=this.mt,n=i.length;for(let t=0;t<n;t++)e(i[t]),this.mt!==s&&Xt.Ke(this);return this}map(e){var t=new O,i=[],s=this.h,n=this.mt,r=s.length;for(let t=0;t<r;t++)i.push(e(s[t])),this.mt!==n&&Xt.Ke(this);return t.h=i,t.Ue(),t}filter(e){var t=new O,i=[],s=this.h,n=this.mt,r=s.length;for(let t=0;t<r;t++){var a=s[t];e(a)&&i.push(a),this.mt!==n&&Xt.Ke(this)}return t.h=i,t.Ue(),t}insertAt(t,e){Yt,Xt.r(t,O,"insertAt:i"),t<0&&Xt.G(t,">= 0",O,"insertAt:i"),this.f&&Xt.O(this,t);var i=this.h;t>=i.length?i.push(e):i.splice(t,0,e),this.Ue()}remove(t){if(null===t)return!1;this.f&&Xt.O(this,t);var e=this.h,t=e.indexOf(t);return-1!==t&&(t===e.length-1?e.pop():e.splice(t,1),this.Ue(),!0)}delete(t){return this.remove(t)}removeAt(t){Yt,Xt.r(t,O,"removeAt:i");var e=this.h;(t<0||t>=e.length)&&Xt.G(t,"0 <= i < length",O,"removeAt:i"),this.f&&Xt.O(this,t),t===e.length-1?e.pop():e.splice(t,1),this.Ue()}removeRange(i,s){Yt,Xt.r(i,O,"removeRange:from"),Xt.r(s,O,"removeRange:to");var n=this.h,r=n.length;if(i<0)i=0;else if(r<=i)return this;if(!(s<0||(s=r<=s?r-1:s)<i)){this.f&&Xt.O(this);let t=i,e=s+1;for(;e<r;)n[t++]=n[e++];n.length=r-(s-i+1),this.Ue()}return this}copy(){var t=new O,e=this.h;return 0<e.length&&(t.h=Array.prototype.slice.call(e)),t}toArray(){var e=this.h,i=this.count,s=new Array(i);for(let t=0;t<i;t++)s[t]=e[t];return s}get _N(){return this.h}toSet(){var e=new C,i=this.h,s=this.count;for(let t=0;t<s;t++)e.add(i[t]);return e}sort(t){return Yt,Xt.t(t,"function",O,"sort:sortfunc"),this.f&&Xt.O(this),this.h.sort(t),this.Ue(),this}sortRange(t,e,i){var s,n=this.h,r=n.length,a=(void 0===e&&(e=0),void 0===i&&(i=r),Yt,Xt.t(t,"function",O,"sortRange:sortfunc"),Xt.r(e,O,"sortRange:from"),Xt.r(i,O,"sortRange:to"),this.f&&Xt.O(this),i-e);if(!(a<=1))if((e<0||r-1<=e)&&Xt.G(e,"0 <= from < length",O,"sortRange:from"),2==a)0<t(a=n[e],s=n[e+1])&&(n[e]=s,n[e+1]=a,this.Ue());else{if(0===e)if(r<=i)n.sort(t);else{var o=n.slice(0,i);o.sort(t);for(let t=0;t<i;t++)n[t]=o[t]}else if(r<=i){var h=n.slice(e);h.sort(t);for(let t=e;t<r;t++)n[t]=h[t-e]}else{var l=n.slice(e,i);l.sort(t);for(let t=e;t<i;t++)n[t]=l[t-e]}this.Ue()}return this}reverse(){return this.f&&Xt.O(this),this.h.reverse(),this.Ue(),this}get count(){return this.h.length}get size(){return this.h.length}get length(){return this.h.length}get iterator(){var t;return this.h.length<=0?o.instance:null!==(t=this.mr)?(t.reset(),t):new u(this)}get iteratorBackwards(){var t;return this.h.length<=0?o.instance:null!==(t=this.pr)?(t.reset(),t):new c(this)}}class g{Lo;ri;constructor(t){this.Lo=t,this.ri=t.k.values()}[Symbol.iterator](){return this.Lo.k.values()}key;value;get iterator(){return this}reset(){var t=this.Lo;this.ri=t.k.values()}next(){var t=this.ri.next();return this.value=t.value,this.key=t.value,!t.done}hasNext(){return this.next()}first(){return 0===this.Lo.k.size?null:(this.ri=this.Lo.k.values(),this.ri.next().value)}any(t){return this.Lo.any(t)}all(t){return this.Lo.all(t)}each(t){return this.Lo.each(t),this}map(e){const i=new O;return this.Lo.k.forEach(t=>i.add(e(t))),i.iterator}filter(e){const i=new O;return this.Lo.k.forEach(t=>{e(t)&&i.add(t)}),i.iterator}get count(){return this.Lo.count}kl(){this.key=null,this.value=null,this.ri=null}toString(){return"SetIterator"}}class C{f;k;constructor(t){this.f=!1,this.k=new Set,void 0!==t&&this.addAll(t)}[Symbol.iterator](){return this.k.values()}values(){return this.k.values()}w(){return this.f=!0,this}ut(){return this.f=!1,this}toString(){return"Set()#"+C.ps(this)}add(t){return null===t||this.k.add(t),this}addAll(e){if(null!==e)if(Array.isArray(e)){var i=e.length;for(let t=0;t<i;t++){var s=e[t];null!==s&&this.k.add(s)}}else for(var t=e.iterator;t.next();){var n=t.value;null!==n&&this.k.add(n)}return this}has(t){return this.k.has(t)}contains(t){return this.has(t)}containsAll(t){if(null!==t)for(var e=t.iterator;e.next();)if(!this.has(e.value))return!1;return!0}containsAny(t){if(null===t)return!0;for(var e=t.iterator;e.next();)if(this.has(e.value))return!0;return!1}first(){return 0===this.k.size?null:this.k.values().next().value}any(t){for(const e of this.k)if(t(e))return!0;return!1}all(t){for(const e of this.k)if(!t(e))return!1;return!0}each(t){for(const e of this.k)t(e);return this}map(t){var e=new C;for(const i of this.k)e.add(t(i));return e}filter(t){var e=new C;for(const i of this.k)t(i)&&e.add(i);return e}delete(t){return this.f&&Xt.O(this),this.k.delete(t)}remove(t){return this.delete(t)}removeAll(e){if(null!==e)if(this.f&&Xt.O(this),Array.isArray(e)){var i=e.length;for(let t=0;t<i;t++)this.delete(e[t])}else for(var t=e.iterator;t.next();)this.delete(t.value);return this}retainAll(t){if(null!==t&&0!==this.count){this.f&&Xt.O(this);for(var e=new C,i=(e.addAll(t),[]),s=this.iterator;s.next();){var n=s.value;e.contains(n)||i.push(n)}this.removeAll(i)}return this}clear(){this.f&&Xt.O(this),this.k.clear()}copy(){const e=new C;return this.k.forEach(t=>e.add(t)),e}toArray(){return Array.from(this.k)}toList(){const e=new O;return this.k.forEach(t=>e.add(t)),e}get count(){return this.k.size}get size(){return this.k.size}get iterator(){return this.k.size<=0?o.instance:new g(this)}entries(){return this.k.entries()}keys(){return this.k.keys()}forEach(t,e){return this.k.forEach(t,e)}static fu=1;static ji(t){t.__gohashid=C.fu++}static ps(t){return t.__gohashid}}class f{et;ri;constructor(t){this.et=t,this.ri=t.k.keys()}[Symbol.iterator](){return this.et.k.keys()}key;value;get iterator(){return this}reset(){var t=this.et;this.ri=t.k.keys()}next(){var t=this.ri.next();return this.value=t.value,this.key=t.value,!t.done}hasNext(){return this.next()}first(){return 0===this.et.k.size?null:(this.ri=this.et.k.keys(),this.ri.next().value)}any(t){for(const e of this.et.k)if(t(e[0]))return!0;return!1}all(t){for(const e of this.et.k)if(!t(e[0]))return!1;return!0}each(t){for(const e of this.et.k)t(e[0]);return this}map(t){var e=this.et,i=new O;for(const s of e.k)i.add(t(s[0]));return i.iterator}filter(t){var e=this.et,i=new O;for(const n of e.k){var s=n[0];t(s)&&i.add(s)}return i.iterator}get count(){return this.et.size}kl(){this.key=null,this.value=null,this.ri=null}toString(){return"MapKeySetIterator"}}class p extends C{et;constructor(t){super(),C.ji(this),this.f=!0,this.et=t}[Symbol.iterator](){return this.k.keys()}values(){return this.k.keys()}w(){return this}ut(){return this}toString(){return"MapKeySet("+this.et.toString()+")"}add(t){Xt.n("This Set is read-only: "+this.toString())}has(t){return this.et.contains(t)}contains(t){return this.has(t)}delete(t){Xt.n("This Set is read-only: "+this.toString())}remove(t){return this.delete(t)}clear(){Xt.n("This Set is read-only: "+this.toString())}first(){return 0===this.et.k.size?null:this.et.k.keys().next().value}any(t){for(const e of this.et.k)if(t(e[0]))return!0;return!1}all(t){for(const e of this.et.k)if(!t(e[0]))return!1;return!0}each(t){for(const e of this.et.k)t(e[0]);return this}map(t){var e=new C;for(const i of this.et.k)e.add(t(i[0]));return e}filter(t){var e=new C;for(const s of this.et.k){var i=s[0];t(i)&&e.add(i)}return e}copy(){return new p(this.et)}toSet(){var t=new C;for(const e of this.et.k)t.add(e[0]);return t}toArray(){var t=this.et.k,e=new Array(t.size);let i=0;for(const s of t)e[i]=s[0],i++;return e}toList(){var t=new O;for(const e of this.et.k)t.add(e[0]);return t}get count(){return this.et.size}get size(){return this.et.size}get iterator(){return this.et.size<=0?o.instance:new f(this.et)}}class A{et;ri;constructor(t){this.et=t,this.ri=t.k.values()}[Symbol.iterator](){return this.et.k.values()}key;value;get iterator(){return this}reset(){var t=this.et;this.ri=t.k.values()}next(){var t=this.ri.next();return this.value=t.value,this.key=t.value,!t.done}hasNext(){return this.next()}first(){return 0===this.et.k.size?null:(this.ri=this.et.k.values(),this.ri.next().value)}any(t){for(const e of this.et.k)if(t(e[1]))return!0;return!1}all(t){for(const e of this.et.k)if(!t(e[1]))return!1;return!0}each(t){for(const e of this.et.k)t(e[1]);return this}map(t){var e=this.et,i=new O;for(const s of e.k)i.add(t(s[1]));return i.iterator}filter(t){var e=this.et,i=new O;for(const n of e.k){var s=n[1];t(s)&&i.add(s)}return i.iterator}get count(){return this.et.size}kl(){this.key=null,this.value=null,this.ri=null}toString(){return"MapValueSetIterator"}}class T{constructor(t,e){this.key=t,this.value=e}toString(){return"{"+this.key+":"+this.value+"}"}key;value}class w{et;ri;constructor(t){this.et=t,this.ri=t.k.entries()}[Symbol.iterator](){return this.et.k.entries()}key;value;get iterator(){return this}reset(){var t=this.et;this.ri=t.k.entries()}next(){var t=this.ri.next();return t.done?(this.key=null,this.value=null,!1):(this.key=t.value[0],this.value=t.value[1],!0)}hasNext(){return this.next()}first(){if(0===this.et.k.size)return null;this.ri=this.et.k.entries();var t=this.ri.next().value;return this.key=t[0],this.value=t[1],new T(t[0],t[1])}any(t){return this.et.any(t)}all(t){return this.et.all(t)}each(t){return this.et.each(t),this}map(i){const s=new O;let n=null;return this.et.k.forEach((t,e)=>{null===n?n=new T(e,t):(n.key=e,n.value=t),s.add(i(n))}),s.iterator}filter(i){const s=new O;let n=null;return this.et.k.forEach((t,e)=>{null===n?n=new T(e,t):(n.key=e,n.value=t),i(n)&&(s.add(n),n=null)}),s.iterator}get count(){return this.et.size}kl(){this.key=null,this.value=null,this.ri=null}toString(){return"MapIterator"}}class L{f;k;constructor(t){C.ji(this),this.f=!1,this.k=new Map,void 0!==t&&this.addAll(t)}[Symbol.iterator](){return this.k.entries()}entries(){return this.k.entries()}w(){return this.f=!0,this}ut(){return this.f=!1,this}toString(){return"Map()#"+C.ps(this)}set(t,e){return this.f&&Xt.O(this,t),this.k.set(t,e),this}add(t,e){return this.set(t,e)}addAll(e){if(null!==e)if(this.f&&Xt.O(this),Array.isArray(e)){var i=e.length;for(let t=0;t<i;t++){var s=e[t];this.set(s.key,s.value)}}else if(e instanceof L)for(var t=e.iterator;t.next();)this.set(t.key,t.value);else for(var n=e.iterator;n.next();){var r=n.value;this.set(r.key,r.value)}return this}first(){var t;return 0===this.k.size?null:(t=this.k.entries().next().value,new T(t[0],t[1]))}any(t){let e=null;for(var[i,s]of this.k)if(null===e?e=new T(i,s):(e.key=i,e.value=s),t(e))return!0;return!1}all(t){let e=null;for(var[i,s]of this.k)if(null===e?e=new T(i,s):(e.key=i,e.value=s),!t(e))return!1;return!0}each(t){let e=null;for(var[i,s]of this.k)null===e?e=new T(i,s):(e.key=i,e.value=s),t(e);return this}map(t){var e,i,s=new L;let n=null;for([e,i]of this.k)null===n?n=new T(e,i):(n.key=e,n.value=i),s.set(e,t(n));return s}filter(t){var e,i,s=new L;let n=null;for([e,i]of this.k)null===n?n=new T(e,i):(n.key=e,n.value=i),t(n)&&s.set(e,i);return s}has(t){return this.k.has(t)}contains(t){return this.has(t)}get(t){t=this.k.get(t);return void 0===t?null:t}getValue(t){return this.get(t)}delete(t){return null!==t&&(this.f&&Xt.O(this,t),this.k.delete(t))}remove(t){return this.delete(t)}clear(){this.f&&Xt.O(this),this.k.clear()}copy(){var t=new L;return t.k=new Map(this.k),t}toArray(){var t=this.k,e=new Array(t.size);let i=0;for(const s of t)e[i]=new T(s[0],s[1]),i++;return e}toKeySet(){return new p(this)}get count(){return this.k.size}get size(){return this.k.size}get iterator(){return this.k.size<=0?o.instance:new w(this)}get iteratorKeys(){return this.count<=0?o.instance:new f(this)}keys(){return this.k.keys()}get iteratorValues(){return this.count<=0?o.instance:new A(this)}values(){return this.k.values()}forEach(t,e){return this.k.forEach(t,e)}}class U{S;P;f;constructor(t,e){void 0===t?(this.S=0,this.P=0):"number"==typeof t&&"number"==typeof e?(this.S=t,this.P=e):Xt.n("Invalid arguments to Point constructor: "+t+", "+e),this.f=!1}c(t){return this.S=t.S,this.P=t.P,this}e(t,e){return this.S=t,this.P=e,this}setTo(t,e){return Yt,Xt.t(t,"number",U,"setTo:x"),Xt.t(e,"number",U,"setTo:y"),this.st(),this.S=t,this.P=e,this}set(t){return Yt,Xt.s(t,U,U,"set:p"),this.st(),this.S=t.S,this.P=t.P,this}copy(){var t=new U;return t.S=this.S,t.P=this.P,t}rt(){return this.f=!0,Object.freeze(this),this}L(){return this.f||Object.isFrozen(this)?this:this.copy().w()}w(){return this.f=!0,this}ut(){return Object.isFrozen(this)&&Xt.n("cannot thaw constant: "+this),this.f=!1,this}st(e){if(Yt,this.f){let t="The Point is frozen, so its properties cannot be set: "+this.toString();void 0!==e&&(t+="  to value: "+e),Xt.n(t)}}static parse(s){if("string"!=typeof s)return new U;{var n=s.split(" ");let t=0,e=0;for(;""===n[t];)t++;s=n[t++];s&&(e=parseFloat(s));let i=0;for(;""===n[t];)t++;return(s=n[t++])&&(i=parseFloat(s)),new U(e,i)}}static stringify(t){return Yt,Xt.s(t,U),t.x.toString()+" "+t.y.toString()}static stringifyFixed(e){return Xt.t(e,"number",U,"stringifyFixed:digits"),t=>t.x.toFixed(e)+" "+t.y.toFixed(e)}toString(){return"Point("+this.x+","+this.y+")"}equals(t){return t instanceof U&&this.S===t.x&&this.P===t.y}equalTo(t,e){return this.S===t&&this.P===e}equalsApprox(t){return I.p(this.S,t.x)&&I.p(this.P,t.y)}add(t){return Yt,Xt.s(t,U,U,"add:p"),this.st(),this.S+=t.x,this.P+=t.y,this}subtract(t){return Yt,Xt.s(t,U,U,"subtract:p"),this.st(),this.S-=t.x,this.P-=t.y,this}offset(t,e){return Yt,Xt.r(t,U,"offset:dx"),Xt.r(e,U,"offset:dy"),this.st(),this.S+=t,this.P+=e,this}rotate(i){if(Yt,Xt.r(i,U,"rotate:angle"),this.st(),0!==i){var s=this.S,n=this.P;if(0!==s||0!==n){let t=0,e=0;360<=i?i-=360:i<0&&(i+=360),e=90===i?(t=0,1):180===i?(t=-1,0):270===i?(t=0,-1):(i=i*Math.PI/180,t=Math.cos(i),Math.sin(i)),this.S=t*s-e*n,this.P=e*s+t*n}}return this}scale(t,e){return Yt,Xt.r(t,U,"scale:sx"),Xt.r(e,U,"scale:sy"),this.st(),this.S*=t,this.P*=e,this}distanceSquaredPoint(t){Yt,Xt.s(t,U,U,"distanceSquaredPoint:p");var e=t.x-this.S,t=t.y-this.P;return e*e+t*t}distanceSquared(t,e){Yt,Xt.r(t,U,"distanceSquared:px"),Xt.r(e,U,"distanceSquared:py");t-=this.S,e-=this.P;return t*t+e*e}normalize(){Yt,this.st();var t=this.S,e=this.P,i=Math.sqrt(t*t+e*e);return 0<i&&(this.S=t/i,this.P=e/i),this}directionPoint(t){return Yt,Xt.s(t,U,U,"directionPoint:p"),this.tC(t.x-this.S,t.y-this.P)}direction(t,e){return Yt,Xt.r(t,U,"direction:px"),Xt.r(e,U,"direction:py"),this.tC(t-this.S,e-this.P)}tC(e,i){if(0===e)return 0<i?90:i<0?270:0;if(0===i)return 0<e?0:180;{if(isNaN(e)||isNaN(i))return 0;let t=180*Math.atan(Math.abs(i/e))/Math.PI;return e<0?i<0?t+=180:t=180-t:i<0&&(t=360-t),t}}static compareWithLineSegment(t,e,i,s,n,r){return Yt,Xt.r(t,U,"compareWithLineSegment:a1x"),Xt.r(e,U,"compareWithLineSegment:a1y"),Xt.r(i,U,"compareWithLineSegment:a2x"),Xt.r(s,U,"compareWithLineSegment:a2y"),Xt.r(n,U,"compareWithLineSegment:b1x"),Xt.r(r,U,"compareWithLineSegment:b1y"),I.cu(t,e,i,s,n,r)}compareWithLineSegmentPoint(t,e){return Yt,Xt.s(t,U,U,"compareWithLineSegmentPoint:p"),Xt.s(e,U,U,"compareWithLineSegmentPoint:q"),I.cu(t.x,t.y,e.x,e.y,this.x,this.y)}static intersectingLineSegments(t,e,i,s,n,r,a,o){return Yt,Xt.r(t,U,"intersectingLineSegments:a1x"),Xt.r(e,U,"intersectingLineSegments:a1y"),Xt.r(i,U,"intersectingLineSegments:a2x"),Xt.r(s,U,"intersectingLineSegments:a2y"),Xt.r(n,U,"intersectingLineSegments:b1x"),Xt.r(r,U,"intersectingLineSegments:b1y"),Xt.r(a,U,"intersectingLineSegments:b2x"),Xt.r(o,U,"intersectingLineSegments:b2y"),I.uu(t,e,i,s,n,r,a,o)}projectOntoLineSegment(t,e,i,s){return Yt,Xt.r(t,U,"projectOntoLineSegment:px"),Xt.r(e,U,"projectOntoLineSegment:py"),Xt.r(i,U,"projectOntoLineSegment:qx"),Xt.r(s,U,"projectOntoLineSegment:qy"),I.Sl(t,e,i,s,this.S,this.P,this),this}projectOntoLineSegmentPoint(t,e){return Yt,Xt.s(t,U,U,"projectOntoLineSegmentPoint:p"),Xt.s(e,U,U,"projectOntoLineSegmentPoint:q"),I.Sl(t.x,t.y,e.x,e.y,this.S,this.P,this),this}snapToGrid(t,e,i,s){return Yt,Xt.r(t,U,"snapToGrid:originx"),Xt.r(e,U,"snapToGrid:originy"),Xt.r(i,U,"snapToGrid:cellwidth"),Xt.r(s,U,"snapToGrid:cellheight"),I.vg(this.S,this.P,t,e,i,s,this),this}snapToGridPoint(t,e){return Yt,Xt.s(t,U,U,"snapToGridPoint:p"),Xt.s(e,qt,U,"snapToGridPoint:q"),I.vg(this.S,this.P,t.x,t.y,e.width,e.height,this),this}setRectSpot(t,e){return Yt,Xt.s(t,Z,U,"setRectSpot:r"),Xt.s(e,J,U,"setRectSpot:spot"),this.st(),this.S=t.x+e.x*t.width+e.offsetX,this.P=t.y+e.y*t.height+e.offsetY,this}setSpot(t,e,i,s,n){return Yt,Xt.r(t,U,"setSpot:x"),Xt.r(e,U,"setSpot:y"),Xt.r(i,U,"setSpot:w"),Xt.r(s,U,"setSpot:h"),(i<0||s<0)&&Xt.n("Point.setSpot:Width and height cannot be negative"),Xt.s(n,J,U,"setSpot:spot"),this.st(),this.S=t+n.x*i+n.offsetX,this.P=e+n.y*s+n.offsetY,this}D(t){return t.Pt(this),this}Ge(t){return t.rs(this),this}static distanceLineSegmentSquared(t,e,i,s,n,r){Yt,Xt.r(t,U,"distanceLineSegmentSquared:px"),Xt.r(e,U,"distanceLineSegmentSquared:py"),Xt.r(i,U,"distanceLineSegmentSquared:ax"),Xt.r(s,U,"distanceLineSegmentSquared:ay"),Xt.r(n,U,"distanceLineSegmentSquared:bx"),Xt.r(r,U,"distanceLineSegmentSquared:by");let a=n-i,o=r-s;var h=a*a+o*o,i=i-t,s=s-e,l=-i*a-s*o;return l<=0||h<=l?(a=n-t,o=r-e,Math.min(i*i+s*s,a*a+o*o)):(l=a*s-o*i)*l/h}static distanceSquared(t,e,i,s){Yt,Xt.r(t,U,"distanceSquared:px"),Xt.r(e,U,"distanceSquared:py"),Xt.r(i,U,"distanceSquared:qx"),Xt.r(s,U,"distanceSquared:qy");i-=t,t=s-e;return i*i+t*t}static direction(e,t,i,s){Yt,Xt.r(e,U,"direction:px"),Xt.r(t,U,"direction:py"),Xt.r(i,U,"direction:qx"),Xt.r(s,U,"direction:qy");i-=e,e=s-t;if(0==i)return 0<e?90:e<0?270:0;if(0==e)return 0<i?0:180;{if(isNaN(i)||isNaN(e))return 0;let t=180*Math.atan(Math.abs(e/i))/Math.PI;return i<0?e<0?t+=180:t=180-t:e<0&&(t=360-t),t}}get x(){return this.S}set x(t){Yt,Xt.t(t,"number",U,"x"),this.st(t),this.S=t}get y(){return this.P}set y(t){Yt,Xt.t(t,"number",U,"y"),this.st(t),this.P=t}isReal(){return isFinite(this.x)&&isFinite(this.y)}static To=new U(0,0).rt();static iC=new U(-1/0,-1/0).rt();static eC=new U(1/0,1/0).rt();static sC=new U(6,6).rt();static Ek=new U(NaN,NaN).rt();static Vk=[];static a(){var t=U.Vk.pop();return void 0===t?new U:t}static H(t,e){var i=U.Vk.pop();return void 0===i?new U(t,e):(i.x=t,i.y=e,i)}static o(t){U.Vk.push(t)}}class qt{J;Z;f;constructor(t,e){void 0===t?(this.J=0,this.Z=0):"number"==typeof t&&(0<=t||isNaN(t))&&"number"==typeof e&&(0<=e||isNaN(e))?(this.J=t,this.Z=e):Xt.n("Invalid arguments to Size constructor: "+t+", "+e),this.f=!1}c(t){return this.J=t.J,this.Z=t.Z,this}e(t,e){return this.J=t,this.Z=e,this}setTo(t,e){return Yt,Xt.t(t,"number",qt,"setTo:w"),Xt.t(e,"number",qt,"setTo:h"),t<0&&Xt.G(t,">= 0",qt,"setTo:w"),e<0&&Xt.G(e,">= 0",qt,"setTo:h"),this.st(),this.J=t,this.Z=e,this}set(t){return Yt,Xt.s(t,qt,qt,"set:s"),this.st(),this.J=t.J,this.Z=t.Z,this}copy(){var t=new qt;return t.J=this.J,t.Z=this.Z,t}rt(){return this.f=!0,Object.freeze(this),this}L(){return this.f||Object.isFrozen(this)?this:this.copy().w()}w(){return this.f=!0,this}ut(){return Object.isFrozen(this)&&Xt.n("cannot thaw constant: "+this),this.f=!1,this}st(e){if(Yt,this.f){let t="The Size is frozen, so its properties cannot be set: "+this.toString();void 0!==e&&(t+="  to value: "+e),Xt.n(t)}}static parse(s){if("string"!=typeof s)return new qt;{var n=s.split(" ");let t=0,e=0;for(;""===n[t];)t++;s=n[t++];s&&(e=parseFloat(s));let i=0;for(;""===n[t];)t++;return(s=n[t++])&&(i=parseFloat(s)),new qt(e,i)}}static stringify(t){return Yt,Xt.s(t,qt),t.width.toString()+" "+t.height.toString()}static stringifyFixed(e){return Xt.t(e,"number",qt,"stringifyFixed:digits"),t=>t.width.toFixed(e)+" "+t.height.toFixed(e)}toString(){return"Size("+this.width+","+this.height+")"}equals(t){return t instanceof qt&&this.J===t.width&&this.Z===t.height}equalTo(t,e){return this.J===t&&this.Z===e}equalsApprox(t){return I.p(this.J,t.width)&&I.p(this.Z,t.height)}inflate(t,e){Yt,Xt.r(t,qt,"inflate:w"),Xt.r(e,qt,"inflate:h");t=this.width+t,this.J=0<=t?t:0,t=this.height+e;return this.Z=0<=t?t:0,this}get width(){return this.J}set width(t){Yt,Xt.t(t,"number",qt,"width"),this.st(t),t<0&&Xt.G(t,">= 0",qt,"width"),this.J=t}get height(){return this.Z}set height(t){Yt,Xt.t(t,"number",qt,"height"),this.st(t),t<0&&Xt.G(t,">= 0",qt,"height"),this.Z=t}isReal(){return isFinite(this.width)&&isFinite(this.height)}static lf=new qt(0,0).rt();static Bk=new qt(1,1).rt();static nC=new qt(6,6).rt();static du=new qt(8,8).rt();static oC=new qt(10,10).rt();static zk=new qt(1/0,1/0).rt();static xw=new qt(NaN,NaN).rt();static rC=[];static a(){var t=qt.rC.pop();return void 0===t?new qt:t}static o(t){qt.rC.push(t)}}class Z{S;P;J;Z;f;constructor(t,e,i,s){var n,r,a,o;void 0===t?(this.S=0,this.P=0,this.J=0,this.Z=0):"number"==typeof t&&"number"==typeof e&&"number"==typeof i&&(0<=i||isNaN(i))&&"number"==typeof s&&(0<=s||isNaN(s))?(this.S=t,this.P=e,this.J=i,this.Z=s):t instanceof U?(n=t.x,r=t.y,e instanceof U?(a=e.x,o=e.y,this.S=Math.min(n,a),this.P=Math.min(r,o),this.J=Math.abs(n-a),this.Z=Math.abs(r-o)):e instanceof qt?(this.S=n,this.P=r,this.J=e.width,this.Z=e.height):Xt.n("Incorrect second argument supplied to Rect constructor "+e)):Xt.n("Invalid arguments to Rect constructor: "+t+", "+e+", "+i+", "+s),this.f=!1}c(t){return this.S=t.S,this.P=t.P,this.J=t.J,this.Z=t.Z,this}e(t,e,i,s){return this.S=t,this.P=e,this.J=i,this.Z=s,this}Do(t,e){return this.J=t,this.Z=e,this}setTo(t,e,i,s){return Yt,Xt.t(t,"number",Z,"setTo:x"),Xt.t(e,"number",Z,"setTo:y"),Xt.t(i,"number",Z,"setTo:w"),Xt.t(s,"number",Z,"setTo:h"),i<0&&Xt.G(i,">= 0",Z,"setTo:w"),s<0&&Xt.G(s,">= 0",Z,"setTo:h"),this.st(),this.S=t,this.P=e,this.J=i,this.Z=s,this}set(t){return Yt,Xt.s(t,Z,Z,"set:r"),this.st(),this.S=t.S,this.P=t.P,this.J=t.J,this.Z=t.Z,this}setPoint(t){return Yt,Xt.s(t,U,Z,"setPoint:p"),this.st(),this.S=t.x,this.P=t.y,this}setSize(t){return Yt,Xt.s(t,qt,Z,"setSize:s"),this.st(),this.J=t.width,this.Z=t.height,this}copy(){var t=new Z;return t.S=this.S,t.P=this.P,t.J=this.J,t.Z=this.Z,t}rt(){return this.f=!0,Object.freeze(this),this}L(){return this.f||Object.isFrozen(this)?this:this.copy().w()}w(){return this.f=!0,this}ut(){return Object.isFrozen(this)&&Xt.n("cannot thaw constant: "+this),this.f=!1,this}st(e){if(Yt,this.f){let t="The Rect is frozen, so its properties cannot be set: "+this.toString();void 0!==e&&(t+="  to value: "+e),Xt.n(t)}}static parse(r){if("string"!=typeof r)return new Z;{var a=r.split(" ");let t=0,e=0;for(;""===a[t];)t++;r=a[t++];r&&(e=parseFloat(r));let i=0;for(;""===a[t];)t++;(r=a[t++])&&(i=parseFloat(r));let s=0;for(;""===a[t];)t++;(r=a[t++])&&(s=parseFloat(r));let n=0;for(;""===a[t];)t++;return(r=a[t++])&&(n=parseFloat(r)),new Z(e,i,s,n)}}static stringify(t){return Yt,Xt.s(t,Z),t.x.toString()+" "+t.y.toString()+" "+t.width.toString()+" "+t.height.toString()}static stringifyFixed(e){return Xt.t(e,"number",Z,"stringifyFixed:digits"),t=>t.x.toFixed(e)+" "+t.y.toFixed(e)+" "+t.width.toFixed(e)+" "+t.height.toFixed(e)}toString(){return"Rect("+this.x+","+this.y+","+this.width+","+this.height+")"}equals(t){return t instanceof Z&&this.S===t.x&&this.P===t.y&&this.J===t.width&&this.Z===t.height}equalTo(t,e,i,s){return this.S===t&&this.P===e&&this.J===i&&this.Z===s}equalsApprox(t){return I.p(this.S,t.x)&&I.p(this.P,t.y)&&I.p(this.J,t.width)&&I.p(this.Z,t.height)}equalsApproxTo(t,e,i,s){return I.p(this.S,t)&&I.p(this.P,e)&&I.p(this.J,i)&&I.p(this.Z,s)}equalsApproxClose(t){return I.q(this.S,t.x)&&I.q(this.P,t.y)&&I.q(this.J,t.width)&&I.q(this.Z,t.height)}containsPoint(t){return Yt,Xt.s(t,U,Z,"containsPoint:p"),this.S<=t.x&&this.S+this.J>=t.x&&this.P<=t.y&&this.P+this.Z>=t.y}containsRect(t){return Yt,Xt.s(t,Z,Z,"containsRect:r"),this.S<=t.x&&t.x+t.width<=this.S+this.J&&this.P<=t.y&&t.y+t.height<=this.P+this.Z}contains(t,e,i,s){return Yt,Xt.r(t,Z,"contains:x"),Xt.r(e,Z,"contains:y"),void 0===i?i=0:Xt.r(i,Z,"contains:w"),void 0===s?s=0:Xt.r(s,Z,"contains:h"),(i<0||s<0)&&Xt.n("Rect.contains:Width and height cannot be negative"),this.S<=t&&t+i<=this.S+this.J&&this.P<=e&&e+s<=this.P+this.Z}offset(t,e){return Yt,Xt.r(t,Z,"offset:dx"),Xt.r(e,Z,"offset:dy"),this.st(),this.S+=t,this.P+=e,this}inflate(t,e){return Yt,Xt.r(t,Z,"inflate:w"),Xt.r(e,Z,"inflate:h"),this.bw(e,t,e,t)}addMargin(t){return Yt,Xt.s(t,E,Z,"addMargin:m"),this.bw(t.top,t.right,t.bottom,t.left)}subtractMargin(t){return Yt,Xt.s(t,E,Z,"subtractMargin:m"),this.bw(-t.top,-t.right,-t.bottom,-t.left)}grow(t,e,i,s){return Yt,Xt.r(t,Z,"grow:t"),Xt.r(e,Z,"grow:r"),Xt.r(i,Z,"grow:b"),Xt.r(s,Z,"grow:l"),this.bw(t,e,i,s)}bw(t,e,i,s){Yt,this.st();var n=this.J,n=(e+s<=-n?(this.S+=n/2,this.J=0):(this.S-=s,this.J+=e+s),this.Z);return t+i<=-n?(this.P+=n/2,this.Z=0):(this.P-=t,this.Z+=t+i),this}intersectRect(t){return Yt,Xt.s(t,Z,Z,"intersectRect:r"),this.lC(t.x,t.y,t.width,t.height)}intersect(t,e,i,s){return(Yt,Xt.r(t,Z,"intersect:x"),Xt.r(e,Z,"intersect:y"),Xt.r(i,Z,"intersect:w"),Xt.r(s,Z,"intersect:h"),i<0||s<0)&&Xt.n("Rect.intersect:Width and height cannot be negative"),this.lC(t,e,i,s)}lC(t,e,i,s){Yt,this.st();var n=Math.max(this.S,t),r=Math.max(this.P,e),t=Math.min(this.S+this.J,t+i),i=Math.min(this.P+this.Z,e+s);return this.S=n,this.P=r,this.J=Math.max(0,t-n),this.Z=Math.max(0,i-r),this}intersectsRect(t){return Yt,Xt.s(t,Z,Z,"intersectsRect:r"),this.intersects(t.x,t.y,t.width,t.height)}intersects(t,e,i,s){(Yt,Xt.r(t,Z,"intersects:x"),Xt.r(e,Z,"intersects:y"),Xt.r(t,Z,"intersects:w"),Xt.r(e,Z,"intersects:h"),i<0||s<0)&&Xt.n("Rect.intersects:Width and height cannot be negative");var n=this.J,r=this.S;return!(n!==1/0&&i!==1/0&&(n+=r,i+=t,isNaN(i)||isNaN(n)||i<r||n<t)||(i=this.Z,r=this.P,i!==1/0&&s!==1/0&&(i+=r,s+=e,isNaN(s)||isNaN(i)||s<r||i<e)))}intersectsRectPlus(t,e){var i=this.J,s=t.width+e+e,n=this.S,r=t.x-e;return i+=n,!((s+=r)<n||i<r||(s=this.Z,n=t.height+e+e,s+=i=this.P,(n+=r=t.y-e)<i)||s<r)}unionPoint(t){return Yt,Xt.s(t,U,Z,"unionPoint:p"),this.unionNoCheck(t.x,t.y,0,0)}unionRect(t){return Yt,Xt.s(t,Z,Z,"unionRect:r"),this.unionNoCheck(t.S,t.P,t.J,t.Z)}union(t,e,i,s){return Yt,Xt.r(t,Z,"union:x"),Xt.r(e,Z,"union:y"),void 0===i?i=0:Xt.r(i,Z,"union:w"),void 0===s?s=0:Xt.r(s,Z,"union:h"),(i<0||s<0)&&Xt.n("Rect.union:Width and height cannot be negative"),this.st(),this.unionNoCheck(t,e,i,s)}unionNoCheck(t,e,i,s){var n=Math.min(this.S,t),r=Math.min(this.P,e),t=Math.max(this.S+this.J,t+i),i=Math.max(this.P+this.Z,e+s);return this.S=n,this.P=r,this.J=t-n,this.Z=i-r,this}setSpot(t,e,i){return Yt,Xt.r(t,Z,"setSpot:x"),Xt.r(e,Z,"setSpot:y"),Xt.s(i,J,Z,"setSpot:spot"),this.st(),this.S=t-i.offsetX-i.x*this.J,this.P=e-i.offsetY-i.y*this.Z,this}static contains(t,e,i,s,n,r,a,o){return Yt,Xt.r(t,Z,"contains:rx"),Xt.r(e,Z,"contains:ry"),Xt.r(i,Z,"contains:rw"),Xt.r(s,Z,"contains:rh"),Xt.r(n,Z,"contains:x"),Xt.r(r,Z,"contains:y"),void 0===a?a=0:Xt.r(a,Z,"contains:w"),void 0===o?o=0:Xt.r(o,Z,"contains:h"),(i<0||s<0||a<0||o<0)&&Xt.n("Rect.contains:Width and height cannot be negative"),t<=n&&n+a<=t+i&&e<=r&&r+o<=e+s}static intersects(t,e,i,s,n,r,a,o){(Yt,Xt.r(t,Z,"intersects:rx"),Xt.r(e,Z,"intersects:ry"),Xt.r(i,Z,"intersects:rw"),Xt.r(s,Z,"intersects:rh"),Xt.r(n,Z,"intersects:x"),Xt.r(r,Z,"intersects:y"),Xt.r(a,Z,"intersects:w"),Xt.r(o,Z,"intersects:h"),i<0||s<0||a<0||o<0)&&Xt.n("Rect.intersects:Width and height cannot be negative");return i+=t,!((a+=n)<t||i<n||(a=s,t=o,a+=e,(t+=r)<e)||a<r)}static intersectsLineSegment(t,e,i,s,n,r,a,o){return(Yt,Xt.r(t,Z,"intersectsLineSegment:x"),Xt.r(e,Z,"intersectsLineSegment:y"),Xt.r(i,Z,"intersectsLineSegment:w"),Xt.r(s,Z,"intersectsLineSegment:h"),Xt.r(n,Z,"intersectsLineSegment:p1x"),Xt.r(r,Z,"intersectsLineSegment:p1y"),Xt.r(a,Z,"intersectsLineSegment:p2x"),Xt.r(o,Z,"intersectsLineSegment:p2y"),i<0||s<0)&&Xt.n("Rect.intersectsLineSegment: width and height cannot be negative"),I.hC(t,e,i,s,n,r,a,o)}get x(){return this.S}set x(t){Yt,Xt.t(t,"number",Z,"x"),this.st(t),this.S=t}get y(){return this.P}set y(t){Yt,Xt.t(t,"number",Z,"y"),this.st(t),this.P=t}get width(){return this.J}set width(t){Yt,Xt.t(t,"number",Z,"width"),this.st(t),t<0&&Xt.G(t,">= 0",Z,"width"),this.J=t}get height(){return this.Z}set height(t){Yt,Xt.t(t,"number",Z,"height"),this.st(t),t<0&&Xt.G(t,">= 0",Z,"height"),this.Z=t}get left(){return this.S}set left(t){Yt,Xt.t(t,"number",Z,"left"),this.st(t),this.S=t}get top(){return this.P}set top(t){Yt,Xt.t(t,"number",Z,"top"),this.st(t),this.P=t}get right(){return this.S+this.J}set right(t){Yt,Xt.r(t,Z,"right"),this.st(t),this.S+=t-(this.S+this.J)}get bottom(){return this.P+this.Z}set bottom(t){Yt,Xt.r(t,Z,"top"),this.st(t),this.P+=t-(this.P+this.Z)}get position(){return new U(this.S,this.P)}set position(t){Yt,Xt.s(t,U,Z,"position"),this.st(t),this.S=t.x,this.P=t.y}get size(){return new qt(this.J,this.Z)}set size(t){Yt,Xt.s(t,qt,Z,"size"),this.st(t),this.J=t.width,this.Z=t.height}get center(){return new U(this.S+this.J/2,this.P+this.Z/2)}set center(t){Yt,Xt.s(t,U,Z,"center"),this.st(t),this.S=t.x-this.J/2,this.P=t.y-this.Z/2}get centerX(){return this.S+this.J/2}set centerX(t){Yt,Xt.r(t,Z,"centerX"),this.st(t),this.S=t-this.J/2}get centerY(){return this.P+this.Z/2}set centerY(t){Yt,Xt.r(t,Z,"centerY"),this.st(t),this.P=t-this.Z/2}isReal(){return isFinite(this.x)&&isFinite(this.y)&&isFinite(this.width)&&isFinite(this.height)}isEmpty(){return 0===this.width&&0===this.height}static Xk=new Z(0,0,0,0).rt();static RD=new Z(NaN,NaN,NaN,NaN).rt();static Yk=[];static a(){var t=Z.Yk.pop();return void 0===t?new Z:t}static H(t,e,i,s){var n=Z.Yk.pop();return void 0===n?new Z(t,e,i,s):n.e(t,e,i,s)}static o(t){Z.Yk.push(t)}}class E{fn;cn;un;dn;f;constructor(t,e,i,s){void 0===t?(this.fn=0,this.cn=0,this.un=0,this.dn=0):void 0===e?(this.top=s=i=e=t,this.right=e,this.bottom=i,this.left=s):void 0===i?(s=e,this.top=i=t,this.right=e,this.bottom=i,this.left=s):void 0!==s?(this.top=t,this.right=e,this.bottom=i,this.left=s):Xt.n("Invalid arguments to Margin constructor: "+t+", "+e+", "+i+", "+s),this.f=!1}c(t){return this.fn=t.fn,this.cn=t.cn,this.un=t.un,this.dn=t.dn,this}setTo(t,e,i,s){return Yt,Xt.t(t,"number",E,"setTo:t"),Xt.t(e,"number",E,"setTo:r"),Xt.t(i,"number",E,"setTo:b"),Xt.t(s,"number",E,"setTo:l"),this.st(),this.fn=t,this.cn=e,this.un=i,this.dn=s,this}set(t){return Yt,Xt.s(t,E,E,"assign:m"),this.st(),this.fn=t.fn,this.cn=t.cn,this.un=t.un,this.dn=t.dn,this}copy(){var t=new E;return t.fn=this.fn,t.cn=this.cn,t.un=this.un,t.dn=this.dn,t}rt(){return this.f=!0,Object.freeze(this),this}L(){return this.f||Object.isFrozen(this)?this:this.copy().w()}w(){return this.f=!0,this}ut(){return Object.isFrozen(this)&&Xt.n("cannot thaw constant: "+this),this.f=!1,this}st(e){if(Yt,this.f){let t="The Margin is frozen, so its properties cannot be set: "+this.toString();void 0!==e&&(t+="  to value: "+e),Xt.n(t)}}static parse(r){if("string"!=typeof r)return new E;{var a=r.split(" ");let t=0,e=NaN;for(;""===a[t];)t++;r=a[t++];if(r&&(e=parseFloat(r)),isNaN(e))return new E;let i=NaN;for(;""===a[t];)t++;if((r=a[t++])&&(i=parseFloat(r)),isNaN(i))return new E(e);let s=NaN;for(;""===a[t];)t++;if((r=a[t++])&&(s=parseFloat(r)),isNaN(s))return new E(e,i);let n=NaN;for(;""===a[t];)t++;return(r=a[t++])&&(n=parseFloat(r)),isNaN(n)?new E(e,i):new E(e,i,s,n)}}static stringify(t){return Yt,Xt.s(t,E),t.top.toString()+" "+t.right.toString()+" "+t.bottom.toString()+" "+t.left.toString()}static stringifyFixed(e){return Xt.t(e,"number",E,"stringifyFixed:digits"),t=>t.top.toFixed(e)+" "+t.right.toFixed(e)+" "+t.bottom.toFixed(e)+" "+t.left.toFixed(e)}toString(){return"Margin("+this.top+","+this.right+","+this.bottom+","+this.left+")"}equals(t){return t instanceof E&&this.fn===t.top&&this.cn===t.right&&this.un===t.bottom&&this.dn===t.left}equalTo(t,e,i,s){return this.fn===t&&this.cn===e&&this.un===i&&this.dn===s}equalsApprox(t){return I.p(this.fn,t.top)&&I.p(this.cn,t.right)&&I.p(this.un,t.bottom)&&I.p(this.dn,t.left)}get top(){return this.fn}set top(t){Yt,Xt.r(t,E,"top"),this.st(t),this.fn=t}get right(){return this.cn}set right(t){Yt,Xt.r(t,E,"right"),this.st(t),this.cn=t}get bottom(){return this.un}set bottom(t){Yt,Xt.r(t,E,"bottom"),this.st(t),this.un=t}get left(){return this.dn}set left(t){Yt,Xt.r(t,E,"left"),this.st(t),this.dn=t}isReal(){return isFinite(this.top)&&isFinite(this.right)&&isFinite(this.bottom)&&isFinite(this.left)}static qg=new E(0,0,0,0).rt();static aC=new E(2,2,2,2).rt();static fC=[];static a(){var t=E.fC.pop();return void 0===t?new E:t}static o(t){E.fC.push(t)}}class J{S;P;Vs;Bs;f;constructor(t,e,i,s){void 0===t?(this.S=0,this.P=0,this.Vs=0,this.Bs=0):(void 0===e&&(e=0),void 0===i&&(i=0),void 0===s&&(s=0),this.x=t,this.y=e,this.offsetX=i,this.offsetY=s),this.f=!1}c(t){return this.S=t.S,this.P=t.P,this.Vs=t.Vs,this.Bs=t.Bs,this}setTo(t,e,i,s){return Yt,this.kw(t,"setTo:x"),this.kw(e,"setTo:y"),this.Sw(i,"setTo:offx"),this.Sw(s,"setTo:offy"),this.st(),this.S=t,this.P=e,this.Vs=i,this.Bs=s,this}set(t){return Yt,Xt.s(t,J,J,"set:s"),this.st(),this.S=t.S,this.P=t.P,this.Vs=t.Vs,this.Bs=t.Bs,this}copy(){var t=new J;return t.S=this.S,t.P=this.P,t.Vs=this.Vs,t.Bs=this.Bs,t}rt(){return this.f=!0,Object.freeze(this),this}L(){return this.f||Object.isFrozen(this)?this:this.copy().w()}w(){return this.f=!0,this}ut(){return Object.isFrozen(this)&&Xt.n("cannot thaw constant: "+this),this.f=!1,this}st(e){if(Yt,this.f){let t="The Spot is frozen, so its properties cannot be set: "+this.toString();void 0!==e&&(t+="  to value: "+e),Xt.n(t)}}He(t){return this.S=NaN,this.P=NaN,this.Vs=t,this}kw(t,e){(isNaN(t)||1<t||t<0)&&Xt.G(t,"0 <= "+e+" <= 1",J,e)}Sw(t,e){!isNaN(t)&&t!==1/0&&t!==-1/0||Xt.G(t,"real number, not NaN or Infinity",J,e)}static parse(r){if("string"!=typeof r)return new J;{if("None"===(r=r.trim()))return J.None;if("TopLeft"===r)return J.TopLeft;if("Top"===r||"TopCenter"===r||"MiddleTop"===r)return J.TopCenter;if("TopRight"===r)return J.TopRight;if("Left"===r||"LeftCenter"===r||"MiddleLeft"===r)return J.LeftCenter;if("Center"===r)return J.Center;if("Right"===r||"RightCenter"===r||"MiddleRight"===r)return J.RightCenter;if("BottomLeft"===r)return J.BottomLeft;if("Bottom"===r||"BottomCenter"===r||"MiddleBottom"===r)return J.BottomCenter;if("BottomRight"===r)return J.BottomRight;if("TopSide"===r)return J.TopSide;if("LeftSide"===r)return J.LeftSide;if("RightSide"===r)return J.RightSide;if("BottomSide"===r)return J.BottomSide;if("TopBottomSides"===r)return J.TopBottomSides;if("LeftRightSides"===r)return J.LeftRightSides;if("TopLeftSides"===r)return J.TopLeftSides;if("TopRightSides"===r)return J.TopRightSides;if("BottomLeftSides"===r)return J.BottomLeftSides;if("BottomRightSides"===r)return J.BottomRightSides;if("NotTopSide"===r)return J.NotTopSide;if("NotLeftSide"===r)return J.NotLeftSide;if("NotRightSide"===r)return J.NotRightSide;if("NotBottomSide"===r)return J.NotBottomSide;if("AllSides"===r)return J.AllSides;if("Default"===r)return J.Default;var a=r.split(" ");let t=0,e=0;for(;""===a[t];)t++;r=a[t++];void 0!==r&&0<r.length&&(e=parseFloat(r));let i=0;for(;""===a[t];)t++;void 0!==(r=a[t++])&&0<r.length&&(i=parseFloat(r));let s=0;for(;""===a[t];)t++;void 0!==(r=a[t++])&&0<r.length&&(s=parseFloat(r));let n=0;for(;""===a[t];)t++;return void 0!==(r=a[t++])&&0<r.length&&(n=parseFloat(r)),new J(e,i,s,n)}}static stringify(t){return Yt,Xt.s(t,J),t.isSpot()?t.x.toString()+" "+t.y.toString()+" "+t.offsetX.toString()+" "+t.offsetY.toString():t.toString()}static stringifyFixed(e){return Xt.t(e,"number",J,"stringifyFixed:digits"),t=>t.x.toFixed(e)+" "+t.y.toFixed(e)+" "+t.offsetX.toFixed(e)+" "+t.offsetY.toFixed(e)}toString(){return this.isSpot()?0===this.Vs&&0===this.Bs?"Spot("+this.x+","+this.y+")":"Spot("+this.x+","+this.y+","+this.offsetX+","+this.offsetY+")":this.equals(J.None)?"None":this.equals(J.TopLeft)?"TopLeft":this.equals(J.TopCenter)?"Top":this.equals(J.TopRight)?"TopRight":this.equals(J.LeftCenter)?"Left":this.equals(J.Center)?"Center":this.equals(J.RightCenter)?"Right":this.equals(J.BottomLeft)?"BottomLeft":this.equals(J.BottomCenter)?"Bottom":this.equals(J.BottomRight)?"BottomRight":this.equals(J.TopSide)?"TopSide":this.equals(J.LeftSide)?"LeftSide":this.equals(J.RightSide)?"RightSide":this.equals(J.BottomSide)?"BottomSide":this.equals(J.TopBottomSides)?"TopBottomSides":this.equals(J.LeftRightSides)?"LeftRightSides":this.equals(J.TopLeftSides)?"TopLeftSides":this.equals(J.TopRightSides)?"TopRightSides":this.equals(J.BottomLeftSides)?"BottomLeftSides":this.equals(J.BottomRightSides)?"BottomRightSides":this.equals(J.NotTopSide)?"NotTopSide":this.equals(J.NotLeftSide)?"NotLeftSide":this.equals(J.NotRightSide)?"NotRightSide":this.equals(J.NotBottomSide)?"NotBottomSide":this.equals(J.AllSides)?"AllSides":this.equals(J.Default)?"Default":"None"}equals(t){return t instanceof J&&(this.S===t.x||isNaN(this.S)&&isNaN(t.x))&&(this.P===t.y||isNaN(this.P)&&isNaN(t.y))&&this.Vs===t.offsetX&&this.Bs===t.offsetY}opposite(){return new J(.5-(this.S-.5),.5-(this.P-.5),-this.Vs,-this.Bs)}includesSide(t){if(!this.isSide())return!1;if(!t.isSide())if(t.equals(J.Left))t=J.LeftSide;else if(t.equals(J.Right))t=J.RightSide;else if(t.equals(J.Top))t=J.TopSide;else{if(!t.equals(J.Bottom))return!1;t=J.BottomSide}var e=this.Bs,t=t.offsetY;return(e&t)===t}get x(){return this.S}set x(t){Yt,this.kw(t,"x"),this.st(t),this.S=t}get y(){return this.P}set y(t){Yt,this.kw(t,"y"),this.st(t),this.P=t}get offsetX(){return this.Vs}set offsetX(t){Yt,this.Sw(t,"offsetX"),this.st(t),this.Vs=t}get offsetY(){return this.Bs}set offsetY(t){Yt,this.Sw(t,"offsetY"),this.st(t),this.Bs=t}isSpot(){return!isNaN(this.x)&&!isNaN(this.y)}isNoSpot(){return isNaN(this.x)||isNaN(this.y)}isSide(){return isNaN(this.x)&&isNaN(this.y)&&1===this.offsetX&&0!==this.offsetY}isNone(){return isNaN(this.x)&&isNaN(this.y)&&0===this.offsetX&&0===this.offsetY}isDefault(){return isNaN(this.x)&&isNaN(this.y)&&-1===this.offsetX&&0===this.offsetY}static None=new J(0,0,0,0).He(0).rt();static Default=new J(0,0,-1,0).He(-1).rt();static TopLeft=new J(0,0,0,0).rt();static TopCenter=new J(.5,0,0,0).rt();static TopRight=new J(1,0,0,0).rt();static LeftCenter=new J(0,.5,0,0).rt();static Center=new J(.5,.5,0,0).rt();static RightCenter=new J(1,.5,0,0).rt();static BottomLeft=new J(0,1,0,0).rt();static BottomCenter=new J(.5,1,0,0).rt();static BottomRight=new J(1,1,0,0).rt();static MiddleTop=J.TopCenter;static MiddleLeft=J.LeftCenter;static MiddleRight=J.RightCenter;static MiddleBottom=J.BottomCenter;static Top=J.TopCenter;static Left=J.LeftCenter;static Right=J.RightCenter;static Bottom=J.BottomCenter;static TopSide=new J(0,0,1,1).He(1).rt();static LeftSide=new J(0,0,1,2).He(1).rt();static RightSide=new J(0,0,1,4).He(1).rt();static BottomSide=new J(0,0,1,8).He(1).rt();static TopBottomSides=new J(0,0,1,9).He(1).rt();static LeftRightSides=new J(0,0,1,6).He(1).rt();static TopLeftSides=new J(0,0,1,3).He(1).rt();static TopRightSides=new J(0,0,1,5).He(1).rt();static BottomLeftSides=new J(0,0,1,10).He(1).rt();static BottomRightSides=new J(0,0,1,12).He(1).rt();static NotTopSide=new J(0,0,1,14).He(1).rt();static NotLeftSide=new J(0,0,1,13).He(1).rt();static NotRightSide=new J(0,0,1,11).He(1).rt();static NotBottomSide=new J(0,0,1,7).He(1).rt();static AllSides=new J(0,0,1,15).He(1).rt();static Kk=new J(.156,.156).rt();static Uk=new J(.844,.844).rt();static cC=[];static a(){var t=J.cC.pop();return void 0===t?new J:t}static o(t){J.cC.push(t)}}class H{m11;m12;m21;m22;dx;dy;constructor(){this.m11=1,this.m12=0,this.m21=0,this.m22=1,this.dx=0,this.dy=0}set(t){return this.m11=t.m11,this.m12=t.m12,this.m21=t.m21,this.m22=t.m22,this.dx=t.dx,this.dy=t.dy,this}setTo(t,e,i,s,n,r){return this.m11=t,this.m12=e,this.m21=i,this.m22=s,this.dx=n,this.dy=r,this}copy(){var t=new H;return t.m11=this.m11,t.m12=this.m12,t.m21=this.m21,t.m22=this.m22,t.dx=this.dx,t.dy=this.dy,t}toString(){return"Transform("+this.m11+","+this.m12+","+this.m21+","+this.m22+","+this.dx+","+this.dy+")"}equals(t){return this.m11===t.m11&&this.m12===t.m12&&this.m21===t.m21&&this.m22===t.m22&&this.dx===t.dx&&this.dy===t.dy}Gk(){return 0===this.dx&&0===this.dy&&1===this.m11&&0===this.m12&&0===this.m21&&1===this.m22}ti(){return this.m11=1,this.m12=0,this.m21=0,this.m22=1,this.dx=0,this.dy=0,this}hf(t){var e=this.m11*t.m11+this.m21*t.m12,i=this.m12*t.m11+this.m22*t.m12,s=this.m11*t.m21+this.m21*t.m22,n=this.m12*t.m21+this.m22*t.m22;return this.dx=this.m11*t.dx+this.m21*t.dy+this.dx,this.dy=this.m12*t.dx+this.m22*t.dy+this.dy,this.m11=e,this.m12=i,this.m21=s,this.m22=n,this}uC(t){var e=1/(t.m11*t.m22-t.m12*t.m21),i=t.m22*e,s=-t.m12*e,n=-t.m21*e,r=t.m11*e,a=e*(t.m21*t.dy-t.m22*t.dx),e=e*(t.m12*t.dx-t.m11*t.dy),t=this.m11*i+this.m21*s,i=this.m12*i+this.m22*s,s=this.m11*n+this.m21*r,n=this.m12*n+this.m22*r;return this.dx=this.m11*a+this.m21*e+this.dx,this.dy=this.m12*a+this.m22*e+this.dy,this.m11=t,this.m12=i,this.m21=s,this.m22=n,this}Mw(){var t=1/(this.m11*this.m22-this.m12*this.m21),e=this.m22*t,i=-this.m12*t,s=-this.m21*t,n=this.m11*t,r=t*(this.m21*this.dy-this.m22*this.dx),t=t*(this.m12*this.dx-this.m11*this.dy);return this.m11=e,this.m12=i,this.m21=s,this.m22=n,this.dx=r,this.dy=t,this}ys(i,s,n){if(360<=i?i-=360:i<0&&(i+=360),0!==i){this.se(s,n);let t=0,e=0;e=90===i?(t=0,1):180===i?(t=-1,0):270===i?(t=0,-1):(i=i*Math.PI/180,t=Math.cos(i),Math.sin(i));var i=this.m11*t+this.m21*e,r=this.m12*t+this.m22*e,a=this.m11*-e+this.m21*t,o=this.m12*-e+this.m22*t;this.m11=i,this.m12=r,this.m21=a,this.m22=o,this.se(-s,-n)}return this}se(t,e){return this.dx+=this.m11*t+this.m21*e,this.dy+=this.m12*t+this.m22*e,this}v(t,e){return void 0===e&&(e=t),this.m11*=t,this.m12*=t,this.m21*=e,this.m22*=e,this}ID(){if(1===this.m11&&0===this.m12)return 0;let t=180*Math.atan2(this.m12,this.m11)/Math.PI;return t<0&&(t+=360),t}Pt(t){var e=t.x,i=t.y;return t.e(e*this.m11+i*this.m21+this.dx,e*this.m12+i*this.m22+this.dy)}rs(t){var e=1/(this.m11*this.m22-this.m12*this.m21),i=this.m22*e,s=-this.m12*e,n=-this.m21*e,r=this.m11*e,a=e*(this.m21*this.dy-this.m22*this.dx),e=e*(this.m12*this.dx-this.m11*this.dy),o=t.x,h=t.y;return t.e(o*i+h*n+a,o*s+h*r+e)}Pw(t){var e=1/(this.m11*this.m22-this.m12*this.m21),i=this.m22*e,s=-this.m12*e,n=-this.m21*e,r=this.m11*e,a=e*(this.m21*this.dy-this.m22*this.dx),e=e*(this.m12*this.dx-this.m11*this.dy),o=1.25*t.x,h=1.2*t.y;return t.e(o*i+h*n+a,o*s+h*r+e)}Nw(t){var e=t.x,i=t.y,s=e+t.width,n=i+t.height,r=this.m11,a=this.m12,o=this.m21,h=this.m22,l=this.dx,u=this.dy,d=e*r+i*o+l,c=e*a+i*h+u,g=s*r+i*o+l,i=s*a+i*h+u,m=e*r+n*o+l,e=e*a+n*h+u,r=s*r+n*o+l,o=s*a+n*h+u,l=d,s=c,a=c,n=Math.min(d,g),l=Math.max(l,g),s=Math.min(s,i),a=Math.max(a,i);return n=Math.min(n,m),l=Math.max(l,m),s=Math.min(s,e),a=Math.max(a,e),n=Math.min(n,r),l=Math.max(l,r),s=Math.min(s,o),a=Math.max(a,o),t.e(n,s,l-n,a-s),t}static dC=[];static a(){var t=H.dC.pop();return void 0===t?new H:t}static o(t){H.dC.push(t)}static Hk="54a702f3e53909c447824c6706603faf4c"}const I={OD:"7da71ca0ad381e90",Gn:(Math.sqrt(2)-1)/3*4,gC:null,Cw:t=>{if(t<=0)return 0;let e=I.gC;if(null===e){e=[];for(let t=0;t<=2e3;t++)e[t]=Math.sqrt(t);I.gC=e}var i;return t<1?(i=1/t)<=2e3?1/e[0|i]:Math.sqrt(t):t<=2e3?e[0|t]:Math.sqrt(t)},p:(t,e)=>{t-=e;return t<.5&&-.5<t},q:(t,e)=>{t-=e;return t<5e-8&&-5e-8<t},zi:(t,e,i,s,n,r,a)=>{n<=0&&(n=1e-6);let o=0,h=0,l=0,u=0;if(o=t<i?(h=t,i):(h=i,t),l=e<s?(u=e,s):(u=s,e),t===i)return u<=a&&a<=l&&t-n<=r&&r<=t+n;if(e===s)return h<=r&&r<=o&&e-n<=a&&a<=e+n;var d=o+n,c=h-n;if(c<=r&&r<=d){var g=l+n,m=u-n;if(m<=a&&a<=g)if(g-m<d-c){if(!(n<t-i||n<i-t))return!0;g=(s-e)/(i-t)*(r-t)+e;if(g-n<=a&&a<=g+n)return!0}else{if(!(n<e-s||n<s-e))return!0;m=(i-t)/(s-e)*(a-e)+t;if(m-n<=r&&r<=m+n)return!0}}return!1},Aw:(t,e,i,s,n,r,a,o,h,l,u,d)=>{var c,g,m,f,p,v;return I.zi(t,e,a,o,d,i,s)&&I.zi(t,e,a,o,d,n,r)?I.zi(t,e,a,o,d,l,u):(p=((m=((c=(t+i)/2)+(i=(i+n)/2))/2)+(n=(i+(i=(n+a)/2))/2))/2,v=((f=((g=(e+s)/2)+(s=(s+r)/2))/2)+(r=(s+(s=(r+o)/2))/2))/2,I.Aw(t,e,c,g,m,f,p,v,h,l,u,d)||I.Aw(p,v,n,r,i,s,a,o,h,l,u,d))},mC:(t,e,i,s,n,r,a,o,h)=>{var l=(i+n)/2,u=(s+r)/2;return h.e((((t+i)/2+l)/2+(l+(n+a)/2)/2)/2,(((e+s)/2+u)/2+(u+(r+o)/2)/2)/2),h},ED:(t,e,i,s,n,r,a,o)=>{var h=(i+n)/2,l=(s+r)/2,t=((t+i)/2+h)/2,i=((e+s)/2+l)/2,e=(h+(n+a)/2)/2,s=(l+(r+o)/2)/2;return U.direction(t,i,e,s)},gu:(t,e,i,s,n,r,a,o,h,l)=>{var u,d,c,g,m,f;return I.zi(t,e,a,o,h,i,s)&&I.zi(t,e,a,o,h,n,r)?(l.unionNoCheck(t,e,0,0),l.unionNoCheck(a,o,0,0)):(m=((c=((u=(t+i)/2)+(i=(i+n)/2))/2)+(n=(i+(i=(n+a)/2))/2))/2,f=((g=((d=(e+s)/2)+(s=(s+r)/2))/2)+(r=(s+(s=(r+o)/2))/2))/2,I.gu(t,e,u,d,c,g,m,f,h,l),I.gu(m,f,n,r,i,s,a,o,h,l)),l},Hn:(t,e,i,s,n,r,a,o,h,l)=>{var u,d,c,g,m,f;return I.zi(t,e,a,o,h,i,s)&&I.zi(t,e,a,o,h,n,r)?(0===l.length&&(l.push(t),l.push(e)),l.push(a),l.push(o)):(m=((c=((u=(t+i)/2)+(i=(i+n)/2))/2)+(n=(i+(i=(n+a)/2))/2))/2,f=((g=((d=(e+s)/2)+(s=(s+r)/2))/2)+(r=(s+(s=(r+o)/2))/2))/2,I.Hn(t,e,u,d,c,g,m,f,h,l),I.Hn(m,f,n,r,i,s,a,o,h,l)),l},vk:(t,e,i,s,n,r,a,o,h,l)=>{var u,d,c,g;return I.zi(t,e,n,r,l,i,s)?I.zi(t,e,n,r,l,o,h):(c=((u=(t+i)/2)+(i=(i+n)/2))/2,g=((d=(e+s)/2)+(s=(s+r)/2))/2,I.vk(t,e,u,d,c,g,a,o,h,l)||I.vk(c,g,i,s,n,r,a,o,h,l))},eE:(t,e,i,s,n,r,a)=>{return a.e(((t+i)/2+(i+n)/2)/2,((e+s)/2+(s+r)/2)/2),a},qk:(t,e,i,s,n,r,a,o)=>{var h,l,u,d;return I.zi(t,e,n,r,a,i,s)?(o.unionNoCheck(t,e,0,0),o.unionNoCheck(n,r,0,0)):(u=((h=(t+i)/2)+(i=(i+n)/2))/2,d=((l=(e+s)/2)+(s=(s+r)/2))/2,I.qk(t,e,h,l,u,d,a,o),I.qk(u,d,i,s,n,r,a,o)),o},Wg:(t,e,i,s,n,r,a,o)=>{var h,l,u,d;return I.zi(t,e,n,r,a,i,s)?(0===o.length&&(o.push(t),o.push(e)),o.push(n),o.push(r)):(u=((h=(t+i)/2)+(i=(i+n)/2))/2,d=((l=(e+s)/2)+(s=(s+r)/2))/2,I.Wg(t,e,h,l,u,d,a,o),I.Wg(u,d,i,s,n,r,a,o)),o},jg:(n,r,a,o,h,l,u,d,c,g,m,f,p,v)=>{if(I.zi(n,r,u,d,p,a,o)&&I.zi(n,r,u,d,p,h,l))return!!I.uu(n,r,u,d,c,g,m,f)&&0!=(y=(n-u)*(g-f)-(r-d)*(c-m))&&(v.e(((n*d-r*u)*(c-m)-(n-u)*(c*f-g*m))/y,((n*d-r*u)*(g-f)-(r-d)*(c*f-g*m))/y),!0);{var y=(n+a)/2,x=(r+o)/2,a=(a+h)/2,o=(o+l)/2,h=(h+u)/2,l=(l+d)/2,A=(y+a)/2,w=(x+o)/2,a=(a+h)/2,o=(o+l)/2,b=(A+a)/2,P=(w+o)/2;let t=1/0,e=!1,i=0,s=0;return I.jg(n,r,y,x,A,w,b,P,c,g,m,f,p,v)&&(n=(v.x-c)*(v.x-c)+(v.y-g)*(v.y-g))<t&&(t=n,e=!0,i=v.x,s=v.y),I.jg(b,P,a,o,h,l,u,d,c,g,m,f,p,v)&&(r=(v.x-c)*(v.x-c)+(v.y-g)*(v.y-g))<t&&(t=r,e=!0,i=v.x,s=v.y),e&&(v.x=i,v.y=s),e}},Jg:(i,s,t,e,n,r,a,o,h,l,u,d,c)=>{let g=0;if(I.zi(i,s,a,o,c,t,e)&&I.zi(i,s,a,o,c,n,r)){var m=(i-a)*(l-d)-(s-o)*(h-u);if(0==m)return g;var f=((i*o-s*a)*(h-u)-(i-a)*(h*d-l*u))/m,p=((i*o-s*a)*(l-d)-(s-o)*(h*d-l*u))/m;if(u<=f)return g;let t=0,e=0;if((u<h?h-u:u-h)<(d<l?l-d:d-l)){if(e=s<o?(t=s,o):(t=o,s),p<t||p>e)return g}else if(e=i<a?(t=i,a):(t=a,i),f<t||f>e)return g;0<m?g++:m<0&&g--}else{var p=(i+t)/2,f=(s+e)/2,m=(t+n)/2,t=(e+r)/2,e=(n+a)/2,n=(r+o)/2,r=(p+m)/2,v=(f+t)/2,m=(m+e)/2,t=(t+n)/2,y=(r+m)/2,x=(v+t)/2;g=(g+=I.Jg(i,s,p,f,r,v,y,x,h,l,u,d,c))+I.Jg(y,x,m,t,e,n,a,o,h,l,u,d,c)}return g},Sl:(i,s,n,r,a,o,h)=>{if(I.q(i,n)){let t=0,e=0;e=s<r?(t=s,r):(t=r,s);var l=o;return l<t?(h.e(i,t),!1):l>e?(h.e(i,e),!1):(h.e(i,l),!0)}if(I.q(s,r)){let t=0,e=0;e=i<n?(t=i,n):(t=n,i);var l=a;return l<t?(h.e(t,s),!1):l>e?(h.e(e,s),!1):(h.e(l,s),!0)}return(l=((i-a)*(i-n)+(s-o)*(s-r))/((n-i)*(n-i)+(r-s)*(r-s)))<-5e-6?(h.e(i,s),!1):1.000005<l?(h.e(n,r),!1):(h.e(i+l*(n-i),s+l*(r-s)),!0)},vn:(i,s,n,r,a,o,t,h,l)=>{if(I.p(i,n)&&I.p(s,r))return l.e(i,s),!1;if(I.q(a,t))return I.q(i,n)?(I.Sl(i,s,n,r,a,o,l),!1):(u=(r-s)/(n-i)*(a-i)+s,I.Sl(i,s,n,r,a,u,l));var u=(h-o)/(t-a);if(I.q(i,n)){h=u*(i-a)+o;let t=0,e=0;return e=s<r?(t=s,r):(t=r,s),h<t?(l.e(i,t),!1):h>e?(l.e(i,e),!1):(l.e(i,h),!0)}t=(r-s)/(n-i);if(I.q(u,t))return I.Sl(i,s,n,r,a,o,l),!1;h=(t*i-u*a+o-s)/(t-u);if(I.q(t,0)){let t=0,e=0;return e=i<n?(t=i,n):(t=n,i),h<t?(l.e(t,s),!1):h>e?(l.e(e,s),!1):(l.e(h,s),!0)}return a=t*(h-i)+s,I.Sl(i,s,n,r,h,a,l)},sE:(t,e,i,s,n)=>I.vn(i.x,i.y,s.x,s.y,t.x,t.y,e.x,e.y,n),nE:(s,n,t,e,i,r,a,o,h,l)=>{let u=1/0;function d(t,e){var i=(t-s)*(t-s)+(e-n)*(e-n);i<u&&(u=i,h.e(t,e))}d(h.x,h.y);let c=0,g=0,m=0,f=0;g=i<a?(c=i,a):(c=a,i),f=r<o?(m=i,a):(m=a,i);var p=(g-c)/2+l,l=(f-m)/2+l,i=(i+a)/2,a=(r+o)/2;if(0!==p&&0!==l)if((s<t?t-s:s-t)<.5){r=1-(t-i)*(t-i)/(p*p);if(r<0)return h;o=Math.sqrt(r),r=-l*o+a;d(t,l*o+a),d(t,r)}else{o=(e-n)/(t-s),r=1/(p*p)+o*o/(l*l),e=2*o*(n-o*s)/(l*l)-2*o*a/(l*l)-2*i/(p*p),t=e*e-4*r*(2*o*s*a/(l*l)-2*n*a/(l*l)+a*a/(l*l)+i*i/(p*p)-1+(n-o*s)*(n-o*s)/(l*l));if(t<0)return h;a=Math.sqrt(t),i=(-e+a)/(2*r),p=(d(i,o*i-o*s+n),(-e-a)/(2*r));d(p,o*p-o*s+n)}return h},Ml:(t,e,i,s,n,r,a,o,h)=>{let l=1e21,u=t,d=e;var c;return I.vn(t,e,t,s,n,r,a,o,h)&&(c=(h.x-n)*(h.x-n)+(h.y-r)*(h.y-r))<l&&(l=c,u=h.x,d=h.y),I.vn(i,e,i,s,n,r,a,o,h)&&(c=(h.x-n)*(h.x-n)+(h.y-r)*(h.y-r))<l&&(l=c,u=h.x,d=h.y),I.vn(t,e,i,e,n,r,a,o,h)&&(c=(h.x-n)*(h.x-n)+(h.y-r)*(h.y-r))<l&&(l=c,u=h.x,d=h.y),I.vn(t,s,i,s,n,r,a,o,h)&&(e=(h.x-n)*(h.x-n)+(h.y-r)*(h.y-r))<l&&(l=e,u=h.x,d=h.y),h.e(u,d),l<1e21},Lw:(t,e,i)=>I.hC(t.x,t.y,t.width,t.height,e.x,e.y,i.x,i.y),hC:(t,e,i,s,n,r,a,o)=>{var h=t,l=t+i,u=e,d=e+s;if(n===a){let t=0,e=0;return e=r<o?(t=r,o):(t=o,r),h<=n&&n<=l&&t<=d&&e>=u}if(r!==o)return!!(Z.contains(t,e,i,s,n,r)||Z.contains(t,e,i,s,a,o)||I.uu(h,u,l,u,n,r,a,o)||I.uu(l,u,l,d,n,r,a,o)||I.uu(l,d,h,d,n,r,a,o)||I.uu(h,d,h,u,n,r,a,o));{let t=0,e=0;return e=n<a?(t=n,a):(t=a,n),u<=r&&r<=d&&t<=l&&e>=h}},uu:(t,e,i,s,n,r,a,o)=>t===i&&e===s&&n===a&&r===o?t===n&&e===r:I.cu(t,e,i,s,n,r)*I.cu(t,e,i,s,a,o)<=0&&I.cu(n,r,a,o,t,e)*I.cu(n,r,a,o,i,s)<=0,cu:(t,e,i,s,n,r)=>{i-=t,s-=e;let a=n-t,o=r-e,h=a*s-o*i;return h=0===h&&0<(h=a*i+o*s)&&(a-=i,o-=s,(h=a*i+o*s)<0)?0:h},Zg:t=>(t<0&&(t+=360),360<=t&&(t-=360),t),pC:(t,e,i,s,n,r)=>{var a=Math.PI,o=(r||(s*=a/180,n*=a/180),n<s?-1:1),h=[],l=a/2;let u=s,d=Math.min(2*a,Math.abs(n-s));if(d<1e-5)r=u+o*Math.min(d,l),a=t+i*Math.cos(u),n=e+i*Math.sin(u),s=t+i*Math.cos(r),r=e+i*Math.sin(r),h.push([a,n,a=(a+s)/2,n=(n+r)/2,a,n,s,r]);else for(;1e-5<d;){var c=u+o*Math.min(d,l);h.push(I.VD(i,u,c,t,e)),d-=Math.abs(c-u),u=c}return h},VD:(t,e,i,s,n)=>{var r=(i-e)/2,a=t*Math.cos(r),o=t*Math.sin(r),h=a,l=-o,u=h*h+l*l,d=u+h*a+l*o,u=4/3*(Math.sqrt(2*u*d)-d)/(h*o-l*a),d=h-u*l,o=l+u*h,a=d,l=-o,u=r+e,h=Math.cos(u),r=Math.sin(u);return[s+t*Math.cos(e),n+t*Math.sin(e),s+d*h-o*r,n+d*r+o*h,s+a*h-l*r,n+a*r+l*h,s+t*Math.cos(i),n+t*Math.sin(i)]},vg:(t,e,i,s,n,r,a)=>{i=Math.floor((t-i)/n)*n+i,s=Math.floor((e-s)/r)*r+s;let o=i,h=(i+n-t<n/2&&(o=i+n),s);return s+r-e<r/2&&(h=s+r),a.e(o,h),a},yC:(t,e)=>{let i=Math.max(t,e),s=Math.min(t,e),n,r=1;for(;n=i%s,r=s,i=s,0<(s=n););return r},BD:(t,e,i,s)=>{var n=i<0,r=s<0;let a,o=0,h=0,l=void(h=t<e?(o=1,0):(o=0,1)),u,d=0,c=0;return l=0===(a=o)?t:e,d=0===a?i:s,(0===a?n:r)&&(d=-d),u=0===(a=h)?t:e,c=0===a?i:s,(0===a?n:r)&&(c=-c),I.zD(l,u,d,c,0,0)},zD:(t,n,r,a,o,h)=>{let l=0;if(0<a)if(0<r){var u=t*t,d=n*n,c=t*r,g=n*a;let e=g-d,i=-d+Math.sqrt(c*c+g*g),s=e;for(let t=0;t<9999999999&&(s=.5*(e+i))!==e&&s!==i;++t){var m=c/(s+u),f=g/(s+d),m=m*m+f*f-1;if(0<m)e=s;else{if(!(m<0))break;i=s}}var p=(o=u*r/(s+u))-r,v=(h=d*a/(s+d))-a;l=Math.sqrt(p*p+v*v)}else o=0,h=n,l=Math.abs(a-n);else{var p=t*t-n*n,v=t*r;l=v<p?(o=t*(a=v/p),h=n*Math.sqrt(Math.abs(1-a*a)),v=o-r,Math.sqrt(v*v+h*h)):(o=t,h=0,Math.abs(r-t))}return l},qn:new h,$g:new h,yr:new h,wr:0,Qg:100};I.za=I.OD;(t={})[t.Line=1]="Line",t[t.Rectangle=2]="Rectangle",t[t.Ellipse=3]="Ellipse",t[t.Path=4]="Path";var P=t,S=((t={})[t.None=0]="None",t[t.Default=1]="Default",t[t.Fill=2]="Fill",t[t.Uniform=6]="Uniform",t);class W{l;_g;tm;af;mu;pu;Wn;jn;Jn;nt;Ae;Le;ne;oe;zs;ff;cf;constructor(t){Yt,1<arguments.length&&Xt.n("Geometry constructor can take at most one optional argument, the Geometry type."),C.ji(this),this.l=2,void 0===t?t=4:(Yt,Xt.it(t,P,"GeometryType")),this.nt=t,this.Ae=0,this.Le=0,this.ne=0,this.oe=0,this.zs=4===t?new O:W.Tw,this._g=this.zs.mt,this.tm=(new Z).w(),this.af=null,this.mu=null,this.pu=NaN,this.Wn=J.TopLeft,this.jn=J.BottomRight,this.ff=NaN,this.cf=NaN,this.Jn=2}copy(){var t=new W;if(t.l=-2&this.l,t.nt=this.nt,t.Ae=this.Ae,t.Le=this.Le,t.ne=this.ne,t.oe=this.oe,4===this.nt){var e=this.zs.h,i=t.zs;for(let t=0;t<e.length;t++){var s=e[t];i.add(s.copy())}t.zs=i}else t.zs=this.zs;return t._g=this._g,t.tm.c(this.tm),t.af=this.af,t.mu=this.mu,t.pu=this.pu,t.Wn=this.Wn.L(),t.jn=this.jn.L(),t.ff=this.ff,t.cf=this.cf,t.Jn=this.Jn,t}static Line=1;static Rectangle=2;static Ellipse=3;static Path=4;static Tw=(new O).w();get f(){return 0!=(1&this.l)}set f(t){t?this.l|=1:this.l&=-2}get Nt(){return 0!=(2&this.l)}set Nt(t){t?this.l|=2:this.l&=-3}rt(){return this.w(),Object.freeze(this),this}w(){if(this.f=!0,4===this.type){var t=this.figures;t.w();for(const e of t)e.w()}return this}ut(){if(Object.isFrozen(this)&&Xt.n("cannot thaw constant: "+this),this.f=!1,4===this.type){var t=this.figures;t.ut();for(const e of t)e.ut()}return this}equalsApprox(t){if(!(t instanceof W))return!1;if(this.type!==t.type)return 1===this.type&&4===t.type?this.wC(t):1===t.type&&4===this.type&&t.wC(this);if(4!==this.type)return I.p(this.startX,t.startX)&&I.p(this.startY,t.startY)&&I.p(this.endX,t.endX)&&I.p(this.endY,t.endY);var e=this.figures.h,i=t.figures.h,s=e.length;if(s!==i.length)return!1;for(let t=0;t<s;t++){var n=e[t],r=i[t];if(!n.equalsApprox(r))return!1}return!0}wC(t){if(1===this.type&&4===t.type&&1===t.figures.count){t=t.figures.elt(0);if(1===t.segments.count&&I.p(this.startX,t.startX)&&I.p(this.startY,t.startY)){t=t.segments.elt(0);if(2===t.type&&I.p(this.endX,t.endX)&&I.p(this.endY,t.endY))return!0}}return!1}static stringify(t){return t.toString()}static stringifyFixed(e){return Xt.t(e,"number",W,"stringifyFixed:digits"),t=>t.toString(e)}ci(t){t in P?this.type=t:Xt.gr(this,t)}toString(i){void 0===i&&(i=-1);var t,s,n=t=>0===t?"0":t.toFixed(i);let r;switch(this.type){case 1:return i<0?"M"+this.startX.toString()+" "+this.startY.toString()+"L"+this.endX.toString()+" "+this.endY.toString():"M"+n(this.startX)+" "+n(this.startY)+"L"+n(this.endX)+" "+n(this.endY);case 2:return(r=new Z(this.startX,this.startY,0,0)).union(this.endX,this.endY,0,0),i<0?"M"+r.x.toString()+" "+r.y.toString()+"H"+r.right.toString()+"V"+r.bottom.toString()+"H"+r.left.toString()+"z":"M"+n(r.x)+" "+n(r.y)+"H"+n(r.right)+"V"+n(r.bottom)+"H"+n(r.left)+"z";case 3:return(r=new Z(this.startX,this.startY,0,0)).union(this.endX,this.endY,0,0),i<0?(s=r.left.toString()+" "+(r.y+r.height/2).toString(),t=r.right.toString()+" "+(r.y+r.height/2).toString(),"M"+s+"A"+(r.width/2).toString()+" "+(r.height/2).toString()+" 0 0 1 "+t+"A"+(r.width/2).toString()+" "+(r.height/2).toString()+" 0 0 1 "+s):(t=n(r.left)+" "+n(r.y+r.height/2),s=n(r.right)+" "+n(r.y+r.height/2),"M"+t+"A"+n(r.width/2)+" "+n(r.height/2)+" 0 0 1 "+s+"A"+n(r.width/2)+" "+n(r.height/2)+" 0 0 1 "+t);case 4:let e="";var a=this.figures.h,o=a.length;for(let t=0;t<o;t++){var h=a[t];0<t&&(e+=" x "),h.isFilled&&(e+="F "),e+=h.toString(i)}return e;default:return P[this.type]}}static fillPath(t){"string"!=typeof t&&Xt.Bi(t,"string",W,"fillPath:str");var e=t.split(/[Xx]/),i=e.length;let s="";for(let t=0;t<i;t++){var n=e[t];null!==n.match(/[Ff]/)?0===t?s+=n:s+="X"+(" "===n[0]?"":" ")+n:s+=(0===t?"":"X ")+"F"+(" "===n[0]?"":" ")+n}return s}static im="UuBbMmZzLlHhVvCcSsQqTtAaFfXx";static parse(e,t){void 0===t&&(t=!1),"string"!=typeof e&&Xt.Bi(e,"string",W,"parse:str");var i=new RegExp("(["+W.im+"])(["+W.im+"])","gm"),O=new RegExp("(["+W.im+"])([^s])","gm"),E=new RegExp("([^s])(["+W.im+"])","gm");const n=(e=(e=(e=(e=(e=(e=(e=(e=e.replace(/,/gm," ")).replace(i,"$1 $2")).replace(i,"$1 $2")).replace(O,"$1 $2")).replace(E,"$1 $2")).replace(/([0-9])([+\-])/gm,"$1 $2")).replace(/[\s\r\t\n]+/gm," ")).replace(/^\s+|\s+$/g,"")).split(" ");for(let s=0;s<n.length;s++){var r=n[s];if(null!==r.match(/(\.[0-9]*)(\.)/gm)){var a=Xt.ct();let e="",i=!1;for(let t=0;t<r.length;t++){var o=r[t];"."!==o||i?"."===o?(a.push(e),e="."):e+=o:(i=!0,e+=o)}a.push(e),n.splice(s,1);for(let t=0;t<a.length;t++)n.splice(s+t,0,a[t]);s+=a.length-1,Xt.ot(a)}}let s=-1,h="",l="";const u=new U(0,0),d=new U(0,0),c=new U(0,0);let g=!0;function m(){return s>=A-1||null!==n[s+1].match(N)||(g=!1)}function f(){return s++,n[s]}function p(t){let e=parseFloat(f()),i=parseFloat(f());h===h.toLowerCase()&&(e=c.x+e,i=c.y+i),t.e(e,i)}function v(){return p(c),c}function y(){return p(d),d}function x(){var t=l.toLowerCase();return"c"===t||"s"===t||"q"===t||"t"===t?new U(2*c.x-d.x,2*c.y-d.y):new U(c.x,c.y)}const A=n.length,w=Be.xC(null);let b=!1,P=!1,S=!1,k=!0,M=null;const N=new RegExp("["+W.im+"]");for(;!(s>=A-1);)if(l=h,""!==(h=f())){let t=!(g=!0);switch(h.toUpperCase()){case"X":k=!0,b=!1,P=!1;break;case"M":for(M=v(),null===w.Ai||!0===k?(w.yu(M.x,M.y,b,!1,!P,S),k=!1):w.XD(M.x,M.y),u.c(c);!m();)M=v(),w.xr(M.x,M.y);break;case"L":for(;!m();)M=v(),w.xr(M.x,M.y);g&&(t=!0);break;case"H":for(;!m();)c.e((h===h.toLowerCase()?c.x:0)+parseFloat(f()),c.y),w.xr(c.x,c.y);break;case"V":for(;!m();)c.e(c.x,(h===h.toLowerCase()?c.y:0)+parseFloat(f())),w.xr(c.x,c.y);g&&(t=!0);break;case"C":for(;!m();){var C=new U,L=(p(C),y()),D=v();w.br(C.x,C.y,L.x,L.y,D.x,D.y)}g&&(t=!0);break;case"S":for(;!m();){var T=x(),B=y(),H=v();w.br(T.x,T.y,B.x,B.y,H.x,H.y)}g&&(t=!0);break;case"Q":for(;!m();){var I=y(),K=v();w.Dw(I.x,I.y,K.x,K.y)}g&&(t=!0);break;case"T":for(;!m();){var G=x(),F=(d.c(G),v());w.Dw(G.x,G.y,F.x,F.y),d.c(F)}g&&(t=!0);break;case"B":for(;!m();){var V=parseFloat(f()),z=parseFloat(f());let t=parseFloat(f()),e=parseFloat(f());var Y=parseFloat(f());let i=Y,s=!1;m()||(i=parseFloat(f()),m())||(s=0!==parseFloat(f())),h===h.toLowerCase()&&(t+=c.x,e+=c.y),w.YD(V,z,t,e,Y,i,s)}g&&(t=!0);break;case"A":for(;!m();){var X=Math.abs(parseFloat(f())),q=Math.abs(parseFloat(f())),j=parseFloat(f());let t=!1,e=!1,i=0,s=0;var R=f();s=(i=1===R.length?(t=!!parseFloat(R),e=!!parseFloat(f()),parseFloat(f())):2===R.length?(t=!!parseFloat(R[0]),e=!!parseFloat(R[1]),parseFloat(f())):(t=!!parseFloat(R[0]),e=!!parseFloat(R[1]),parseFloat(R.slice(2))),parseFloat(f())),h===h.toLowerCase()&&(i=c.x+i,s=c.y+s),c.e(i,s),w.KD(X,q,j,t,e,i,s)}g&&(t=!0);break;case"Z":w.UD(),c.c(u);break;case"F":{let t="",e=1;for(;n[s+e];){if("0"===n[s+e])S=!0;else if(null===n[s+e].match(/[Uu]/)&&null!==n[s+e].match(N)){t=n[s+e];break}e++}t.match(/[Mm]/)?b=!0:w.GD();break}case"U":{let t="",e=1;for(;n[s+e];){if(null!==n[s+e].match(/[Ff]/));else if(null!==n[s+e].match(N)){t=n[s+e];break}e++}t.match(/[Mm]/)?P=!0:w.HD(!1);break}default:"0"!==h&&"1"!==h&&Xt.ft("Unknown geometry command: "+h)}if(t){Xt.ft(`Bad geometry command: ${h}, next token: ${f()},
string: `+e);break}}i=w.em;if(Be.bC(w),t)for(var Q=i.figures.iterator;Q.next();)Q.value.isFilled=!0;return i}static kC(e,i){var s=e.length,n=U.a();for(let t=0;t<s;t++){var r=e[t];n.x=r[0],n.y=r[1],i.Pt(n),r[0]=n.x,r[1]=n.y,n.x=r[2],n.y=r[3],i.Pt(n),r[2]=n.x,r[3]=n.y,n.x=r[4],n.y=r[5],i.Pt(n),r[4]=n.x,r[5]=n.y,n.x=r[6],n.y=r[7],i.Pt(n),r[6]=n.x,r[7]=n.y}U.o(n)}Wk(){if(this.Nt)return!0;if(4===this.type){var t=this.figures;if(this._g!==t.mt)return!0;var e=this.figures.h,i=e.length;for(let t=0;t<i;t++)if(e[t].Wk())return!0}return!1}Fw(){if(this.Nt=!1,this.af=null,this.mu=null,this.pu=NaN,4===this.type){var t=this.figures,e=(this._g=t.mt,this.figures.h),i=e.length;for(let t=0;t<i;t++)e[t].vD()}t=this.tm;t.ut(),isNaN(this.ff)||isNaN(this.cf)?t.e(0,0,0,0):t.e(0,0,this.ff,this.cf),this.SC(t,!1),t.unionNoCheck(0,0,0,0),t.w()}computeBoundsWithoutOrigin(){var t=new Z;return this.SC(t,!0),t}SC(n,e){switch(this.type){case 1:case 2:case 3:e?n.e(this.Ae,this.Le,0,0):n.unionNoCheck(this.Ae,this.Le,0,0),n.unionNoCheck(this.ne,this.oe,0,0);break;case 4:var t=this.figures,r=t.h,i=t.length;for(let t=0;t<i;t++){var a=r[t],o=(e&&0===t?n.e(a.startX,a.startY,0,0):n.unionNoCheck(a.startX,a.startY,0,0),a.segments.h),h=o.length;let i=a.startX,s=a.startY;for(let t=0;t<h;t++){var l=o[t];switch(l.type){case 2:case 1:i=l.endX,s=l.endY,n.unionNoCheck(i,s,0,0);break;case 3:I.gu(i,s,l.point1X,l.point1Y,l.point2X,l.point2Y,l.endX,l.endY,.5,n),i=l.endX,s=l.endY;break;case 4:I.qk(i,s,l.point1X,l.point1Y,l.endX,l.endY,.5,n),i=l.endX,s=l.endY;break;case 5:case 6:var u=5===l.type?l.Fo(a):l.Kh(a,i,s),d=u.length;if(0===d)i=5===l.type?l.centerX:l.endX,s=5===l.type?l.centerY:l.endY,n.unionNoCheck(i,s,0,0);else{let e=null;for(let t=0;t<d;t++)e=u[t],I.gu(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],.5,n);null!==e&&(i=e[6],s=e[7])}break;default:Xt.n("Unknown Segment type: "+l.type)}}}break;default:Xt.n("Unknown Geometry type: "+this.type)}}qD(t,e){var i=this.bounds;let s=t/i.width,n=e/i.height;return isFinite(s)||(s=1),isFinite(n)||(n=1),1===s&&1===n?this:this.copy().scale(s,n)}normalize(){this.f&&Xt.O(this);var t=this.computeBoundsWithoutOrigin();return this.offset(-t.x,-t.y),new U(-t.x,-t.y)}offset(t,e){return this.f&&Xt.O(this),Yt,Xt.r(t,W,"offset"),Xt.r(e,W,"offset"),this.D(1,0,0,1,t,e),this}scale(t,e){return this.f&&Xt.O(this),(Yt,Xt.r(t,W,"scale:x"),Xt.r(e,W,"scale:y"),0===t&&Xt.G(t,"scale must be non-zero",W,"scale:x"),0===e)&&Xt.G(e,"scale must be non-zero",W,"scale:y"),this.D(t,0,0,e,0,0),this}rotate(t,e,i){this.f&&Xt.O(this),void 0===e&&(e=0),void 0===i&&(i=0),Yt,Xt.r(t,W,"rotate:angle"),Xt.r(e,W,"rotate:x"),Xt.r(i,W,"rotate:y");var s=H.a();return s.ti(),s.ys(t,e,i),this.D(s.m11,s.m12,s.m21,s.m22,s.dx,s.dy),H.o(s),this}D(e,i,s,n,r,a){let o=0,h=0;switch(this.type){case 1:case 2:case 3:o=this.Ae,h=this.Le,this.Ae=o*e+h*s+r,this.Le=o*i+h*n+a,o=this.ne,h=this.oe,this.ne=o*e+h*s+r,this.oe=o*i+h*n+a;break;case 4:var l=this.figures.h,u=l.length;for(let t=0;t<u;t++){var d=l[t],c=(o=d.startX,h=d.startY,d.startX=o*e+h*s+r,d.startY=o*i+h*n+a,d.segments.h),g=c.length;for(let t=0;t<g;t++){var m=c[t];switch(m.type){case 2:case 1:o=m.endX,h=m.endY,m.endX=o*e+h*s+r,m.endY=o*i+h*n+a;break;case 3:o=m.point1X,h=m.point1Y,m.point1X=o*e+h*s+r,m.point1Y=o*i+h*n+a,o=m.point2X,h=m.point2Y,m.point2X=o*e+h*s+r,m.point2Y=o*i+h*n+a,o=m.endX,h=m.endY,m.endX=o*e+h*s+r,m.endY=o*i+h*n+a;break;case 4:o=m.point1X,h=m.point1Y,m.point1X=o*e+h*s+r,m.point1Y=o*i+h*n+a,o=m.endX,h=m.endY,m.endX=o*e+h*s+r,m.endY=o*i+h*n+a;break;case 5:if(o=m.centerX,h=m.centerY,m.centerX=o*e+h*s+r,m.centerY=o*i+h*n+a,0!==i){let t=180*Math.atan2(i,e)/Math.PI;t<0&&(t+=360),m.startAngle+=t}e<0&&(m.startAngle=180-m.startAngle,m.sweepAngle=-m.sweepAngle),n<0&&(m.startAngle=-m.startAngle,m.sweepAngle=-m.sweepAngle),m.radiusX*=Math.sqrt(e*e+s*s),void 0!==m.radiusY&&(m.radiusY*=Math.sqrt(i*i+n*n));break;case 6:if(o=m.endX,h=m.endY,m.endX=o*e+h*s+r,m.endY=o*i+h*n+a,0!==m.radiusX&&0!==m.radiusY){if(0!==i){let t=180*Math.atan2(i,e)/Math.PI;t<0&&(t+=360),m.xAxisRotation+=t}e<0&&(m.xAxisRotation=180-m.xAxisRotation,m.isClockwiseArc=!m.isClockwiseArc),n<0&&(m.xAxisRotation=-m.xAxisRotation,m.isClockwiseArc=!m.isClockwiseArc),m.radiusX*=Math.sqrt(e*e+s*s),m.radiusY*=Math.sqrt(i*i+n*n)}break;default:Xt.n("Unknown Segment type: "+m.type)}}}}return this.Nt=!0,this}containsPoint(t,e){void 0===e&&(e=0);var i=this.Ae,s=this.Le,n=this.ne,r=this.oe;switch(this.type){case 1:return I.zi(i,s,n,r,e,t.x,t.y);case 2:var a=Math.min(i,n)-e,o=Math.min(s,r)-e,h=Math.abs(n-i)+2*e,l=Math.abs(r-s)+2*e,a=Z.H(a,o,h,l),o=a.containsPoint(t);return Z.o(a),o;case 3:h=Math.min(i,n)-e,l=Math.min(s,r)-e,a=(Math.abs(n-i)+2*e)/2,o=(Math.abs(r-s)+2*e)/2;return!(a<=0||o<=0)&&(h=t.x-(h+a))*h/(a*a)+(l=t.y-(l+o))*l/(o*o)<=1;case 4:return this.jk(t,e,!0,!1);default:return!1}}jk(t,e,i,s){var r=t.x,a=t.y,o=this.bounds.x-20,h=a;let l=0,u=0,d=0,c=0,g=0,m=0;var n=this.figures.h,f=n.length;for(let t=0;t<f;t++){var p=n[t],v=!p.isEvenOdd;if(p.isFilled){if(i&&p.Jk(r,a,e))return!0;var y=p.segments;u=p.startX,d=p.startY;let s=u,n=d;var x=y.h;for(let i=0;i<=y.length;i++){let t,e;switch(m=i!==y.length?(t=x[i],e=t.type,g=t.endX,t.endY):(e=2,g=s,n),e){case 1:var A=this.Rw(r,a,o,h,u,d,s,n);if(isNaN(A))return!0;l+=A,s=g,n=m;break;case 2:A=this.Rw(r,a,o,h,u,d,g,m);if(isNaN(A))return!0;l+=A;break;case 3:c=I.Jg(u,d,t.point1X,t.point1Y,t.point2X,t.point2Y,g,m,o,h,r,a,.5),l+=c;break;case 4:var w=(u+2*t.point1X)/3,b=(d+2*t.point1Y)/3,P=(2*t.point1X+g)/3,S=(2*t.point1Y+m)/3;c=I.Jg(u,d,w,b,P,S,g,m,o,h,r,a,.5),l+=c;break;case 5:case 6:{var k=5===t.type?t.Fo(p):t.Kh(p,u,d),M=k.length;if(0===M){w=this.Rw(r,a,o,h,u,d,5===t.type?t.centerX:t.endX,5===t.type?t.centerY:t.endY);if(isNaN(w))return!0;l+=w;break}let e=null;for(let t=0;t<M;t++){if(e=k[t],0===t){var N=this.Rw(r,a,o,h,u,d,e[0],e[1]);if(isNaN(N))return!0;l+=N}c=I.Jg(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],o,h,r,a,.5),l+=c}null!==e&&(g=e[6],m=e[7]);break}default:Xt.n("Unknown Segment type: "+t.type)}u=g,d=m}if(v){if(0!==l)return!0}else if(l%2!=0)return!0;l=0}else if(p.Jk(r,a,s?e:e+2))return!0}return!1}Rw(t,e,i,s,n,r,a,o){if(I.zi(n,r,a,o,.05,t,e))return NaN;var h=(t-i)*(r-o);if(0==h)return 0;var l=((t*s-e*i)*(n-a)-(t-i)*(n*o-r*a))/h,s=(t*s-e*i)*(r-o)/h;if(t<=l)return 0;if((a<n?n-a:a-n)<(o<r?r-o:o-r)){if(r<o){if(s<r||o<s)return 0}else if(s<o||r<s)return 0}else if(n<a){if(l<n||a<l)return 0}else if(l<a||n<l)return 0;return 0<h?1:-1}MC(e,i,s){var n=this.figures.h,r=n.length;for(let t=0;t<r;t++)if(n[t].Jk(e,i,s))return!0;return!1}getPointAlongPath(t,s){if(t<0?t=0:1<t&&(t=1),void 0===s&&(s=new U),1===this.type)s.e(this.startX+t*(this.endX-this.startX),this.startY+t*(this.endY-this.startY));else{var n=this.flattenedSegments,r=this.flattenedLengths,e=this.flattenedTotalLength,a=n.length,o=e*t;let i=0;for(let e=0;e<a;e++){var h=r[e],l=h.length;for(let t=0;t<l;t++){var u,d,c,g,m,f=h[t];if(i+f>=o)return u=o-i,u=0===f?0:u/f,d=(m=n[e])[2*t],c=m[2*t+1],g=m[2*t+2],m=m[2*t+3],s.e(d+(g-d)*u,c+(m-c)*u),s;i+=f}}}return s}getAngleAlongPath(t){if(t<0?t=0:1<t&&(t=1),1===this.type)return 180*Math.atan2(this.endY-this.startY,this.endX-this.startX)/Math.PI;var i=this.flattenedSegments,s=this.flattenedLengths,e=this.flattenedTotalLength,n=i.length,r=e*t;let a=0;for(let e=0;e<n;e++){var o=s[e],h=o.length;for(let t=0;t<h;t++){var l,u,d,c,g=o[t];if(a+g>=r)return l=(c=i[e])[2*t],u=c[2*t+1],d=c[2*t+2],c=c[2*t+3],Math.abs(d-l)<1&&Math.abs(c-u)<1?0:Math.abs(d-l)<1?0<=c-u?90:270:Math.abs(c-u)<1?0<=d-l?0:180:180*Math.atan2(c-u,d-l)/Math.PI;a+=g}}return NaN}getPointAndAngleAlongPath(t,n){if(t<0?t=0:1<t&&(t=1),(n=void 0===n?[]:n).length=3,1===this.type)n[0]=this.startX+t*(this.endX-this.startX),n[1]=this.startY+t*(this.endY-this.startY),n[2]=180*Math.atan2(this.endY-this.startY,this.endX-this.startX)/Math.PI;else{var r=this.flattenedSegments,e=this.flattenedLengths,i=this.flattenedTotalLength,a=r.length,o=i*t;let s=0;for(let i=0;i<a;i++){var h=e[i],l=h.length;for(let e=0;e<l;e++){var u=h[e];if(s+u>=o){var d=o-s,d=0===u?0:d/u,c=r[i],g=c[2*e],m=c[2*e+1],f=c[2*e+2],c=c[2*e+3];n[0]=g+(f-g)*d,n[1]=m+(c-m)*d;let t;return t=Math.abs(f-g)<1&&Math.abs(c-m)<1?0:Math.abs(f-g)<1?0<=c-m?90:270:Math.abs(c-m)<1?0<=f-g?0:180:180*Math.atan2(c-m,f-g)/Math.PI,n[2]=t,n}s+=u}}}return n}getFractionForPoint(a){if(1===this.type){var i=this.startX,s=this.startY,n=this.endX,r=this.endY;if(i===n&&s===r)return 0;{var o=a.x,h=a.y;let t=0,e=0;return i===n?(e=s<r?(t=s,r):(t=r,s),h<=t?t===s?0:1:h>=e?e===s?0:1:Math.abs(h-s)/(e-t)):s===r?(e=i<n?(t=i,n):(t=n,i),o<=t?t===i?0:1:o>=e?e===i?0:1:Math.abs(o-i)/(e-t)):(x=(n-i)*(n-i)+(r-s)*(r-s),A=U.a(),I.Sl(i,s,n,r,o,h,A),n=A.x,r=A.y,U.o(A),Math.sqrt(((n-i)*(n-i)+(r-s)*(r-s))/x))}}if(2!==this.type){var l=this.flattenedSegments,u=this.flattenedLengths,o=this.flattenedTotalLength,d=U.a();let e=1/0,i=0,s=0;var c=l.length;let n=0,r=0;for(let t=0;t<c;t++){var g=l[t],m=u[t],f=g.length;for(let t=0;t<f;t+=2){var p,v=g[t],y=g[t+1];0===t?(n=v,r=y):(I.Sl(n,r,v,y,a.x,a.y,d),(p=(d.x-a.x)*(d.x-a.x)+(d.y-a.y)*(d.y-a.y))<e&&(e=p,i=s,i+=Math.sqrt((d.x-n)*(d.x-n)+(d.y-r)*(d.y-r))),s+=m[(t-2)/2],n=v,r=y)}}U.o(d);h=i/o;return h<0?0:1<h?1:h}var x,t,e,A=this.startX,n=this.startY,i=this.endX,r=this.endY;return A===i&&n===r?0:(o=2*(s=i-A)+2*(x=r-n),h=a.x,t=a.y,h=Math.min(Math.max(h,A),i),t=Math.min(Math.max(t,n),r),A=Math.abs(h-A),i=Math.abs(h-i),n=Math.abs(t-n),r=Math.abs(t-r),(e=Math.min(A,i,n,r))===n?h/o:e===i?(s+t)/o:e===r?(2*s+x-h)/o:e===A?(2*s+2*x-t)/o:0)}get flattenedSegments(){return this.PC(),this.af}PC(){var t,e;null===this.af&&(t=this.af=[],e=this.mu=[],this.WD(t,e))}get flattenedLengths(){return this.PC(),this.mu}get flattenedTotalLength(){let e=this.pu;if(isNaN(e)){if(1===this.type){var t=Math.abs(this.endX-this.startX),i=Math.abs(this.endY-this.startY);e=Math.sqrt(t*t+i*i)}else if(2===this.type){t=Math.abs(this.endX-this.startX),i=Math.abs(this.endY-this.startY);e=2*t+2*i}else{var s=this.flattenedLengths,n=s.length;for(let t=e=0;t<n;t++){var r=s[t],a=r.length;for(let t=0;t<a;t++)e+=r[t]}}this.pu=e}return e}Zk(e){var i=[];let s=0,n=0;var r=e.length;for(let t=0;t<r;t+=2){var a,o=e[t],h=e[t+1];0===t?(s=o,n=h):(a=Math.sqrt(U.distanceSquared(s,n,o,h)),i.push(a),s=o,n=h)}return i}WD(r,a){let o=[];var t=[];if(1===this.type)o.push(this.startX),o.push(this.startY),o.push(this.endX),o.push(this.endY),r.push(o),t.push(Math.sqrt((this.startX-this.endX)*(this.startX-this.endX)+(this.startY-this.endY)*(this.startY-this.endY))),a.push(t);else if(2===this.type)o.push(this.startX),o.push(this.startY),o.push(this.endX),o.push(this.startY),o.push(this.endX),o.push(this.endY),o.push(this.startX),o.push(this.endY),o.push(this.startX),o.push(this.startY),r.push(o),t.push(Math.abs(this.startX-this.endX)),t.push(Math.abs(this.startY-this.endY)),t.push(Math.abs(this.startX-this.endX)),t.push(Math.abs(this.startY-this.endY)),a.push(t);else if(3===this.type){var t=new k,e=(t.startX=this.endX,t.startY=(this.startY+this.endY)/2,new b(5)),s=(e.startAngle=0,e.sweepAngle=360,e.centerX=(this.startX+this.endX)/2,e.centerY=(this.startY+this.endY)/2,e.radiusX=Math.abs(this.startX-this.endX)/2,e.radiusY=Math.abs(this.startY-this.endY)/2,t.add(e),e.Fo(t)),n=s.length;if(0===n)o.push(e.centerX),o.push(e.centerY);else{let e=t.startX,i=t.startY;for(let t=0;t<n;t++){var h=s[t];I.Hn(e,i,h[2],h[3],h[4],h[5],h[6],h[7],.5,o),e=h[6],i=h[7]}}r.push(o),a.push(this.Zk(o))}else for(var l=this.figures.iterator;l.next();){var u=l.value;(o=[]).push(u.startX),o.push(u.startY);let e=u.startX,i=u.startY,s=e,n=i;var d=u.segments.h,c=d.length;for(let t=0;t<c;t++){var g=d[t];switch(g.type){case 1:4<=o.length&&(r.push(o),a.push(this.Zk(o))),(o=[]).push(g.endX),o.push(g.endY),e=g.endX,i=g.endY,s=e,n=i;break;case 2:o.push(g.endX),o.push(g.endY),e=g.endX,i=g.endY;break;case 3:I.Hn(e,i,g.point1X,g.point1Y,g.point2X,g.point2Y,g.endX,g.endY,.5,o),e=g.endX,i=g.endY;break;case 4:I.Wg(e,i,g.point1X,g.point1Y,g.endX,g.endY,.5,o),e=g.endX,i=g.endY;break;case 5:var m=g.Fo(u),f=m.length;if(0===f)o.push(g.centerX),o.push(g.centerY),e=g.centerX,i=g.centerY;else for(let t=0;t<f;t++){var p=m[t];I.Hn(e,i,p[2],p[3],p[4],p[5],p[6],p[7],.5,o),e=p[6],i=p[7]}break;case 6:var v=g.Kh(u,e,i),y=v.length,x=g.endX,A=g.endY;if(0===y)o.push(x),o.push(A),e=x,i=A;else for(let t=0;t<y;t++){var w=v[t];I.Hn(e,i,w[2],w[3],w[4],w[5],w[6],w[7],.5,o),e=w[6],i=w[7]}break;default:Xt.n("Segment not of valid type: "+g.type)}g.isClosed&&(o.push(s),o.push(n))}4<=o.length&&(r.push(o),a.push(this.Zk(o)))}}get type(){return this.nt}set type(t){this.nt!==t&&(Yt,Xt.it(t,P,"GeometryType"),this.f&&Xt.O(this,t),4===(this.nt=t)?this.zs=new O:(null===W.Tw&&(W.Tw=(new O).w()),this.zs=W.Tw),this.Nt=!0)}get startX(){return this.Ae}set startX(t){this.Ae!==t&&(Yt,Xt.r(t,W,"startX"),this.f&&Xt.O(this,t),this.Ae=t,this.Nt=!0)}get startY(){return this.Le}set startY(t){this.Le!==t&&(Yt,Xt.r(t,W,"startY"),this.f&&Xt.O(this,t),this.Le=t,this.Nt=!0)}get endX(){return this.ne}set endX(t){this.ne!==t&&(Yt,Xt.r(t,W,"endX"),this.f&&Xt.O(this,t),this.ne=t,this.Nt=!0)}get endY(){return this.oe}set endY(t){this.oe!==t&&(Yt,Xt.r(t,W,"endY"),this.f&&Xt.O(this,t),this.oe=t,this.Nt=!0)}get figures(){return this.zs}set figures(t){this.zs!==t&&(Yt,Xt.s(t,O,W,"figures"),this.f&&Xt.O(this,t),this.zs=t,this.Nt=!0)}add(t){return this.zs.add(t),this}setSpots(t,e,i,s,n,r,a,o){return this.f&&Xt.O(this),this.Wn=new J(t,e,n,r).w(),this.jn=new J(i,s,a,o).w(),this}get spot1(){return this.Wn}set spot1(t){Yt,Xt.s(t,J,W,"spot1"),this.f&&Xt.O(this,t),this.Wn=t.L()}get spot2(){return this.jn}set spot2(t){Yt,Xt.s(t,J,W,"spot2"),this.f&&Xt.O(this,t),this.jn=t.L()}get defaultStretch(){return this.Jn}set defaultStretch(t){this.Jn=t}get bounds(){return this.Wk()&&this.Fw(),this.tm}}W.stringify=W.stringify,W.stringifyFixed=W.stringifyFixed,W.fillPath=W.fillPath,W.parse=W.parse;class k{l;Ae;Le;uf;sm;ve;constructor(t,e,i,s,n){this.l=2|((i=void 0===i?!0:i)?4:0)|((s=void 0===s?!0:s)?8:0)|((n=void 0===n?!1:n)?16:0),void 0!==t?(Yt,Xt.r(t,k,"sx"),this.Ae=t):this.Ae=0,void 0!==e?(Yt,Xt.r(e,k,"sy"),this.Le=e):this.Le=0,this.uf=new O,this.sm=this.uf.mt,this.ve=null}copy(){var t=new k,e=(t.l=-2&this.l,t.Ae=this.Ae,t.Le=this.Le,this.uf.h),i=e.length,s=t.uf;for(let t=0;t<i;t++){var n=e[t].copy();s.add(n)}return t.sm=this.sm,t.ve=this.ve,t}equalsApprox(t){if(!(t instanceof k&&I.p(this.startX,t.startX)&&I.p(this.startY,t.startY)))return!1;var e=this.segments.h,i=t.segments.h,s=e.length;if(s!==i.length)return!1;for(let t=0;t<s;t++){var n=e[t],r=i[t];if(!n.equalsApprox(r))return!1}return!0}toString(e){void 0===e&&(e=-1);let i="";i=e<0?"M"+this.startX.toString()+" "+this.startY.toString():"M"+(t=t=>0===t?"0":t.toFixed(e))(this.startX)+" "+t(this.startY);var t,s=this.segments.h,n=s.length;for(let t=0;t<n;t++){var r=s[t];i+=" "+r.toString(e)}return i}get f(){return 0!=(1&this.l)}set f(t){t?this.l|=1:this.l&=-2}get Nt(){return 0!=(2&this.l)}set Nt(t){t?this.l|=2:this.l&=-3}w(){this.f=!0;var t=this.segments,e=(t.w(),t.h),i=t.length;for(let t=0;t<i;t++)e[t].w();return this}ut(){this.f=!1;var t=this.segments,e=(t.ut(),t.h),i=e.length;for(let t=0;t<i;t++)e[t].ut();return this}Wk(){if(this.Nt)return!0;var t=this.segments;if(this.sm!==t.mt)return!0;for(const e of t)if(e.Nt)return!0;return!1}vD(){this.Nt=!1,this.ve=null;var t=this.segments;this.sm=t.mt;for(const e of t)e.Nt=!1,e.Xs=null}get isFilled(){return 0!=(4&this.l)}set isFilled(t){Yt,Xt.t(t,"boolean",k,"isFilled"),this.f&&Xt.O(this,t),t?this.l|=4:this.l&=-5}get isShadowed(){return 0!=(8&this.l)}set isShadowed(t){Yt,Xt.t(t,"boolean",k,"isShadowed"),this.f&&Xt.O(this,t),t?this.l|=8:this.l&=-9}get isEvenOdd(){return 0!=(16&this.l)}set isEvenOdd(t){Yt,Xt.t(t,"boolean",k,"isEvenOdd"),this.f&&Xt.O(this,t),t?this.l|=16:this.l&=-17}get startX(){return this.Ae}set startX(t){Yt,Xt.r(t,k,"startX"),this.f&&Xt.O(this,t),this.Ae=t,this.ve=null,this.Nt=!0}get startY(){return this.Le}set startY(t){Yt,Xt.r(t,k,"startY"),this.f&&Xt.O(this,t),this.Le=t,this.ve=null,this.Nt=!0}get segments(){return this.uf}set segments(t){Yt,Xt.s(t,O,k,"segments"),this.f&&Xt.O(this,t),this.uf=t,this.ve=null,this.Nt=!0}add(t){return this.uf.add(t),this.ve=null,this}Jk(i,s,n){var e=this;let r=e.startX,a=e.startY,o=r,h=a;var l=e.segments.h,u=l.length;for(let t=0;t<u;t++){var d=l[t];switch(d.type){case 1:o=d.endX,h=d.endY,r=d.endX,a=d.endY;break;case 2:if(I.zi(r,a,d.endX,d.endY,n,i,s))return!0;r=d.endX,a=d.endY;break;case 3:if(I.Aw(r,a,d.point1X,d.point1Y,d.point2X,d.point2Y,d.endX,d.endY,.5,i,s,n))return!0;r=d.endX,a=d.endY;break;case 4:if(I.vk(r,a,d.point1X,d.point1Y,d.endX,d.endY,.5,i,s,n))return!0;r=d.endX,a=d.endY;break;case 5:case 6:var c=5===d.type?d.Fo(e):d.Kh(e,r,a),g=c.length,m=5===d.type?d.centerX:d.endX,f=5===d.type?d.centerY:d.endY;if(0===g){if(I.zi(r,a,m,f,n,i,s))return!0;r=m,a=f}else{let e=null;for(let t=0;t<g;t++)if(e=c[t],0===t&&I.zi(r,a,e[0],e[1],n,i,s)||I.Aw(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],.5,i,s,n))return!0;null!==e&&(r=e[6],a=e[7])}break;default:Xt.n("Unknown Segment type: "+d.type)}if(d.isClosed&&(r!==o||a!==h)&&I.zi(r,a,o,h,n,i,s))return!0}return!1}}(t={})[t.Move=1]="Move",t[t.Line=2]="Line",t[t.Bezier=3]="Bezier",t[t.QuadraticBezier=4]="QuadraticBezier",t[t.Arc=5]="Arc",t[t.SvgArc=6]="SvgArc";var M=t;class b{nt;l;ne;oe;gn;Pl;Nl;kr;Xs;constructor(t,e,i,s,n,r,a,o){if(C.ji(this),void 0===t?t=2:(Yt,Xt.it(t,M,"SegmentType")),this.nt=t,this.l=2,void 0!==e?(Yt,Xt.r(e,b,"ex"),this.ne=e):this.ne=0,void 0!==i?(Yt,Xt.r(i,b,"ey"),this.oe=i):this.oe=0,void 0===s&&(s=0),void 0===n&&(n=0),void 0===r&&(r=0),void 0===a&&(a=0),6===t){let t=r;(t%=360)<0&&(t+=360),this.gn=t,this.Pl=0,Yt,Xt.r(s,b,"x1"),this.Nl=Math.max(s,0),Yt,Xt.r(n,b,"y1"),this.kr=Math.max(n,0),"boolean"==typeof a?a&&(this.isLargeArc=!0):"number"==typeof a&&a&&(this.isLargeArc=!0),o&&(this.isClockwiseArc=!0)}else Yt,Xt.r(s,b,"x1"),this.gn=s,Yt,Xt.r(n,b,"y1"),this.Pl=n,Yt,Xt.r(r,b,"x2"),5===t&&(r=Math.max(r,0)),this.Nl=r,"number"==typeof a?(5===t&&(a=Math.max(a,0)),this.kr=a):this.kr=0;this.Xs=null}copy(){var t=new b;return t.nt=this.nt,t.l=-2&this.l,t.ne=this.ne,t.oe=this.oe,t.gn=this.gn,t.Pl=this.Pl,t.Nl=this.Nl,t.kr=this.kr,t}equalsApprox(t){if(!(t instanceof b)||this.type!==t.type||this.isClosed!==t.isClosed)return!1;switch(this.type){case 1:case 2:return I.p(this.endX,t.endX)&&I.p(this.endY,t.endY);case 3:return I.p(this.endX,t.endX)&&I.p(this.endY,t.endY)&&I.p(this.point1X,t.point1X)&&I.p(this.point1Y,t.point1Y)&&I.p(this.point2X,t.point2X)&&I.p(this.point2Y,t.point2Y);case 4:return I.p(this.endX,t.endX)&&I.p(this.endY,t.endY)&&I.p(this.point1X,t.point1X)&&I.p(this.point1Y,t.point1Y);case 5:return I.p(this.startAngle,t.startAngle)&&I.p(this.sweepAngle,t.sweepAngle)&&I.p(this.centerX,t.centerX)&&I.p(this.centerY,t.centerY)&&I.p(this.radiusX,t.radiusX)&&I.p(this.radiusY,t.radiusY);case 6:return this.isClockwiseArc===t.isClockwiseArc&&this.isLargeArc===t.isLargeArc&&I.p(this.xAxisRotation,t.xAxisRotation)&&I.p(this.endX,t.endX)&&I.p(this.endY,t.endY)&&I.p(this.radiusX,t.radiusX)&&I.p(this.radiusY,t.radiusY);default:return!1}}ci(t){t in M?this.type=t:Xt.gr(this,t)}toString(e){void 0===e&&(e=-1);var t=t=>0===t?"0":t.toFixed(e);let i="";switch(this.type){case 1:i=e<0?"M"+this.endX.toString()+" "+this.endY.toString():"M"+t(this.endX)+" "+t(this.endY);break;case 2:i=e<0?"L"+this.endX.toString()+" "+this.endY.toString():"L"+t(this.endX)+" "+t(this.endY);break;case 3:i=e<0?"C"+this.point1X.toString()+" "+this.point1Y.toString()+" "+this.point2X.toString()+" "+this.point2Y.toString()+" "+this.endX.toString()+" "+this.endY.toString():"C"+t(this.point1X)+" "+t(this.point1Y)+" "+t(this.point2X)+" "+t(this.point2Y)+" "+t(this.endX)+" "+t(this.endY);break;case 4:i=e<0?"Q"+this.point1X.toString()+" "+this.point1Y.toString()+" "+this.endX.toString()+" "+this.endY.toString():"Q"+t(this.point1X)+" "+t(this.point1Y)+" "+t(this.endX)+" "+t(this.endY);break;case 5:i=e<0?"B"+this.startAngle.toString()+" "+this.sweepAngle.toString()+" "+this.centerX.toString()+" "+this.centerY.toString()+" "+this.radiusX.toString()+" "+this.radiusY.toString():"B"+t(this.startAngle)+" "+t(this.sweepAngle)+" "+t(this.centerX)+" "+t(this.centerY)+" "+t(this.radiusX)+" "+t(this.radiusY);break;case 6:i=e<0?"A"+this.radiusX.toString()+" "+this.radiusY.toString()+" "+this.xAxisRotation.toString()+" "+(this.isLargeArc?1:0)+" "+(this.isClockwiseArc?1:0)+" "+this.endX.toString()+" "+this.endY.toString():"A"+t(this.radiusX)+" "+t(this.radiusY)+" "+t(this.xAxisRotation)+" "+(this.isLargeArc?1:0)+" "+(this.isClockwiseArc?1:0)+" "+t(this.endX)+" "+t(this.endY);break;default:i=M[this.type]}return i+(this.isClosed?"z":"")}static Move=1;static Line=2;static Bezier=3;static QuadraticBezier=4;static Arc=5;static SvgArc=6;get f(){return 0!=(1&this.l)}set f(t){t?this.l|=1:this.l&=-2}get Nt(){return 0!=(2&this.l)}set Nt(t){t?this.l|=2:this.l&=-3}w(){return this.f=!0,this}ut(){return this.f=!1,this}close(){return this.isClosed=!0,this}Fo(e){if(null===this.Xs||!1!==e.Nt){e=this.radiusX;let t=this.radiusY;if(void 0===t&&(t=e),0===e||0===t)this.Xs=[];else{var i,s=this.gn,n=this.Pl,r=I.pC(0,0,e<t?e:t,this.startAngle,this.startAngle+this.sweepAngle,!1),a=(e!==t&&((i=H.a()).ti(),e<t?i.v(1,t/e):i.v(e/t,1),W.kC(r,i),H.o(i)),r.length);for(let t=0;t<a;t++){var o=r[t];o[0]+=s,o[1]+=n,o[2]+=s,o[3]+=n,o[4]+=s,o[5]+=n,o[6]+=s,o[7]+=n}this.Xs=r}}return this.Xs}Kh(a,o,h){if(null===this.Xs||!1!==a.Nt)if(0===this.radiusX||0===this.radiusY)this.Xs=[];else{a=o,o=h;let t=this.Nl,e=this.kr;0===t&&(t=1e-4),0===e&&(e=1e-4);var h=this.gn*(Math.PI/180),l=this.isLargeArc,u=this.isClockwiseArc,d=this.ne,c=this.oe,g=Math.cos(h),h=Math.sin(h),m=g*(a-d)/2+h*(o-c)/2,f=-h*(a-d)/2+g*(o-c)/2,p=m*m/(t*t)+f*f/(e*e);1<p&&(t*=Math.sqrt(p),e*=Math.sqrt(p));let i=(l===u?-1:1)*Math.sqrt((t*t*e*e-t*t*f*f-e*e*m*m)/(t*t*f*f+e*e*m*m)),s=(i=isNaN(i)?0:i)*t*f/e,n=i*-e*m/t;isNaN(s)&&(s=0),isNaN(n)&&(n=0);const v=(a+d)/2+g*s-h*n,y=(o+c)/2+h*s+g*n,x=(t,e)=>Math.sqrt(t*t+e*e),A=(t,e,i,s)=>(t*i+e*s)/(x(t,e)*x(i,s)),w=(t,e,i,s)=>(t*s<e*i?-1:1)*Math.acos(A(t,e,i,s)),b=w(1,0,(m-s)/t,(f-n)/e),P=(m-s)/t,S=(f-n)/e,k=(-m-s)/t,M=(-f-n)/e;let r=w(P,S,k,M);p=A(P,S,k,M),l=(p<=-1?r=Math.PI:1<=p&&(r=0),!u&&0<r&&(r-=2*Math.PI),u&&r<0&&(r+=2*Math.PI),t>e?t:e),a=t>e?1:t/e,d=t>e?e/t:1,o=I.pC(0,0,l,b,b+r,!0),c=H.a();c.ti(),c.se(v,y),c.ys(this.gn,0,0),c.v(a,d),W.kC(o,c),H.o(c),this.Xs=o}return this.Xs}get isClosed(){return 0!=(8&this.l)}set isClosed(t){this.isClosed!==t&&(t?this.l|=8:this.l&=-9,this.Nt=!0)}get type(){return this.nt}set type(t){Yt,Xt.it(t,M,"SegmentType"),this.f&&Xt.O(this,t),this.nt=t,this.Nt=!0}get endX(){return this.ne}set endX(t){Yt,Xt.r(t,b,"endX"),this.f&&Xt.O(this,t),this.ne=t,this.Nt=!0}get endY(){return this.oe}set endY(t){Yt,Xt.r(t,b,"endY"),this.f&&Xt.O(this,t),this.oe=t,this.Nt=!0}get point1X(){return this.gn}set point1X(t){Yt,Xt.r(t,b,"point1X"),this.f&&Xt.O(this,t),this.gn=t,this.Nt=!0}get point1Y(){return this.Pl}set point1Y(t){Yt,Xt.r(t,b,"point1Y"),this.f&&Xt.O(this,t),this.Pl=t,this.Nt=!0}get point2X(){return this.Nl}set point2X(t){Yt,Xt.r(t,b,"point2X"),this.f&&Xt.O(this,t),this.Nl=t,this.Nt=!0}get point2Y(){return this.kr}set point2Y(t){Yt,Xt.r(t,b,"point2Y"),this.f&&Xt.O(this,t),this.kr=t,this.Nt=!0}get centerX(){return this.gn}set centerX(t){Yt,Xt.r(t,b,"centerX"),this.f&&Xt.O(this,t),this.gn=t,this.Nt=!0}get centerY(){return this.Pl}set centerY(t){Yt,Xt.r(t,b,"centerY"),this.f&&Xt.O(this,t),this.Pl=t,this.Nt=!0}get radiusX(){return this.Nl}set radiusX(t){Yt,Xt.r(t,b,"radiusX"),t<0&&Xt.G(t,">= zero",b,"radiusX"),this.f&&Xt.O(this,t),this.Nl=t,this.Nt=!0}get radiusY(){return this.kr}set radiusY(t){Yt,Xt.r(t,b,"radiusY"),t<0&&Xt.G(t,">= zero",b,"radiusY"),this.f&&Xt.O(this,t),this.kr=t,this.Nt=!0}get startAngle(){return this.ne}set startAngle(t){Yt,Xt.r(t,b,"startAngle"),this.f&&Xt.O(this,t),(t%=360)<0&&(t+=360),this.ne=t,this.Nt=!0}get sweepAngle(){return this.oe}set sweepAngle(t){Yt,Xt.r(t,b,"sweepAngle"),this.f&&Xt.O(this,t),this.oe=t=(t=360<t?360:t)<-360?-360:t,this.Nt=!0}get isClockwiseArc(){return 0!=(4&this.l)}set isClockwiseArc(t){this.f&&Xt.O(this,t),t?this.l|=4:this.l&=-5,this.Nt=!0}get isLargeArc(){return 0!=(16&this.l)}set isLargeArc(t){this.f&&Xt.O(this,t),t?this.l|=16:this.l&=-17,this.Nt=!0}get xAxisRotation(){return this.gn}set xAxisRotation(t){Yt,Xt.r(t,b,"xAxisRotation"),this.f&&Xt.O(this,t),(t%=360)<0&&(t+=360),this.gn=t,this.Nt=!0}}class N{b;Iw;Ow;nm;om;rm;lm;hm;am;fm;cm;um;dm;gm;Ro;mm;pm;ym;Te;constructor(){this.b=null,this.Iw=new U(0,0).w(),this.Ow=new U(0,0).w(),this.nm=0,this.om=0,this.rm=1,this.lm="",this.hm="",this.am=!1,this.fm=!1,this.cm=0,this.um=0,this.dm=!1,this.gm=!1,this.Ro=!1,this.mm=null,this.pm=0,this.ym=null,this.Te=null}copy(){var t=new N;return this.clone(t)}clone(t){return t.b=this.b,t.Iw.c(this.viewPoint),t.Ow.c(this.documentPoint),t.nm=this.nm,t.om=this.om,t.rm=this.rm,t.lm=this.lm,t.hm=this.hm,t.am=this.am,t.fm=this.fm,t.cm=this.cm,t.um=this.um,t.dm=this.dm,t.gm=this.gm,t.Ro=this.Ro,t.mm=this.mm,t.pm=this.pm,t.ym=this.ym,t.Te=this.Te,t}toString(){let t="^";return 0!==this.modifiers&&(t+="M:"+this.modifiers),0!==this.button&&(t+="B:"+this.button),""!==this.key&&(t+="K:"+this.key),0!==this.clickCount&&(t+="C:"+this.clickCount),0!==this.delta&&(t+="D:"+this.delta),this.handled&&(t+="h"),this.bubbles&&(t+="b"),null!==this.documentPoint&&(t+="@"+this.documentPoint.toString()),t}get diagram(){return this.b}set diagram(t){this.b=t}get viewPoint(){return this.Iw}set viewPoint(t){Xt.s(t,U,N,"viewPoint"),this.Iw.c(t)}get documentPoint(){return this.Ow}set documentPoint(t){Xt.s(t,U,N,"documentPoint"),this.Ow.c(t)}getMultiTouchViewPoint(t,e){var i=this.diagram;return null!==i&&i.NC(this.event,t,e),e}getMultiTouchDocumentPoint(t,e){var i=this.diagram;return null!==i&&(i.NC(this.event,t,e),e.c(i.transformViewToDoc(e))),e}get modifiers(){return this.nm}set modifiers(t){this.nm=t}get button(){return this.om}set button(t){if(this.om=t,null===this.event)switch(t){case 0:return void(this.buttons=1);case 1:return void(this.buttons=4);case 2:return void(this.buttons=2)}}get buttons(){return this.rm}set buttons(t){this.rm=t}get key(){return this.lm}set key(t){this.lm=t}get code(){return this.hm}set code(t){this.hm=t}get down(){return this.am}set down(t){this.am=t}get up(){return this.fm}set up(t){this.fm=t}get clickCount(){return this.cm}set clickCount(t){this.cm=t}get delta(){return this.um}set delta(t){this.um=t}get isMultiTouch(){return this.dm}set isMultiTouch(t){this.dm=t}get handled(){return this.gm}set handled(t){this.gm=t}get bubbles(){return this.Ro}set bubbles(t){this.Ro=t}get event(){return this.mm}set event(t){this.mm=t}get isTouchEvent(){var t=this.event;return null!==t&&("touch"===t.pointerType||"pen"===t.pointerType)}get timestamp(){return this.pm}set timestamp(t){this.pm=t}get targetDiagram(){return this.ym}set targetDiagram(t){this.ym=t}get targetObject(){return this.Te}set targetObject(t){this.Te=t}get control(){return 0!=(1&this.modifiers)}set control(t){this.modifiers=t?1|this.modifiers:-2&this.modifiers}get shift(){return 0!=(4&this.modifiers)}set shift(t){this.modifiers=t?4|this.modifiers:-5&this.modifiers}get alt(){return 0!=(2&this.modifiers)}set alt(t){this.modifiers=t?2|this.modifiers:-3&this.modifiers}get meta(){return 0!=(8&this.modifiers)}set meta(t){this.modifiers=t?8|this.modifiers:-9&this.modifiers}get left(){var t=this.event;return null===t||"mousedown"!==t.type&&"mouseup"!==t.type&&"pointerdown"!==t.type&&"pointerup"!==t.type?0!=(1&this.buttons):0===this.button}set left(t){t?this.buttons|=1:this.buttons&=-2}get right(){var t=this.event;return null===t||"mousedown"!==t.type&&"mouseup"!==t.type&&"pointerdown"!==t.type&&"pointerup"!==t.type?0!=(2&this.buttons):2===this.button}set right(t){t?this.buttons|=2:this.buttons&=-3}get middle(){var t=this.event;return null===t||"mousedown"!==t.type&&"mouseup"!==t.type&&"pointerdown"!==t.type&&"pointerup"!==t.type?0!=(4&this.buttons):1===this.button}set middle(t){t?this.buttons|=4:this.buttons&=-5}}class B{b;Tt;wm;xm;constructor(){this.b=null,this.Tt="",this.wm=null,this.xm=null}copy(){var t=new B;return t.b=this.b,t.Tt=this.Tt,t.wm=this.wm,t.xm=this.xm,t}toString(){let t="*"+this.name;return null!==this.subject&&(t+=":"+this.subject.toString()),null!==this.parameter&&(t+="("+this.parameter.toString()+")"),t}get diagram(){return this.b}set diagram(t){this.b=t}get name(){return this.Tt}set name(t){this.Tt=t}get subject(){return this.wm}set subject(t){this.wm=t}get parameter(){return this.xm}set parameter(t){this.xm=t}}(t={})[t.Transaction=1]="Transaction",t[t.Property=2]="Property",t[t.Insert=3]="Insert",t[t.Remove=4]="Remove";var G=t;class F{wu;bm;mn;Li;b;xu;df;gf;mf;pf;constructor(){this.wu=2,this.bm="",this.mn="",this.Li=null,this.b=null,this.xu=null,this.df=null,this.gf=null,this.mf=null,this.pf=null}static Transaction=1;static Property=2;static Insert=3;static Remove=4;clear(){this.Li=null,this.b=null,this.xu=null,this.df=null,this.gf=null,this.mf=null,this.pf=null}copy(){var t=new F;t.wu=this.wu,t.bm=this.bm,t.mn=this.mn,t.Li=this.Li,t.b=this.b,t.xu=this.xu;let e=this.df;return Xt.Mt(e)&&"function"==typeof e.copyFrozen?t.df=e.copyFrozen():t.df=e,e=this.gf,Xt.Mt(e)&&"function"==typeof e.copyFrozen?t.gf=e.copyFrozen():t.gf=e,e=this.mf,Xt.Mt(e)&&"function"==typeof e.copyFrozen?t.mf=e.copyFrozen():t.mf=e,e=this.pf,Xt.Mt(e)&&"function"==typeof e.copyFrozen?t.pf=e.copyFrozen():t.pf=e,t}ci(t){t in G?this.change=t:Xt.gr(this,t)}toString(){let t="";return 1===this.change?t+="* ":2===this.change?t+=null!==this.model?"!m":"!d":t+=(null!==this.model?"!m":"!d")+this.change,this.propertyName&&"string"==typeof this.propertyName&&(t+=" "+this.propertyName),this.modelChange&&this.modelChange!==this.propertyName&&(t+=" "+this.modelChange),t+=": ",1===this.change?null!==this.oldValue&&(t+=" "+this.oldValue):(null!==this.object&&(t+=Xt.toString(this.object)),null!==this.oldValue&&(t+="  old: "+Xt.toString(this.oldValue)),null!==this.oldParam&&(t+=" "+this.oldParam),null!==this.newValue&&(t+="  new: "+Xt.toString(this.newValue)),null!==this.newParam&&(t+=" "+this.newParam)),t}getValue(t){return t?this.oldValue:this.newValue}getParam(t){return t?this.oldParam:this.newParam}canUndo(){return null!==this.model||null!==this.diagram}undo(){this.canUndo()&&(null!==this.model?this.model.changeState(this,!0):null!==this.diagram&&this.diagram.CC(this,!0))}canRedo(){return null!==this.model||null!==this.diagram}redo(){this.canRedo()&&(null!==this.model?this.model.changeState(this,!1):null!==this.diagram&&this.diagram.CC(this,!1))}get model(){return this.Li}set model(t){this.Li=t}get diagram(){return this.b}set diagram(t){this.b=t}get change(){return this.wu}set change(t){this.wu=t}get modelChange(){return this.bm}set modelChange(t){Yt,Xt.t(t,"string",F,"modelChange"),this.bm=t}get propertyName(){return this.mn}set propertyName(t){Yt,"string"!=typeof t&&Xt.t(t,"function",F,"propertyName"),this.mn=t}get isTransactionFinished(){return 1===this.wu&&("CommittedTransaction"===this.mn||"FinishedUndo"===this.mn||"FinishedRedo"===this.mn)}get object(){return this.xu}set object(t){this.xu=t}get oldValue(){return this.df}set oldValue(t){this.df=t}get oldParam(){return this.gf}set oldParam(t){this.gf=t}get newValue(){return this.mf}set newValue(t){this.mf=t}get newParam(){return this.pf}set newParam(t){this.pf=t}}class R{AC;Tt;$k;constructor(){this.AC=(new O).w(),this.Tt="",this.$k=!1}toString(t){let e="Transaction: "+this.name+" "+this.changes.count.toString()+(this.isComplete?"":", incomplete");if(void 0!==t&&0<t){var i=this.changes.count;for(let t=0;t<i;t++){var s=this.changes.elt(t);null!==s&&(e+=`
  `+s.toString())}}return e}clear(){var e=this.changes;e.ut();for(let t=e.count-1;0<=t;t--){var i=e.elt(t);null!==i&&i.clear()}e.clear(),e.w()}canUndo(){return this.isComplete}undo(){if(this.canUndo())for(let t=this.changes.count-1;0<=t;t--){var e=this.changes.elt(t);null!==e&&e.undo()}}canRedo(){return this.isComplete}redo(){if(this.canRedo()){var e=this.changes.count;for(let t=0;t<e;t++){var i=this.changes.elt(t);null!==i&&i.redo()}}}jD(e){var i=this.changes;for(let t=i.count-1;t>=e;t--){var s=i.elt(t);null!==s&&s.undo(),i.ut(),i.removeAt(t)}i.w()}optimize(){if(this.isComplete){var i=this.changes,s=(i.ut(),new L);for(let e=0;e<i.count;e++){var n=i.elt(e);if(null!==n&&2===n.change&&n.object){let t=s.get(n.object);t||(t=new L,s.set(n.object,t));var r=t.get(n.propertyName);null===r?t.set(n.propertyName,-1):(0<r&&i.setElt(r,null),t.set(n.propertyName,e))}}let e=0;for(let t=0;t<i.count;t++){var a=i.elt(t);null!==a&&(t>e&&i.setElt(e,a),e++)}for(;i.length>e;)i.pop();i.w()}}get changes(){return this.AC}get name(){return this.Tt}set name(t){this.Tt=t}get isComplete(){return this.$k}set isComplete(t){this.$k=t}}class Q{Ew;Xi;LC;Ys;Qk;km;Zn;Vw;_k;pn;yf;Bw;Ks;zw;Xw;Sm;Yw;constructor(t){this.Ew=new C,this.Xi=!1,this.LC=(new O).w(),this.Ys=-1,this.Qk=999,this.Ks=!1,this.km=null,this.Zn=0,this.Vw=!1,Yt,this.Vw=!0,this._k=23,this.pn=(new O).w(),this.yf=new O,this.Bw=!0,this.zw=!1,this.Xw=!1,this.Sm=!1,this.Yw=!1,t&&Object.assign(this,t)}toString(e){let i="UndoManager "+this.historyIndex+"<"+this.history.count+"<="+this.maxHistoryLength,s=(i+="[",this.nestedTransactionNames.count);for(let t=0;t<s;t++)0<t&&(i+=" "),i+=this.nestedTransactionNames.elt(t);if(i+="]",void 0!==e&&0<e){s=this.history.count;for(let t=0;t<s;t++)i+=`
 `+this.history.elt(t).toString(e-1)}return i}clear(){var e=this.history;e.ut();for(let t=e.count-1;0<=t;t--){var i=e.elt(t);null!==i&&i.clear()}e.clear(),this.Ys=-1,e.w(),this.Ks=!1,this.km=null,this.Zn=0,this.pn.ut(),this.pn.clear(),this.pn.w(),this.yf.clear(),this.zw=!1,this.Xw=!1,this.Sm=!1,this.Yw=!1}copyProperties(t){this.isEnabled=t.isEnabled,this.maxHistoryLength=t.maxHistoryLength,this.bu=t.bu}addModel(t){this.Ew.add(t)}removeModel(t){this.Ew.remove(t)}startTransaction(t){if(null===(t=void 0===t?"":t)&&(t=""),this.isUndoingRedoing)return!1;!0===this.Bw&&(this.Bw=!1,this.Zn++,this.Cl||this.i("StartingFirstTransaction",t,this.currentTransaction),0<this.Zn)&&this.Zn--,this.isEnabled&&(this.pn.ut(),this.pn.add(t),this.pn.w(),null===this.currentTransaction?this.yf.add(0):this.yf.add(this.currentTransaction.changes.count)),this.Zn++;var e=1===this.transactionLevel;return!e||this.Cl||this.i("StartedTransaction",t,this.currentTransaction),e}commitTransaction(t){return this.TC(!0,t=void 0===t?"":t)}rollbackTransaction(){return this.TC(!1,"")}TC(i,s){if(!this.isUndoingRedoing){this.bu&&this.transactionLevel<1&&Xt.ft("Ending transaction without having started a transaction: "+s);var n,r,a,o=1===this.transactionLevel;let t=this.currentTransaction,e=(o&&i&&(this.Cl||this.i("CommittingTransaction",s,t)),0);if(0<this.transactionLevel&&(this.Zn--,this.isEnabled)&&(0<(n=this.pn.count)&&(""===s&&(s=this.pn.elt(0)),this.pn.ut(),this.pn.removeAt(n-1),this.pn.w()),0<(n=this.yf.count)&&(e=this.yf.elt(n-1),this.yf.removeAt(n-1))),o){if(i)this.Sm=!1,null===t&&""!==s&&(t=this.currentTransaction),this.isEnabled&&null!==t&&((n=t).isComplete||(n.isComplete=!0,n.name=s),this.discardHistoryAfterIndex(),(o=this.history).ut(),0<=(r=this.maxHistoryLength)&&(0===r?o.clear():o.count>=r&&(null!==(a=o.elt(0))&&a.clear(),o.removeAt(0),this.Ys--)),0===r||0!==o.count&&o.get(o.count-1)===n||(o.add(n),this.Ys++),o.w(),t=n),this.Cl||this.i("CommittedTransaction",s,t);else{this.Ks=!0;try{this.isEnabled&&null!==t&&(t.isComplete=!0,t.undo())}finally{this.Cl||this.i("RolledBackTransaction",s,t),this.Ks=!1}null!==t&&t.clear()}return this.km=null,this.Kw&&this.clear(),this.Kw=!1,!(this.Uw=!1)}this.isEnabled&&!i&&null!==t&&t.jD(e)}return!1}discardHistoryAfterIndex(){if(!this.isUndoingRedoing&&this.canRedo()){var e=this.history;e.ut();for(let t=e.count-1;t>this.historyIndex;t--){var i=e.elt(t);null!==i&&i.clear(),e.removeAt(t),this.Sm=!0}e.w()}}oE(t){this.Zn+=t,this.Zn<0&&(this.Zn=0)}canUndo(){var t;return!(!this.isEnabled||0<this.transactionLevel||null===(t=this.transactionToUndo)||!t.canUndo())}undo(){if(this.canUndo()){var t=this.transactionToUndo;try{this.Ks=!0,this.i("StartingUndo","Undo",t),this.Ys--,t.undo()}catch(t){Xt.ft("undo error: "+t.toString())}finally{this.i("FinishedUndo","Undo",t),this.Ks=!1}}}canRedo(){var t;return!(!this.isEnabled||0<this.transactionLevel||null===(t=this.transactionToRedo)||!t.canRedo())}redo(){if(this.canRedo()){var t=this.transactionToRedo;try{this.Ks=!0,this.i("StartingRedo","Redo",t),this.Ys++,t.redo()}catch(t){Xt.ft("redo error: "+t.toString())}finally{this.i("FinishedRedo","Redo",t),this.Ks=!1}}}i(t,e,i){void 0===i&&(i=null);for(var s=new F,n=(s.change=1,s.propertyName=t,s.object=i,s.oldValue=e,this.models);n.next();){var r=n.value;(s.model=r).Gw(s)}}handleChanged(e){if(this.isEnabled&&!this.isUndoingRedoing&&!this.skipsEvent(e)){let t=this.currentTransaction;null===t&&(t=new R,this.km=t);var i=e.copy(),s=t.changes;s.ut(),s.add(i),s.w(),this.bu&&0<this._k&&this.transactionLevel<=0&&!this.Bw&&(null!==(s=e.diagram)&&!1===s.Uh||(Xt.ft("Change not within a transaction: "+i.toString()),this._k--))}}skipsEvent(t){if(null===t||1===t.change)return!0;t=t.object;if(null!==t)if(void 0!==t.layer){var e=t.layer;if(null!==e&&e.isTemporary)return!0}else if(t.isTemporary)return!0;return!1}get models(){return this.Ew.iterator}get isEnabled(){return this.Xi}set isEnabled(t){this.Xi=t}get transactionToUndo(){return 0<=this.historyIndex&&this.historyIndex<=this.history.count-1?this.history.elt(this.historyIndex):null}get transactionToRedo(){return this.historyIndex<this.history.count-1?this.history.elt(this.historyIndex+1):null}get isUndoingRedoing(){return this.Ks}get history(){return this.LC}get maxHistoryLength(){return this.Qk}set maxHistoryLength(t){this.Qk=t}get historyIndex(){return this.Ys}get currentTransaction(){return this.km}get transactionLevel(){return this.Zn}get isInTransaction(){return 0<this.Zn}get bu(){return this.Vw}set bu(t){this.Vw=t}get nestedTransactionNames(){return this.pn}get Kw(){return this.zw}set Kw(t){this.zw=t}get Uw(){return this.Xw}set Uw(t){this.Xw=t}get Cl(){return this.Yw}set Cl(t){this.Yw=t}get isJustDiscarded(){return this.Sm}}class _{b;Tt;Xi;tS;iS;Mm;DC;constructor(){C.ji(this),this.b=K.Pm(),this.Tt="",this.Xi=!0,this.tS=!1,this.iS=null,this.DC=new N,this.Mm=-1}get diagram(){return this.b}set diagram(t){t instanceof K&&(this.b=t)}toString(){return""!==this.name?this.name+" Tool":Xt.an(this.constructor)}updateAdornments(t){}canStart(){return this.isEnabled}doStart(){}doActivate(){this.isActive=!0}doDeactivate(){this.isActive=!1}doStop(){}doCancel(){this.transactionResult=null,this.stopTool()}stopTool(){var t=this.diagram;t.currentTool===this&&(t.currentTool=null,t.currentCursor="")}doMouseDown(){!this.isActive&&this.canStart()&&this.doActivate()}doMouseMove(){}doMouseUp(){this.stopTool()}doMouseWheel(){}canStartMultiTouch(){return!0}standardPinchZoomStart(){var t,e,i=this.diagram,s=i.lastInput,n=s.getMultiTouchViewPoint(0,U.H(NaN,NaN)),r=s.getMultiTouchViewPoint(1,U.H(NaN,NaN));n.isReal()&&r.isReal()&&(this.doCancel(),i.getInputOption("hasGestureZoom"))&&(i.eS=i.scale,e=r.x-n.x,t=r.y-n.y,e=Math.sqrt(e*e+t*t),i.sS=e,s.bubbles=!1),U.o(n),U.o(r)}standardPinchZoomMove(){var t,e,i,s,n=this.diagram,r=n.lastInput,a=r.getMultiTouchViewPoint(0,U.H(NaN,NaN)),o=r.getMultiTouchViewPoint(1,U.H(NaN,NaN));a.isReal()&&o.isReal()&&(this.doCancel(),n.getInputOption("hasGestureZoom"))&&(e=o.x-a.x,t=o.y-a.y,e=Math.sqrt(e*e+t*t)/n.sS,t=new U((Math.min(o.x,a.x)+Math.max(o.x,a.x))/2,(Math.min(o.y,a.y)+Math.max(o.y,a.y))/2),e=n.eS*e,i=n.commandHandler,e!==n.scale&&i.canResetZoom(e)&&(s=n.zoomPoint,n.zoomPoint=t,i.resetZoom(e),n.zoomPoint=s),r.bubbles=!1),U.o(a),U.o(o)}doKeyDown(){"Escape"===this.diagram.lastInput.code&&this.doCancel()}doKeyUp(){}startTransaction(t){return void 0===t&&(t=this.name),this.transactionResult=null,this.diagram.startTransaction(t)}stopTransaction(){var t=this.diagram;return null===this.transactionResult?t.rollbackTransaction():t.commitTransaction(this.transactionResult)}standardMouseSelect(){var e=this.diagram;if(e.allowSelect){var t=e.lastInput,i=e.findPartAt(t.documentPoint,!1);if(null!==i){if(Xt.dr?t.meta:t.control){e.V("ChangingSelection",e.selection);let t=i;for(;null!==t&&!t.canSelect();)t=t.containingGroup;null!==t&&(t.isSelected=!t.isSelected),e.V("ChangedSelection",e.selection)}else if(t.shift){if(!i.isSelected){e.V("ChangingSelection",e.selection);let t=i;for(;null!==t&&!t.canSelect();)t=t.containingGroup;null!==t&&(t.isSelected=!0),e.V("ChangedSelection",e.selection)}}else if(!i.isSelected){let t=i;for(;null!==t&&!t.canSelect();)t=t.containingGroup;null!==t&&e.select(t)}}else!t.left||(Xt.dr?t.meta:t.control)||t.shift||e.clearSelection()}}standardMouseClick(t,e){var i=this.diagram,s=i.lastInput,t=i.findObjectAt(s.documentPoint,t=void 0===t?null:t,e=void 0===e?t=>!t.layer.isTemporary:e);return s.targetObject=t,this.JD(t,s,i),s.handled}JD(i,s,n){if(s.handled=!1,null===i||i.isEnabledObject()){let e=0,t=(s.left?e=1!==s.clickCount&&2===s.clickCount?2:1:s.right&&1===s.clickCount&&(e=3),"ObjectSingleClicked");if(null!==i){switch(e){case 1:t="ObjectSingleClicked";break;case 2:t="ObjectDoubleClicked";break;case 3:t="ObjectContextClicked"}0!==e&&n.V(t,i)}else{switch(e){case 1:t="BackgroundSingleClicked";break;case 2:t="BackgroundDoubleClicked";break;case 3:t="BackgroundContextClicked"}0!==e&&n.V(t)}if(null!==i)for(;null!==i;){let t=null;switch(e){case 1:t=i.click;break;case 2:t=i.doubleClick||i.click;break;case 3:t=i.contextClick}if(null!==t&&(t(s,i),s.handled))break;i=i.panel}else{let t=null;switch(e){case 1:t=n.click;break;case 2:t=n.doubleClick||n.click;break;case 3:t=n.contextClick}null!==t&&t(s)}}}standardMouseOver(){var n=this.diagram,r=n.lastInput;if(!0!==n.animationManager.Mi){var t=n.skipsUndoManager;n.skipsUndoManager=!0;let i=n.viewportBounds.containsPoint(r.documentPoint)?n.findObjectAt(r.documentPoint,null,null):null,s=(!r.event||"pointercancel"!==r.event.type&&"pointerout"!==r.event.type||(i=null),!1);if((r.targetObject=i)!==n.wf){let t=n.wf;var e=t;for(n.wf=i,this.doCurrentObjectChanged(t,i),r.handled=!1;null!==t;){var a=t.mouseLeave;if(null!==a&&(i===t||null!==i&&i.isContainedBy(t)||(a(r,t,i),s=!0,r.handled)))break;t=t.panel}for(t=e,r.handled=!1;null!==i;){var o=i.mouseEnter;if(null!==o&&(t===i||null!==t&&t.isContainedBy(i)||(o(r,i,t),s=!0,r.handled)))break;i=i.panel}i=n.wf}if(null!==i){let t=i,e="";for(;null!==t&&""===(e=t.cursor);)t=t.panel;for(n.currentCursor=e,r.handled=!1,t=i;null!==t;){var h=t.mouseOver;if(null!==h&&(h(r,t),s=!0,r.handled))break;t=t.panel}}else{this.doUpdateCursor(null);e=n.mouseOver;null!==e&&(e(r),s=!0)}s&&n.requestUpdate(),n.skipsUndoManager=t}}doUpdateCursor(t){var e=this.diagram;e&&(e.currentCursor="")}doCurrentObjectChanged(t,e){}standardMouseWheel(){var s=this.diagram,n=s.lastInput;let r=n.delta;if(0!==r&&s.documentBounds.isReal()){var a=s.commandHandler,o=s.toolManager.mouseWheelBehavior;if(null!==a&&(2===o&&!n.shift||1===o&&n.control))(0<r?a.canIncreaseZoom():a.canDecreaseZoom())&&(h=s.zoomPoint,s.zoomPoint=n.viewPoint,0<r?a.increaseZoom():a.decreaseZoom(),s.zoomPoint=h),n.bubbles=!1;else if(2===o&&n.shift||1===o&&!n.control){var a=s.position.copy(),h=n.event,o=h.deltaMode;let t=h.deltaX,e=h.deltaY,i="pixel";if(0===t&&0===e||n.shift)!n.shift&&s.allowVerticalScroll?(r=3*r*s.scrollVerticalLineChange,s.scroll(i,0<r?"up":"down",Math.abs(r))):n.shift&&s.allowHorizontalScroll&&(r=3*r*s.scrollHorizontalLineChange,s.scroll(i,0<r?"left":"right",Math.abs(r)));else{switch(o){case 0:i="pixel";break;case 1:i="line";break;case 2:i="page"}0!==t&&s.allowHorizontalScroll&&(t*=s.scrollHorizontalLineChange/16,s.scroll(i,0<t?"right":"left",Math.abs(t))),0!==e&&s.allowVerticalScroll&&(e*=s.scrollVerticalLineChange/16,s.scroll(i,0<e?"down":"up",Math.abs(e)))}this.doWheelChange(s,a,n)}}}doWheelChange(t,e,i){t.position.equals(e)&&0===i.event.wheelDeltaX||(i.bubbles=!1)}standardWaitAfter(t,e){Yt,Xt.t(t,"number",_,"standardWaitAfter:delay"),void 0===e&&(e=this.diagram.lastInput),this.cancelWaitAfter();const i=this,s=e.clone(this.DC);this.Mm=Xt.Xh(()=>i.doWaitAfter(s),t)}cancelWaitAfter(){-1!==this.Mm&&Xt.Gg(this.Mm),this.Mm=-1}doWaitAfter(t){}findToolHandleAt(t,e){t=this.diagram.findObjectAt(t,t=>{for(;null!==t&&!(t.panel instanceof X);)t=t.panel;return t});return null!==t&&t.part.category===e?t:null}isBeyondDragSize(t,e){var i=this.diagram,s=(void 0===t&&(t=i.firstInput.viewPoint),void 0===e&&(e=i.lastInput.viewPoint),i.toolManager.dragSize);let n=s.width,r=s.height;return i.firstInput.isTouchEvent&&(n+=6,r+=6),Math.abs(e.x-t.x)>n||Math.abs(e.y-t.y)>r}get name(){return this.Tt}set name(t){Xt.t(t,"string",_,"name"),this.Tt=t}get isEnabled(){return this.Xi}set isEnabled(t){Xt.t(t,"boolean",_,"isEnabled"),this.Xi=t}get isActive(){return this.tS}set isActive(t){Xt.t(t,"boolean",_,"isActive"),this.tS=t}get transactionResult(){return this.iS}set transactionResult(t){null!==t&&Xt.t(t,"string",_,"transactionResult"),this.iS=t}}(t={})[t.Scroll=1]="Scroll",t[t.Zoom=2]="Zoom",t[t.None=3]="None";var $=t,it=((t={})[t.Zoom=1]="Zoom",t[t.Cancel=2]="Cancel",t[t.None=3]="None",t);class st extends _{FC;RC;IC;nS;oS;rS;lS;hS;aS;fS;Nm;Gh;constructor(t){super(),this.name="ToolManager",this.FC=new O,this.RC=new O,this.IC=new O,this.nS=850,this.oS=850,this.rS=new qt(2,2).rt(),this.lS=5e3,this.hS=1,this.aS=1,this.fS=null,this.Nm=null,this.Gh=-1,t&&Object.assign(this,t)}static WheelScroll=1;static WheelZoom=2;static WheelNone=3;static GestureZoom=1;static GestureCancel=2;static GestureNone=3;get mouseWheelBehavior(){return this.hS}set mouseWheelBehavior(t){Xt.it(t,$,"WheelMode"),this.hS=t}get gestureBehavior(){return this.aS}set gestureBehavior(t){Xt.it(t,it,"GestureMode"),this.aS=t}initializeStandardTools(){}updateAdornments(t){var e,i=this.currentToolTip;i instanceof X&&this.Nm===t&&(e=i.adornedObject,(null!==t?e.part===t:null===e)?this.showToolTip(i,e):this.hideToolTip())}doMouseDown(){var e=this.diagram,t=e.lastInput;if(t.isTouchEvent&&2===this.gestureBehavior&&(t.bubbles=!1),t.isMultiTouch){if(this.cancelWaitAfter(),3===this.gestureBehavior)return void(t.bubbles=!0);if(2===this.gestureBehavior)return;if(e.currentTool.canStartMultiTouch())return void e.currentTool.standardPinchZoomStart()}var i=e.undoManager,s=(Yt,i.bu&&0!==i.transactionLevel&&Xt.ft("WARNING: In ToolManager.doMouseDown: UndoManager.transactionLevel is not zero"),this.mouseDownTools.length);for(let t=0;t<s;t++){var n=this.mouseDownTools.elt(t);if(n.diagram=this.diagram,n.canStart())return e.doFocus(),e.currentTool=n,void(e.currentTool===n&&(n.isActive||n.doActivate(),n.doMouseDown()))}1===e.lastInput.button&&(1===this.mouseWheelBehavior?this.mouseWheelBehavior=2:2===this.mouseWheelBehavior&&(this.mouseWheelBehavior=1)),this.doActivate(),this.standardWaitAfter(this.holdDelay,t)}doMouseMove(){var e=this.diagram,t=e.lastInput;if(t.isMultiTouch){if(3===this.gestureBehavior)return void(t.bubbles=!0);if(2===this.gestureBehavior)return;if(e.currentTool.canStartMultiTouch())return void e.currentTool.standardPinchZoomMove()}if(this.isActive){var i=this.mouseMoveTools.length;for(let t=0;t<i;t++){var s=this.mouseMoveTools.elt(t);if(s.diagram=this.diagram,s.canStart())return e.doFocus(),e.currentTool=s,void(e.currentTool===s&&(s.isActive||s.doActivate(),s.doMouseMove()))}}this.standardMouseActivity(e);var n=t.event;null===n||"pointermove"!==n.type&&n.cancelable||(t.bubbles=!0)}standardMouseActivity(t){this.standardMouseOver(),this.isBeyondDragSize()&&this.standardWaitAfter(this.isActive?this.holdDelay:this.hoverDelay,t.lastInput)}doCurrentObjectChanged(t,e){var i=this.currentToolTip;null===i||null!==e&&i instanceof X&&(e===i||e.isContainedBy(i))||this.hideToolTip()}doWaitAfter(t){var e=this.diagram;e.ZD()&&(this.doMouseHover(),this.isActive||this.doToolTip(),t.isTouchEvent)&&!e.lastInput.handled&&((t=t.copy()).button=2,t.buttons=2,e.lastInput=t,e.Hw=!0,e.doMouseUp())}doMouseHover(){var t=this.diagram,e=t.lastInput;null===e.targetObject&&(e.targetObject=t.findObjectAt(e.documentPoint,null,null));let i=e.targetObject;if(null!==i)for(e.handled=!1;null!==i;){var s=this.isActive?i.mouseHold:i.mouseHover;if(null!==s&&(s(e,i),e.handled))break;i=i.panel}else{t=this.isActive?t.mouseHold:t.mouseHover;null!==t&&t(e)}}doToolTip(){var t=this.diagram,e=t.lastInput;null===e.targetObject&&(e.targetObject=t.findObjectAt(e.documentPoint,null,null));let i=e.targetObject;if(null!==i){e=this.currentToolTip;if(!(e instanceof X)||i!==e&&!i.isContainedBy(e)){for(;null!==i;){var s=i.toolTip;if(null!==s)return void this.showToolTip(s,i);i=i.panel}this.hideToolTip()}}else{e=t.toolTip;null!==e?this.showToolTip(e,null):this.hideToolTip()}}showToolTip(t,e){Yt,t instanceof X||t instanceof pt||Xt.n("showToolTip:tooltip must be an Adornment or HTMLInfo."),null!==e&&Xt.s(e,y,st,"showToolTip:obj");var i=this.diagram,s=(t!==this.currentToolTip&&this.hideToolTip(),t instanceof X?(t.layerName="Tool",t.selectable=!1,t.scale=1/i.scale,t.category="ToolTip",t.hasPlaceholder()&&(t.placeholder.scale=i.scale),null!==(s=t.diagram)&&s!==i&&s.remove(t),i.add(t),null!==e?t.adornedObject=e:t.data=i.model,t.ensureBounds(),this.positionToolTip(t,e)):t instanceof pt&&t!==this.currentToolTip&&t.show(e,i,this),this.currentToolTip=t,-1!==this.Gh&&(Xt.Gg(this.Gh),this.Gh=-1),this.toolTipDuration);if(0<s&&s!==1/0){const n=this;this.Gh=Xt.Xh(()=>n.hideToolTip(),s)}}positionToolTip(t,e){var i,s,n,r;t.hasPlaceholder()||(t=t,s=(i=this.diagram).lastInput.documentPoint.copy(),n=t.measuredBounds,r=i.viewportBounds,i.lastInput.isTouchEvent&&(s.x-=n.width),s.x+n.width>r.right&&(s.x-=n.width+5/i.scale),s.x<r.x&&(s.x=r.x),s.y+20/i.scale+n.height>r.bottom?s.y-=n.height+5/i.scale:s.y+=20/i.scale,s.y<r.y&&(s.y=r.y),t.position=s)}hideToolTip(){-1!==this.Gh&&(Xt.Gg(this.Gh),this.Gh=-1);var t=this.diagram,e=this.currentToolTip;null!==e&&(e instanceof X?(t.remove(e),null!==this.Nm&&this.Nm.removeAdornment(e.category),e.data=null,e.adornedObject=null):e instanceof pt&&null!==e.hide&&e.hide(t,this),this.currentToolTip=null)}get currentToolTip(){return this.fS}set currentToolTip(t){Yt,null===t||(t instanceof X||t instanceof pt)||Xt.n("ToolManager.currentToolTip must be an Adornment or HTMLInfo."),this.fS=t,this.Nm=null!==t&&t instanceof X?t.adornedPart:null}doMouseUp(){this.cancelWaitAfter();var e=this.diagram;if(this.isActive){var i=this.mouseUpTools.length;for(let t=0;t<i;t++){var s=this.mouseUpTools.elt(t);if(s.diagram=this.diagram,s.canStart())return e.doFocus(),e.currentTool=s,void(e.currentTool===s&&(s.isActive||s.doActivate(),s.doMouseUp()))}}e.doFocus(),this.doDeactivate()}doMouseWheel(){this.standardMouseWheel()}doKeyDown(){var t=this.diagram;null!==t.commandHandler&&t.commandHandler.doKeyDown()}doKeyUp(){var t=this.diagram;null!==t.commandHandler&&t.commandHandler.doKeyUp()}findTool(e){Xt.t(e,"string",st,"findTool:name");let i=this.mouseDownTools.length;for(let t=0;t<i;t++){var s=this.mouseDownTools.elt(t);if(s.name===e)return s}i=this.mouseMoveTools.length;for(let t=0;t<i;t++){var n=this.mouseMoveTools.elt(t);if(n.name===e)return n}i=this.mouseUpTools.length;for(let t=0;t<i;t++){var r=this.mouseUpTools.elt(t);if(r.name===e)return r}return null}replaceTool(e,i){Xt.t(e,"string",st,"replaceTool:name"),null!==i&&(Xt.s(i,_,st,"replaceTool:newtool"),i.diagram=this.diagram);let s=this.mouseDownTools.length;for(let t=0;t<s;t++){var n=this.mouseDownTools.elt(t);if(n.name===e)return null!==i?this.mouseDownTools.setElt(t,i):this.mouseDownTools.removeAt(t),n}s=this.mouseMoveTools.length;for(let t=0;t<s;t++){var r=this.mouseMoveTools.elt(t);if(r.name===e)return null!==i?this.mouseMoveTools.setElt(t,i):this.mouseMoveTools.removeAt(t),r}s=this.mouseUpTools.length;for(let t=0;t<s;t++){var a=this.mouseUpTools.elt(t);if(a.name===e)return null!==i?this.mouseUpTools.setElt(t,i):this.mouseUpTools.removeAt(t),a}return null}replaceStandardTool(t,e,i){this.ii(t,e,i)}ii(t,e,i){Xt.t(t,"string",st,"replaceStandardTool:name"),Xt.s(i,O,st,"replaceStandardTool:list"),null!==e&&(Xt.s(e,_,st,"replaceStandardTool:newtool"),e.name=t,e.diagram=this.diagram),this.findTool(t)?this.replaceTool(t,e):null!==e&&i.add(e)}get mouseDownTools(){return this.FC}get mouseMoveTools(){return this.RC}get mouseUpTools(){return this.IC}get hoverDelay(){return this.nS}set hoverDelay(t){Xt.t(t,"number",st,"hoverDelay"),this.nS=t}get holdDelay(){return this.oS}set holdDelay(t){Xt.t(t,"number",st,"holdDelay"),this.oS=t}get dragSize(){return this.rS}set dragSize(t){Xt.s(t,qt,st,"dragSize"),this.rS=t.L()}get toolTipDuration(){return this.lS}set toolTipDuration(t){Xt.t(t,"number",st,"toolTipDuration"),this.lS=t}get actionTool(){return this.findTool("Action")}set actionTool(t){this.ii("Action",t,this.mouseDownTools)}get relinkingTool(){return this.findTool("Relinking")}set relinkingTool(t){this.ii("Relinking",t,this.mouseDownTools)}get linkReshapingTool(){return this.findTool("LinkReshaping")}set linkReshapingTool(t){this.ii("LinkReshaping",t,this.mouseDownTools)}get resizingTool(){return this.findTool("Resizing")}set resizingTool(t){this.ii("Resizing",t,this.mouseDownTools)}get rotatingTool(){return this.findTool("Rotating")}set rotatingTool(t){this.ii("Rotating",t,this.mouseDownTools)}get linkingTool(){return this.findTool("Linking")}set linkingTool(t){this.ii("Linking",t,this.mouseMoveTools)}get draggingTool(){return this.findTool("Dragging")}set draggingTool(t){this.ii("Dragging",t,this.mouseMoveTools)}get dragSelectingTool(){return this.findTool("DragSelecting")}set dragSelectingTool(t){this.ii("DragSelecting",t,this.mouseMoveTools)}get panningTool(){return this.findTool("Panning")}set panningTool(t){this.ii("Panning",t,this.mouseMoveTools)}get contextMenuTool(){return this.findTool("ContextMenu")}set contextMenuTool(t){this.ii("ContextMenu",t,this.mouseUpTools)}get textEditingTool(){return this.findTool("TextEditing")}set textEditingTool(t){this.ii("TextEditing",t,this.mouseUpTools)}get clickCreatingTool(){return this.findTool("ClickCreating")}set clickCreatingTool(t){this.ii("ClickCreating",t,this.mouseUpTools)}get clickSelectingTool(){return this.findTool("ClickSelecting")}set clickSelectingTool(t){this.ii("ClickSelecting",t,this.mouseUpTools)}}class d extends _{cS;uS;yn;dS;gS;mS;pS;xf;Cm;yS;Hh;Sr;OC;wS;ku;Su;xS;bS;kS;SS;constructor(t){super(),this.name="Dragging",this.cS=!0,this.SS=!0,this.uS=!0,this.yn=null,this.dS=null,this.gS=null,this.mS=null,this.pS=!1,this.ku=!1,this.xf=new U(NaN,NaN),this.Cm=new U,this.yS=!0,this.Hh=100,this.Sr=[],this.OC=(new C).w(),this.wS=new Ot,this.Su=null,this.xS="copy",this.bS="",this.kS="no-drop",t&&Object.assign(this,t)}get isCopyEnabled(){return this.cS}set isCopyEnabled(t){Xt.t(t,"boolean",d,"isCopyEnabled"),this.cS=t}get copiesEffectiveCollection(){return this.uS}set copiesEffectiveCollection(t){Xt.t(t,"boolean",d,"copiesEffectiveCollection"),this.uS=t}get dragOptions(){return this.wS}set dragOptions(t){Xt.s(t,Ot,d,"dragOptions"),this.wS=t}get isGridSnapEnabled(){return this.dragOptions.isGridSnapEnabled}set isGridSnapEnabled(t){Xt.t(t,"boolean",d,"isGridSnapEnabled"),this.dragOptions.isGridSnapEnabled=t}get isComplexRoutingRealtime(){return this.yS}set isComplexRoutingRealtime(t){this.yS=t;var e=this.diagram.findRouter("AvoidsLinks");null!==e&&(e.isRealtime=t)}get isGridSnapRealtime(){return this.dragOptions.isGridSnapRealtime}set isGridSnapRealtime(t){Xt.t(t,"boolean",d,"isGridSnapRealtime"),this.dragOptions.isGridSnapRealtime=t}get gridSnapCellSize(){return this.dragOptions.gridSnapCellSize}set gridSnapCellSize(t){Xt.s(t,qt,d,"gridSnapCellSize"),this.dragOptions.gridSnapCellSize.equals(t)||(t=t.L(),this.dragOptions.gridSnapCellSize=t)}get gridSnapCellSpot(){return this.dragOptions.gridSnapCellSpot}set gridSnapCellSpot(t){Xt.s(t,J,d,"gridSnapCellSpot"),this.dragOptions.gridSnapCellSpot.equals(t)||(t=t.L(),this.dragOptions.gridSnapCellSpot=t)}get gridSnapOrigin(){return this.dragOptions.gridSnapOrigin}set gridSnapOrigin(t){Xt.s(t,U,d,"gridSnapOrigin"),this.dragOptions.gridSnapOrigin.equals(t)||(t=t.L(),this.dragOptions.gridSnapOrigin=t)}get dragsLink(){return this.dragOptions.dragsLink}set dragsLink(t){Xt.t(t,"boolean",d,"dragsLink"),this.dragOptions.dragsLink=t}get dragsTree(){return this.dragOptions.dragsTree}set dragsTree(t){Xt.t(t,"boolean",d,"dragsTree"),this.dragOptions.dragsTree=t}get copyCursor(){return this.xS}set copyCursor(t){this.xS=t}get moveCursor(){return this.bS}set moveCursor(t){this.bS=t}get nodropCursor(){return this.kS}set nodropCursor(t){this.kS=t}get currentPart(){return this.dS}set currentPart(t){null!==t&&Xt.s(t,Y,d,"currentPart"),this.dS=t}get copiedParts(){return this.mS}set copiedParts(t){this.mS=t}get draggedParts(){return this.gS}set draggedParts(t){this.gS=t}get draggingParts(){return null!==this.copiedParts?this.copiedParts.toKeySet():null!==this.draggedParts?this.draggedParts.toKeySet():this.OC}get draggedLink(){return this.diagram.draggedLink}set draggedLink(t){null!==t&&Xt.s(t,q,d,"draggedLink"),this.diagram.draggedLink=t}get isDragOutStarted(){return this.pS}set isDragOutStarted(t){this.pS=t}get startPoint(){return this.Cm}set startPoint(t){Xt.s(t,U,d,"startPoint"),this.Cm.equals(t)||this.Cm.c(t)}get delay(){return this.Hh}set delay(t){Xt.t(t,"number",d,"delay"),this.Hh=t}canStart(){var t,e;return!!this.isEnabled&&!((t=this.diagram).isReadOnly&&!t.allowDragOut||!(t.allowMove||t.allowCopy||t.allowDragOut)||!t.allowSelect||!(e=t.lastInput).left||t.currentTool!==this&&(!this.isBeyondDragSize()||e.isTouchEvent&&e.timestamp-t.firstInput.timestamp<this.Hh)||null===this.findDraggablePart())}findDraggablePart(){var t=this.diagram;let e=t.findPartAt(t.firstInput.documentPoint,!1);if(null===e)return null;for(;null!==e&&!e.canSelect();)e=e.containingGroup;return null!==e&&(e.canMove()||e.canCopy())?e:null}standardMouseSelect(){var e,i=this.diagram;if(i.allowSelect){let t=i.findPartAt(i.firstInput.documentPoint,!1);if(null!==t){for(;null!==t&&!t.canSelect();)t=t.containingGroup;this.currentPart=t,null===this.currentPart||this.currentPart.isSelected||(i.V("ChangingSelection",i.selection),e=i.lastInput,(Xt.dr?e.meta:e.control)||e.shift||i.clearSelection(!0),this.currentPart.isSelected=!0,i.V("ChangedSelection",i.selection))}}}doActivate(){var t=this.diagram,e=((this.Su=null)===this.currentPart&&this.standardMouseSelect(),this.currentPart);null!==e&&(e.canMove()||e.canCopy())&&(t.cacheGroupExternalLinks(!0),d.St=null,this.isActive=!0,this.xf.set(t.position),this.MS(t.selection),this.Sr.length=0,t.animationManager.stopAnimation(),e=this.computeEffectiveCollection(t.selection,this.dragOptions),this.draggedParts=e,this.SS=this.diagram.layout.isRealtime,this.diagram.layout.isRealtime=!1,(t.Am=!0)===t.getRenderingHint("temporaryPixelRatio")&&30<t.avgSpf&&t.vw(),t.qw(this.draggedParts),t.Mu=!0,this.startTransaction("Drag"),this.startPoint=t.firstInput.documentPoint,t.isMouseCaptured=!0,t.allowDragOut)&&this.$D()}MS(t){var e;this.dragsLink&&(e=this.diagram).allowRelink&&(e.model.bf()&&1===t.count&&t.first()instanceof q?(this.draggedLink=t.first(),this.draggedLink.canRelinkFrom()&&this.draggedLink.canRelinkTo()&&this.draggedLink.clearAdornments(),this.yn=e.toolManager.findTool("Relinking"),null===this.yn&&(this.yn=new ot,this.yn.diagram=e),this.yn.originalLink=this.draggedLink):(this.draggedLink=null,this.yn=null))}computeEffectiveCollection(t,e){return this.diagram.commandHandler.computeEffectiveCollection(t,e)}Us(t){return void 0===t?new Ft(U.To):this.isGridSnapEnabled?new Ft(new U(Math.round(1e3*t.x)/1e3,Math.round(1e3*t.y)/1e3)):new Ft(t.copy())}doDeactivate(){this.isActive=!1;var t=this.diagram;this.diagram.layout.isRealtime=this.SS,t.Mu=!1,t.Al=!0,t.cacheGroupExternalLinks(!1),t.stopAutoScroll(),this.PS(),t.Lm(this.draggedParts),this.Su=null,this.currentPart=null,this.draggedParts=null,this.isDragOutStarted=!1,this.ku=!1,d.QD(),this.EC(),this.xf.e(NaN,NaN),null!==d.vh&&(d.vh.currentCursor=""),d.vh=null,d.St=null,this.Ll(),t.isMouseCaptured=!1,t.currentCursor="",t.Am=!1,this.stopTransaction(),t.NS(!0)}stopTransaction(){var t=this.diagram,e=super.stopTransaction();return e&&null!==t.undoManager.transactionToUndo&&t.undoManager.transactionToUndo.optimize(),e}PS(){var t=this.diagram,e=t.skipsUndoManager,i=(t.skipsUndoManager=!0,t.lastInput);this.VC(i,null),t.skipsUndoManager=e,this.Sr.length=0}BC(){this.Ll(),this.CS();var t=this.diagram;this.xf.isReal()&&(t.position=this.xf),t.stopAutoScroll()}doCancel(){this.Ll(),this.CS();var t=this.diagram;this.xf.isReal()&&(t.position=this.xf),this.stopTool()}doKeyDown(){var t=this.diagram,e=t.lastInput;this.isActive&&("Escape"===e.code?this.doCancel():e.code!==t.previousInput.code&&this.doMouseMove())}doKeyUp(){this.isActive&&this.doMouseMove()}_D(t,e){let i=1/0,s=1/0,n=-1/0,r=-1/0;for(var a=t.iterator;a.next();){var o,h=a.value;h.isVisible()&&(o=(h=h.location).x,h=h.y,isNaN(o)||isNaN(h)||(o<i&&(i=o),h<s&&(s=h),o>n&&(n=o),h>r&&(r=h)))}return i===1/0?e.e(0,0,0,0):e.e(i,s,n-i,r-s),e}AS(t){if(null===this.copiedParts){var e=this.diagram;if(!(t&&(e.isReadOnly||e.isModelReadOnly)||null===this.draggedParts)){for(var i=e.undoManager,i=(i.isEnabled&&i.isInTransaction?null!==i.currentTransaction&&0<i.currentTransaction.changes.count&&(e.undoManager.rollbackTransaction(),e.startTransaction("Drag")):this.CS(),e.skipsUndoManager=!t,e.partManager.addsToTemporaryLayer=!t,this.startPoint=e.firstInput.documentPoint,this.copiesEffectiveCollection?this.draggedParts.toKeySet():e.selection),s=e.copyParts(i,e,!0),n=new L,r=this.draggedParts.iterator;r.next();){var a,o=r.key;o.De()&&o.canCopy()&&null!==(a=s.getValue(o))&&(a.location=o.location,a.ensureBounds(),n.add(a,this.Us(a.location)))}for(var h=s.iterator;h.next();){var l=h.value;l instanceof q&&l.canCopy()&&n.add(l,this.Us())}this.copiedParts=n,this.MS(n.toKeySet()),null!==this.draggedLink&&(i=(t=this.draggedLink).routeBounds,t.Mr(this.startPoint.x-(i.x+i.width/2),this.startPoint.y-(i.y+i.height/2))),this.doUpdateCursor(null)}}}Ll(){var t=this.diagram;if(null!==this.copiedParts){if(t.removeParts(this.copiedParts.toKeySet(),!1),(this.copiedParts=null)!==this.draggedParts)for(var e=this.draggedParts.iterator;e.next();)e.key instanceof q&&(e.value.point=new U(0,0));this.doUpdateCursor(null)}t.skipsUndoManager=!1,t.partManager.addsToTemporaryLayer=!1,this.startPoint=t.firstInput.documentPoint}EC(){null!==this.draggedLink&&(this.dragsLink&&null!==this.yn&&(this.yn.stopDraggingMouseMove(),this.yn.originalLink=null),this.draggedLink=null,this.yn=null)}kf(t,e){var i=this.diagram,s=this.startPoint,n=U.a();n.c(i.lastInput.documentPoint),this.moveParts(t,n.subtract(s),e),U.o(n),!0===i.getRenderingHint("temporaryPixelRatio")&&null===i.Tl&&30<i.avgSpf&&(i.vw(),i.Pu())}moveParts(t,e,i){void 0===i&&(i=!1);var s=this.diagram;null!==s&&s.LS(t,e,this.dragOptions,i)}CS(){if(null!==this.draggedParts){var e=this.diagram;let t=this.draggedParts.iterator;for(;t.next();){var i=t.key;i.De()&&(i.location=t.value.point)}for(t=this.draggedParts.iterator;t.next();){var s,n=t.key;n instanceof q&&n.wn&&(s=t.value.point,this.draggedParts.add(n,this.Us()),n.Mr(-s.x,-s.y))}e.maybeUpdate()}}tF(t){return null===t||!!(null===(t=t.part)||t instanceof X||t.layer.isTemporary||this.draggedParts&&this.draggedParts.contains(t)||this.copiedParts&&this.copiedParts.contains(t))}TS(t){var e=this.diagram,i=(this.dragsLink&&(null!==this.draggedLink&&(this.draggedLink.fromNode=null,this.draggedLink.toNode=null),this.zC(!1)),this.findDragOverObject(t)),s=e.lastInput,n=(s.targetObject=i,this.doUpdateCursor(i),e.skipsUndoManager);let r=!1;try{if(e.skipsUndoManager=!0,r=this.VC(s,i),!this.isActive&&null===d.St)return;var a,o=null!==i?i.part:null;if(null!==o&&(!e.handlesDragDropForTopLevelParts||!o.isTopLevel||o instanceof j)||null===(a=e.mouseDragOver)||(a(s),r=!0),!this.isActive&&null===d.St||(this.doDragOver(t,i),!this.isActive&&null===d.St))return}finally{e.skipsUndoManager=n,r&&e.maybeUpdate()}this.Su=i,e.isReadOnly||!e.allowMove&&!e.allowCopy||!e.allowHorizontalScroll&&!e.allowVerticalScroll||e.doAutoScroll(s.viewPoint)}findDragOverObject(t){return this.diagram.DS(t,null,t=>!this.tF(t))}doUpdateCursor(t){var e=this.diagram;null!==t&&this.Su===t||(!this.diagram.currentTool.isActive||this.mayCopy()?e.currentCursor=this.copyCursor:this.mayMove()?e.currentCursor=this.moveCursor:this.mayDragOut()&&(e.currentCursor=this.nodropCursor))}VC(e,i){let s=!1,n=this.Sr.length;var r=0<n?this.Sr[0]:null;if(i===r)return!1;e.handled=!1;for(let t=0;t<n;t++){var a=this.Sr[t],o=a.mouseDragLeave;if(null!==o&&(o(e,a,i),s=!0,e.handled))break}if(this.Sr.length=0,(this.isActive||null!==d.St)&&null!==i){e.handled=!1;let t=i;for(;null!==t;)this.Sr.push(t),t=this.XC(t);n=this.Sr.length;for(let t=0;t<n;t++){var h=this.Sr[t],l=h.mouseDragEnter;if(null!==l&&(l(e,h,r),s=!0,e.handled))break}}return s}rE(t,e){return null!==t&&!!(t===e||t.isContainedBy(e)||e instanceof j&&!(t instanceof j)&&e.handlesDragDropForMembers&&t.part.isMemberOf(e))}XC(t){var e=t.panel;if(null!==e)return e;if(t instanceof Y&&!(t instanceof j)){e=t.containingGroup;if(null!==e&&e.handlesDragDropForMembers)return e}return null}YC(t,e){const i=this.diagram,s=this.yn;if(null===s)return null;var n=s.portGravity,n=i.findObjectsNear(t,n,t=>s.findValidLinkablePort(t,e)),r=U.a();let a=1/0,o=null;for(var h=n.iterator;h.next();){var l,u=h.value;null!==u.part&&(l=u.getDocumentPoint(J.Center,r),(l=t.distanceSquaredPoint(l))<a)&&(o=u,a=l)}return U.o(r),o}zC(n){var r=this.draggedLink;if(null!==r&&!(r.pointsCount<2)){var a=this.diagram;if(!a.isReadOnly){var o=this.yn;if(null!==o){let t=null,e=null,i=(null===r.fromNode&&null!==(t=this.YC(r.getPoint(0),!1))&&(e=t.part),null),s=null;null===r.toNode&&null!==(i=this.YC(r.getPoint(r.pointsCount-1),!0))&&(s=i.part),o.isValidLink(e,t,s,i)?n?(r.defaultFromPoint=r.getPoint(0),r.defaultToPoint=r.getPoint(r.pointsCount-1),r.wn=!1,r.fromNode=e,null!==t&&(r.fromPortId=t.portId),r.toNode=s,null!==i&&(r.toPortId=i.portId),r.fromPort!==a.FS&&a.V("LinkRelinked",r,a.FS),r.toPort!==a.RS&&a.V("LinkRelinked",r,a.RS)):o.doDraggingMouseMove(e,t,s,i):o.doDraggingMouseMove(null,null,null,null)}}}}doDragOver(t,e){}KC(t){var e=this.diagram,i=(this.dragsLink&&this.zC(!0),this.PS(),this.findDragOverObject(t)),s=e.lastInput;if(null!==(s.targetObject=i)){s.handled=!1;let t=i;for(;null!==t;){var n=t.mouseDrop;if(null!==n&&(n(s,t),s.handled))break;this.iF(s,t),t=this.XC(t)}}else{var r=e.mouseDrop;null!==r&&r(s)}if(this.isActive||null!==d.St){for(var a=(this.copiedParts||this.draggedParts).iterator;a.next();){var o=a.key;o instanceof D&&o.linksConnected.each(t=>t.wn=!1)}if(this.doDropOnto(t,i),this.isActive||null!==d.St){for(var h=Z.a(),l=e.selection.iterator;l.next();){var u=l.value;u instanceof D&&this.eF(e,u,h)}Z.o(h)}}}iF(t,e){var i=this.diagram,e=e.part;!i.handlesDragDropForTopLevelParts||!e.isTopLevel||e instanceof j||null!==(e=i.mouseDrop)&&e(t)}eF(e,i,s){if(i.canAvoid()){let t=!1;s=i.getAvoidableRect(s),e.viewportBounds.containsRect(s)&&(t=!0);var n=this.copiedParts||this.draggedParts,e=e.IS(s,t=>t.part,t=>t instanceof q,!0,t=>t instanceof q,t);if(0!==e.count)for(var r=e.iterator;r.next();){var a=r.value;n.contains(a)&&n.contains(i)||!a.isMemberOf(i)&&a.isAvoiding&&a.invalidateRoute()}}}doDropOnto(t,e){}doMouseMove(){var t,e;this.isActive&&(e=(t=this.diagram).lastInput,this.simulatedMouseMove(e.event,e.documentPoint,e.targetDiagram)||null!==this.currentPart&&null!==this.draggedParts&&(this.mayCopy()?(this.AS(!1),t.qw(this.copiedParts),this.kf(this.copiedParts,!1),t.Lm(this.copiedParts)):this.mayMove()?(this.Ll(),this.kf(this.draggedParts,!0)):this.mayDragOut()?(this.AS(!1),this.kf(this.copiedParts,!1)):this.Ll(),this.TS(t.lastInput.documentPoint)))}doMouseUp(){if(this.isActive){var e=this.diagram,i=e.lastInput;if(!this.simulatedMouseUp(i.event,i.documentPoint,i.targetDiagram)){let t=!1;var s,i=this.mayCopy();i&&null!==this.copiedParts?(this.Ll(),this.AS(!0),e.qw(this.copiedParts),this.kf(this.copiedParts,!1),e.Lm(this.copiedParts),null!==this.copiedParts&&(e.V("ChangingSelection",e.selection),e.clearSelection(!0),this.copiedParts.iteratorKeys.each(t=>{t.isSelected=!0}))):(t=!0,this.Ll(),this.mayMove()&&(this.kf(this.draggedParts,!0),this.TS(e.lastInput.documentPoint))),this.ku=!0,this.KC(e.lastInput.documentPoint),this.isActive&&(s=(i?this.copiedParts:this.draggedParts).toKeySet(),this.copiedParts=null,t&&this.sF(),e.invalidateDocumentBounds(),e.Lm(this.draggedParts),this.transactionResult=i?"Copy":"Move",e.V(i?"SelectionCopied":"SelectionMoved",s)),this.stopTool(),i&&e.V("ChangedSelection",e.selection)}}}simulatedMouseMove(e,i,s){if(null===d.St)return!1;var t=d.St.diagram,n=(s instanceof K||(s=null),d.vh);if(s!==n&&(null!==n&&n!==t&&(n.stopAutoScroll(),d.St.isDragOutStarted=!1,null!==(n=n.toolManager.findTool("Dragging")))&&n.doSimulatedDragLeave(),null!==(d.vh=s)&&s!==t&&(d.St.BC(),null!==(n=s.toolManager.findTool("Dragging")))&&(n.UC(),n.doSimulatedDragEnter()),this.doUpdateCursor(null)),null===s||s===t||!s.allowDrop||s.isReadOnly||!s.allowInsert)return!1;n=s.toolManager.findTool("Dragging");if(null!==n){let t=i;null!==e&&(void 0!==e.targetTouches&&(0<e.targetTouches.length?e=e.targetTouches[0]:0<e.changedTouches.length&&(e=e.changedTouches[0])),t=s.getMouse(e)),s.lastInput.documentPoint=t,s.lastInput.viewPoint=s.transformDocToView(t),s.lastInput.down=!1,s.lastInput.up=!1,n.doSimulatedDragOver()}return!0}simulatedMouseUp(e,i,s){if(null===d.St)return!1;var n=d.vh,r=d.St.diagram;if(null===s)return d.St.doCancel(),!0;if(s!==n){var a=n.toolManager.findTool("Dragging");if(null!==n&&n!==r&&null!==a)return n.stopAutoScroll(),d.St.isDragOutStarted=!1,a.doSimulatedDragLeave(),!1;r=(d.vh=s).toolManager.findTool("Dragging");null!==r&&(d.St.BC(),r.UC(),r.doSimulatedDragEnter())}if(s===this.diagram)return!1;{let t=i;null!==e?(void 0!==e.targetTouches&&(0<e.targetTouches.length?e=e.targetTouches[0]:0<e.changedTouches.length&&(e=e.changedTouches[0])),t=s.getMouse(e)):null===t&&(t=new U),s.lastInput.documentPoint=t,s.lastInput.viewPoint=s.transformDocToView(t),s.lastInput.down=!1,s.lastInput.up=!0;n=s.toolManager.findTool("Dragging"),a=(null!==n&&n.doSimulatedDrop(),d.St);return null!==a&&(r=a.mayCopy(),a.transactionResult=r?"Copy":"Move",a.stopTool()),!0}}sF(){if(null!==this.draggedParts)for(var t=this.draggedParts.iterator;t.next();){var e=t.key;e instanceof D&&null!==(e=e.containingGroup)&&e.hasPlaceholder()&&!this.draggedParts.contains(e)&&e.placeholder.u()}}mayCopy(){if(!this.isCopyEnabled)return!1;var t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.allowCopy||!(Xt.dr?t.lastInput.alt:t.lastInput.control))return!1;for(var e=t.selection.iterator;e.next();)if(e.value.canCopy())return!0;return!(null===this.draggedLink||!this.dragsLink||!this.draggedLink.canCopy())}mayDragOut(){if(!this.isCopyEnabled)return!1;var t=this.diagram;if(!t.allowDragOut||!t.allowCopy||t.allowMove)return!1;for(var e=t.selection.iterator;e.next();)if(e.value.canCopy())return!0;return!(null===this.draggedLink||!this.dragsLink||!this.draggedLink.canCopy())}mayMove(){var t=this.diagram;if(t.isReadOnly||!t.allowMove)return!1;for(var e=t.selection.iterator;e.next();)if(e.value.canMove())return!0;return!(null===this.draggedLink||!this.dragsLink||!this.draggedLink.canMove())}UC(){d.Ww.contains(this)||d.Ww.add(this)}static QD(){if(0<d.Ww.count){var e=d.Ww,i=e.length;for(let t=0;t<i;t++){var s=e.elt(t);s.EC(),s.Ll(),s.PS(),s.diagram.stopAutoScroll()}e.clear()}}computeBorder(t,e,i){return this.ku||null===this.draggedParts||this.draggedParts.contains(t)?null:i.c(e)}getDraggingSource(){return d.St}mayDragIn(){var t,e=this.diagram;return!(!e.allowDrop||e.isReadOnly||e.isModelReadOnly||!e.allowInsert||null===(t=d.St)||t.diagram.model.dataFormat!==e.model.dataFormat)}doSimulatedDragEnter(){var t,e;this.mayDragIn()&&((t=this.diagram).animationManager.stopAnimation(),t.Pr(),t.animationManager.stopAnimation(),null!==(e=d.St)&&(e.diagram.Am=!1,null===t.lastInput.event)&&(t.lastInput.event=e.diagram.lastInput.event),this.doUpdateCursor(null))}doSimulatedDragLeave(){var t=d.St;null!==t&&t.doSimulatedDragOut(),this.doCancel()}doSimulatedDragOver(){var t=this.diagram,e=(t.animationManager.Nu=!0,d.St);if(null!==e&&null!==e.draggedParts){if(!this.mayDragIn())return;this.GC(e.draggedParts.toKeySet(),!1,t.firstInput),this.kf(this.copiedParts,!1),this.TS(t.lastInput.documentPoint)}t.animationManager.Nu=!1}doSimulatedDrop(){var t=this.diagram,e=d.St;if(null!==e){var i=e.diagram;if(e.ku=!0,this.Ll(),!this.mayDragIn())return;t.animationManager.Nu=!0,t.V("ChangingSelection",t.selection),this.startTransaction("Drop"),this.GC(e.draggedParts.toKeySet(),!0,t.lastInput),this.kf(this.copiedParts,!1);const s=new C;null!==this.copiedParts&&(t.clearSelection(!0),this.copiedParts.iteratorKeys.each(t=>{t.isSelected=!0,s.add(t)})),this.KC(t.lastInput.documentPoint),t.invalidateDocumentBounds(),null!==this.copiedParts&&(this.transactionResult="ExternalCopy"),this.copiedParts=null,t.doFocus(),t.V("ExternalObjectsDropped",s,i),this.stopTransaction(),t.V("ChangedSelection",t.selection)}t.animationManager.Nu=!1}GC(t,e,i){if(null===this.copiedParts){var s=this.diagram;if(!s.isReadOnly&&!s.isModelReadOnly){s.skipsUndoManager=!e,s.partManager.addsToTemporaryLayer=!e,this.startPoint=i.documentPoint;for(var n=s.copyParts(t,s,!0),e=Z.a(),r=(this._D(t,e),e.x+e.width/2),a=e.y+e.height/2,o=(Z.o(e),this.Cm),h=new L,l=U.a(),u=t.iterator;u.next();){var d,c=u.value;c instanceof q&&c.canCopy()&&null!==(d=n.getValue(c))&&(d.points=c.points,d.Mr(o.x-r,o.y-a),d.wn=!0,h.add(d,this.Us()))}for(var g=t.iterator;g.next();){var m,f=g.value;f.De()&&f.canCopy()&&null!==(m=n.getValue(f))&&(f=f.location,l.e(o.x-(r-f.x),o.y-(a-f.y)),m.location=l,m.ensureBounds(),h.add(m,this.Us(l)))}U.o(l),this.copiedParts=h,this.MS(h.toKeySet()),null!==this.draggedLink&&(s=(i=this.draggedLink).routeBounds,i.Mr(this.startPoint.x-(s.x+s.width/2),this.startPoint.y-(s.y+s.height/2))),this.doUpdateCursor(null)}}}$D(){this.isDragOutStarted=!0,this.ku=!1,d.St=this,d.vh=this.diagram,this.doSimulatedDragOut()}doSimulatedDragOut(){var t=this.diagram;t.Am=!1,this.mayCopy()||this.mayMove()?t.currentCursor="":t.currentCursor=this.nodropCursor,this.Su=null}computeMove(t,e,i,s){var n=this.diagram;return null!==n?n.computeMove(t,e,this.dragOptions,s):new U}static Ww=new O;static St=null;static vh=null}st.prototype.doCancel=function(){null!==d.St&&d.St.doCancel(),_.prototype.doCancel.call(this)};class nt extends _{OS;ES;Dl;VS;BS;qh;zS;Wh;XS;YS;KS;US;GS;HS;HC;vS;Fl;qS;constructor(){super(),this.OS=100,this.ES=!1,this.Dl="pointer",this.VS=new q({layerName:"Tool"}).add(new V({isPanelMain:!0,stroke:"blue"}).theme("stroke","tempLink"),new V({toArrow:"Standard",fill:"blue",stroke:"blue"}).theme("fill","tempLink").theme("stroke","tempLink")).ui(),this.qh=new V("Rectangle",{portId:"",fill:null,stroke:"magenta",strokeWidth:2,desiredSize:qt.Bk}).theme("stroke","tempPort"),this.BS=new D({selectable:!1,layerName:"Tool"}).add(this.qh).ui(),this.Wh=new V("Rectangle",{portId:"",fill:null,stroke:"magenta",strokeWidth:2,desiredSize:qt.Bk}).theme("stroke","tempPort"),this.zS=new D({selectable:!1,layerName:"Tool"}).add(this.Wh).ui(),this.XS=null,this.YS=null,this.KS=null,this.US=null,this.GS=null,this.HS=!0,this.HC=new L,this.vS=null,this.Fl=null,this.qS=null}doStop(){this.diagram.stopAutoScroll(),this.originalLink=null,this.originalFromNode=null,this.originalFromPort=null,this.originalToNode=null,this.originalToPort=null,this.validPortsCache.clear(),this.targetPort=null}get portGravity(){return this.OS}set portGravity(t){Xt.t(t,"number",nt,"portGravity"),0<=t&&(this.OS=t)}get isUnconnectedLinkValid(){return this.ES}set isUnconnectedLinkValid(t){Xt.t(t,"boolean",nt,"isUnconnectedLinkValid"),this.ES=t}get linkingCursor(){return this.Dl}set linkingCursor(t){this.Dl=t}get temporaryLink(){return this.VS}set temporaryLink(t){Xt.s(t,q,nt,"temporaryLink"),t.ui(),this.VS=t}get temporaryFromNode(){return this.BS}set temporaryFromNode(t){Xt.s(t,D,nt,"temporaryFromNode"),t.ui(),(this.BS=t)&&(this.qh=t.port)}get temporaryFromPort(){return this.qh}set temporaryFromPort(t){var e,i;Xt.s(t,y,nt,"temporaryFromPort"),null!==this.qh&&null!==(e=this.qh.panel)&&(i=e.F.indexOf(this.qh),e.removeAt(i),e.insertAt(i,t)),this.qh=t}get temporaryToNode(){return this.zS}set temporaryToNode(t){Xt.s(t,D,nt,"temporaryToNode"),t.ui(),(this.zS=t)&&(this.Wh=t.port)}get temporaryToPort(){return this.Wh}set temporaryToPort(t){var e,i;Xt.s(t,y,nt,"temporaryToPort"),null!==this.Wh&&null!==(e=this.Wh.panel)&&(i=e.F.indexOf(this.Wh),e.removeAt(i),e.insertAt(i,t)),this.Wh=t}get originalLink(){return this.XS}set originalLink(t){null!==t&&Xt.s(t,q,nt,"originalLink"),this.XS=t}get originalFromNode(){return this.YS}set originalFromNode(t){null!==t&&Xt.s(t,D,nt,"originalFromNode"),this.YS=t}get originalFromPort(){return this.KS}set originalFromPort(t){null!==t&&Xt.s(t,y,nt,"originalFromPort"),this.KS=t}get originalToNode(){return this.US}set originalToNode(t){null!==t&&Xt.s(t,D,nt,"originalToNode"),this.US=t}get originalToPort(){return this.GS}set originalToPort(t){null!==t&&Xt.s(t,y,nt,"originalToPort"),this.GS=t}get isForwards(){return this.HS}set isForwards(t){this.HS=t}get validPortsCache(){return this.HC}get targetPort(){return this.vS}set targetPort(t){null!==t&&Xt.s(t,y,nt,"targetPort"),this.vS=t}copyPortProperties(t,e,i,s,n){var r,a;null!==t&&null!==e&&null!==i&&null!==s&&(a=e.getDocumentScale(),(r=qt.a()).width=e.naturalBounds.width*a,r.height=e.naturalBounds.height*a,s.desiredSize=r,qt.o(r),n?(s.toSpot=e.toSpot,s.toEndSegmentLength=e.toEndSegmentLength):(s.fromSpot=e.fromSpot,s.fromEndSegmentLength=e.fromEndSegmentLength),i.locationSpot=J.Center,a=U.a(),i.location=e.getDocumentPoint(J.Center,a),U.o(a),s.angle=e.getDocumentAngle(),null!==this.portTargeted)&&this.portTargeted(t,e,i,s,n)}setNoTargetPortProperties(t,e,i){null!==e&&(e.desiredSize=qt.Bk,e.fromSpot=J.None,e.toSpot=J.None),null!==t&&(t.location=this.diagram.lastInput.documentPoint),null!==this.portTargeted&&this.portTargeted(null,null,t,e,i)}doMouseDown(){this.isActive&&this.doMouseMove()}doMouseMove(){var t,e;this.isActive&&(t=this.diagram,this.targetPort=this.findTargetPort(this.isForwards),null!==this.targetPort&&this.targetPort.part instanceof D?(e=this.targetPort.part,this.isForwards?this.copyPortProperties(e,this.targetPort,this.temporaryToNode,this.temporaryToPort,!0):this.copyPortProperties(e,this.targetPort,this.temporaryFromNode,this.temporaryFromPort,!1)):this.isForwards?this.setNoTargetPortProperties(this.temporaryToNode,this.temporaryToPort,!0):this.setNoTargetPortProperties(this.temporaryFromNode,this.temporaryFromPort,!1),t.allowHorizontalScroll||t.allowVerticalScroll)&&t.doAutoScroll(t.lastInput.viewPoint)}findValidLinkablePort(t,e){if(null!==t){var i=t.part;if(i instanceof D)for(;null!==t;){var s=e?t.toLinkable:t.fromLinkable;if(!0===s&&(null!==t.portId||t instanceof D)&&(e?this.isValidTo(i,t):this.isValidFrom(i,t)))return t;if(!1===s)return null;t=t.panel}}return null}findTargetPort(e){var t=this.diagram,i=t.lastInput.documentPoint;let s=this.portGravity;s<=0&&(s=.1);const n=this,r=t.findObjectsNear(i,s,t=>n.findValidLinkablePort(t,e),null,!0);let a=1/0,o=null;for(var h=r.iterator;h.next();){var l,u,d,c=h.value,g=c.part;g instanceof D&&(u=c.getDocumentPoint(J.Center,U.a()),d=i.x-u.x,l=i.y-u.y,U.o(u),(u=d*d+l*l)<a)&&(null!==(d=this.validPortsCache.getValue(c))?d&&(o=c,a=u):e&&this.isValidLink(this.originalFromNode,this.originalFromPort,g,c)||!e&&this.isValidLink(g,c,this.originalToNode,this.originalToPort)?(this.validPortsCache.add(c,!0),o=c,a=u):this.validPortsCache.add(c,!1))}if(null!==o){t=o.part;if(t instanceof D&&(null===t.layer||t.layer.allowLink))return o}return null}isValidFrom(e,i){if(null===e||null===i)return this.isUnconnectedLinkValid;if(this.diagram.currentTool===this&&(null!==e.layer&&!e.layer.allowLink||!0!==i.fromLinkable))return!1;var s=i.fromMaxLinks;if(s<1/0){if(null!==this.originalLink&&e===this.originalFromNode&&i===this.originalFromPort)return!0;let t=i.portId;if(null===t&&(t=""),e.findLinksOutOf(t).count>=s)return!1}return!0}isValidTo(e,i){if(null===e||null===i)return this.isUnconnectedLinkValid;if(this.diagram.currentTool===this&&(null!==e.layer&&!e.layer.allowLink||!0!==i.toLinkable))return!1;var s=i.toMaxLinks;if(s<1/0){if(null!==this.originalLink&&e===this.originalToNode&&i===this.originalToPort)return!0;let t=i.portId;if(null===t&&(t=""),e.findLinksInto(t).count>=s)return!1}return!0}isInSameNode(t,e){return null!==t&&null!==e&&(t===e||(t=t.part,e=e.part,null!==t&&t===e))}isLinked(i,s){if(null!==i&&null!==s){var n=i.part;if(n instanceof D){let e=i.portId;null===e&&(e="");i=s.part;if(i instanceof D){let t=s.portId;null===t&&(t="");for(var r=i.findLinksInto(t);r.next();){var a=r.value;if(a.fromNode===n&&a.fromPortId===e)return!0}}}}return!1}isValidLink(t,e,i,s){if(!this.isValidFrom(t,e)||!this.isValidTo(i,s)||null!==e&&null!==s&&((!e.fromLinkableSelfNode||!s.toLinkableSelfNode)&&this.isInSameNode(e,s)||(!e.fromLinkableDuplicates||!s.toLinkableDuplicates)&&this.isLinked(e,s))||null!==this.originalLink&&(null!==t&&this.isLabelDependentOnLink(t,this.originalLink)||null!==i&&this.isLabelDependentOnLink(i,this.originalLink))||null!==t&&null!==i&&(null===t.data&&null!==i.data||null!==t.data&&null===i.data)||!this.isValidCycle(t,i,this.originalLink))return!1;let n;return!(null!==t&&null!==(n=t.linkValidation)&&!n(t,e,i,s,this.originalLink)||null!==i&&null!==(n=i.linkValidation)&&!n(t,e,i,s,this.originalLink))&&(null===(n=this.linkValidation)||n(t,e,i,s,this.originalLink))}isLabelDependentOnLink(t,e){var i,s;return null!==t&&null!==(i=t.labeledLink)&&(i===e||((s=new C).add(t),this.WS(i,e,s)))}WS(t,e,i){var s;return t===e||!(null===(s=t.fromNode)||!s.isLinkLabel||(i.add(s),!this.WS(s.labeledLink,e,i)))||!(null===(s=t.toNode)||!s.isLinkLabel||(i.add(s),!this.WS(s.labeledLink,e,i)))}isValidCycle(t,e,i){if(void 0===i&&(i=null),null===t||null===e)return this.isUnconnectedLinkValid;var s=this.diagram.validCycle;if(1===s)return!0;if(5===s){var n=i||this.temporaryLink;if(null!==n&&!n.isTreeLink)return!0;for(var r=e.linksConnected;r.next();){var a=r.value;if(a!==i&&a.isTreeLink&&a.toNode===e)return!1}}else{if(6!==s)return 2===s?!this.nF(t,e,i):3===s?!this.Cu(t,e,i,!1):4!==s||!this.oF(t,e,i);n=i||this.temporaryLink;if(null!==n&&!n.isTreeLink)return!0;for(var o=t.linksConnected;o.next();){var h=o.value;if(h!==i&&h.isTreeLink&&h.fromNode===t)return!1}}return!this.Cu(t,e,i,!0)}Cu(t,e,i,s){if(t===e)return!0;if(null!==t&&null!==e)for(var n=t.linksConnected;n.next();){var r=n.value;if(r!==i&&(!s||r.isTreeLink)&&r.toNode===t){r=r.fromNode;if(r!==t&&this.Cu(r,e,i,s))return!0}}return!1}nF(t,e,i){var s;return t===e||((s=new C).add(e),this.vC(s,t,e,i))}vC(t,e,i,s){if(e===i)return!0;if(null!==e&&null!==i&&!t.contains(e)){t.add(e);for(var n=e.linksConnected;n.next();){var r=n.value;if(r!==s&&r.toNode===e){r=r.fromNode;if(r!==e&&this.vC(t,r,i,s))return!0}}}return!1}oF(t,e,i){var s;return t===e||((s=new C).add(e),this.qC(s,t,e,i))}qC(t,e,i,s){if(e===i)return!0;if(null!==e&&null!==i&&!t.contains(e)){t.add(e);for(var n=e.linksConnected;n.next();){var r=n.value;if(r!==s){var a=r.fromNode,r=r.toNode,r=a===e?r:a;if(r!==e&&this.qC(t,r,i,s))return!0}}}return!1}get linkValidation(){return this.Fl}set linkValidation(t){null!==t&&Xt.t(t,"function",nt,"linkValidation"),this.Fl=t}get portTargeted(){return this.qS}set portTargeted(t){null!==t&&Xt.t(t,"function",nt,"portTargeted"),this.qS=t}}(t={})[t.Either=1]="Either",t[t.ForwardsOnly=2]="ForwardsOnly",t[t.BackwardsOnly=3]="BackwardsOnly";var rt=t;class at extends nt{jS;JS;C;ZS;constructor(t){super(),this.name="Linking",this.jS={},this.JS=null,this.C=1,this.ZS=null,t&&Object.assign(this,t)}static Either=1;static ForwardsOnly=2;static BackwardsOnly=3;get archetypeLinkData(){return this.jS}set archetypeLinkData(t){null!==t&&Xt.t(t,"object",at,"archetypeLinkData"),t instanceof y&&Xt.s(t,q,at,"archetypeLinkData"),this.jS=t}get archetypeLabelNodeData(){return this.JS}set archetypeLabelNodeData(t){null!==t&&Xt.t(t,"object",at,"archetypeLabelNodeData"),t instanceof y&&Xt.s(t,D,at,"archetypeLabelNodeData"),this.JS=t}get direction(){return this.C}set direction(t){Xt.it(t,rt,"LinkingDirection"),this.C=t}get startObject(){return this.ZS}set startObject(t){null!==t&&Xt.s(t,y,at,"startObject"),this.ZS=t}canStart(){var t;return!(!this.isEnabled||(t=this.diagram).isReadOnly||t.isModelReadOnly||!t.allowLink||!t.model.jw()||!t.lastInput.left||t.currentTool!==this&&!this.isBeyondDragSize()||null===this.findLinkablePort())}findLinkablePort(){var t=this.diagram;let e=this.startObject;if(null!==(e=null===e?t.findObjectAt(t.firstInput.documentPoint,null,null):e)){t=e.part;if(t instanceof D){var i=this.direction;if(1===i||2===i){var s=this.findValidLinkablePort(e,!1);if(null!==s)return this.isForwards=!0,s;if(this.startObject===t){s=t.port;if(this.findValidLinkablePort(s,!1))return this.isForwards=!0,s}}if(1===i||3===i){s=this.findValidLinkablePort(e,!0);if(null!==s)return this.isForwards=!1,s;if(this.startObject===t){i=t.port;if(this.findValidLinkablePort(i,!0))return this.isForwards=!1,i}}}}return null}doActivate(){var t,e=this.diagram,i=this.findLinkablePort();null===i?this.stopTool():(this.startTransaction(this.name),e.isMouseCaptured=!0,e.currentCursor=this.linkingCursor,this.isForwards?(null!==this.temporaryToNode&&(this.temporaryToNode.location=e.lastInput.documentPoint),this.originalFromPort=i,(t=this.originalFromPort.part)instanceof D&&(this.originalFromNode=t),this.copyPortProperties(this.originalFromNode,this.originalFromPort,this.temporaryFromNode,this.temporaryFromPort,!1)):(null!==this.temporaryFromNode&&(this.temporaryFromNode.location=e.lastInput.documentPoint),this.originalToPort=i,(t=this.originalToPort.part)instanceof D&&(this.originalToNode=t),this.copyPortProperties(this.originalToNode,this.originalToPort,this.temporaryToNode,this.temporaryToPort,!0)),e.add(this.temporaryFromNode),this.temporaryFromNode&&this.temporaryFromNode.ensureBounds(),e.add(this.temporaryToNode),this.temporaryToNode&&this.temporaryToNode.ensureBounds(),null!==this.temporaryLink&&(null!==this.temporaryFromNode&&(this.temporaryLink.fromNode=this.temporaryFromNode),null!==this.temporaryToNode&&(this.temporaryLink.toNode=this.temporaryToNode),this.temporaryLink.isTreeLink=this.isNewTreeLink(),this.temporaryLink.invalidateRoute(),e.add(this.temporaryLink)),this.isActive=!0)}doDeactivate(){this.isActive=!1;var t=this.diagram;t.remove(this.temporaryLink),t.remove(this.temporaryFromNode),t.remove(this.temporaryToNode),t.isMouseCaptured=!1,t.currentCursor="",this.stopTransaction()}doStop(){super.doStop(),this.startObject=null}doMouseUp(){if(this.isActive){var r=this.diagram;let t=this.transactionResult=null,e=null,i=null,s=null,n=null;try{this.targetPort=this.findTargetPort(this.isForwards);var a,o=this.targetPort;null!==o?(a=o.part)instanceof D&&(this.isForwards?(null!==this.originalFromNode&&(t=this.originalFromNode,e=this.originalFromPort),i=a,s=o):(t=a,e=o,null!==this.originalToNode&&(i=this.originalToNode,s=this.originalToPort))):this.isForwards?null!==this.originalFromNode&&this.isUnconnectedLinkValid&&(t=this.originalFromNode,e=this.originalFromPort):null!==this.originalToNode&&this.isUnconnectedLinkValid&&(i=this.originalToNode,s=this.originalToPort),null!==t||null!==i?null!==(n=this.insertLink(t,e,i,s))?(null===o&&(this.isForwards?n.defaultToPoint=r.lastInput.documentPoint:n.defaultFromPoint=r.lastInput.documentPoint),r.allowSelect&&(r.V("ChangingSelection",r.selection),r.clearSelection(!0),n.isSelected=!0),this.transactionResult=this.name,r.V("LinkDrawn",n)):this.doNoLink(t,e,i,s):this.isForwards?this.doNoLink(this.originalFromNode,this.originalFromPort,null,null):this.doNoLink(null,null,this.originalToNode,this.originalToPort)}finally{this.stopTool(),n&&r.allowSelect&&r.V("ChangedSelection",r.selection)}}}isNewTreeLink(){var t,e=this.archetypeLinkData;return null===e||(e instanceof q?e.isTreeLink:null===(t=this.diagram)||(e=t.partManager.getLinkCategoryForData(e),null===(t=t.partManager.findLinkTemplateForCategory(e)))||t.isTreeLink)}insertLink(t,e,i,s){return this.diagram.partManager.insertLink(t,e,i,s)}doNoLink(t,e,i,s){}}class ot extends nt{$S;QS;ws;_S;constructor(t){super(),this.name="Relinking",this.$S=new V("Diamond",{desiredSize:qt.du,fill:"lightblue",stroke:"dodgerblue",cursor:this.linkingCursor,segmentIndex:0}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.QS=new V("Diamond",{desiredSize:qt.du,fill:"lightblue",stroke:"dodgerblue",cursor:this.linkingCursor,segmentIndex:-1}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.ws=null,this._S=new Z,t&&Object.assign(this,t)}updateAdornments(i){if(null!==i&&i instanceof q){let t="RelinkFrom",e=null;var s;i.isSelected&&!this.diagram.isReadOnly&&null!==(s=i.selectionObject)&&i.canRelinkFrom()&&i.actualBounds.isReal()&&i.isVisible()&&s.actualBounds.isReal()&&s.isVisibleObject()&&null===(e=i.findAdornment(t))&&(e=this.makeAdornment(s,!1),i.addAdornment(t,e)),null===e&&i.removeAdornment(t),t="RelinkTo",e=null,i.isSelected&&!this.diagram.isReadOnly&&null!==(s=i.selectionObject)&&i.canRelinkTo()&&i.actualBounds.isReal()&&i.isVisible()&&s.actualBounds.isReal()&&s.isVisibleObject()&&(null===(e=i.findAdornment(t))?(e=this.makeAdornment(s,!0),i.addAdornment(t,e)):e.u()),null===e&&i.removeAdornment(t)}}makeAdornment(t,e){var i=new X,e=(i.type=jt.Link,e?this.toHandleArchetype:this.fromHandleArchetype);return null!==e&&i.add(e.copy().Tm()),i.adornedObject=t,i}get fromHandleArchetype(){return this.$S}set fromHandleArchetype(t){null!==t&&Xt.s(t,y,ot,"fromHandleArchetype"),this.$S=t}get toHandleArchetype(){return this.QS}set toHandleArchetype(t){null!==t&&Xt.s(t,y,ot,"toHandleArchetype"),this.QS=t}get handle(){return this.ws}set handle(t){if(null!==t&&(Xt.s(t,y,ot,"handle"),!(t.part instanceof X)))throw new Error("new handle is not in an Adornment: "+t);this.ws=t}canStart(){if(!this.isEnabled)return!1;var t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowRelink||!t.model.jw()||!t.lastInput.left)return!1;let e=this.findToolHandleAt(t.firstInput.documentPoint,"RelinkFrom");return null!==(e=null===e?this.findToolHandleAt(t.firstInput.documentPoint,"RelinkTo"):e)}doActivate(){var e=this.diagram;if(null===this.originalLink){let t=this.handle;if(null===(t=null===t&&null===(t=this.findToolHandleAt(e.firstInput.documentPoint,"RelinkFrom"))?this.findToolHandleAt(e.firstInput.documentPoint,"RelinkTo"):t))return;var i=t.part;if(!(i instanceof X&&i.adornedPart instanceof q))return;this.handle=t,this.isForwards=null===i||"RelinkTo"===i.category,this.originalLink=i.adornedPart}this.startTransaction(this.name),e.isMouseCaptured=!0,e.currentCursor=this.linkingCursor,this.originalFromPort=this.originalLink.fromPort,this.originalFromNode=this.originalLink.fromNode,this.originalToPort=this.originalLink.toPort,this.originalToNode=this.originalLink.toNode,this._S.set(this.originalLink.actualBounds),null!==this.originalLink&&0<this.originalLink.pointsCount&&(null===this.originalLink.fromNode&&(null!==this.temporaryFromPort&&(this.temporaryFromPort.desiredSize=qt.lf),null!==this.temporaryFromNode)&&(this.temporaryFromNode.location=this.originalLink.getPoint(0)),null===this.originalLink.toNode)&&(null!==this.temporaryToPort&&(this.temporaryToPort.desiredSize=qt.lf),null!==this.temporaryToNode)&&(this.temporaryToNode.location=this.originalLink.getPoint(this.originalLink.pointsCount-1)),this.copyPortProperties(this.originalFromNode,this.originalFromPort,this.temporaryFromNode,this.temporaryFromPort,!1),this.copyPortProperties(this.originalToNode,this.originalToPort,this.temporaryToNode,this.temporaryToPort,!0),e.add(this.temporaryFromNode),e.add(this.temporaryToNode),null!==this.temporaryLink&&(null!==this.temporaryFromNode&&(this.temporaryLink.fromNode=this.temporaryFromNode),null!==this.temporaryToNode&&(this.temporaryLink.toNode=this.temporaryToNode),this.copyLinkProperties(this.originalLink,this.temporaryLink),this.temporaryLink.invalidateRoute(),e.add(this.temporaryLink)),this.isActive=!0}copyLinkProperties(e,i){if(null!==e&&null!==i){i.adjusting=e.adjusting,i.corner=e.corner;let t=e.curve;11!==t&&10!==t||(t=0),i.curve=t,i.curviness=e.curviness,i.isTreeLink=e.isTreeLink,i.points=e.points,i.routing=e.routing,i.smoothness=e.smoothness,i.fromSpot=e.fromSpot,i.fromEndSegmentLength=e.fromEndSegmentLength,i.fromShortLength=e.fromShortLength,i.toSpot=e.toSpot,i.toEndSegmentLength=e.toEndSegmentLength,i.toShortLength=e.toShortLength}}doDeactivate(){this.isActive=!1;var t=this.diagram;t.remove(this.temporaryLink),t.remove(this.temporaryFromNode),t.remove(this.temporaryToNode),t.isMouseCaptured=!1,t.currentCursor="",this.stopTransaction()}doStop(){super.doStop(),this.handle=null}doMouseUp(){if(this.isActive){var r,a=this.diagram;this.transactionResult=null;let t=this.originalFromNode,e=this.originalFromPort,i=this.originalToNode,s=this.originalToPort,n=this.originalLink;try{this.targetPort=this.findTargetPort(this.isForwards),null!==this.targetPort?(r=this.targetPort.part)instanceof D&&(this.isForwards?(i=r,s=this.targetPort):(t=r,e=this.targetPort)):this.isUnconnectedLinkValid?this.isForwards?(i=null,s=null):(t=null,e=null):n=null,null!==n?(this.reconnectLink(n,this.isForwards?i:t,this.isForwards?s:e,this.isForwards),null===this.targetPort&&(this.isForwards?n.defaultToPoint=a.lastInput.documentPoint:n.defaultFromPoint=a.lastInput.documentPoint,n.invalidateRoute()),this.transactionResult=this.name,a.V("LinkRelinked",n,this.isForwards?this.originalToPort:this.originalFromPort)):this.doNoRelink(this.originalLink,this.isForwards),this.originalLink.invalidateOtherJumpOvers(this._S)}finally{this.stopTool()}}}reconnectLink(t,e,i,s){i=null!==i&&null!==i.portId?i.portId:"";return s?(t.toNode=e,t.toPortId=i):(t.fromNode=e,t.fromPortId=i),!0}doNoRelink(t,e){}doDraggingMouseMove(t,e,i,s){null!==t?(this.copyPortProperties(t,e,this.temporaryFromNode,this.temporaryFromPort,!1),this.diagram.add(this.temporaryFromNode)):this.diagram.remove(this.temporaryFromNode),null!==i?(this.copyPortProperties(i,s,this.temporaryToNode,this.temporaryToPort,!0),this.diagram.add(this.temporaryToNode)):this.diagram.remove(this.temporaryToNode)}stopDraggingMouseMove(){this.diagram.remove(this.temporaryFromNode),this.diagram.remove(this.temporaryToNode)}}(t={})[t.None=0]="None",t[t.Horizontal=1]="Horizontal",t[t.Vertical=2]="Vertical",t[t.All=3]="All";var t;class ht extends _{Io;tM;iM;ws;Jw;eM;Dm;constructor(t){super(),this.name="LinkReshaping",this.Io=new V("Rectangle",{desiredSize:qt.nC,fill:"lightblue",stroke:"dodgerblue"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.tM=new V("Diamond",{desiredSize:qt.du,fill:"lightblue",stroke:"dodgerblue",cursor:"move"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.iM=3,this.ws=null,this.Jw=null,this.eM=new U,this.Dm=new O,t&&Object.assign(this,t)}static None=0;static Horizontal=1;static Vertical=2;static All=3;getReshapingBehavior(t){return t?t.Nr:0}setReshapingBehavior(t,e){t.Nr=e}updateAdornments(e){if(null!==e&&e instanceof q){let t=null;var i;e.isSelected&&!this.diagram.isReadOnly&&null!==(i=e.path)&&e.canReshape()&&e.actualBounds.isReal()&&e.isVisible()&&i.actualBounds.isReal()&&i.isVisibleObject()&&(null===(t=e.findAdornment(this.name))||t.sM!==e.pointsCount||t.nM!==e.resegmentable)&&null!==(t=this.makeAdornment(i))&&(t.sM=e.pointsCount,t.nM=e.resegmentable,e.addAdornment(this.name,t)),null===t&&e.removeAdornment(this.name)}}makeAdornment(e){var i=e.part,t=i.points,s=i.pointsCount,n=i.isOrthogonal;let r=null;if(null!==t&&1<s){(r=new X).type=jt.Link;var a=i.firstPickIndex,o=i.lastPickIndex,h=n?1:0;if(i.resegmentable&&9!==i.computeCurve())for(let t=a+h;t<o-h;t++){var l=this.makeResegmentHandle(e,t);null!==l&&(l.segmentIndex=t,l.segmentFraction=.5,l.fromMaxLinks=999,r.add(l))}for(let t=a+1;t<o;t++){var u=this.makeHandle(e,t);if(null!==u){if((u.segmentIndex=t)!==a)if(t===a+1&&n){var d=i.getPoint(a);let t=i.getPoint(a+1);I.p(d.x,t.x)&&I.p(d.y,t.y)&&(t=i.getPoint(a-1)),I.p(d.x,t.x)?(this.setReshapingBehavior(u,2),u.cursor="n-resize"):I.p(d.y,t.y)&&(this.setReshapingBehavior(u,1),u.cursor="w-resize")}else if(t===o-1&&n){let t=i.getPoint(o-1);d=i.getPoint(o);I.p(t.x,d.x)&&I.p(t.y,d.y)&&(t=i.getPoint(o+1)),I.p(t.x,d.x)?(this.setReshapingBehavior(u,2),u.cursor="n-resize"):I.p(t.y,d.y)&&(this.setReshapingBehavior(u,1),u.cursor="w-resize")}else t!==o&&(this.setReshapingBehavior(u,3),u.cursor="move");r.add(u)}}r.adornedObject=e}return r}makeHandle(t,e){var i=this.handleArchetype;return null===i?null:i.copy().Tm()}get handleArchetype(){return this.Io}set handleArchetype(t){null!==t&&Xt.s(t,y,ht,"handleArchetype"),this.Io=t}makeResegmentHandle(t,e){var i=this.midHandleArchetype;return null===i?null:i.copy().Tm()}get midHandleArchetype(){return this.tM}set midHandleArchetype(t){null!==t&&Xt.s(t,y,ht,"midHandleArchetype"),this.tM=t}get handle(){return this.ws}set handle(t){if(null!==t&&(Xt.s(t,y,ht,"handle"),!(t.part instanceof X)))throw new Error("new handle is not in an Adornment: "+t);this.ws=t}get adornedLink(){return this.Jw}canStart(){var t;return!(!this.isEnabled||(t=this.diagram).isReadOnly||!t.allowReshape||!t.lastInput.left||null===this.findToolHandleAt(t.firstInput.documentPoint,this.name))}doActivate(){var t=this.diagram;if(null===this.handle&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),null!==this.handle){var e=this.handle.part.adornedPart;if(e instanceof q){if(this.Jw=e,t.isMouseCaptured=!0,this.startTransaction(this.name),e.resegmentable&&999===this.handle.fromMaxLinks){var i=e.points.copy(),s=this.getResegmentingPoint();if(i.insertAt(this.handle.segmentIndex+1,s),e.isOrthogonal&&i.insertAt(this.handle.segmentIndex+1,s),e.points=i,e.invalidateAdornments(),e.updateAdornments(),this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name),null===this.handle)return void this.doDeactivate()}this.eM=e.getPoint(this.handle.segmentIndex),this.Dm=e.points.copy(),this.isActive=!0}}}doDeactivate(){this.stopTransaction(),this.handle=null,this.Jw=null,this.diagram.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){var t=this.diagram,e=super.stopTransaction();return e&&null!==t.undoManager.transactionToUndo&&t.undoManager.transactionToUndo.optimize(),e}doCancel(){var t=this.adornedLink;null!==t&&(t.points=this.Dm),this.stopTool()}getResegmentingPoint(){return this.handle.getDocumentPoint(J.Center)}doMouseMove(){var t=this.diagram;this.isActive&&(t=this.computeReshape(t.lastInput.documentPoint),this.reshape(t))}doMouseUp(){var t,e,i,s,n,r,a,o=this.diagram;this.isActive&&(t=this.computeReshape(o.lastInput.documentPoint),this.reshape(t),null!==(t=this.adornedLink)&&t.resegmentable&&(e=this.handle.segmentIndex,i=t.getPoint(e-1),s=t.getPoint(e),n=t.getPoint(e+1),t.isOrthogonal?e>t.firstPickIndex+1&&e<t.lastPickIndex-1&&(r=t.getPoint(e-2),this.isWithinResegmentingDistance(i,s)&&(this.isInLineOrtho(r,i,s,n,!0)||this.isInLineOrtho(r,i,s,n,!1))?(a=t.points.copy(),this.isInLineOrtho(r,i,s,n,!0)?(a.setElt(e-2,new U(r.x,(n.y+r.y)/2)),a.setElt(e+1,new U(n.x,(n.y+r.y)/2))):(a.setElt(e-2,new U((n.x+r.x)/2,r.y)),a.setElt(e+1,new U((n.x+r.x)/2,n.y))),a.removeAt(e),a.removeAt(e-1),t.points=a,t.invalidateAdornments()):(r=t.getPoint(e+2),this.isWithinResegmentingDistance(s,n)&&(this.isInLineOrtho(i,s,n,r,!0)||this.isInLineOrtho(i,s,n,r,!1))&&(a=t.points.copy(),this.isInLineOrtho(i,s,n,r,!0)?(a.setElt(e-1,new U(i.x,(i.y+r.y)/2)),a.setElt(e+2,new U(r.x,(i.y+r.y)/2))):(a.setElt(e-1,new U((i.x+r.x)/2,i.y)),a.setElt(e+2,new U((i.x+r.x)/2,r.y))),a.removeAt(e+1),a.removeAt(e),t.points=a,t.invalidateAdornments()))):(r=U.a(),I.Sl(i.x,i.y,n.x,n.y,s.x,s.y,r)&&r.distanceSquaredPoint(s)<this.resegmentingDistance*this.resegmentingDistance&&((a=t.points.copy()).removeAt(e),t.points=a,t.invalidateAdornments()),U.o(r))),o.invalidateDocumentBounds(),this.transactionResult=this.name,o.V("LinkReshaped",this.adornedLink,this.Dm)),this.stopTool()}isWithinResegmentingDistance(t,e){return Math.abs(t.x-e.x)<this.resegmentingDistance&&Math.abs(t.y-e.y)<this.resegmentingDistance}isInLineOrtho(t,e,i,s,n){return n?Math.abs(t.y-e.y)<this.resegmentingDistance&&Math.abs(e.y-i.y)<this.resegmentingDistance&&Math.abs(i.y-s.y)<this.resegmentingDistance:Math.abs(t.x-e.x)<this.resegmentingDistance&&Math.abs(e.x-i.x)<this.resegmentingDistance&&Math.abs(i.x-s.x)<this.resegmentingDistance}get resegmentingDistance(){return this.iM}set resegmentingDistance(t){Xt.t(t,"number",ht,"resegmentingDistance"),this.iM=t}reshape(n){var r=this.adornedLink;r.startRoute();let a=this.handle.segmentIndex;var o=this.getReshapingBehavior(this.handle);if(r.isOrthogonal)if(a===r.firstPickIndex+1){var h=r.firstPickIndex+1;2===o?(r.setPointAt(h,r.getPoint(h-1).x,n.y),r.setPointAt(h+1,r.getPoint(h+2).x,n.y)):1===o&&(r.setPointAt(h,n.x,r.getPoint(h-1).y),r.setPointAt(h+1,n.x,r.getPoint(h+2).y))}else if(a===r.lastPickIndex-1){var h=r.lastPickIndex-1;2===o?(r.setPointAt(h-1,r.getPoint(h-2).x,n.y),r.setPointAt(h,r.getPoint(1+h).x,n.y)):1===o&&(r.setPointAt(h-1,n.x,r.getPoint(h-2).y),r.setPointAt(h,n.x,r.getPoint(1+h).y))}else{let t=a;var o=r.getPoint(t),h=r.getPoint(t-1),l=r.getPoint(t+1);I.p(h.x,o.x)&&I.p(o.y,l.y)?(I.p(h.x,r.getPoint(t-2).x)&&!I.p(h.y,r.getPoint(t-2).y)?(r.insertPointAt(t,n.x,h.y),a++,t++):r.setPointAt(t-1,n.x,h.y),I.p(l.y,r.getPoint(t+2).y)&&!I.p(l.x,r.getPoint(t+2).x)?r.insertPointAt(t+1,l.x,n.y):r.setPointAt(t+1,l.x,n.y)):I.p(h.y,o.y)&&I.p(o.x,l.x)?(I.p(h.y,r.getPoint(t-2).y)&&!I.p(h.x,r.getPoint(t-2).x)?(r.insertPointAt(t,h.x,n.y),a++,t++):r.setPointAt(t-1,h.x,n.y),I.p(l.x,r.getPoint(t+2).x)&&!I.p(l.y,r.getPoint(t+2).y)?r.insertPointAt(t+1,n.x,l.y):r.setPointAt(t+1,n.x,l.y)):I.p(h.x,o.x)&&I.p(o.x,l.x)?(I.p(h.x,r.getPoint(t-2).x)&&!I.p(h.y,r.getPoint(t-2).y)?(r.insertPointAt(t,n.x,h.y),a++,t++):r.setPointAt(t-1,n.x,h.y),I.p(l.x,r.getPoint(t+2).x)&&!I.p(l.y,r.getPoint(t+2).y)?r.insertPointAt(t+1,n.x,l.y):r.setPointAt(t+1,n.x,l.y)):I.p(h.y,o.y)&&I.p(o.y,l.y)&&(I.p(h.y,r.getPoint(t-2).y)&&!I.p(h.x,r.getPoint(t-2).x)?(r.insertPointAt(t,h.x,n.y),a++,t++):r.setPointAt(t-1,h.x,n.y),I.p(l.y,r.getPoint(t+2).y)&&!I.p(l.x,r.getPoint(t+2).x)?r.insertPointAt(t+1,l.x,n.y):r.setPointAt(t+1,l.x,n.y)),r.setPointAt(a,n.x,n.y)}else{r.setPointAt(a,n.x,n.y);let t=r.fromNode,e=r.fromPort;null!==t&&null!==(o=t.findVisibleNode())&&o!==t&&(t=o,e=t.port),1===a&&r.computeSpot(!0,e).isNoSpot()&&(h=e.getDocumentPoint(J.Center,U.a()),l=r.getLinkPointFromPoint(t,e,h,n,!0,U.a()),r.setPointAt(0,l.x,l.y),U.o(h),U.o(l));let i=r.toNode,s=r.toPort;null!==i&&null!==(o=i.findVisibleNode())&&o!==i&&(i=o,s=i.port),a===r.pointsCount-2&&r.computeSpot(!1,s).isNoSpot()&&(h=s.getDocumentPoint(J.Center,U.a()),l=r.getLinkPointFromPoint(i,s,h,n,!1,U.a()),r.setPointAt(r.pointsCount-1,l.x,l.y),U.o(h),U.o(l))}r.commitRoute()}computeReshape(t){var e=this.adornedLink,i=this.handle.segmentIndex;switch(this.getReshapingBehavior(this.handle)){case 3:return t;case 2:var s=e.getPoint(i);return new U(s.x,t.y);case 1:s=e.getPoint(i);return new U(t.x,s.y);default:return e.getPoint(i)}}get originalPoint(){return this.eM}get originalPoints(){return this.Dm}}class lt extends _{Cr;Ar;Oo;Sf;oM;xs;Io;ws;Fm;rM;Mf;Zw;$w;Qw;constructor(t){super(),this.name="Resizing",this.Cr=new qt(1,1).w(),this.Ar=new qt(9999,9999).w(),this.Oo=new qt(NaN,NaN).w(),this.Sf=!1,this.oM=!0,this.xs=null,this.Io=new V("Rectangle",{alignmentFocus:J.Center,desiredSize:qt.nC,fill:"lightblue",stroke:"dodgerblue",strokeWidth:1,cursor:"pointer"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.ws=null,this.Fm=new U,this.rM=new qt,this.Mf=new U,this.Zw=new qt(0,0),this.$w=new qt(1/0,1/0),this.Qw=new qt(1,1),t&&Object.assign(this,t)}updateAdornments(e){if(!(null===e||e instanceof q)){if(e.isSelected&&!this.diagram.isReadOnly){var i=e.resizeObject;let t=e.findAdornment(this.name);if(null!==i&&e.canResize()&&e.actualBounds.isReal()&&e.isVisible()&&i.actualBounds.isReal()&&i.isVisibleObject()&&null!==(t=null!==t&&t.adornedObject===i?t:this.makeAdornment(i)))return i=i.getDocumentAngle(),e.Rl()&&this.updateResizeHandles(t,i),void e.addAdornment(this.name,t)}e.removeAdornment(this.name)}}makeAdornment(t){let e=null;var i=t.part.resizeAdornmentTemplate;if(null===i){(e=new X).type=jt.Spot,e.locationSpot=J.Center;var s=new je;s.isPanelMain=!0,e.add(s),e.add(this.makeHandle(t,J.TopLeft)),e.add(this.makeHandle(t,J.TopRight)),e.add(this.makeHandle(t,J.BottomRight)),e.add(this.makeHandle(t,J.BottomLeft)),e.add(this.makeHandle(t,J.MiddleTop)),e.add(this.makeHandle(t,J.MiddleRight)),e.add(this.makeHandle(t,J.MiddleBottom)),e.add(this.makeHandle(t,J.MiddleLeft))}else if(i.ui(),null===(e=i.copy()))return null;return e.adornedObject=t,e}makeHandle(t,e){var i=this.handleArchetype;return null===i?null:((i=i.copy().Tm()).alignment=e,i)}updateResizeHandles(t,e){if(null!==t)if(!t.alignment.isDefault()&&("pointer"===t.cursor||0<t.cursor.indexOf("resize")))this.rF(t,e);else if(t instanceof jt)for(var i=t.elements;i.next();){var s=i.value;this.updateResizeHandles(s,e)}}rF(t,e){let i=t.alignment,s=e;if((i=i.isNoSpot()?J.Center:i).x<=0)i.y<=0?s+=225:1<=i.y?s+=135:s+=180;else if(1<=i.x)i.y<=0?s+=315:1<=i.y&&(s+=45);else if(i.y<=0)s+=270;else{if(!(1<=i.y))return;s+=90}s<0?s+=360:360<=s&&(s-=360),s<22.5?t.cursor="e-resize":s<67.5?t.cursor="se-resize":s<112.5?t.cursor="s-resize":s<157.5?t.cursor="sw-resize":s<202.5?t.cursor="w-resize":s<247.5?t.cursor="nw-resize":s<292.5?t.cursor="n-resize":s<337.5?t.cursor="ne-resize":t.cursor="e-resize"}get handleArchetype(){return this.Io}set handleArchetype(t){null!==t&&Xt.s(t,y,lt,"handleArchetype"),this.Io=t}get handle(){return this.ws}set handle(t){if(null!==t&&(Xt.s(t,y,lt,"handle"),!(t.part instanceof X)))throw new Error("new handle is not in an Adornment: "+t);this.ws=t}get adornedObject(){return this.xs}set adornedObject(t){if(null!==t&&(Xt.s(t,y,lt,"handle"),t.part instanceof X))throw new Error("new handle must not be in an Adornment: "+t);this.xs=t}canStart(){var t;return!(!this.isEnabled||(t=this.diagram).isReadOnly||!t.allowResize||!t.lastInput.left||null===this.findToolHandleAt(t.firstInput.documentPoint,this.name))}doActivate(){var t=this.diagram;null===this.handle&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),null!==this.handle&&(this.adornedObject=this.handle.part.adornedObject,null!==this.adornedObject)&&(t.isMouseCaptured=!0,t.animationManager.stopAnimation(),t.Mu=!0,this.startTransaction(this.name),this.Fm.set(this.adornedObject.getDocumentPoint(this.handle.alignment.opposite())),this.Mf.set(this.adornedObject.part.location),this.rM.set(this.adornedObject.desiredSize),this.Qw=this.computeCellSize(),this.Zw=this.computeMinSize(),this.$w=this.computeMaxSize(),this.isActive=!0)}doDeactivate(){var t=this.diagram;t.Mu=!1,t.Al=!0,this.stopTransaction(),this.handle=null,this.xs=null,t.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){var t=this.diagram,e=super.stopTransaction();return e&&null!==t.undoManager.transactionToUndo&&t.undoManager.transactionToUndo.optimize(),e}doCancel(){null!==this.adornedObject&&(this.adornedObject.desiredSize=this.originalDesiredSize,this.adornedObject.part.location=this.originalLocation),this.stopTool()}doMouseMove(){var t,e,i,s,n,r=this.diagram;this.isActive&&(n=this.Zw,t=this.$w,e=this.Qw,i=r.lastInput.documentPoint,i=this.adornedObject.getLocalPoint(i,U.a()),s=this.computeReshape(),n=this.computeResize(i,this.handle.alignment,n,t,e,s),this.resize(n),r.maybeUpdate(),U.o(i))}doMouseUp(){var t,e,i,s,n,r=this.diagram;this.isActive&&(n=this.Zw,t=this.$w,e=this.Qw,i=this.adornedObject.getLocalPoint(r.lastInput.documentPoint,U.a()),s=this.computeReshape(),n=this.computeResize(i,this.handle.alignment,n,t,e,s),this.resize(n),U.o(i),r.invalidateDocumentBounds(),this.transactionResult=this.name,r.V("PartResized",this.adornedObject,this.originalDesiredSize)),this.stopTool()}resize(e){var i=this.diagram,s=this.adornedObject;if(null!==s){s.desiredSize=e.size;e=s.part,s=(e.ensureBounds(),s.getDocumentPoint(this.handle.alignment.opposite()));if(e instanceof j){var n=new O;n.add(e);let t;this.dragsMembers||e.hasPlaceholder()||((t=new Ot).dragsMembers=!1),i.moveParts(n,this.oppositePoint.copy().subtract(s),!0,t)}else e.location=e.location.copy().subtract(s).add(this.oppositePoint);i.maybeUpdate()}}computeResize(t,e,i,s,n,r){e.isNoSpot()&&(e=J.Center);var a=this.adornedObject.naturalBounds,o=a.x,h=a.y,l=a.x+a.width,u=a.y+a.height;let d=1;if(!r){let t=a.width,e=a.height;t<=0&&(t=1),e<=0&&(e=1),d=e/t}var c=U.a(),t=(I.vg(t.x,t.y,o,h,n.width,n.height,c),a.copy());return e.x<=0?e.y<=0?(t.x=Math.max(c.x,l-s.width),t.x=Math.min(t.x,l-i.width),t.width=Math.max(l-t.x,i.width),t.y=Math.max(c.y,u-s.height),t.y=Math.min(t.y,u-i.height),t.height=Math.max(u-t.y,i.height),r||(1<=t.height/t.width?(t.height=Math.max(Math.min(d*t.width,s.height),i.height),t.width=t.height/d):(t.width=Math.max(Math.min(t.height/d,s.width),i.width),t.height=d*t.width),t.x=l-t.width,t.y=u-t.height)):1<=e.y?(t.x=Math.max(c.x,l-s.width),t.x=Math.min(t.x,l-i.width),t.width=Math.max(l-t.x,i.width),t.height=Math.max(Math.min(c.y-h,s.height),i.height),r||(1<=t.height/t.width?(t.height=Math.max(Math.min(d*t.width,s.height),i.height),t.width=t.height/d):(t.width=Math.max(Math.min(t.height/d,s.width),i.width),t.height=d*t.width),t.x=l-t.width)):(t.x=Math.max(c.x,l-s.width),t.x=Math.min(t.x,l-i.width),t.width=l-t.x,r||(t.height=Math.max(Math.min(d*t.width,s.height),i.height),t.width=t.height/d,t.y=h+.5*(u-h-t.height))):1<=e.x?e.y<=0?(t.width=Math.max(Math.min(c.x-o,s.width),i.width),t.y=Math.max(c.y,u-s.height),t.y=Math.min(t.y,u-i.height),t.height=Math.max(u-t.y,i.height),r||(1<=t.height/t.width?(t.height=Math.max(Math.min(d*t.width,s.height),i.height),t.width=t.height/d):(t.width=Math.max(Math.min(t.height/d,s.width),i.width),t.height=d*t.width),t.y=u-t.height)):1<=e.y?(t.width=Math.max(Math.min(c.x-o,s.width),i.width),t.height=Math.max(Math.min(c.y-h,s.height),i.height),r||(1<=t.height/t.width?(t.height=Math.max(Math.min(d*t.width,s.height),i.height),t.width=t.height/d):(t.width=Math.max(Math.min(t.height/d,s.width),i.width),t.height=d*t.width))):(t.width=Math.max(Math.min(c.x-o,s.width),i.width),r||(t.height=Math.max(Math.min(d*t.width,s.height),i.height),t.width=t.height/d,t.y=h+.5*(u-h-t.height))):e.y<=0?(t.y=Math.max(c.y,u-s.height),t.y=Math.min(t.y,u-i.height),t.height=u-t.y,r||(t.width=Math.max(Math.min(t.height/d,s.width),i.width),t.height=d*t.width,t.x=o+.5*(l-o-t.width))):1<=e.y&&(t.height=Math.max(Math.min(c.y-h,s.height),i.height),r||(t.width=Math.max(Math.min(t.height/d,s.width),i.width),t.height=d*t.width,t.x=o+.5*(l-o-t.width))),U.o(c),t}computeReshape(){let t=0;return!(6===(t=this.adornedObject instanceof V?this.adornedObject.lM():t)||this.diagram.lastInput.shift)}computeMinSize(){var t=this.adornedObject.minSize.copy(),e=this.minSize;return!isNaN(e.width)&&e.width>t.width&&(t.width=e.width),!isNaN(e.height)&&e.height>t.height&&(t.height=e.height),t}computeMaxSize(){var t=this.adornedObject.maxSize.copy(),e=this.maxSize;return!isNaN(e.width)&&e.width<t.width&&(t.width=e.width),!isNaN(e.height)&&e.height<t.height&&(t.height=e.height),t}computeCellSize(){var t=new qt(NaN,NaN),e=this.adornedObject.part,e=(null!==e&&(e=e.resizeCellSize,!isNaN(e.width)&&0<e.width&&(t.width=e.width),!isNaN(e.height))&&0<e.height&&(t.height=e.height),this.cellSize),i=(isNaN(t.width)&&!isNaN(e.width)&&0<e.width&&(t.width=e.width),isNaN(t.height)&&!isNaN(e.height)&&0<e.height&&(t.height=e.height),this.diagram);return(isNaN(t.width)||isNaN(t.height))&&i&&null!==(i=i.grid)&&i.visible&&this.isGridSnapEnabled&&(e=i.gridCellSize,isNaN(t.width)&&!isNaN(e.width)&&0<e.width&&(t.width=e.width),isNaN(t.height))&&!isNaN(e.height)&&0<e.height&&(t.height=e.height),!isNaN(t.width)&&0!==t.width&&t.width!==1/0||(t.width=1),!isNaN(t.height)&&0!==t.height&&t.height!==1/0||(t.height=1),t}get minSize(){return this.Cr}set minSize(i){if(Xt.s(i,qt,lt,"minSize"),!this.Cr.equals(i)){let t=i.width,e=(isNaN(t)&&(t=0),i.height);isNaN(e)&&(e=0),this.Cr.e(t,e)}}get maxSize(){return this.Ar}set maxSize(i){if(Xt.s(i,qt,lt,"maxSize"),!this.Ar.equals(i)){let t=i.width,e=(isNaN(t)&&(t=1/0),i.height);isNaN(e)&&(e=1/0),this.Ar.e(t,e)}}get cellSize(){return this.Oo}set cellSize(t){Xt.s(t,qt,lt,"cellSize"),this.Oo.equals(t)||this.Oo.c(t)}get isGridSnapEnabled(){return this.Sf}set isGridSnapEnabled(t){Xt.t(t,"boolean",lt,"isGridSnapEnabled"),this.Sf=t}get dragsMembers(){return this.oM}set dragsMembers(t){Xt.t(t,"boolean",lt,"dragsMembers"),this.oM=t}get oppositePoint(){return this.Fm}set oppositePoint(t){Xt.s(t,U,lt,"oppositePoint"),this.Fm.equals(t)||this.Fm.c(t)}get originalDesiredSize(){return this.rM}get originalLocation(){return this.Mf}}class ut extends _{hM;aM;xs;Io;ws;fM;Rm;Mf;cM;uM;constructor(t){super(),this.name="Rotating",this.hM=45,this.aM=2,this.Mf=new U,this.xs=null,this.Io=new V("Ellipse",{desiredSize:qt.du,fill:"lightblue",stroke:"dodgerblue",strokeWidth:1,cursor:"pointer"}).theme("fill","adornmentFill").theme("stroke","adornmentStroke"),this.ws=null,this.fM=0,this.Rm=new U(NaN,NaN),this.cM=0,this.uM=50,t&&Object.assign(this,t)}updateAdornments(e){if(null!==e){if(e.Il()){var i=e.rotateObject;if(i===e||i===e.path||i.isPanelMain)return}if(e.isSelected&&!this.diagram.isReadOnly){i=e.rotateObject;if(null!==i&&e.canRotate()&&e.actualBounds.isReal()&&e.isVisible()&&i.actualBounds.isReal()&&i.isVisibleObject()){let t=e.findAdornment(this.name);if(null!==(t=null!==t&&t.adornedObject===i?t:this.makeAdornment(i)))return t.angle=i.getDocumentAngle(),t.hasPlaceholder()||(t.location=this.computeAdornmentLocation(i)),void e.addAdornment(this.name,t)}}e.removeAdornment(this.name)}}makeAdornment(t){let e=null;var i=t.part.rotateAdornmentTemplate;if(null===i){(e=new X).type=jt.Position,e.locationSpot=J.Center;var s=this.handleArchetype;null!==s&&e.add(s.copy().Tm())}else if(i.ui(),null===(e=i.copy()))return null;return e.adornedObject=t,e}get handleArchetype(){return this.Io}set handleArchetype(t){null!==t&&Xt.s(t,y,ut,"handleArchetype"),this.Io=t}get handle(){return this.ws}set handle(t){if(null!==t&&(Xt.s(t,y,ut,"handle"),!(t.part instanceof X)))throw new Error("new handle is not in an Adornment: "+t);this.ws=t}get adornedObject(){return this.xs}set adornedObject(t){if(null!==t&&(Xt.s(t,y,ut,"handle"),t.part instanceof X))throw new Error("new handle must not be in an Adornment: "+t);this.xs=t}canStart(){var t;return!(!this.isEnabled||(t=this.diagram).isReadOnly||!t.allowRotate||!t.lastInput.left||null===this.findToolHandleAt(t.firstInput.documentPoint,this.name))}doActivate(){var t=this.diagram;if(null===this.adornedObject){if(null===this.handle&&(this.handle=this.findToolHandleAt(t.firstInput.documentPoint,this.name)),null===this.handle)return;this.adornedObject=this.handle.part.adornedObject}null!==this.adornedObject&&(t.isMouseCaptured=!0,t.delaysLayout=!0,this.startTransaction(this.name),this.fM=this.adornedObject.angle,this.Rm=this.computeRotationPoint(this.adornedObject),this.Mf=this.adornedObject.part.location.copy(),this.isActive=!0)}computeRotationPoint(t){var e=t.part,i=e.locationObject;return e.rotationSpot.isSpot()?t.getDocumentPoint(e.rotationSpot):t===e||t===i?i.getDocumentPoint(e.locationSpot):t.getDocumentPoint(J.Center)}computeAdornmentLocation(t){let e=this.rotationPoint;e.isReal()||(e=this.computeRotationPoint(t));var i=t.getLocalPoint(e);let s=this.handleAngle;s<0?s+=360:360<=s&&(s-=360),s=Math.round(45*Math.round(s/45));var n=this.handleDistance;return 0===s?i.x=t.naturalBounds.width+n:45===s?(i.x=t.naturalBounds.width+n,i.y=t.naturalBounds.height+n):90===s?i.y=t.naturalBounds.height+n:135===s?(i.x=-n,i.y=t.naturalBounds.height+n):180===s?i.x=-n:225===s?(i.x=-n,i.y=-n):270===s?i.y=-n:315===s&&(i.x=t.naturalBounds.width+n,i.y=-n),t.getDocumentPoint(i)}doDeactivate(){var t=this.diagram;this.stopTransaction(),this.handle=null,this.xs=null,this.Rm=new U(NaN,NaN),t.isMouseCaptured=!1,this.isActive=!1}stopTransaction(){var t=this.diagram,e=super.stopTransaction();return e&&null!==t.undoManager.transactionToUndo&&t.undoManager.transactionToUndo.optimize(),e}doCancel(){this.diagram.delaysLayout=!1,this.rotate(this.originalAngle),this.stopTool()}doMouseMove(){var t=this.diagram;this.isActive&&(t=this.computeRotate(t.lastInput.documentPoint),this.rotate(t))}doMouseUp(){var t,e=this.diagram;this.isActive&&(e.delaysLayout=!1,t=this.computeRotate(e.lastInput.documentPoint),this.rotate(t),e.invalidateDocumentBounds(),this.transactionResult=this.name,e.V("PartRotated",this.adornedObject,this.originalAngle)),this.stopTool()}rotate(t){Yt,Xt.r(t,ut,"rotate:newangle");var e,i,s=this.adornedObject;null!==s&&(s.angle=t,(s=s.part).ensureBounds(),(i=s.locationObject)!==(e=s.rotateObject)&&!i.isContainedBy(e)||(i=this.Mf.copy(),s.location=i.subtract(this.rotationPoint).rotate(t-this.originalAngle).add(this.rotationPoint)),this.diagram.maybeUpdate())}computeRotate(t){let e=this.rotationPoint.directionPoint(t)-this.handleAngle;var t=this.adornedObject.panel,t=(null!==t&&(e-=t.getDocumentAngle()),360<=e?e-=360:e<0&&(e+=360),Math.min(Math.abs(this.snapAngleMultiple),180)),i=Math.min(Math.abs(this.snapAngleEpsilon),t/2);return!this.diagram.lastInput.shift&&0<t&&0<i&&(e%t<i?e=Math.floor(e/t)*t:e%t>t-i&&(e=(Math.floor(e/t)+1)*t)),360<=e?e-=360:e<0&&(e+=360),e}get snapAngleMultiple(){return this.hM}set snapAngleMultiple(t){Xt.t(t,"number",ut,"snapAngleMultiple"),this.hM=t}get snapAngleEpsilon(){return this.aM}set snapAngleEpsilon(t){Xt.t(t,"number",ut,"snapAngleEpsilon"),this.aM=t}get originalAngle(){return this.fM}get rotationPoint(){return this.Rm}set rotationPoint(t){this.Rm=t.copy()}get handleAngle(){return this.cM}set handleAngle(t){Xt.t(t,"number",ut,"handleAngle"),this.cM=t}get handleDistance(){return this.uM}set handleDistance(t){Xt.t(t,"number",ut,"handleDistance"),this.uM=t}}class dt extends _{constructor(t){super(),this.name="ClickSelecting",t&&Object.assign(this,t)}canStart(){return!(!this.isEnabled||this.isBeyondDragSize())}doMouseUp(){this.isActive&&(this.standardMouseSelect(),this.standardMouseClick()||this.diagram.lastInput.isTouchEvent&&this.diagram.toolManager.doToolTip()),this.stopTool()}}class ct extends _{Pf;constructor(t){super(),this.name="Action",this.Pf=null,t&&Object.assign(this,t)}canStart(){var t,e,i;return!(!this.isEnabled||(e=(t=this.diagram).lastInput,null===(i=t.findObjectAt(e.documentPoint,t=>{for(;null!==t.panel;){if(t.isActionable)return t;t=t.panel}return t})))||!i.isActionable||(this.Pf=i,t.wf=t.findObjectAt(e.documentPoint,null,null),0))}doMouseDown(){var t,e;this.isActive?(t=this.diagram.lastInput,null!==(e=this.Pf)&&null!==(t.targetObject=e).actionDown&&e.actionDown(t,e)):this.canStart()&&this.doActivate()}doMouseMove(){var t,e;this.isActive&&(t=this.diagram.lastInput,null!==(e=this.Pf))&&null!==(t.targetObject=e).actionMove&&e.actionMove(t,e)}doMouseUp(){if(this.isActive){const t=this.diagram.lastInput,e=this.Pf;if(null===e)return;null!==(t.targetObject=e).actionUp&&e.actionUp(t,e),this.standardMouseClick(t=>{for(;null!==t.panel;){if(t.isActionable&&t===e)return t;t=t.panel}return t},t=>t===e)}this.stopTool()}doCancel(){var t=this.diagram.lastInput,e=this.Pf;null!==e&&(null!==(t.targetObject=e).actionCancel&&e.actionCancel(t,e),this.stopTool())}doStop(){this.Pf=null}}class gt extends _{Ol;dM;Sf;gM;constructor(t){super(),this.name="ClickCreating",this.Ol=null,this.dM=!0,this.Sf=!1,this.gM=new U(0,0),t&&Object.assign(this,t)}canStart(){if(!this.isEnabled||null===this.archetypeNodeData)return!1;var t=this.diagram;if(t.isReadOnly||t.isModelReadOnly||!t.allowInsert||!t.lastInput.left||this.isBeyondDragSize())return!1;if(this.isDoubleClick){if(1===t.lastInput.clickCount&&(this.gM=t.lastInput.viewPoint.copy()),2!==t.lastInput.clickCount||this.isBeyondDragSize(this.gM))return!1}else if(1!==t.lastInput.clickCount)return!1;return!(t.currentTool!==this&&null!==t.findPartAt(t.lastInput.documentPoint,!0))}doMouseUp(){var t=this.diagram;this.isActive&&this.insertPart(t.lastInput.documentPoint),this.stopTool()}insertPart(t){var e,i,s=this.diagram,n=this.archetypeNodeData;if(null===n)return null;let r=null;try{s.V("ChangingSelection",s.selection),this.startTransaction(this.name),n instanceof Y?n.De()&&(n.ui(),null!==(r=n.copy()))&&s.add(r):null!==n&&(e=s.model.copyNodeData(n),Xt.Mt(e))&&(s.model.addNodeData(e),r=s.findPartForData(e)),null!==r&&(i=U.H(t.x,t.y),this.isGridSnapEnabled&&this.diagram.mM(r,t,i),r.location=i,s.allowSelect&&(s.clearSelection(!0),r.isSelected=!0),U.o(i)),s.invalidateDocumentBounds(),this.transactionResult=this.name,s.V("PartCreated",r)}finally{this.stopTransaction(),s.V("ChangedSelection",s.selection)}return r}get archetypeNodeData(){return this.Ol}set archetypeNodeData(t){null!==t&&Xt.t(t,"object",gt,"archetypeNodeData"),this.Ol=t}get isDoubleClick(){return this.dM}set isDoubleClick(t){Xt.t(t,"boolean",gt,"isDoubleClick"),this.dM=t}get isGridSnapEnabled(){return this.Sf}set isGridSnapEnabled(t){Xt.t(t,"boolean",gt,"isGridSnapEnabled"),this.Sf=t}}class mt extends _{Hh;pM;El;constructor(t){super(),this.name="DragSelecting",this.Hh=175,this.pM=!1,this.El=new Y({layerName:"Tool",selectable:!1}).add(new V("Rectangle",{name:"SHAPE",fill:null,stroke:"magenta"}).theme("stroke","dragSelect")).ui(),t&&Object.assign(this,t)}canStart(){var t,e;return!!this.isEnabled&&!!(t=this.diagram).allowSelect&&!(!(e=t.lastInput).left||t.currentTool!==this&&(!this.isBeyondDragSize()||e.timestamp-t.firstInput.timestamp<this.delay||null!==t.findPartAt(e.documentPoint,!0)))}doActivate(){var t=this.diagram;this.isActive=!0,t.isMouseCaptured=!0,t.skipsUndoManager=!0,t.add(this.box),this.doMouseMove()}doDeactivate(){var t=this.diagram;t.stopAutoScroll(),t.remove(this.box),t.skipsUndoManager=!1,t.isMouseCaptured=!1,this.isActive=!1}doMouseMove(){var e=this.diagram;if(this.isActive&&null!==this.box){var i=this.computeBoxBounds();let t=this.box.findObject("SHAPE");null===t&&(t=this.box.findMainElement());var s=qt.a().e(i.width,i.height);t.desiredSize=s,this.box.Nf(i.x,i.y,!1),qt.o(s),(e.allowHorizontalScroll||e.allowVerticalScroll)&&e.doAutoScroll(e.lastInput.viewPoint)}}doMouseUp(){if(this.isActive){var t=this.diagram;t.remove(this.box);try{t.currentCursor="wait",t.V("ChangingSelection",t.selection),this.selectInRect(this.computeBoxBounds()),t.V("ChangedSelection",t.selection)}finally{t.currentCursor=""}}this.stopTool()}computeBoxBounds(){var t=this.diagram;return new Z(t.firstInput.documentPoint,t.lastInput.documentPoint)}selectInRect(t){var e=this.diagram,i=e.lastInput,s=e.findPartsIn(t,this.isPartialInclusion);if(Xt.dr?i.meta:i.control)if(i.shift)for(var n=s.iterator;n.next();){var r=n.value;r.isSelected&&(r.isSelected=!1)}else for(var a=s.iterator;a.next();){var o=a.value;o.isSelected=!o.isSelected}else if(i.shift)for(var h=s.iterator;h.next();){var l=h.value;l.isSelected||(l.isSelected=!0)}else{for(var u=new O,d=e.selection.iterator;d.next();){var c=d.value;s.contains(c)||u.add(c)}for(var g=u.iterator;g.next();)g.value.isSelected=!1;for(var m=s.iterator;m.next();){var f=m.value;f.isSelected||(f.isSelected=!0)}}}get delay(){return this.Hh}set delay(t){Xt.t(t,"number",mt,"delay"),this.Hh=t}get isPartialInclusion(){return this.pM}set isPartialInclusion(t){Xt.t(t,"boolean",mt,"isPartialInclusion"),this.pM=t}get box(){return this.El}set box(t){null!==t&&(Xt.s(t,Y,mt,"box"),t.ui()),this.El=t}}class ft extends _{_w;WC;Ro;yM;constructor(t){super(),this.name="Panning",this._w=new U,this.WC=new U,this.Ro=!1;const e=this;this.yM=()=>{var t=e.diagram;null!==t&&t.Ti(v.document,"scroll",e.yM,!1),e.stopTool()},t&&Object.assign(this,t)}canStart(){var t;return!!this.isEnabled&&!(!(t=this.diagram).allowHorizontalScroll&&!t.allowVerticalScroll||!t.lastInput.left||t.currentTool!==this&&!this.isBeyondDragSize())}doActivate(){var t=this.diagram;this.Ro?(t.lastInput.bubbles=!0,t.Ht(v.document,"scroll",this.yM,!1)):(t.currentCursor="move",t.isMouseCaptured=!0,this._w.c(t.position)),this.isActive=!0}doDeactivate(){var t=this.diagram;t.currentCursor="",t.isMouseCaptured=!1,this.isActive=!1}doCancel(){var t=this.diagram;t.position=this._w,t.isMouseCaptured=!1,this.stopTool()}doMouseMove(){this.jC()}doMouseUp(){this.jC(),this.stopTool()}jC(){var i=this.diagram;if(this.isActive&&i)if(this.Ro)i.lastInput.bubbles=!0;else{var s=i.position,n=i.firstInput.documentPoint,r=i.lastInput.documentPoint;let t=s.x+n.x-r.x,e=s.y+n.y-r.y;i.allowHorizontalScroll||(t=s.x),i.allowVerticalScroll||(e=s.y),i.position=this.WC.e(t,e)}}get bubbles(){return this.Ro}set bubbles(t){Xt.t(t,"boolean",ft,"bubbles"),this.Ro=t}get originalPosition(){return this._w}}class pt{tx;ix;wM;xM;constructor(t){this.tx=null,this.ix=null,this.wM=null,this.xM=null,t&&Object.assign(this,t)}get mainElement(){return this.wM}set mainElement(t){null!==t&&Xt.s(t,HTMLElement,pt,"mainElement"),this.wM=t}get show(){return this.tx}set show(t){this.tx!==t&&(null!==t&&Xt.t(t,"function",pt,"show"),this.tx=t)}get hide(){return this.ix}set hide(t){this.ix!==t&&(null!==t&&Xt.t(t,"function",pt,"hide"),this.ix=t)}get valueFunction(){return this.xM}set valueFunction(t){this.xM=t}}class vt{di;Im;Cf;constructor(t,e,i){this.di=t,this.Im=e,this.Cf=i}}class yt extends _{bM;ex;kM;SM;sx;nx;ox;constructor(t){super(),this.name="ContextMenu",this.bM=null,this.ex=null,this.kM=null,this.SM=new U,this.sx=null,this.ox=!1;const e=this;this.nx=()=>e.stopTool(),t&&Object.assign(this,t)}lF(){var t=new pt;t.show=(t,e,i)=>i.showDefaultContextMenu(),t.hide=(t,e)=>e.hideDefaultContextMenu(),yt.Au=t;const e=this;this.nx=()=>e.stopTool();var t=Xt.hn("div"),i=Xt.hn("div"),s=(t.style.cssText="top: 0px;z-index:10002;position: fixed;display: none;text-align: center;left: 25%;width: 50%;background-color: #F5F5F5;padding: 16px;border: 16px solid #444;border-radius: 10px;margin-top: 10px",i.style.cssText="z-index:10001;position: fixed;display: none;top: 0;left: 0;width: 100%;height: 100%;background-color: black;opacity: 0.8;",Xt.hn("style")),s=(v.document.getElementsByTagName("head")[0].appendChild(s),s.sheet.insertRule(".goCXul { list-style: none; }",0),s.sheet.insertRule(".goCXli {font:700 1.5em Helvetica, Arial, sans-serif;position: relative;min-width: 60px; }",0),s.sheet.insertRule(".goCXa {color: #444;display: inline-block;padding: 4px;text-decoration: none;margin: 2px;border: 1px solid gray;border-radius: 10px; }",0),this.diagram);null!==s&&(s.Ht(t,"contextmenu",yt.jh,!1),s.Ht(t,"selectstart",yt.jh,!1),s.Ht(i,"contextmenu",yt.jh,!1)),t.className="goCXforeground",i.className="goCXbackground",v.document.body&&(v.document.body.appendChild(t),v.document.body.appendChild(i)),yt.Om=t,yt.Em=i,yt.MM=!0}static Au=null;static MM=!1;static Em=null;static Om=null;static jh(t){return t.preventDefault(),!1}canStart(){var t;return!(!this.isEnabled||(t=this.diagram,this.isBeyondDragSize())||!t.lastInput.right||1<t.lastInput.clickCount||!(t.lastInput.isTouchEvent&&null!==this.defaultTouchContextMenu||null!==this.findObjectWithContextMenu()))}doStart(){var t=this.diagram;this.SM.set(t.firstInput.documentPoint)}doStop(){this.hideContextMenu(),this.currentObject=null}findObjectWithContextMenu(t){void 0===t&&(t=null);var e=this.diagram,i=e.lastInput;let s=null;if(null!==(s=t instanceof K?s:t instanceof y?t:e.findObjectAt(i.documentPoint,null,t=>!t.layer.isTemporary))){let t=s;for(;null!==t;){if(null!==t.contextMenu)return t;t=t.panel}if(e.lastInput.isTouchEvent&&this.defaultTouchContextMenu)return s.part}else if(null!==e.contextMenu)return e;return null}doActivate(){}doMouseDown(){var t;super.doMouseDown(),this.isActive&&this.currentContextMenu instanceof X&&null!==(t=this.diagram.toolManager.findTool("Action"))&&t.canStart()&&(t.doActivate(),t.doMouseDown(),t.doDeactivate()),this.diagram.toolManager.mouseDownTools.contains(this)&&this.doContextClick()}doMouseUp(){var t;this.isActive&&this.currentContextMenu instanceof X&&null!==(t=this.diagram.toolManager.findTool("Action"))&&t.canStart()&&(t.doActivate(),t.doCancel(),t.doDeactivate()),this.doContextClick()}doContextClick(){var e=this.diagram;if(this.isActive){var i=this.currentContextMenu;if(null!==i){let t=null;i instanceof pt||null!==(t=e.findObjectAt(e.lastInput.documentPoint,null,null))&&t.isContainedBy(i)&&this.standardMouseClick(null,null),this.maybeStopTool(t)}}else this.canStart()&&(this.openMenu(!0),this.isActive||this.stopTool())}maybeStopTool(t){this.stopTool(),this.canStart()&&(this.diagram.currentTool=this).doMouseUp()}openMenu(t,e){var i;void 0===e&&(e=null),this.ox||(this.ox=!0,t&&this.standardMouseSelect(),t=this.standardMouseClick(),this.ox=!1,t)||(this.isActive=!0,t=yt.Au,null!==(e=null===e?this.findObjectWithContextMenu():e)?null!==(i=e.contextMenu)?(this.currentObject=e instanceof y?e:null,this.showContextMenu(i,this.currentObject)):null!==t&&this.showContextMenu(t,this.currentObject):null!==t&&this.showContextMenu(t,null),this.currentContextMenu instanceof X&&!this.currentContextMenu.visible&&this.stopTool())}doMouseMove(){var t=this.diagram.toolManager.findTool("Action");null!==t&&t.doMouseMove(),this.isActive&&this.diagram.toolManager.doMouseMove()}showContextMenu(t,e){Yt,t instanceof X||t instanceof pt||Xt.n("showContextMenu:contextMenu must be an Adornment or HTMLInfo."),null!==e&&Xt.s(e,y,yt,"showContextMenu:obj");var i,s,n=this.diagram;t!==this.currentContextMenu&&this.hideContextMenu(),t instanceof X?((i=t).layerName="Tool",i.selectable=!1,i.scale=1/n.scale,i.category=this.name,i.hasPlaceholder()&&(i.placeholder.scale=n.scale),null!==(s=i.diagram)&&s!==n&&s.remove(i),n.add(i),null!==e?i.adornedObject=e:i.data=n.model,i.ensureBounds(),this.positionContextMenu(i,e)):t instanceof pt&&t.show(e,n,this),this.currentContextMenu=t}positionContextMenu(t,e){var i,s,n,r;t.hasPlaceholder()||(t=t,s=(i=this.diagram).lastInput.documentPoint.copy(),n=t.measuredBounds,r=i.viewportBounds,i.lastInput.isTouchEvent&&(s.x-=n.width),s.x+n.width>r.right&&(s.x-=n.width+5/i.scale),s.x<r.x&&(s.x=r.x),s.y+n.height>r.bottom&&(s.y-=n.height+5/i.scale),s.y<r.y&&(s.y=r.y),t.position=s)}hideContextMenu(){var t=this.diagram,e=this.currentContextMenu;null!==e&&(e instanceof X?(t.remove(e),null!==this.ex&&this.ex.removeAdornment(e.category),e.data=null,e.adornedObject=null):e instanceof pt&&(null!==e.hide?e.hide(t,this):null!==e.mainElement&&(e.mainElement.style.display="none")),this.currentContextMenu=null,this.standardMouseOver())}hF(){const e=this,t=new O;return t.add(new vt("Copy",t=>t.commandHandler.copySelection(),t=>t.commandHandler.canCopySelection())),t.add(new vt("Cut",t=>t.commandHandler.cutSelection(),t=>t.commandHandler.canCutSelection())),t.add(new vt("Delete",t=>t.commandHandler.deleteSelection(),t=>t.commandHandler.canDeleteSelection())),t.add(new vt("Paste",t=>t.commandHandler.pasteSelection(e.mouseDownPoint),t=>t.commandHandler.canPasteSelection(e.mouseDownPoint))),t.add(new vt("Select All",t=>t.commandHandler.selectAll(),t=>t.commandHandler.canSelectAll())),t.add(new vt("Undo",t=>t.commandHandler.undo(),t=>t.commandHandler.canUndo())),t.add(new vt("Redo",t=>t.commandHandler.redo(),t=>t.commandHandler.canRedo())),t.add(new vt("Scroll To Part",t=>t.commandHandler.scrollToPart(),t=>t.commandHandler.canScrollToPart())),t.add(new vt("Zoom To Fit",t=>t.commandHandler.zoomToFit(),t=>t.commandHandler.canZoomToFit())),t.add(new vt("Reset Zoom",t=>t.commandHandler.resetZoom(),t=>t.commandHandler.canResetZoom())),t.add(new vt("Group Selection",t=>t.commandHandler.groupSelection(),t=>t.commandHandler.canGroupSelection())),t.add(new vt("Ungroup Selection",t=>t.commandHandler.ungroupSelection(),t=>t.commandHandler.canUngroupSelection())),t.add(new vt("Edit Text",t=>t.commandHandler.editTextBlock(),t=>t.commandHandler.canEditTextBlock())),t}showDefaultContextMenu(){const e=this.diagram,i=(null===this.sx&&(this.sx=this.hF()),yt.Om.innerHTML="",yt.Em.addEventListener("pointerdown",this.nx,!1),this),t=Xt.hn("ul");t.className="goCXul",yt.Om.appendChild(t),t.innerHTML="";for(var s=this.sx.iterator;s.next();){var n=s.value,r=n.Im,a=n.Cf;"function"!=typeof r||"function"==typeof a&&!a(e)||((r=Xt.hn("li")).className="goCXli",(a=Xt.hn("a")).className="goCXa",a.href="#",a.Im=n.Im,a.addEventListener("pointerdown",function(t){return this.Im(e),i.stopTool(),t.preventDefault(),!1},!1),a.textContent=n.di,r.appendChild(a),t.appendChild(r))}yt.Om.style.display="block",yt.Em.style.display="block"}hideDefaultContextMenu(){var t;null!==this.currentContextMenu&&this.currentContextMenu===yt.Au&&(yt.Om.style.display="none",yt.Em.style.display="none",null!==(t=this.diagram)&&t.Ti(yt.Em,"pointerdown",this.nx,!1),this.currentContextMenu=null)}get currentContextMenu(){return this.bM}set currentContextMenu(t){Yt,null===t||(t instanceof X||t instanceof pt)||Xt.n("ContextMenuTool.currentContextMenu must be an Adornment or HTMLInfo."),this.bM=t,this.ex=t instanceof X?t.adornedPart:null}get defaultTouchContextMenu(){return!1===yt.MM&&null===yt.Au&&K.isUsingDOM()&&this.lF(),yt.Au}set defaultTouchContextMenu(t){Yt,null===t||(t instanceof X||t instanceof pt)||Xt.n("ContextMenuTool.defaultTouchContextMenu must be an Adornment or HTMLInfo."),null===t&&(yt.MM=!0),yt.Au=t}get currentObject(){return this.kM}set currentObject(t){null!==t&&Xt.s(t,y,yt,"currentObject"),this.kM=t}get mouseDownPoint(){return this.SM}}(xt={})[xt.LostFocus=1]="LostFocus",xt[xt.MouseDown=2]="MouseDown",xt[xt.Tab=3]="Tab",xt[xt.Enter=4]="Enter";(e={})[e.SingleClick=1]="SingleClick",e[e.SingleClickSelected=2]="SingleClickSelected",e[e.DoubleClick=3]="DoubleClick";var xt,At=e,wt=((e={})[e.None=1]="None",e[e.Active=2]="Active",e[e.Editing=3]="Editing",e[e.Validating=4]="Validating",e[e.Invalid=5]="Invalid",e[e.Validated=6]="Validated",e);class bt extends _{Fe;PM;NM;Vl;jt;CM;AM;LM;rx;lx;constructor(t){super(),this.name="TextEditing",this.Fe=new z,this.PM=null,this.NM=2,this.Vl=null,this.jt=1,this.CM=1,this.AM=!0,this.LM=null,this.rx=new pt,this.lx=null,this.aF(this.rx),t&&Object.assign(this,t)}static LostFocus=1;static MouseDown=2;static Tab=3;static Enter=4;static SingleClick=1;static SingleClickSelected=2;static DoubleClick=3;static StateNone=1;static StateActive=2;static StateEditing=3;static StateValidating=4;static StateInvalid=5;static StateValidated=6;aF(t){if(K.isUsingDOM()){const u=Xt.hn("textarea"),s=(this.lx=u,this);u.addEventListener("input",function(t){var e,i;null!==s.textBlock&&(e=s.measureTemporaryTextBlock(this.value),i=this.textScale,this.style.width=20+Math.max(s.textBlock.measuredBounds.width,e.measuredBounds.width)*i+"px",this.rows=Math.max(s.textBlock.lineCount,e.lineCount))},!1),u.addEventListener("keydown",function(t){var e;t.isComposing||null===s.textBlock||("Enter"===(e=t.key)?(!1===s.textBlock.isMultiline&&t.preventDefault(),s.acceptText(4)):"Tab"===e?(s.acceptText(3),t.preventDefault()):"Escape"===e&&(s.doCancel(),null!==s.diagram)&&s.diagram.doFocus())},!1),u.addEventListener("focus",function(t){s.fF(t)},!1),u.addEventListener("blur",function(t){s.cF(t)},!1),t.valueFunction=()=>u.value,t.mainElement=u,t.show=(e,i,s)=>{if(e instanceof z&&s instanceof bt)if(5===s.state)u.style.border="3px solid red",u.focus();else{var n=e.getDocumentPoint(J.Center),r=i.position,a=i.scale;let t=e.getDocumentScale()*a;t<s.minimumEditorScale&&(t=s.minimumEditorScale);var o=e.naturalBounds.width*t+6,h=e.naturalBounds.height*t+2,l=(n.x-r.x)*a,n=(n.y-r.y)*a,r=e.verticalAlignment,a=(e.lineHeight+e.spacingAbove+e.spacingBelow)*e.lineCount*t,r=r.y*h-r.y*a+r.offsetY-(.5*h-.5*a)-a/2;u.value=e.text,i.div.style.font=e.font;u.style.position="absolute",u.style.zIndex="100",u.style.font="inherit",u.style.fontSize=100*t+"%",u.style.lineHeight="normal",u.style.width=o+"px",u.style.left=(l-o/2|0)-1+"px",u.style.top=(n+r|0)-1+"px",u.style.textAlign=e.textAlign,u.style.margin="0",u.style.padding="1px",u.style.border="0",u.style.outline="none",u.style.whiteSpace="pre-wrap",u.style.overflow="hidden",u.rows=e.lineCount,u.textScale=t,u.className="goTXarea",i.div.appendChild(u),u.focus(),s.selectsTextOnActivate&&(u.select(),u.setSelectionRange(0,9999))}},t.hide=(t,e)=>{t.div.removeChild(u)}}}get textBlock(){return this.PM}set textBlock(t){null!==t&&Xt.s(t,z,bt,"textBlock"),this.PM=t}get currentTextEditor(){return this.LM}set currentTextEditor(t){this.LM=t}get defaultTextEditor(){return this.rx}set defaultTextEditor(t){Yt,t instanceof pt||Xt.n("TextEditingTool.defaultTextEditor must be an HTMLInfo."),this.rx=t}get starting(){return this.NM}set starting(t){Xt.it(t,At,"TextEditingStarting"),this.NM=t}canStart(){var t,e;return!!this.isEnabled&&!(null===(t=this.diagram)||t.isReadOnly||bt.Af&&bt.Af!==this&&(bt.Af.acceptText(2),bt.Af)&&bt.Af!==this||!t.lastInput.left||this.isBeyondDragSize()||(e=t.lastInput.documentPoint,!(null!==(e=t.findObjectAt(e))&&e instanceof z&&e.editable&&e.part.canEdit()))||null===(e=e.part)||2===this.starting&&!e.isSelected||3===this.starting&&t.lastInput.clickCount<2)}doStart(){null!==(bt.Af=this).textBlock&&this.doActivate()}doActivate(){if(!this.isActive){var i=this.diagram;if(null!==i){let e=this.textBlock;if(null!==(e=null===e?i.findObjectAt(i.lastInput.documentPoint):e)&&e instanceof z&&null!==(this.textBlock=e).part){i.animationManager.stopAnimation(),this.isActive=!0,this.jt=2;let t=this.defaultTextEditor;null!==e.textEditor&&(t=e.textEditor),this.Fe=this.textBlock.copy();var s=new Z(this.textBlock.getDocumentPoint(J.TopLeft),this.textBlock.getDocumentPoint(J.BottomRight));i.scrollToRect(s),t.show(e,i,this),this.currentTextEditor=t}}}}doCancel(){this.stopTool()}doMouseUp(){this.canStart()&&this.doActivate()}doMouseDown(){this.isActive&&this.acceptText(2)}acceptText(t){switch(t){case 2:6===this.jt?this.currentTextEditor instanceof HTMLElement&&this.currentTextEditor.focus():2!==this.jt&&5!==this.jt&&3!==this.jt||(this.jt=4,this.JC());break;case 1:case 4:case 3:4===t&&!0===this.textBlock.isMultiline||2!==this.jt&&5!==this.jt&&3!==this.jt||(this.jt=4,this.JC())}}JC(){var e=this.textBlock,i=this.diagram,s=this.currentTextEditor;if(null!==e&&null!==s){var n=e.text;let t="";(null!==s.valueFunction&&(t=s.valueFunction()),this.isValidText(e,n,t))?(this.startTransaction(this.name),this.jt=6,this.transactionResult=this.name,e.text=t,this.doSuccess(n,t),null!==i&&i.V("TextEdited",e,n),this.stopTransaction(),this.stopTool(),null!==i&&i.doFocus()):(this.jt=5,this.doError(n,t))}}doError(t,e){var i=this.textBlock,t=(null!==i.errorFunction&&i.errorFunction(this,t,e),this.currentTextEditor);t&&t.show(i,this.diagram,this)}doSuccess(t,e){var i=this.textBlock;null!==i.textEdited&&i.textEdited(i,t,e)}doDeactivate(){var t=this.diagram;null!==t&&(this.jt=1,null!==this.currentTextEditor&&this.currentTextEditor.hide(t,this),this.textBlock=null,this.isActive=!1)}doStop(){bt.Af=null}fF(t){var e;null!==this.currentTextEditor&&1!==this.state&&(e=this.lx,2===this.jt&&(this.jt=3),"function"==typeof e.select)&&this.selectsTextOnActivate&&(e.select(),e.setSelectionRange(0,9999))}cF(t){var e;null!==this.currentTextEditor&&1!==this.state&&("function"==typeof(e=this.lx).focus&&e.focus(),"function"==typeof e.select)&&this.selectsTextOnActivate&&(e.select(),e.setSelectionRange(0,9999))}isValidText(t,e,i){Xt.s(t,z,bt,"isValidText:textblock");var s=this.textValidation;return!(null!==s&&!s(t,e,i)||null!==(s=t.textValidation)&&!s(t,e,i))}get textValidation(){return this.Vl}set textValidation(t){null!==t&&Xt.t(t,"function",bt,"textValidation"),this.Vl=t}get minimumEditorScale(){return this.CM}set minimumEditorScale(t){null!==t&&Xt.t(t,"number",bt,"minimumEditorScale"),this.CM=t}get selectsTextOnActivate(){return this.AM}set selectsTextOnActivate(t){null!==t&&Xt.t(t,"boolean",bt,"selectsTextOnActivate"),this.AM=t}get state(){return this.jt}set state(t){this.jt!==t&&(Xt.it(t,wt,"TextEditingState"),this.jt=t)}measureTemporaryTextBlock(t){var e=this.Fe;return e.text=t,e.wt(this.textBlock.Bl,1/0),e}static Af=null}(e={})[e.Default=1]="Default",e[e.AnimateLocations=2]="AnimateLocations",e[e.None=3]="None";var Pt=e;class St{b;Di;Xi;Lr;$n;Eo;TM;DM;Vm;Mi;Lf;xn;Bm;Jh;hx;zm;ax;Tf;Nu;Xm;constructor(t){this.b=K.Pm(),this.Di=!1,this.Vm=!1,this.Mi=!1,this.Lf=!1,this.ax=!0,this.Tf=1,this.Nu=!1,this.Xi=!0,this.Lr=!0,this.Eo=600,this.TM=!1,this.DM=!1,this.$n=new C,this.xn=new kt,this.Bm=new kt,(this.xn.bs=this).Jh=new C,this.hx=new C,this.zm=new C,this.Xm=new C,t&&Object.assign(this,t)}Vo(t){this.b=t}lE(){return this.b}canStart(t){return!0}zl(t){return!(!this.Xi||!this.canStart(t)||(this.$n.add(t),this.defaultAnimation.isAnimating&&this.stopAnimation(),this.b.Fi(),this.Mi=!0,0))}getBundleAnimation(){return this.Bm}FM(){if(this.Xi&&(0<this.Bm.we.count&&this.Bm.start(),this.Mi)){const e=this.xn,i=this.b,s=this.$n.contains("Model");if(s&&(this.Lf=!0,1===this.Tf?(e.isViewportUnconstrained=!0,e.we.clear(),e.add(i,"position",i.position.copy().offset(0,-200),i.position),e.add(i,"opacity",0,1)):3===this.Tf&&e.we.clear(),2===this.Tf&&i.fx.equals(i.lt)?this.ax=!0:this.ax=!1,i.V("InitialAnimationStarting",this)),s&&!this.Lr||0===e.we.count)this.$n.clear(),this.Mi=!1,e.we.clear(),e.cx(i),this.Lf=!1,i.T();else{this.$n.clear(),i.Tr=!1;var t=e.we.get(i);1!==i.autoScale&&null!==t&&(delete t.li.scale,delete t.ks.scale);const n=this;v.requestAnimationFrame(()=>{!1===n.Mi||e.Di||(i.getRenderingHint("temporaryPixelRatio")&&i.vw(),i.RM(),n.Mi=!1,e.start(),e.Di&&(n.Lu(),i.invalidateDocumentBounds(),e.ZC(0),i.Pr(!0),n.Tu(),i.V("AnimationStarting",n)))})}}}IM(){return this.$n.contains("Trigger")&&1===this.$n.count}$C(t,e,i,s){this.isTicking||this.IM()||t instanceof q&&(null!==t.fromNode||null!==t.toNode)||this.xn.add(t,"position",e,i,s)}ux(t){return this.xn.ux(t)}OM(t){return this.xn.OM(t)}uF(t){const i=this.Jh,s=this;function n(){if(0<s.zm.count&&(i.addAll(s.zm),s.zm.clear(),s.Di=!0),!1!==s.Di&&0!==i.count){s.hx.addAll(i);for(var t=s.hx.iterator;t.next();){var e=t.value;!1!==e.Di&&(e.dF()?e.QC(!1):e.Df=!0)}s.hx.clear(),!1===s.Di||(s.Lu(),s.b.Pr(),s.Tu()),v.requestAnimationFrame(n)}}this.Di?this.gF(t):(this.Di=!0,i.add(t),v.requestAnimationFrame(()=>n()))}gF(t){this.zm.add(t)}mF(){for(var t=this.Jh.iterator;t.next();)t.value.Df=!1}Lu(){var t;this.Vm||(t=this.b,this.TM=t.skipsUndoManager,this.DM=t.xe,t.skipsUndoManager=!0,t.xe=!0,this.Vm=!0)}Tu(){var t=this.b;t.skipsUndoManager=this.TM,t.xe=this.DM,this.Vm=!1}stopAnimation(t){var e=this.xn;if(!0===this.Mi&&(this.Mi=!1,this.Lf=!1,this.$n.clear(),e.pF())&&this.b.requestUpdate(),this.Di){if(e.Du(!0),e.cx(null),!0===t){var i=this.Jh.toArray();for(let t=0;t<i.length;t++)i[t].Du(!0)}}else e.we.clear(),e.cx(this.b)}Du(t){this.Jh.remove(t),0===this.Jh.count&&(this.Di=!1,this.b.requestUpdate()),t===this.defaultAnimation&&this.b.V("AnimationFinished",this)}Ff(t,e){!this.Mi||(this.$n.contains("Expand Tree")||this.$n.contains("Expand SubGraph"))&&(this.xn.Ff(t,e),this._C(t))}Rf(t,e){!this.Mi||(this.$n.contains("Collapse Tree")||this.$n.contains("Collapse SubGraph"))&&(this.xn.Rf(t,e),this.xn.EM(e,"position",e.position,e.position),this._C(t))}tA(t,e){!this.Mi||t.equals(e)||this.IM()||(this.b.Uh||(t=e.copy()),this.xn.EM(this.b,"position",t,e))}iA(t,e){!this.Mi||this.IM()||this.xn.add(this.b,"scale",t,e)}VM(t,e){t.Re&&(t.Dr=e,this.Xm.add(t))}_C(t){for(var e=t.findLinksConnected();e.next();){var i=e.value;i.Re&&(i.Dr=i.points.copy(),this.Xm.add(i))}}get isEnabled(){return this.Xi}set isEnabled(t){Xt.t(t,"boolean",St,"isEnabled"),(this.Xi=t)&&this.Jh.each(t=>{t.isAnimating||t.runCount!==1/0||t.start()})}get duration(){return this.Eo}set duration(t){Xt.t(t,"number",St,"duration"),t<1&&Xt.G(t,">= 1",St,"duration"),this.Eo=t}get isAnimating(){return this.Di}get isTicking(){return this.Vm}get isInitial(){return this.Lr}set isInitial(t){Xt.t(t,"boolean",St,"isInitial"),this.Lr=t}get defaultAnimation(){return this.xn}get activeAnimations(){return this.Jh}get initialAnimationStyle(){return this.Tf}set initialAnimationStyle(t){Yt,Xt.it(t,Pt,"AnimationStyle"),this.Tf=t}static gx=new L;static defineAnimationEffect(t,e){St.gx.add(t,e)}static BM(t,e,i,s,n){let r=(t=null===t?[0,0,0,0]:t)[0],a=t[1];var o=t[2],t=t[3];let h=(e=null===e?[0,0,0,0]:e)[0],l=e[1];var u=e[2],e=e[3],d=(0===o||100===o?(r=h,a=l):0!==u&&100!==u||(h=r,l=a),180<Math.abs(h-r)&&(h>r?r+=360:h+=360),n(i,r,h-r,s)%360);return"hsla("+d+", "+n(i,a,l-a,s)+"%, "+n(i,o,u-o,s)+"%, "+n(i,t,e-t,s)+")"}static{var t=St.gx,e=(t,e,i,s,n,r)=>{t.position=new U(s(n,e.x,i.x-e.x,r),s(n,e.y,i.y-e.y,r))};t.add("position:diagram",e),t.add("position",e),t.add("position:part",(t,e,i,s,n,r)=>{n<r?t.Nf(s(n,e.x,i.x-e.x,r),s(n,e.y,i.y-e.y,r),!1):t.position=new U(s(n,e.x,i.x-e.x,r),s(n,e.y,i.y-e.y,r))}),t.add("location",(t,e,i,s,n,r)=>{n<r?t.Nf(s(n,e.x,i.x-e.x,r),s(n,e.y,i.y-e.y,r),!0):t.location=new U(s(n,e.x,i.x-e.x,r),s(n,e.y,i.y-e.y,r))}),t.add("position:placeholder",(t,e,i,s,n,r)=>{n<r?t.Nf(s(n,e.x,i.x-e.x,r),s(n,e.y,i.y-e.y,r),!1):t.position=new U(s(n,e.x,i.x-e.x,r),s(n,e.y,i.y-e.y,r))}),t.add("position:nodeCollapse",(t,e,i,s,n,r)=>{var a=t.actualBounds,i=i.actualBounds,o=i.x+i.width/2-a.width/2,i=i.y+i.height/2-a.height/2;n<r?t.Nf(s(n,e.x,o-e.x,r),s(n,e.y,i-e.y,r),!1):t.position=new U(s(n,e.x,o-e.x,r),s(n,e.y,i-e.y,r))}),t.add("desiredSize",(t,e,i,s,n,r)=>{t.desiredSize=new Z(s(n,e.width,i.width-e.width,r),s(n,e.height,i.height-e.height,r))}),t.add("width",(t,e,i,s,n,r)=>{t.width=s(n,e,i-e,r)}),t.add("height",(t,e,i,s,n,r)=>{t.height=s(n,e,i-e,r)}),t.add("fill",(t,e,i,s,n,r)=>{t.fill=St.BM(e,i,n,r,s)}),t.add("stroke",(t,e,i,s,n,r)=>{t.stroke=St.BM(e,i,n,r,s)}),t.add("strokeWidth",(t,e,i,s,n,r)=>{t.strokeWidth=s(n,e,i-e,r)}),t.add("strokeDashOffset",(t,e,i,s,n,r)=>{t.strokeDashOffset=s(n,e,i-e,r)}),t.add("background",(t,e,i,s,n,r)=>{t.background=St.BM(e,i,n,r,s)}),t.add("opacity",(t,e,i,s,n,r)=>{t.opacity=s(n,e,i-e,r)}),t.add("scale",(t,e,i,s,n,r)=>{t.scale=s(n,e,i-e,r)}),t.add("angle",(t,e,i,s,n,r)=>{t.angle=s(n,e,i-e,r)})}static Default=1;static AnimateLocations=2;static None=3}class kt{mx;Ym;Di;Fu;Eo;Ss;eA;If;we;px;li;Qn;Ru;Of;yx;wx;Df;zM;xx;bs;b;XM;YM;KM;constructor(t){this.b=null,this.bs=null,this.zM=null,this.xx=null,this.XM=!1,this.Di=!1,this.Df=!1,this.li=0,this.Qn=0,this.mx=kt.EaseInOutQuad,this.Ym=kt.EaseInOutQuad,this.Ru=!1,this.Of=!1,this.yx=1,this.wx=0,this.Eo=NaN,this.Ss=NaN,this.YM=0,this.Fu=null,this.eA=U.To,this.we=new L,this.px=new L,this.If=new C,this.KM=1,t&&Object.assign(this,t)}suspend(){this.Df=!0}advanceTo(t,e){e&&(this.Df=!1),this.Ru&&t>=this.Ss&&(this.Of=!0,t-=this.Ss),this.YM=t,this.QC(!0),this.bs.Lu(),this.b.Pr(),this.bs.Tu(),this.b.redraw()}cx(t){if(this.px.clear(),this.Of=!1,this.wx=0,this.Ss=NaN,0<this.If.count&&this.If.clear(),null!==t)for(var e=t.links;e.next();)e.value.Dr=null}pF(){return 0<this.we.count}start(){if(0!==this.we.count&&!this.Di){let e=this.b;for(var t,i=this.we.iterator;i.next();){var s=i.key;null===e&&(s instanceof K?e=s:s instanceof y&&(e=s.diagram))}null!==e&&(this.b=e,this.bs=e.animationManager,!1!==(t=this.bs).isEnabled)&&(this.Ss=isNaN(this.Eo)?t.duration:this.Eo,this.Ym=this.mx,t.Lf&&1===t.Tf&&this===t.defaultAnimation&&(this.Ym=kt.EaseOutExpo,this.Ss=isNaN(this.Eo)?600===t.duration?900:t.duration:this.Eo),this.KM=e.scrollMode,this.isViewportUnconstrained&&(e.Zh=2),t.Lu(),this.If.each(t=>{t.data=null,e.add(t)}),t.Tu(),this.Di=!0,this.li=+new Date,this.Qn=this.li+this.Ss,t.uF(this))}return this}addTemporaryPart(t,e){return t.De()&&((Yt,void 0===e&&Xt.n("addTemporaryPart: Required Diagram argument missing"),t.diagram===e&&Xt.n("addTemporaryPart: Part already in Diagram, did you mean to pass in a copy?"),null!==this.b)&&this.b!==e&&Xt.n("addTemporaryPart: A different Diagram is already associated with this Animation: "+this.b.toString()),this.If.add(t),this.b=e),this}add(t,e,i,s,n){if(null===this.b&&(t instanceof K?this.b=t:t instanceof y&&null!==t.diagram&&(this.b=t.diagram)),t instanceof Y){if(!t.isAnimated)return this;"position"===e&&(e="position:part")}return this.EM(t,e,i,s,n),this}EM(t,e,i,s,n){var r=this.we;let a,o,h;if("fill"!==(e=t instanceof K&&"position"===e?"position:diagram":e)&&"stroke"!==e&&"background"!==e||(m.Bo(i),m.UM(),i=[m.Yi.n0,m.Yi.n1,m.Yi.n2,m.Yi.n3],m.Bo(s),m.UM(),s=[m.Yi.n0,m.Yi.n1,m.Yi.n2,m.Yi.n3]),r.contains(t))a=r.getValue(t),o=a.li,h=a.ks,void 0===o[e]&&(o[e]=this.Iu(i)),h[e]=this.Iu(s);else{if("position"===e&&i.equalsApprox(s))return;o={},h={},o[e]=this.Iu(i),h[e]=this.Iu(s),a=new Mt(o,h,n),r.add(t,a)}s=o[e];s instanceof U&&!s.isReal()&&s.c(this.eA),n&&0===e.indexOf("position:")&&t instanceof Y?a.bx.location=this.Iu(t.location):n&&(a.bx[e]=this.Iu(i))}Iu(t){return t instanceof U||t instanceof qt?t.copy():t}yF(t){var e=this.we;e.contains(t)&&(e.getValue(t).kx=!0)}ux(t){return!!this.Di&&null!==(t=this.we.getValue(t))&&t.kx}OM(t){return!!this.Di&&null!==(t=this.we.getValue(t))&&!!(t.li.position||t.li["position:part"]||t.li.location)}dF(){if(0<this.If.count)return!0;for(var t=this.we.iterator;t.next();){var e=t.key;if(e instanceof y&&null!==e.diagram||e instanceof K)return!0}return!1}QC(e){if(!this.Df||e){var i=this.bs;if(!1!==this.Di){var s=+new Date;let t=s>this.Qn?this.Ss:s-this.li;e&&((t=this.YM)<this.Ss?(this.li=+new Date-t,this.Qn=this.li+this.Ss):t=this.Ss),i.Lu(),this.ZC(t),this.b.Pr(!0),i.Tu(),s>this.Qn&&(this.Ru&&!this.Of?(this.li=+new Date,this.Qn=this.li+this.Ss,this.Of=!0):this.Du(!1))}}}ZC(t){for(var e=this.Ss,i=this.we.iterator,s=this.Of;i.next();){var n=i.key;if(!(n instanceof y&&null===n.diagram)){var r=i.value,a=s?r.ks:r.li,o=s?r.li:r.ks,h=St.gx;for(const l in o)"position"===l&&(o["position:placeholder"]||o["position:nodeCollapse"])||null!==h.get(l)&&h.get(l)(n,a[l],o[l],this.Ym,t,e,this)}}}stop(){return this.Di&&this.Du(!0),this}Du(t){if(null!==this.xx&&this.xx.wF(this.zM),this.Di){for(var e=this.b,i=this.bs,s=(i.Lf=!1,this.Di=!1,this.Df=!1,i.Lu(),this.we),n=this.If.iterator;n.next();)e.remove(n.value);for(var r=this.Ru,a=s.iterator,o=St.gx;a.next();){var h=a.key,l=a.value,u=r?l.ks:l.li,d=r?l.li:l.ks,c=l.bx;for(const m in d)if(null!==o.get(m)){let t=m;!l.Sx||"position:nodeCollapse"!==t&&"position:placeholder"!==t||(t="position"),o.get(t)(h,u[m],(void 0!==c[m]?c:l.Sx?u:d)[m],this.Ym,this.Ss,this.Ss,this)}l.Sx&&void 0!==c.location&&h instanceof Y&&(h.location=c.location),l.kx&&h instanceof Y&&h.Ki(!1)}this.wx++;s=!t&&this.yx>this.wx;if(s||this!==i.Bm&&this!==i.defaultAnimation||this.we.clear(),e.Mx.clear(),e.NS(!1),e.invalidateDocumentBounds(),e.T(),e.Pr(!0),i.defaultAnimation===this){for(var g=i.Xm.iterator;g.next();)g.value.xF();i.Xm.clear()}e.Pr(!0),this.isViewportUnconstrained&&(e.scrollMode=this.KM),i.Tu(),s?(this.Of=!1,this.start()):(this.cx(null),i.Du(this),this.Fu&&this.Fu(this),e.requestUpdate())}}Ff(t,e){var i,s,n=e.actualBounds;let r=null;null!==(r=e instanceof j?e.placeholder:r)&&r.visible?(i=r.getDocumentPoint(J.TopLeft),s=r.padding,i.x+=s.left,i.y+=s.top,this.add(t,"position",i,t.position,!1)):this.add(t,"position",new U(n.x+n.width/2,n.y+n.height/2),t.position,!1),this.add(t,"scale",.01,t.scale,!1),t instanceof j&&this.bF(t,e)}bF(t,e){for(var i=t.memberParts;i.next();){var s=i.value;s instanceof D&&this.Ff(s,e)}}Rf(e,i){if(e.isVisible()){let t=null;var s,n;null!==(t=i instanceof j?i.placeholder:t)&&t.visible?(s=t.getDocumentPoint(J.TopLeft),n=t.padding,s.x+=n.left,s.y+=n.top,this.add(e,"position:placeholder",e.position,s,!0)):this.add(e,"position:nodeCollapse",e.position,i,!0),this.add(e,"scale",e.scale,.01,!0),this.yF(e),e instanceof j&&this.kF(e,i)}}kF(t,e){for(var i=t.memberParts;i.next();){var s=i.value;s instanceof D&&this.Rf(s,e)}}get duration(){return this.Eo}set duration(t){Xt.t(t,"number",kt,"duration"),t<1&&Xt.G(t,">= 1",kt,"duration"),this.Eo=t}get reversible(){return this.Ru}set reversible(t){this.Ru=t}get runCount(){return this.yx}set runCount(t){0<t?this.yx=t:Xt.n("Animation.runCount value must be a positive integer.")}get finished(){return this.Fu}set finished(t){this.Fu!==t&&(null!==t&&Xt.t(t,"function",kt,"finished"),this.Fu=t)}get easing(){return this.mx}set easing(t){this.mx=t}get isViewportUnconstrained(){return this.XM}set isViewportUnconstrained(t){this.XM=t}get isAnimating(){return this.Di}getTemporaryState(t){let e=this.px.get(t);return null===e&&(e={},this.px.add(t,e)),e}static EaseLinear=(t,e,i,s)=>i*t/s+e;static EaseInOutQuad=(t,e,i,s)=>(t/=s/2)<1?i/2*t*t+e:-i/2*(--t*(t-2)-1)+e;static EaseInQuad=(t,e,i,s)=>i*(t/=s)*t+e;static EaseOutQuad=(t,e,i,s)=>-i*(t/=s)*(t-2)+e;static EaseInExpo=(t,e,i,s)=>0===t?e:i*Math.pow(2,10*(t/s-1))+e;static EaseOutExpo=(t,e,i,s)=>t===s?e+i:i*(1-Math.pow(2,-10*t/s))+e}class Mt{li;ks;bx;Sx;kx;constructor(t,e,i){this.li=t,this.ks=e,this.bx={},this.Sx=i,this.kx=!1}}(e={})[e.Default=1]="Default",e[e.Immediate=2]="Immediate",e[e.Bundled=3]="Bundled";var Nt=e;class Ct{Te;mn;Ou;Ef;constructor(t,e,i){i&&(Yt,Xt.it(i,Nt,"TriggerStart")),this.Te=null,this.mn=t,this.Ou=i||1,this.Ef=null,void 0!==e&&(this.Ef=e,void 0===i)&&(this.Ou=2)}copy(){var t,e=new Ct(this.mn),i=(e.Ou=this.Ou,this.Ef);return null!==i&&(t={},void 0!==i.duration&&(t.duration=i.duration),void 0!==i.finished&&(t.finished=i.finished),void 0!==i.easing&&(t.easing=i.easing),e.Ef=t),e}get propertyName(){return this.mn}set propertyName(t){this.mn=t}get animationSettings(){return this.Ef}set animationSettings(t){this.Ef=t}SF(t){var e=this.Ef;null!==e&&(e.duration&&(t.duration=e.duration),e.finished&&(t.finished=e.finished),e.easing)&&(t.easing=e.easing)}get startCondition(){return this.Ou}set startCondition(t){Yt,Xt.it(t,Nt,"TriggerStart"),this.Ou=t}static Default=1;static Immediate=2;static Bundled=3}class Lt{b;Tt;_t;Fr;Xl;Yl;Kl;Ul;Gl;Hl;vl;ql;Wl;jl;Jl;Zl;Cf;$l;Px;Km;Eu;It;constructor(t){C.ji(this),this.b=null,this.It=new O,this.Tt="",this._t=1,this.Fr=!1,this.Xl=!0,this.Yl=!0,this.Kl=!0,this.Ul=!0,this.Gl=!0,this.Hl=!0,this.vl=!0,this.ql=!0,this.Wl=!0,this.jl=!0,this.Jl=!0,this.Zl=!0,this.Cf=!0,this.$l=!0,this.Px=!0,this.Km=!1,this.Eu=[],t&&Object.assign(this,t)}MF(){var e=this.It;for(let t=0;t<e.length;t++)e.h[t].GM(null);e.clear(),this.Eu.length=0}Vo(t){this.b=t}toString(t){var e='Layer "'+this.name+'"';if((t=void 0===t?0:t)<=0)return e;let i=0,s=0,n=0,r=0,a=0;for(var o=this.It.iterator;o.next();){var h=o.value;h instanceof j?n++:h instanceof D?s++:h instanceof q?r++:h instanceof X?a++:i++}let l="";if(0<i&&(l+=i+" Parts "),0<s&&(l+=s+" Nodes "),0<n&&(l+=n+" Groups "),0<r&&(l+=r+" Links "),0<a&&(l+=a+" Adornments "),1<t)for(var u=this.It.iterator;u.next();){var d=u.value,c=(l+=`
    `+d.toString(),d.data);null!==c&&C.ps(c)&&(l+=" #"+C.ps(c)),d instanceof D?l+=" "+Xt.toString(c):d instanceof q&&(l+=" "+Xt.toString(d.fromNode)+" "+Xt.toString(d.toNode))}return e+" "+this.It.count+": "+l}findObjectAt(i,s,n){if(void 0===s&&(s=null),void 0===n&&(n=null),!1!==this.$l){Yt,i.isReal()||Xt.n("findObjectAt: Point must have a real value, not: "+i.toString());let e=!1;null!==this.diagram&&this.diagram.viewportBounds.containsPoint(i)&&(e=!0);var r=U.a(),a=this.It.h;for(let t=a.length;t--;){var o=a[t];if((!0!==e||!1!==o.Rl())&&o.isVisible()){r.c(i),r.Ge(o.Ms);let t=o.sA(r,s,n);if(null!==t&&null!==(t=null!==s?s(t):t)&&(null===n||n(t)))return U.o(r),t}}U.o(r)}return null}findObjectsAt(i,s,n,r){if(void 0===s&&(s=null),void 0===n&&(n=null),r instanceof O||r instanceof C||(r=new C),!1!==this.$l){Yt,i.isReal()||Xt.n("findObjectsAt: Point must have a real value, not: "+i.toString());let e=!1;null!==this.diagram&&this.diagram.viewportBounds.containsPoint(i)&&(e=!0);var a=U.a(),o=this.It.h;for(let t=o.length;t--;){var h=o[t];if((!0!==e||!1!==h.Rl())&&h.isVisible()){a.c(i),a.Ge(h.Ms);let t=h;h.nA(a,s,n,r)&&null!==(t=null!==s?s(t):t)&&(null===n||n(t))&&r.add(t)}}U.o(a)}return r}findObjectsIn(i,s,n,r,a){if(void 0===s&&(s=null),void 0===n&&(n=null),void 0===r&&(r=!1),a instanceof O||a instanceof C||(a=new C),!1!==this.$l){Yt,i.isReal()||Xt.n("findObjectsIn: Rect must have a real value, not: "+i.toString());let e=!1;null!==this.diagram&&this.diagram.viewportBounds.containsRect(i)&&(e=!0);var o=this.It.h;for(let t=o.length;t--;){var h=o[t];if((!0!==e||!1!==h.Rl())&&h.isVisible()){let t=h;h.Um(i,s,n,r,a)&&null!==(t=null!==s?s(t):t)&&(null===n||n(t))&&a.add(t)}}}return a}IS(e,i,s,n,r,a,o){if(!1!==this.$l){var h=this.It.h;for(let t=h.length;t--;){var l=h[t];if((!0!==o||!1!==l.Rl())&&a(l)&&l.isVisible()){let t=l;l.Um(e,i,s,n,r)&&null!==(t=null!==i?i(t):t)&&(null===s||s(t))&&r.add(t)}}}return r}findObjectsNear(i,s,n,r,a,o){if(void 0===n&&(n=null),void 0===r&&(r=null),!1!==(a=void 0===a?!0:a)&&!0!==a&&((a instanceof O||a instanceof C)&&(o=a),a=!0),o instanceof O||o instanceof C||(o=new C),!1!==this.$l){Yt,i.isReal()||Xt.n("findObjectsNear: Point must have a real value, not: "+i.toString());let e=!1;null!==this.diagram&&this.diagram.viewportBounds.containsPoint(i)&&(e=!0);var h=U.a(),l=U.a(),u=this.It.h;for(let t=u.length;t--;){var d=u[t];if((!0!==e||!1!==d.Rl())&&d.isVisible()){h.c(i),h.Ge(d.Ms),l.e(i.x+s,i.y),l.Ge(d.Ms);let t=d;d.oA(h,l,n,r,a,o)&&null!==(t=null!==n?n(t):t)&&(null===r||r(t))&&o.add(t)}}U.o(h),U.o(l)}return o}HM(){return this.It.h}Gs(t,e){if(this.visible){var i=this.It.h,s=i.length;if(0!==s){var n=Xt.ct(),r=Xt.ct();for(let t=0;t<s;t++){var a=i[t];if(a.vM=t,a instanceof q){if(!1===a.Re)continue}else if(a instanceof X&&null!==a.adornedPart)continue;var o=a.actualBounds;a.isVisible()&&o.intersectsRectPlus(e,10)?(a.Gs(!0),n.push(a)):(a.Gs(!1),null!==a.adornments&&0<a.adornments.count&&r.push(a))}for(let t=0;t<n.length;t++)for(var h=n[t],l=(h.qM(),h.adornments);l.next();){var u=l.value;u.wt(1/0,1/0),u.vt(),u.Gs(!0)}for(let t=0;t<r.length;t++)r[t].qM();Xt.ot(n),Xt.ot(r)}}}Vu(t){let e=1;return 1!==this._t&&(e=t.globalAlpha,t.globalAlpha=e*this._t),e}rA(e,i){for(let t=0;t<i;t++)e[t].Bu()}Ji(e,i,t){if(this.visible&&0!==this._t&&((t=void 0===t?!0:t)||!this.isTemporary)){var s=this.It.h,n=s.length;if(0!==n){e.Fr&&this.rA(s,n);var t=this.Vu(e),r=this.Eu,a=(r.length=0,i.scale),o=Z.a();for(let t=0;t<n;t++){var h=s[t];this.Gm(e,h,i,r,a,o,!0)}Z.o(o),e.Fr&&this.rA(s,n),e.globalAlpha=t}}}hE(e,i,s){if(this.visible&&0!==this._t){var n=this.It.h,r=n.length;if(0!==r){var t=this.Vu(e),a=this.Eu,o=(a.length=0,i.scale),h=Z.a();for(let t=0;t<r;t++){var l=n[t];s.contains(l)||this.Gm(e,l,i,a,o,h,!0)}Z.o(h),e.globalAlpha=t}}}PF(e,i,s,t){if(this.visible&&0!==this._t&&(t||!this.isTemporary)){var n=this.It.h,r=n.length;if(0!==r){var t=this.Vu(e),a=this.Eu,o=(a.length=0,i.scale),h=Z.a();for(let t=0;t<r;t++){var l=n[t];s.contains(l)&&this.Gm(e,l,i,a,o,h,!1)}Z.o(h),e.globalAlpha=t}}}NF(e,t,i,s,n){if(this.visible&&0!==this.opacity){var r=this.diagram.grid.part;if(!s&&this.isTemporary)n&&r.layer===this&&(s=this.Vu(e),r.Ji(e,i),e.globalAlpha=s);else{var s=this.Vu(e),a=i.scale,o=Z.a(),h=this.It.h,l=h.length;for(let t=0;t<l;t++){var u=h[t];!n&&u===r||this.Gm(e,u,i,null,a,o,!1)}Z.o(o),e.globalAlpha=s}}}aE(e,i,s){if(this.visible&&0!==this._t){var t=this.Vu(e),n=this.Eu,r=(n.length=0,i.scale),a=Z.a(),o=this.It.h,h=o.length,l=s.length;for(let t=0;t<h;t++){var u=o[t],d=u.$h(u.actualBounds);this.CF(d,s,l,r)&&this.Gm(e,u,i,n,r,a,!0)}Z.o(a),e.globalAlpha=t}}Gm(s,n,r,t,a,o,h){if(h&&!n.Rl())s.removePartFromView(n);else if(null!==t&&n instanceof q&&(n.isOrthogonal&&t.push(n),!1===n.Re))s.removePartFromView(n);else{let t=!1,e=n.containingGroup;for(;null!==e;)t?null!==e.hi&&o.intersectRect(e.hi):null!==e.hi&&(t=!0,o.c(e.hi)),e=e.containingGroup;h=n.actualBounds;let i=!1;if(t&&n.isVisible()){if(!o.intersectsRect(h))return void s.removePartFromView(n);i=!o.containsRect(h)}i&&(s.save(),s instanceof _t?s.partClipRect=o.copy():(s.beginPath(),s.rect(o.x,o.y,o.width,o.height),s.clip())),h.width*a>r.Hm||h.height*a>r.Hm?n.Ji(s,r):this.AF(s,n),i&&(s.restore(),s.clearContextCache(!0))}}AF(t,e){var i,s=e.actualBounds,n=e.naturalBounds;0===s.width||0===s.height||isNaN(s.x)||isNaN(s.y)||!e.isVisible()||(i=e.D,null===e.background&&(e.bn(t,"rgba(0,0,0,0.3)",!0,!1,n,s),t.fillRect(s.x,s.y,s.width,s.height)),null===e.background)||(t.transform(i.m11,i.m12,i.m21,i.m22,i.dx,i.dy),e.bn(t,e.background,!0,!1,n,s),t.fillRect(0,0,n.width/2,n.height/2),i.Gk())||(e=1/(i.m11*i.m22-i.m12*i.m21),t.transform(i.m22*e,-i.m12*e,-i.m21*e,i.m11*e,e*(i.m21*i.dy-i.m22*i.dx),e*(i.m12*i.dx-i.m11*i.dy)))}CF(e,i,s,t){var n=2/t,r=4/t;for(let t=0;t<s;t++){var a=i[t];if(0!==a.width&&0!==a.height&&e.intersects(a.x-n,a.y-n,a.width+r,a.height+r))return!0}return!1}i(t,e,i,s,n){var r=this.diagram;null!==r&&r.raiseChangedEvent(2,t,this,e,i,s,n)}Qh(t,e,i){var s=this.It;if(e.GM(this),t>=s.count)t=s.count;else if(s.elt(t)===e)return-1;s.insertAt(t,e),e.vm(i);s=this.diagram;return null!==s&&(i?s.T():s.Qh(e)),this.Nx(t,e),t}re(t,e,i){if(!i&&e.layer!==this&&null!==e.layer)return e.layer.re(t,e,i);var s=this.It;if(t<0||t>=s.length){if((t=s.indexOf(e))<0)return-1}else if(s.elt(t)!==e&&(t=s.indexOf(e))<0)return-1;e.qm(i),s.removeAt(t);s=this.diagram;return null!==s&&(i?s.T():s.re(e)),e.GM(null),t}Nx(t,e){t=this.LF(t,e),e instanceof j&&this.TF(t,e),null!==e.svg&&e.svg.remove()}LF(n,r){var a=r.zOrder;if(!isNaN(a)){var o=this.It,h=o.count;if(!(h<=1)){if((n=n<0?o.indexOf(r):n)<0)return-1;let t=n-1,e=NaN;for(;0<=t&&(e=o.elt(t).zOrder,isNaN(e));)t--;let i=n+1,s=NaN;for(;i<h&&(s=o.elt(i).zOrder,isNaN(s));)i++;if(!isNaN(e)&&e>a)for(;;){if(-1===t||e<=a)return++t===n?n:(o.removeAt(n),o.insertAt(t,r),t);for(e=NaN;0<=--t&&(e=o.elt(t).zOrder,isNaN(e)););}else if(!isNaN(s)&&s<a)for(;;){if(i===h||s>=a)return--i===n?n:(o.removeAt(n),o.insertAt(i,r),i);for(s=NaN;++i<h&&(s=o.elt(i).zOrder,isNaN(s)););}}}return n}TF(t,e){null!==e&&isNaN(e.zOrder)&&(this.DF(t,e),null!==(t=e.containingGroup))&&this.Nx(-1,t)}DF(i,s){if(0!==s.memberParts.count){let e=-1;var t,n=this.It.h,r=n.length;for(let t=0;t<r;t++){var a=n[t];if(a===s&&(i=t,0<=e)||e<0&&a.containingGroup===s&&(e=t,0<=i))break}!(e<0)&&e<i&&((t=this.It).removeAt(i),t.insertAt(e,s))}}get parts(){return this.It.iterator}get partsBackwards(){return this.It.iteratorBackwards}get diagram(){return this.b}get name(){return this.Tt}set name(t){Xt.t(t,"string",Lt,"name");var e=this.Tt;if(e!==t){var i=this.diagram;if(null!==i){""===e&&Xt.n("Cannot rename default Layer to: "+t);for(var s=i.layers;s.next();)s.value.name===t&&Xt.n("Layer.name is already present in this diagram: "+t)}this.Tt=t,this.i("name",e,t);for(var n=this.It.iterator;n.next();)n.value.layerName=this.Tt}}get opacity(){return this._t}set opacity(t){var e,i=this._t;i!==t&&(Xt.t(t,"number",Lt,"opacity"),(t<0||1<t)&&Xt.G(t,"0 <= value <= 1",Lt,"opacity"),this._t=t,null!==(e=this.diagram)&&e.T(),this.i("opacity",i,t))}get isViewportAligned(){return this.Km}set isViewportAligned(t){var e=this.Km;e!==t&&(this.Km=t,this.diagram&&(this.lA(),this.diagram.T()),this.i("isViewportAligned",e,t),t)&&(this.isInDocumentBounds=!1)}lA(){if(this.Km){var s=this.diagram,n=this.It.h,t=n.length,r=s.Ct,a=s.At;for(let i=0;i<t;i++){var o=n[i],h=o.naturalBounds.width,l=o.naturalBounds.height;let t=o.alignment,e=(!t.isDefault()&&t.isSpot()||(t=J.BottomRight),o.alignmentFocus);e.isDefault()&&(e=new J(t.x,t.y));h=t.x*r+t.offsetX-(e.x*h+e.offsetX),l=t.y*a+t.offsetY-(e.y*l+e.offsetY),h=U.H(h,l);s.FF(h),o.Nf(h.x,h.y,!0),U.o(h),o.v=1/s.scale}}}get isTemporary(){return this.Fr}set isTemporary(t){var e=this.Fr;e!==t&&(Xt.t(t,"boolean",Lt,"isTemporary"),this.Fr=t,this.i("isTemporary",e,t))}get visible(){return this.Cf}set visible(t){var e=this.Cf;if(e!==t){Xt.t(t,"boolean",Lt,"visible"),this.Cf=t;for(var i=this.It.iterator;i.next();)i.value.Ki(t);var s=this.diagram;null!==s&&s.T(),this.i("visible",e,t)}}get pickable(){return this.$l}set pickable(t){var e=this.$l;e!==t&&(Xt.t(t,"boolean",Lt,"pickable"),this.$l=t,this.i("pickable",e,t))}get isInDocumentBounds(){return this.Px}set isInDocumentBounds(t){var e=this.Px;e!==t&&(this.Px=t,null!==this.diagram&&this.diagram.invalidateDocumentBounds(),this.i("isInDocumentBounds",e,t))}get allowCopy(){return this.Xl}set allowCopy(t){var e=this.Xl;e!==t&&(Xt.t(t,"boolean",Lt,"allowCopy"),this.Xl=t,this.i("allowCopy",e,t))}get allowDelete(){return this.Yl}set allowDelete(t){var e=this.Yl;e!==t&&(Xt.t(t,"boolean",Lt,"allowDelete"),this.Yl=t,this.i("allowDelete",e,t))}get allowTextEdit(){return this.Kl}set allowTextEdit(t){var e=this.Kl;e!==t&&(Xt.t(t,"boolean",Lt,"allowTextEdit"),this.Kl=t,this.i("allowTextEdit",e,t))}get allowGroup(){return this.Ul}set allowGroup(t){var e=this.Ul;e!==t&&(Xt.t(t,"boolean",Lt,"allowGroup"),this.Ul=t,this.i("allowGroup",e,t))}get allowUngroup(){return this.Gl}set allowUngroup(t){var e=this.Gl;e!==t&&(Xt.t(t,"boolean",Lt,"allowUngroup"),this.Gl=t,this.i("allowUngroup",e,t))}get allowLink(){return this.Hl}set allowLink(t){var e=this.Hl;e!==t&&(Xt.t(t,"boolean",Lt,"allowLink"),this.Hl=t,this.i("allowLink",e,t))}get allowRelink(){return this.vl}set allowRelink(t){var e=this.vl;e!==t&&(Xt.t(t,"boolean",Lt,"allowRelink"),this.vl=t,this.i("allowRelink",e,t))}get allowMove(){return this.ql}set allowMove(t){var e=this.ql;e!==t&&(Xt.t(t,"boolean",Lt,"allowMove"),this.ql=t,this.i("allowMove",e,t))}get allowReshape(){return this.Wl}set allowReshape(t){var e=this.Wl;e!==t&&(Xt.t(t,"boolean",Lt,"allowReshape"),this.Wl=t,this.i("allowReshape",e,t))}get allowResize(){return this.jl}set allowResize(t){var e=this.jl;e!==t&&(Xt.t(t,"boolean",Lt,"allowResize"),this.jl=t,this.i("allowResize",e,t))}get allowRotate(){return this.Jl}set allowRotate(t){var e=this.Jl;e!==t&&(Xt.t(t,"boolean",Lt,"allowRotate"),this.Jl=t,this.i("allowRotate",e,t))}get allowSelect(){return this.Zl}set allowSelect(t){var e=this.Zl;e!==t&&(Xt.t(t,"boolean",Lt,"allowSelect"),this.Zl=t,this.i("allowSelect",e,t))}}(e={})[e.None=1]="None",e[e.Uniform=2]="Uniform",e[e.UniformToFill=3]="UniformToFill";var e,Dt=e,Tt=((e={})[e.All=1]="All",e[e.NotDirected=2]="NotDirected",e[e.NotDirectedFast=3]="NotDirectedFast",e[e.NotUndirected=4]="NotUndirected",e[e.DestinationTree=5]="DestinationTree",e[e.SourceTree=6]="SourceTree",e),Bt=((e={})[e.Document=1]="Document",e[e.Infinite=2]="Infinite",e);(e={})[e.TreeParent=1]="TreeParent",e[e.AllParents=2]="AllParents",e[e.AnyParents=3]="AnyParents";class K{bs;wi;WM;Cx;Rr;zu;Ax;Lx;Tx;Dx;Fx;Rx;Vf;Zh;Ix;Ox;Ex;Ql;Bf;Ir;Wm;Vx;Bx;Xu;_n;Or;_h;zo;jm;zf;Jm;Xf;Yu;Er;to;jM;JM;zx;Xx;ZM;Yx;$M;QM;_M;Kx;Zm;Vr;Br;zr;Xr;Yr;Kr;Ux;Ur;Gx;Gr;Hr;vr;qr;Hx;tP;Xo;iP;vx;qx;eP;Li;sP;nP;oP;Ys;Yo;Xi;Wx;Xl;Yl;jx;Jx;Kl;Ul;Gl;Zx;Hl;vl;ql;Wl;jl;Jl;Zl;$x;Qx;rP;Ku;Uu;_x;t1;i1;e1;$m;s1;o1;l1;ei;lP;h1;hP;Gu;kn;io;le;eo;hA;_l;aP;fP;a1;Hu;Qm;f1;Wr;th;ta;RF;IF;_m;c1;u1;ls;t0;i0;vu;ih;Yf;e0;jr;ia;cP;s0;$t;D;qe;Tr;Ui;Ps;OF;eh;Jr;Al;Zr;ea;Kf;uP;qu;sa;Wu;Jt;sh;lt;v;ju;Ct;At;xt;Uf;Hw;d1;na;Gf;g1;m1;p1;EF;VF;Gi;Tl;Hm;o0;dP;gP;aA;r0;BF;zF;XF;w1;YF;KF;UF;oa;fA;nh;ra;la;ha;aa;Pu;jh;ai;Ot;Hf;eS;sS;wf;_t;static b1=null;static cA=new L;static mP;static pP=null;Mu;k1;S1;M1;P1;N1;l0;yP;h0;a0;f0;fx;wP;C1;vf;constructor(t,e){if(K.ww||(K.Hk(),K.ww=!0),C.ji(this),K.uA(this),this.$t=!0,this.Ot=null,this.Ct=0,this.At=0,this.xt=null,K.isUsingDOM()){const s=this,n=()=>{s.Ti(v.document,"DOMContentLoaded",n,!1),s.setRTL()};null!==v.document.body?this.setRTL():s.Ht(v.document,"DOMContentLoaded",n,!1)}this.Uf=null,K.xP("Model",ei);const i=this;return this.sP=t=>i.partManager.doModelDataChanged(t),this.nP=t=>i.partManager.doModelChanged(t),this.g1=null,this.m1=null,this.dA(),this.model=x.initDiagramModel(),this.C1=null,this.themeManager=new zi,this.Xo=!0,this.gA(),this.layout=new Qe,this.Xo=!1,this.BF=null,this.zF=null,this.XF=null,this.w1=null,this.YF=null,this.KF=null,this.UF=null,this.oa=null,this.fA=null,this.nh=null,this.ra=null,this.la=null,this.ha=null,this.aa=null,this.Pu=()=>{},this.jh=null,this.vu=!1,this.Hf=new Gt(this),void 0!==t&&("string"==typeof t||v.Element&&t instanceof Element?this.bP(t):e=t),e&&this.setProperties(e),this.$t=!1,this.requestUpdate(),this}ZD(){return null!==this.xt}get renderer(){return this.Yf}set renderer(e){if(!(this instanceof Ht)){var e=(e=""===e?"default":e).toLowerCase(),t=this.Yf;if(e!==t){let t=null;"default"===(this.Yf=e)||"canvas"===e?(null!==(t=this.ih.get("svg"))&&t.Bt.remove(),this.xt&&(this.ai=this.xt.gi)):"svg"===e?(this.ih.contains("svg")?t=this.ih.get("svg"):(t=new Jt(this,v.document),this.addRenderer("svg",t)),null!==this.div&&this.div.appendChild(t.Bt),this.ai=t.gi,this.xt&&(this.xt.gi.setTransform(this.Gi,0,0,this.Gi,0,0),this.xt.gi.clearRect(0,0,this.Ct,this.At))):"debug"!==e||this.ih.contains("SVG")||(t=new Jt(this,v.document),this.addRenderer("SVG",t),t.Bt.style.backgroundColor="whitesmoke",null!==this.div&&this.div.after(t.Bt)),this.$t||this.redraw()}}}dA(){this.vf=new O,this.setupRouters(),this.bs=new St,this.bs.Vo(this),this.wi=17,this.WM=!1,this.ju=!1,this.Cx="default",this.Jt=new O,this.ih=new L,this.Yf="default",this.resetRenderingHints(),this.GF(),this._t=1,this.lt=new U(NaN,NaN).w(),this.fx=new U(NaN,NaN),this.v=1,this.s0=1,this.Ax=new U(NaN,NaN).w(),this.Lx=NaN,this.Tx=1e-4,this.Dx=100,this.D=new H,this.Fx=new U(NaN,NaN).w(),this.Rx=new Z(NaN,NaN,NaN,NaN).w(),this.Vf=new E(0,0,0,0).w(),this.Zh=1,this.Ix=!1,this.Ox=null,this.Ex=null,this.Ql=1,this.Bf=J.Default,this.Ir=1,this.Wm=J.Default,this.Vx=J.None,this.Bx=J.None,this.qe=!0,this.Xu=!1,this._n=new Set,this.Or=new C,this._h=new C,this.zo=!1,this.sh=new L,this.qu=!0,this.jm=250,this.zf=-1,this.Jm=new E(16,16,16,16).w(),this.Tr=!1,this.Xf=!1,this.Yu=!0,this.e0=new N,(this.e0.diagram=this).jr=new N,(this.jr.diagram=this).ia=new N,(this.ia.diagram=this).Er=null,this.to=null,this.Hw=!1,this.HF(),this.Zr=new C,this.zx=!0,this.Xx=1,this.ZM=!1,this.Yx=1,this.Kx="auto",this.Zm="auto",this.Vr=null,this.Br=null,this.zr=null,this.Xr=null,this.Yr=null,this.Kr=null,this.Ux=null,this.Ur=null,this.Gx=!1,this.Gr=null,this.Hr=null,this.vr=null,this.qr=null,this.Hx=!1,this.d1={},this.na=[null,null],this.Xo=!1,this.iP=!1,this.vx=!1,this.qx=!1,this.eP=!0,this.Ps=!1,this.sa=!1,this.oP=!0,this.Ys=-2,this.eh=new L,this.Wu=new O,this.Yo=!1,this.Xi=!0,this.Wx=!0,this.Xl=!0,this.Yl=!0,this.jx=!1,this.Jx=!0,this.Kl=!0,this.Ul=!0,this.Gl=!0,this.Zx=!0,this.Hl=!0,this.vl=!0,this.ql=!0,this.Wl=!0,this.jl=!0,this.Jl=!0,this.Zl=!0,this.$x=!0,this.Qx=!0,this.rP=!1,this.Gf=!1,this.Ku=!0,this.Uu=!0,this._x=!0,this.t1=!0,this.i1=16,this.e1=16,this.$m=!1,this.s1=!1,this.o1=0,this.l1=0,this.ei=new E(5).w(),this.lP=(new C).w(),this.h1=999999999,this.hP=(new C).w(),this.ea=!0,this.Gu=!0,this.Kf=!0,this.kn=!1,this.io=!1,this.Jr=!0,this.Al=!1,this.eo=!1,this.hA=new C,this.uP=new C,this._l=null,this.aP=new qt(8,8),this.fP=999,this.eS=1,this.sS=0,this.Ui={scale:1,position:new U,bounds:new Z,canvasSize:new qt,newCanvasSize:new qt,isScroll:!1},this.Ui.canvasSize=this.Ui.canvasSize,this.Ui.newCanvasSize=this.Ui.newCanvasSize,this.Ui.isScroll=!1,this.a1=new Z(NaN,NaN,NaN,NaN).w(),this.Hu=new qt(NaN,NaN).w(),this.Qm=new Z(NaN,NaN,NaN,NaN).w(),this.f1=!1,this.vF(),this.ls=null,this.t0=!1,this.wf=null,this.partManager=new ei,this.toolManager=new st,this.toolManager.initializeStandardTools(),this.defaultTool=this.toolManager,this.currentTool=this.defaultTool,this.S1=null,this.M1=new Ot,this.P1=null,this.N1=null,this.k1=!1,this.Mu=!1,this.commandHandler=new Kt,this.a0=null,this.f0=U.Ek,this.wP=!1,this.Gi=1,this.Tl=null,this.Hm=1,this.l0=0,this.yP=[0,0,0,0,0],this.h0=0,this.o0=1,this.dP=0,this.gP=new U,this.aA=500,this.i0=new U,this.r0=!1}static mA=void 0!==v.document;static isUsingDOM(){return K.mA}static useDOM(t){K.mA=!!t&&void 0!==v.document}static he=new WeakMap;clear(){this.animationManager.stopAnimation(),this.model.clear(),K.pA(),this.yA(!1),this.Wu.clear(),this.wA(),this._l=null,this.invalidateDocumentBounds(),this.ensureBounds(),this.T()}yA(t){this.animationManager.stopAnimation(!0),this.lP=(new C).w(),this.hP=(new C).w();var e=this.skipsUndoManager,i=null!==this.Li&&void 0!==this.Li;i&&(this.skipsUndoManager=!0);let s=null;null!==this.ls&&null!==(s=this.ls.part)&&this.remove(s);var n=[],r=this.Jt.length;if(t){for(let t=0;t<r;t++)for(var a=this.Jt.h[t].parts;a.next();){var o=a.value;o!==s&&null===o.data&&n.push(o)}for(let t=0;t<n.length;t++){var h=n[t];this.remove(h)}}for(let t=0;t<r;t++)this.Jt.h[t].MF();return this.partManager.clear(),this._n.clear(),this.Or.clear(),this._h.clear(),this.sh.clear(),this.Zr.clear(),this.wf=null,this.Wu.clear(),this.wA(),Xt.Ik=[],null!==s&&(this.add(s),this.partManager.parts.remove(s)),i&&(this.skipsUndoManager=e),n}static c0=null;static A1="";static pA(){K.c0=null,K.A1=""}static fE(){return null}reset(){this.clear(),this.$t=!0,this.dA(),this.themeManager=new zi,this.$r(),this.Xo=!0,this.gA(),this.layout=new Qe,this.Xo=!1,this.model=x.initDiagramModel(),this.model.undoManager=new Q,this.vu=!1,this.$t=!1,this.T()}vF(){this.Wr=new L,this.Wr.add("",(new D).add(new z({stroke:"black",font:"10pt sans-serif"}).bind("text","",Xt.toString).theme("stroke","text").theme("font","normal"))),this.Wr.add("Comment",(new D).add(new z({stroke:"brown",font:"10pt sans-serif"}).bind("text","",Xt.toString).theme("stroke","comment").theme("font","normal"))),this.Wr.add("LinkLabel",new D({selectable:!1,avoidable:!1}).add(new V("Ellipse",{fill:"black",stroke:null,desiredSize:new qt(3,3).rt()}).theme("fill","link"))),this.ta=new L,this.ta.add("",new j(jt.Vertical,{selectionObjectName:"GROUPPANEL"}).add(new z({stroke:"black",font:"bold 12pt sans-serif"}).bind("text","",Xt.toString).theme("stroke","text").theme("font","bold"),new jt(jt.Auto,{name:"GROUPPPANEL"}).add(new V({fill:"rgba(128,128,128,0.2)",stroke:"black",strokeWidth:1}).theme("fill","group").theme("stroke","outline").theme("strokeWidth","group"),new je({padding:5}).theme("padding","group")))),this.th=new L,this.th.add("",(new q).add(new V({isPanelMain:!0,stroke:"black"}).theme("stroke","link"),new V({toArrow:"Standard",fill:"black",stroke:null,strokeWidth:0}).theme("toArrow").theme("fill","link"))),this.th.add("Comment",(new q).add(new V({isPanelMain:!0,stroke:"brown"}).theme("stroke","comment"))),this._m=new X(jt.Auto).add(new V({fill:null,stroke:"dodgerblue",strokeWidth:3}).theme("stroke","selection").theme("strokeWidth","selection"),new je({margin:1.5}).theme("margin","selection","numbers",null,t=>t?new E(t/2):1.5)),this.c1=this._m,this.u1=new X(jt.Link).add(new V({isPanelMain:!0,fill:null,stroke:"dodgerblue",strokeWidth:3}).theme("stroke","selection").theme("strokeWidth","selection"))}setRTL(t){let e=void 0===t?this.div:t;null===e&&(e=v.document.body);t=Xt.hn("div");t.dir="rtl",t.style.cssText="font-size: 14px; width: 1px; height: 1px; position: absolute; top: -1000px; overflow: scroll;",t.textContent="A",e.appendChild(t);let i="reverse";0<t.scrollLeft?i="default":(t.scrollLeft=1,0===t.scrollLeft&&(i="negative")),e.removeChild(t),this.Cx=i}setScrollWidth(s){let n=void 0===s?this.div:s,r=(null===n&&(n=v.document.body),0);if(K.isUsingDOM()){let t=K.pP,e=K.mP;null===t&&(K.pP=Xt.hn("p"),(t=K.pP).style.width="100%",t.style.height="200px",t.style.boxSizing="content-box",K.mP=Xt.hn("div"),(e=K.mP).style.position="absolute",e.style.visibility="hidden",e.style.width="200px",e.style.height="150px",e.style.boxSizing="content-box",e.appendChild(t)),e.style.overflow="hidden",n.appendChild(e);s=t.offsetWidth;e.style.overflow="scroll";let i=t.offsetWidth;s===i&&(i=e.clientWidth),n.removeChild(e),0!==(r=s-i)||Xt.dr||(r=11)}this.wi=r,this.WM=!0}ci(t){t in Dt?this.autoScale=t:Xt.gr(this,t)}toString(t){void 0===t&&(t=0);let e="",i='Diagram "'+(e=this.div&&this.div.id?this.div.id:e)+'"';if(!(t<=0))for(var s=this.Jt.iterator;s.next();){var n=s.value;i+=`
  `+n.toString(t-1)}return i}static uA(t){K.b1=t}static Pm(){return K.b1}static fromDiv(t){let e=t;return(e="string"==typeof t?v.document.getElementById(t):e)instanceof HTMLDivElement&&K.he.has(e)?K.he.get(e):null}get div(){return this.Ot}set div(t){var e;null!==t&&Xt.s(t,HTMLDivElement,K,"div"),this.Ot!==t&&(null!==(e=this.Ot)?(K.he.delete(e),e.goDiagram=void 0,e.go=void 0,e.innerHTML="",null!==this.xt&&(e=this.xt.Bt,this.Ti(e,"pointermove",this.ra,!1),this.Ti(e,"pointerdown",this.nh,!1),this.Ti(e,"pointerup",this.la,!1),this.Ti(e,"pointerout",this.ha,!1),this.Ti(e,"pointercancel",this.aa,!1),this.xt.dispose()),this.Uf&&(this.Uf.disconnect(),this.Uf=null),null!==(e=this.toolManager)&&(e.mouseDownTools.each(t=>t.cancelWaitAfter()),e.mouseMoveTools.each(t=>t.cancelWaitAfter()),e.mouseUpTools.each(t=>t.cancelWaitAfter())),e.cancelWaitAfter(),this.currentTool.doCancel(),this.xt=null,this.Ti(v,"resize",this.w1,!1),this.Ti(v,"wheel",this.oa,!0),K.Pm()===this&&K.uA(null)):null===this.nh&&(this.eo=!1),(this.Ot=null)!==t?((e=K.he.get(t))&&(e.div=null),this.bP(t),this.Pu(),this.themeManager&&this.themeManager.qF()):this.themeManager&&this.themeManager.WF())}setupRouters(){this.vf.push(new Xi)}bP(t){const r=this;if(K.isUsingDOM()){null==t&&Xt.n("Diagram setup requires an argument DIV."),null!==r.Ot&&Xt.n("Diagram has already completed setup."),"string"==typeof t?r.Ot=v.document.getElementById(t):t instanceof HTMLDivElement?r.Ot=t:Xt.n("No DIV or DIV id supplied: "+t),null===r.Ot&&Xt.n("Invalid DIV id; could not get element with id: "+t);t=K.he.get(r.Ot);if(t&&t!==this&&Xt.n("Invalid div id; div already has a Diagram associated with it."),!r.Uf&&v.ResizeObserver){const s=v.ResizeObserver,n=Xt.Rk(()=>r.requestUpdate(),250,!1);r.Uf=new s(()=>n()),r.Uf.observe(r.Ot)}"static"===v.getComputedStyle(r.Ot,null).position&&(r.Ot.style.position="relative");r.Ot.style["-webkit-tap-highlight-color"]="rgba(255, 255, 255, 0)",r.Ot.innerHTML="",K.he.set(r.Ot,r),(r.Ot.goDiagram=r).Ot.go=v.go;var t=new $t(r),e=(void 0!==t.style&&(t.style.position="absolute",t.style.top="0px",t.style.left="0px","rtl"===v.getComputedStyle(r.Ot,null).getPropertyValue("direction")&&(r.ju=!0),t.style.zIndex="2",t.style.userSelect="none",t.style.MozUserSelect="none",t.style.touchAction="none",t.style.letterSpacing="normal !important",t.style.wordSpacing="normal !important",t.style.lang="unknown"),r.xt=t,r.ai=t.gi,r.ai);r.Gi=r.computePixelRatio(),r.viewSize.isReal()||(r.Ct=r.Ot.clientWidth||1,r.At=r.Ot.clientHeight||1),r.xA(r.Ct,r.At);const a=r;r.Ot.insertBefore(t.Bt,r.Ot.firstChild);var i,t=new $t(null),t=(t.width=1,t.height=1,r.EF=t,r.VF=t.gi,K.isUsingDOM()&&(t=Xt.hn("div"),i=Xt.hn("div"),t.style.position="absolute",t.style.overflow="auto",t.style.width=r.Ct+"px",t.style.height=r.At+"px",t.style.zIndex="1",i.style.position="absolute",i.style.width="1px",i.style.height="1px",r.Ot.appendChild(t),t.appendChild(i),t.onscroll=K.jF,t.addEventListener("pointerdown",K.JF),t.b=r,t.ZF=!0,t.$F=!0,r.g1=t,r.m1=i),r.Pu=Xt.Rk(()=>{r.Tl=null,r.T()},300,!1),r.w1=Xt.Rk(()=>{r.RM()},250,!1),r.jh=t=>(t.preventDefault(),!1),r.oa=i=>{if(a.isEnabled){var s=a.qf(i,!0);s.bubbles=!0;let t=0,e=0;void(s.delta=0)!==i.deltaX?(0!==i.deltaX&&(t=0<i.deltaX?1:-1),0!==i.deltaY&&(e=0<i.deltaY?1:-1),s.delta=Math.abs(i.deltaX)>Math.abs(i.deltaY)?-t:-e):void 0!==i.wheelDeltaX?(0!==i.wheelDeltaX&&(t=0<i.wheelDeltaX?-1:1),0!==i.wheelDeltaY&&(e=0<i.wheelDeltaY?-1:1),s.delta=Math.abs(i.wheelDeltaX)>Math.abs(i.wheelDeltaY)?-t:-e):void 0!==i.wheelDelta&&0!==i.wheelDelta&&(s.delta=0<i.wheelDelta?1:-1),a.doMouseWheel(),a.fa(s,i)}},r.fA=t=>{a.isEnabled&&(r.Gf=!1,a.qf(t,!0),(t=a.currentTool).cancelWaitAfter(),t.standardMouseOver())},r.nh=e=>{if(a.isEnabled){r.Gf=!0;var i=a.d1,i=(void 0===i[e.pointerId]&&(i[e.pointerId]=e),a.na);let t=!1;if(null===i[0]||i[0].pointerId!==e.pointerId&&i[0].pointerType===e.pointerType)if(null!==i[1]&&i[1].pointerId===e.pointerId)i[1]=e,t=!0;else if(null===i[0])i[0]=e;else{if(null!==i[1])return void e.preventDefault();i[1]=e,t=!0}else i[0]=e;var i="touch"===e.pointerType||"pen"===e.pointerType,s=(i&&(a.Hw=!1,a.r0=!0),a.QF(e,e,t)),n=a.gP,i=i?25:10;e.timeStamp-a.dP<a.aA&&!(Math.abs(n.x-e.screenX)>i||Math.abs(n.y-e.screenY)>i)?a.o0++:a.o0=1,s.clickCount=a.o0,a.dP=e.timeStamp,a.gP.setTo(e.screenX,e.screenY),a.doMouseDown(),1===e.button?e.preventDefault():a.fa(s,e)}},r.ra=t=>{if(a.isEnabled){r.Gf=!0;var e=a.na;if(null===e[0]||e[0].pointerId!==t.pointerId&&e[0].pointerType===t.pointerType){if(null!==e[1]&&e[1].pointerId===t.pointerId)return void(e[1]=t);if(null!==e[0])return}e[0]=t,e[0].pointerId===t.pointerId&&(e=a._F(t,t,null!==e[1]),a.doMouseMove(),a.fa(e,t))}},r.la=e=>{if(a.isEnabled){r.Gf=!0;var i="touch"===e.pointerType||"pen"===e.pointerType,s=a.d1;if(i&&a.Hw)delete s[e.pointerId],e.preventDefault();else{s=a.na;if(null===s[0]||s[0].pointerId!==e.pointerId&&s[0].pointerType===e.pointerType)return null!==s[1]&&s[1].pointerId===e.pointerId?void(s[1]=null):void 0;s[0]=null;s=a.kP(e,!1,!0,!1,!0,!1);let t=v.document.elementFromPoint(e.clientX,e.clientY)||null;null!==(t=null!==t&&void 0!==t.shadowRoot&&null!==t.shadowRoot?t.shadowRoot.elementFromPoint(e.clientX,e.clientY):t)&&t.b instanceof K&&t.b!==a&&t.b.u0(e,s),null===t&&(t=e.target),a.u0(e,s),s.clickCount=a.o0,s.targetDiagram=a.SP(e,t),s.targetObject=null,a.doMouseUp(),a.fa(s,e),i&&(a.r0=!1)}}},r.ha=t=>{var e;a.isEnabled&&(r.Gf=!1,(e=a.d1)[t.pointerId]&&delete e[t.pointerId],null!==(e=a.na)[0]&&e[0].pointerId===t.pointerId&&(e[0]=null),null!==e[1]&&e[1].pointerId===t.pointerId&&(e[1]=null),"touch"!==t.pointerType)&&"pen"!==t.pointerType&&((e=a.currentTool).cancelWaitAfter(),e.standardMouseOver())},r.aa=t=>{var e=a.na;null!==e[0]&&e[0].pointerId===t.pointerId?(e[0]=null,a.r0=!1):null!==e[1]&&e[1].pointerId===t.pointerId&&(e[1]=null)},e);r.p1=t.Y[Xt.Os("7eba17a4ca3b1a8346")][Xt.Os("78a118b7")](t.Y,K.Ju,4,4),e.clearContextCache(!0),r.tR(),"svg"===this.Yf&&(i=this.ih.get("svg"),this.Ot.appendChild(i.Bt),this.ai=i.gi)}}addEventListener(t,e,i,s){t.addEventListener(e,i,{capture:s,passive:!1})}Ht(t,e,i,s){t.addEventListener(e,i,{capture:s,passive:!1})}removeEventListener(t,e,i,s){t.removeEventListener(e,i,{capture:s})}Ti(t,e,i,s){t.removeEventListener(e,i,{capture:s})}tR(){var t=this;let e=this.xt.Bt;e instanceof HTMLCanvasElement||(e=t.div),this.Ht(e,"pointerdown",t.nh,!1),this.Ht(e,"pointermove",t.ra,!1),this.Ht(e,"pointerup",t.la,!1),this.Ht(e,"pointerout",t.ha,!1),this.Ht(e,"pointercancel",t.aa,!1),this.Ht(e,"pointerenter",t.iR,!1),this.Ht(e,"pointerleave",t.eR,!1),this.Ht(e,"wheel",t.oa,!1),this.Ht(e,"keydown",t.sR,!1),this.Ht(e,"keyup",t.nR,!1),this.Ht(e,"blur",t.oR,!1),this.Ht(e,"focus",t.rR,!1),this.Ht(e,"selectstart",t=>(t.preventDefault(),!1),!1),this.Ht(e,"contextmenu",t=>(t.preventDefault(),!1),!1),this.Ht(v,"resize",t.w1,!1)}vw(){30<this.l0&&(this.Tl=1)}NS(t){null!==this.Tl&&(this.Tl=null,t&&this.Pu(),Yt,Yt.drawFrames||(this.l0=0,this.yP=[0,0,0,0,0],this.h0=0))}computePixelRatio(){return null!==this.Tl?this.Tl:v.devicePixelRatio||1}get avgSpf(){return this.l0}doMouseDown(){this.currentTool.doMouseDown()}doMouseMove(){this.currentTool.doMouseMove()}doMouseUp(){this.currentTool.doMouseUp()}doMouseWheel(){this.currentTool.doMouseWheel()}doKeyDown(){this.currentTool.doKeyDown()}doKeyUp(){this.currentTool.doKeyUp()}doFocus(){this.focus()}focus(){var t,e;this.xt&&(this.scrollsPageOnFocus?this.xt.focus():(t=v.scrollX,e=v.scrollY,this.xt.focus(),v.scrollTo(t,e)))}rR(t){K.he.get(this).V("GainedFocus")}oR(t){K.he.get(this).V("LostFocus")}RM(){var t,e,i,s;null===this.xt||null===(t=this.Ot)||0===t.clientWidth||0===t.clientHeight||(this.WM||this.setScrollWidth(),e=this.io?this.wi:0,i=this.kn?this.wi:0,s=this.Gi,this.Gi=this.computePixelRatio(),this.Gi!==s&&(this.Xu=!0,this.requestUpdate()),t.clientWidth===this.Ct+e&&t.clientHeight===this.At+i)||(this.ca(),this.qe=!0,null!==(s=this.layout)&&s.isViewportSized&&1===this.autoScale&&(this.Xf=!0,s.invalidateLayout()),this.Ps)||this.requestUpdate()}gA(){let t=0,e=new Lt;e.name="Grid",e.allowSelect=!1,e.pickable=!1,e.isTemporary=!0,e.isInDocumentBounds=!1,this.Qr(e,t++),(e=new Lt).name="ViewportBackground",e.isViewportAligned=!0,e.isTemporary=!0,e.isInDocumentBounds=!1,this.Qr(e,t++),(e=new Lt).name="Background",this.Qr(e,t++),(e=new Lt).name="",this.Qr(e,t++),(e=new Lt).name="Foreground",this.Qr(e,t++),(e=new Lt).name="ViewportForeground",e.isViewportAligned=!0,e.isTemporary=!0,e.isInDocumentBounds=!1,this.Qr(e,t++),(e=new Lt).name="Adornment",e.isTemporary=!0,e.isInDocumentBounds=!1,this.Qr(e,+t),(e=new Lt).name="Tool",e.isTemporary=!0,e.isInDocumentBounds=!0,this.Qr(e,7)}bA(){var t=new jt(jt.Grid,{name:"GRID"}).add(new V("LineH",{stroke:"lightgray",strokeWidth:.5,interval:1}).theme("stroke","gridMinor"),new V("LineV",{stroke:"lightgray",strokeWidth:.5,interval:1}).theme("stroke","gridMinor"),new V("LineH",{stroke:"gray",strokeWidth:.5,interval:5}).theme("stroke","gridMajor"),new V("LineV",{stroke:"gray",strokeWidth:.5,interval:5}).theme("stroke","gridMajor"),new V("LineH",{stroke:"gray",strokeWidth:1,interval:10}).theme("stroke","gridMajor"),new V("LineV",{stroke:"gray",strokeWidth:1,interval:10}).theme("stroke","gridMajor")),e=new Y({layerName:"Grid",zOrder:0,isInDocumentBounds:!1,isAnimated:!1,pickable:!1,locationObjectName:"GRID"}).add(t);return this.add(e),this.partManager.parts.remove(e),t.visible=!1,t}static jF(){var t=K.he.get(this.parentElement||this);t&&(t.s1?t.s1=!1:t.isEnabled?t.diagramScroll(this):t.kA())}static JF(t){this.b.isEnabled?(this.b.o1=t.target.scrollTop,this.b.l1=t.target.scrollLeft):this.b.updateScroll()}diagramScroll(i){if(null!==this.xt){var s=this.g1,n=this.m1,r=(this.$m=!0,this.documentBounds),a=this.viewportBounds,o=this.Vf,h=r.x-o.left,l=r.y-o.top,u=r.width+o.left+o.right,d=r.height+o.top+o.bottom,c=r.right+o.right,o=r.bottom+o.bottom,g=a.x,m=a.y,f=a.width,p=a.height,v=a.right,y=a.bottom,x=this.scale;let t,e=i.scrollLeft;if(this.ju)switch(this.Cx){case"negative":e=e+i.scrollWidth-i.clientWidth;break;case"reverse":e=i.scrollWidth-e-i.clientWidth}var A,w=e;f<u||p<d?(t=U.H(this.position.x,this.position.y),this.allowHorizontalScroll&&this.l1!==w&&(t.x=w/x+h,this.l1=w),this.allowVerticalScroll&&this.o1!==i.scrollTop&&(t.y=i.scrollTop/x+l,this.o1=i.scrollTop),this.position=t,U.o(t),this.$m=!1,this.Gu=!1):(t=U.a(),i.ZF&&this.allowHorizontalScroll&&(h<g&&(this.position=t.e(w+h,this.position.y)),v<c)&&(A=s.scrollWidth-this.Ct,this.position=t.e(-A+w-this.Ct/x+c,this.position.y)),i.$F&&this.allowVerticalScroll&&(l<m&&(this.position=t.e(this.position.x,i.scrollTop+l)),y<o)&&(A=s.scrollHeight-this.At,this.position=t.e(this.position.x,-A+i.scrollTop-this.At/x+o)),U.o(t),this.oh(),this.$m=!1,this.Gu=!1,r=this.documentBounds,a=this.viewportBounds,c=r.right,v=a.right,o=r.bottom,y=a.bottom,h=r.x,g=a.x,l=r.y,m=a.y,u<=f&&g<=h&&c<=v&&(n.style.width="1px"),d<=p&&m<=l&&o<=y&&(n.style.height="1px"))}}computeBounds(t){return void 0===t&&(t=new Z),this.Fi(),this.SA(t)}SA(i){if(this.fixedBounds.isReal())i.c(this.fixedBounds);else{let e=!0;var s=this.Jt.h,n=s.length;for(let t=0;t<n;t++){var r=s[t];if(r.visible&&r.isInDocumentBounds){var a=r.It.h,o=a.length;for(let t=0;t<o;t++){var h=a[t];h.isInDocumentBounds&&h.isVisible()&&(h=h.actualBounds).isReal()&&(e?(e=!1,i.c(h)):i.unionRect(h))}}}e&&i.e(0,0,0,0)}return i.addMargin(this.ei),i}computePartsBounds(e,i){void 0===i&&(i=!1);let s=null;if(Array.isArray(e))for(let t=0;t<e.length;t++){var n=e[t];!i&&n instanceof q||(n.ensureBounds(),null===s?s=n.actualBounds.copy():s.unionRect(n.actualBounds))}else for(var t=e.iterator;t.next();){var r=t.value;!i&&r instanceof q||(r.ensureBounds(),null===s?s=r.actualBounds.copy():s.unionRect(r.actualBounds))}return null===s?new Z(NaN,NaN,0,0):s}Hs(i){if((i||this.eo)&&!this.$t&&null!==this.xt&&this.documentBounds.isReal()){if(this.$t=!0,i){var s=this.initialPosition;if(s.isReal())return this.$t=!1,void(this.position=s);let t=this.initialDocumentSpot,e=this.initialViewportSpot;t.isNoSpot()&&(t=J.TopLeft),e.isNoSpot()&&(e=J.TopLeft);var s=U.a(),n=(s.setRectSpot(this.documentBounds,t),this.viewportBounds),n=Z.H(0,0,n.width,n.height),r=U.a();r.setRectSpot(n,e),r.e(s.x-r.x,s.y-r.y),this.$t=!1,this.position=r,Z.o(n),U.o(r)}let t=this.Ql;var s=1!==(t=i&&1!==this.Ir?this.Ir:t)?this.Zu(t):this.scale,n=this.lt.x,r=this.lt.y,a=this.Ct/s,o=this.At/s;let e=this.Bf;var h=this.Wm,l=(i&&!e.isSpot()&&(h.isSpot()||h.isDefault())&&(l=this.initialDocumentSpot.isSpot()&&this.initialViewportSpot.isSpot(),e=h.isDefault()&&!l?J.Center:h),this.MP(this.documentBounds,a,o,e,i),this.scale),h=(this.scale=s,this.$t=!1,this.viewportBounds);h.equalsApproxTo(n,r,a,o)||this.onViewportBoundsChanged(new Z(n,r,a,o),h,l,!1)}}Zu(t){var e=this.s0;if(null===this.xt)return e;this.ensureBounds();var i=this.documentBounds;if(!i.isReal())return e;var s=i.width,i=i.height,n=this.Ct+(this.io?this.wi:0),r=this.At+(this.kn?this.wi:0),a=n/s,o=r/i;let h;return 2===t?h=(h=(h=(h=Math.min(o,a))>e?e:h)<this.minScale?this.minScale:h)>this.maxScale?this.maxScale:h:3===t?(h=0,h=(h=(h=(h=a<o?(r-this.wi)/i:(n-this.wi)/s)>e?e:h)<this.minScale?this.minScale:h)>this.maxScale?this.maxScale:h):this.scale}zoomToFit(){var t=this.Zh;this.Zh=1,this.scale=this.Zu(2),1!==t&&(this.Hs(!1),this.MP(this.documentBounds,this.Ct/this.v,this.At/this.v,this.Bf,!1)),this.Zh=t}zoomToRect(e,i){void 0===i&&(i=2);var s,n,r=e.width,a=e.height;if(!(0===r||0===a||isNaN(r)&&isNaN(a))){let t=1;2!==i&&3!==i||(t=isNaN(r)?this.viewportBounds.height*this.scale/a:isNaN(a)?this.viewportBounds.width*this.scale/r:(s=this.Ct,n=this.At,3===i?s/r<n/a?(n-(this.kn?this.wi:0))/a:(s-(this.io?this.wi:0))/r:Math.min(n/a,s/r))),this.scale=t,this.position=new U(e.x,e.y)}}get lR(){return this.$t}set lR(t){this.$t=t}alignDocument(t,e){this.ensureBounds();var i=this.documentBounds,s=this.viewportBounds;this.position=new U(i.x+(t.x*i.width+t.offsetX)-(e.x*s.width-e.offsetX),i.y+(t.y*i.height+t.offsetY)-(e.y*s.height-e.offsetY))}focusObject(t){var e;t instanceof y?(this.a0=t,e=U.a(),this.f0=this.transformDocToView(t.getDocumentPoint(J.TopLeft,e)),U.o(e)):(this.a0=null,this.f0=U.Ek)}MP(t,e,i,s,n){var r,a=U.H(this.lt.x,this.lt.y);let o=a.x,h=a.y;null!==this.a0&&(r=U.a(),r=this.a0.getDocumentPoint(J.TopLeft,r),o=r.x-this.f0.x/this.scale,h=r.y-this.f0.y/this.scale,s=J.None,U.o(r)),!n&&1!==this.scrollMode||(s.isSpot()&&(e>t.width&&(o=t.x+(s.x*t.width+s.offsetX)-(s.x*e-s.offsetX)),i>t.height)&&(h=t.y+(s.y*t.height+s.offsetY)-(s.y*i-s.offsetY)),r=this.Vf,n=e-t.width,e<t.width+r.left+r.right?(s=o+e/2,s=Math.min(s,t.right+Math.max(n,r.right)-e/2),s=Math.max(s,t.left-Math.max(n,r.left)+e/2),o=s-e/2):o>t.left?o=t.left:o<t.right-e&&(o=t.right-e),n=i-t.height,i<t.height+r.top+r.bottom?(s=h+i/2,s=Math.min(s,t.bottom+Math.max(n,r.bottom)-i/2),s=Math.max(s,t.top-Math.max(n,r.top)+i/2),h=s-i/2):h>t.top?h=t.top:h<t.bottom-i&&(h=t.bottom-i)),a.x=isFinite(o)?o:-this.ei.left,a.y=isFinite(h)?h:-this.ei.top,null!==this.positionComputation&&(e=this.positionComputation(this,a),a.x=e.x,a.y=e.y),this.bs.tA(this.lt,a),a.x=Math.round(a.x),a.y=Math.round(a.y),this.lt.e(a.x,a.y),this.$r(),this.hR(),U.o(a)}findPartAt(t,e){if(e=void 0===e?!0:e){e=this.DS(t,t=>t.part,t=>t.canSelect());if(e instanceof Y)return e}else{e=this.DS(t,t=>t.part);if(e instanceof Y)return e}return null}findObjectAt(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null),this.Fi();for(var s=this.Jt.iteratorBackwards;s.next();){var n=s.value;if(n.visible){n=n.findObjectAt(t,e,i);if(null!==n)return n}}return null}DS(t,e,i){void 0===e&&(e=null),void 0===i&&(i=null),this.Fi();for(var s=this.Jt.iteratorBackwards;s.next();){var n=s.value;if(n.visible&&!n.isTemporary){n=n.findObjectAt(t,e,i);if(null!==n)return n}}return null}findPartsAt(t,e,i){return this.aR(t,t=>t.part,(e=void 0===e?!0:e)?t=>t instanceof Y&&t.canSelect():null,i)}aR(t,e,i,s){void 0===e&&(e=null),void 0===i&&(i=null),s instanceof O||s instanceof C||(s=new C),this.Fi();for(var n=this.Jt.iteratorBackwards;n.next();){var r=n.value;r.visible&&!r.isTemporary&&r.findObjectsAt(t,e,i,s)}return s}findObjectsAt(t,e,i,s){void 0===e&&(e=null),void 0===i&&(i=null),s instanceof O||s instanceof C||(s=new C),this.Fi();for(var n=this.Jt.iteratorBackwards;n.next();){var r=n.value;r.visible&&r.findObjectsAt(t,e,i,s)}return s}findPartsIn(t,e,i,s){return void 0===i&&(i=!0),this.fR(t,null,t=>t instanceof Y&&(!i||t.canSelect()),e=void 0===e?!1:e,s)}findObjectsIn(t,e,i,s,n){void 0===e&&(e=null),void 0===i&&(i=null),void 0===s&&(s=!1),n instanceof O||n instanceof C||(n=new C),this.Fi();for(var r=this.Jt.iteratorBackwards;r.next();){var a=r.value;a.visible&&a.findObjectsIn(t,e,i,s,n)}return n}IS(t,e,i,s,n,r){for(var a=new C,o=(this.Fi(),this.Jt.iteratorBackwards);o.next();){var h=o.value;h.visible&&h.IS(t,e,i,s,a,n,r)}return a}fR(t,e,i,s,n){void 0===e&&(e=null),void 0===i&&(i=null),void 0===s&&(s=!1),n instanceof O||n instanceof C||(n=new C),this.Fi();for(var r=this.Jt.iteratorBackwards;r.next();){var a=r.value;a.visible&&!a.isTemporary&&a.findObjectsIn(t,e,i,s,n)}return n}findPartsNear(t,e,i,s,n){return void 0===s&&(s=!0),this.cR(t,e,null,t=>t instanceof Y&&(!s||t.canSelect()),i=void 0===i?!0:i,n)}findObjectsNear(t,e,i,s,n,r){void 0===i&&(i=null),void 0===s&&(s=null),!1!==(n=void 0===n?!0:n)&&!0!==n&&((n instanceof O||n instanceof C)&&(r=n),n=!0),r instanceof O||r instanceof C||(r=new C),this.Fi();for(var a=this.Jt.iteratorBackwards;a.next();){var o=a.value;o.visible&&o.findObjectsNear(t,e,i,s,n,r)}return r}cR(t,e,i,s,n,r){void 0===i&&(i=null),void 0===s&&(s=null),!1!==(n=void 0===n?!0:n)&&!0!==n&&((n instanceof O||n instanceof C)&&(r=n),n=!0),r instanceof O||r instanceof C||(r=new C),this.Fi();for(var a=this.Jt.iteratorBackwards;a.next();){var o=a.value;o.visible&&!o.isTemporary&&o.findObjectsNear(t,e,i,s,n,r)}return r}acceptEvent(t){return this.qf(t,t instanceof MouseEvent)}qf(t,e){var i=this.jr;this.jr=this.ia,(this.ia=i).diagram=this,i.event=t,e?this.u0(t,i):(i.viewPoint=this.jr.viewPoint,i.documentPoint=this.jr.documentPoint);let s=0;e=t;return e.ctrlKey&&(s+=1),e.altKey&&(s+=2),e.shiftKey&&(s+=4),e.metaKey&&(s+=8),i.modifiers=s,i.button=e.button,void 0!==e.buttons&&(i.buttons=e.buttons),Xt.dr&&0===e.button&&e.ctrlKey&&(i.button=2),i.down=!1,i.up=!1,i.clickCount=1,i.delta=0,i.handled=!1,i.bubbles=!1,i.timestamp=t.timeStamp,i.isMultiTouch=!1,i.targetDiagram=this.SP(t,t.target),i.targetObject=null,i}SP(t,e){if(null===e)return null;e=K.he.get(e);if(e)return e;let i=t.path;return(i=i||"function"!=typeof t.composedPath?i:t.composedPath())&&i[0]&&K.he.has(i[0])?K.he.get(i[0]):null}QF(t,e,i){var s=this.kP(t,!0,!1,!1,!0,i);return this.u0(e,s),s.targetDiagram=this.SP(t,t.target),s.targetObject=null,i||s.clone(this.e0),s}_F(t,e,i){i=this.kP(t,!1,!1,!1,!1,i);let s=v.document.elementFromPoint(e.clientX,e.clientY)||null,n=this,r=t;return(s=null!==s&&void 0!==s.shadowRoot&&null!==s.shadowRoot?s.shadowRoot.elementFromPoint(e.clientX,e.clientY):s)&&K.he.get(s)&&(r=e,n=K.he.get(s)),i.targetDiagram=n,this.u0(r,i),i.targetObject=null,i}kP(t,e,i,s,n,r){var a=this.jr;this.jr=this.ia,(this.ia=a).diagram=this,a.clickCount=1;let o=a.delta=0;return t.ctrlKey&&(o+=1),t.altKey&&(o+=2),t.shiftKey&&(o+=4),t.metaKey&&(o+=8),a.modifiers=o,a.event=t,a.timestamp=t.timeStamp,a.button=(i?this.firstInput:t).button,a.buttons=t.buttons,Xt.dr&&0===t.button&&t.ctrlKey&&(a.button=2),a.down=e,a.up=i,a.handled=s,a.bubbles=n,a.isMultiTouch=r,a}fa(t,e){return t.bubbles?(Yt,Yt.handleMessages&&Xt.ft("NOT handled "+e.type+" "+t.toString()),!0):(Yt,Yt.handleMessages&&Xt.ft("handled "+e.type+" "+this.currentTool.name+" "+t.toString()),void 0!==e.stopPropagation&&e.stopPropagation(),!1!==e.cancelable&&e.preventDefault(),!(e.cancelBubble=!0))}sR(t){var e,i=K.he.get(this);return!!i.isEnabled&&((e=i.qf(t,!1)).key=t.key,e.code=t.code,e.down=!0,i.doKeyDown(),i.fa(e,t))}nR(t){var e,i=K.he.get(this);return!!i.isEnabled&&((e=i.qf(t,!1)).key=t.key,e.code=t.code,e.up=!0,i.doKeyUp(),i.fa(e,t))}iR(t){var e,i=K.he.get(this);return!!i.isEnabled&&(e=i.qf(t,!0),null!==i.mouseEnter&&i.mouseEnter(e),i.currentTool.standardMouseOver(),i.fa(e,t))}eR(t){var e,i=K.he.get(this);return!!i.isEnabled&&(e=i.qf(t,!0),null!==i.mouseLeave&&i.mouseLeave(e),i.fa(e,t))}getMouse(t){var e,i=this.xt;return null===i?new U(0,0):(i=i.getBoundingClientRect(),e=(t.clientX-i.left)*(this.Ct/i.width),t=(t.clientY-i.top)*(this.At/i.height),null!==this.D?new U(e,t).Ge(this.D):new U(e,t))}u0(t,e){var i=this.xt;let s=0,n=0;null!==i&&(i=i.getBoundingClientRect(),s=(t.clientX-i.left)*(this.Ct/i.width),n=(t.clientY-i.top)*(this.At/i.height)),e.viewPoint.e(s,n),null!==this.D?(t=U.H(s,n),this.D.rs(t),e.documentPoint.c(t),U.o(t)):e.documentPoint.e(s,n)}NC(t,e,i){let s;null!==this.na[0]&&(s=this.na[e],null!==(e=this.xt))&&(e=e.getBoundingClientRect(),i.e((s.clientX-e.left)*(this.Ct/e.width),(s.clientY-e.top)*(this.At/e.height)))}invalidateDocumentBounds(){this.ea||(this.ea=!0,this.requestUpdate(!1))}uR(){this.Ps||this.Fi(),this.ensureBounds()}redraw(){this.$t||this.Ps||(this.T(),this.maybeUpdate())}isUpdateRequested(){return this.Tr}delayInitialization(t){void 0===t&&(t=null);const e=this.animationManager,i=e.isEnabled,s=(e.stopAnimation(),e.isEnabled=!1,this.Pr(),this.eo=!1,this.fx=new U(NaN,NaN),e.isEnabled=i,this.Ps=!0,this);null!==t&&Xt.Xh(()=>{s.Ps=!1,e.zl("Model"),t(s)},1)}requestUpdate(t){if(void 0===t&&(t=!1),!(!0===this.Tr||this.$t||!1===t&&this.Ps)){this.Tr=!0;const e=this;v.requestAnimationFrame(()=>{e.Tr&&e.maybeUpdate()})}}maybeUpdate(){this.Yu&&!this.Tr||(this.Yu&&(this.Yu=!1),this.Pr())}PP(t,e){!this.Gu||this.$t||this.animationManager.defaultAnimation.isAnimating||this.kA()||(t&&this.Fi(),e&&this.Hs(!1))}Pr(n){if(!this.Ps&&(this.Tr=!1,null!==this.Ot||this.Hu.isReal())){this.Ps=!0;var r=this.animationManager,a=this.Wu;if(!r.isAnimating&&0!==a.length){var o=a.h,h=o.length;for(let t=0;t<h;t++){var l=o[t];l.ae(!1),l.u()}a.clear()}a=this.uP;0<a.count&&(a.each(t=>t.NP()),a.clear());let t=!1,e=!1;r.defaultAnimation.isAnimating&&(e=!0,t=this.skipsUndoManager,this.skipsUndoManager=!0),r.Mi||this.RM(),n||this.PP(!1,!0),null!==this.ls&&(this.ls.visible&&!this.t0&&(this._r(),this.t0=!0),!this.ls.visible)&&this.t0&&(this.t0=!1);var a=!this.undoManager.isUndoingRedoing&&(this.Al||0!==this.vf.count&&0!==this.Or.size),u=!this.eo||this.Jr;this.Fi(!0);let i=!1,s=((u||a)&&(this.eo?this.CP(!this.Xf,a):(this.startTransaction("Initial Layout"),!1===r.isEnabled&&r.stopAnimation(),this.CP(!1,a)),i=u),this.Xf=!1,this.Al=!1,this.Fi(),this.vx||this.uR(),n||this.PP(!0,!1),!1);i?((a=Z.a()).c(this.viewportBounds),this.eo||(this.eo=!0,s=!0,this.skipsUndoManager||(this.undoManager.Kw=!0),this.undoManager.Uw=!0,this.dR()),this.gR(),this.Fi(!1),n||this.PP(!0,!0),Z.o(a)):r.Lf&&r.ax&&(1!==this.Ir?this.scale=this.Zu(this.Ir):1!==this.Ql?this.scale=this.Zu(this.Ql):(u=this.initialScale,isFinite(u)&&0<u&&(this.scale=u)),this.Hs(!0)),i&&s&&this.commitTransaction("Initial Layout"),n||this.Ji(this.ai),e&&(this.skipsUndoManager=t),this.Ps=!1}}get Uh(){return this.eo}dR(){1!==this.Ir?this.scale=this.Zu(this.Ir):1!==this.Ql?this.scale=this.Zu(this.Ql):(t=this.initialScale,isFinite(t)&&0<t&&(this.scale=t)),this.Hs(!0);var t=this.Jt.h;this.Gs(t,t.length,this,this.viewportBounds),this.V("InitialLayoutCompleted"),this.fx.c(this.lt),this._r()}gR(){this.V("LayoutCompleted")}d0(t){this._n.add(t)}addInvalidRoute(t){(this.zo?this._h:this.Or).add(t)}Fi(t){if(0!==this._n.size&&(this.Ps||!this.animationManager.isTicking))if(this.Ps||(this.Al=!0),t)this.MA(this._n);else{for(let t=0;t<23&&0!==this._n.size;t++){var e=new Set(this._n);this._n.clear(),this.NP(e,this._n),Yt,22===t&&Xt.ft("failure to validate parts")}this.nodes.each(t=>{t instanceof j&&t.PA(!1)})}}MA(t,e){for(const i of t)!i.De()||i instanceof j||(i.tl()?(i.wt(1/0,1/0),i.vt()):e&&e.add(i));for(const s of t)if(s instanceof j){if(!s.isVisible())continue;this.L1(s)}}NP(t,e){this.MA(t,e);for(const s of t){var i;s instanceof q&&(i=s).isVisible()&&(i.tl()?(i.wt(1/0,1/0),i.vt()):e.add(i))}for(const n of t)n instanceof X&&n.isVisible()&&(n.tl()?(n.wt(1/0,1/0),n.vt()):e.add(n))}g0(t){var e=t instanceof K,i=e?t.links:t.memberParts,s=this._n;if(e)this.Fi(!0);else{for(;i.next();){var n=i.value;!s.has(n)||!n.De()||n instanceof j||n.tl()&&(n.wt(1/0,1/0),n.vt())}for(i.reset();i.next();){var r=i.value;s.has(r)&&r instanceof j&&r.isVisible()&&this.L1(r)}i.reset()}for(;i.next();){var a=i.value;a instanceof q&&s.has(a)&&a.isVisible()&&a.tl()&&(a.wt(1/0,1/0),a.vt())}}L1(t){for(var e=Xt.ct(),i=Xt.ct(),s=t.memberParts;s.next();){var n=s.value;n.isVisible()&&(n instanceof j?(n.Ko()||n.hs()||n.rh())&&this.L1(n):n instanceof q?(n.fromNode===t||n.toNode===t?i:e).push(n):(n.wt(1/0,1/0),n.vt()))}let r=e.length;for(let t=0;t<r;t++){var a=e[t];a.wt(1/0,1/0),a.vt()}Xt.ot(e),t.wt(1/0,1/0),t.vt(),r=i.length;for(let t=0;t<r;t++){var o=i[t];o.wt(1/0,1/0),o.vt()}Xt.ot(i)}Gs(e,i,s,n){if(this.Kf||this.animationManager.isAnimating){for(let t=0;t<i;t++)e[t].Gs(s,n);this.Fi()}}Ji(t){null!==this.Ot&&(null===this.xt&&Xt.n("No canvas specified"),"svg"===this.Yf?this.mR(t):this.pR(t))}pR(e){var i=this.animationManager;if(!(i.Mi||i.isAnimating&&!i.isTicking)){var s=new Date;if(this.m0(),"0"!==this.Ot.style.opacity){var n=e!==this.ai,r=this.Jt.h,a=r.length;if(this.Gs(r,a,this,this.viewportBounds),n)e.clearContextCache(!0),this.oh();else if(!this.qe&&!i.isAnimating)return;var o=this.D,h=(o.ti(),this.Gi),i=this.lt,l=this.v;1!==l&&o.v(l),0===i.x&&0===i.y||o.se(-i.x,-i.y),e.setTransform(h,0,0,h,0,0),e.clearRect(0,0,this.Ct,this.At),1!==this._t&&(e.globalAlpha=this._t),this.AP(e);for(let t=0;t<a;t++)e.setTransform(h,0,0,h,0,0),e.transform(o.m11,o.m12,o.m21,o.m22,o.dx,o.dy),e.commitTransform(),r[t].Ji(e,this);let t=!1;this.Hf?this.Hf.Ju(this)&&(t=this.p1()):t=!0,t&&(H.prototype.rs=H.prototype.Pw),n?(this.ai.clearContextCache(!0),this.oh()):(this.Kf=!1,this.qe=!1);var l=+new Date-+s,i=(Yt,Yt.drawFrames),u=this.yP;if(i||null===this.Tl){u[this.h0]=l,this.h0=(this.h0+1)%u.length;let e=0;for(let t=0;t<u.length;t++)e+=u[t];this.l0=e/u.length}if(1!==this._t&&(e.globalAlpha=1),i){e.setTransform(1,0,0,1,0,0);for(let t=0;t<u.length;t++)e.fillText(u[t].toString(),20,150+20*t)}}}}mR(e){if(null!==this.Ot){var i=this.animationManager;if(!(i.Mi||i.isAnimating&&!i.isTicking)){this.m0();var s=this.Ct,n=this.At,r=(e.surface.resize(s,n,s,n),this.Jt.h),a=r.length;if(this.Gs(r,a,this,this.viewportBounds),this.qe||i.isAnimating){s=this.lt,n=this.v,i=this.D,n=(i.ti(),1!==n&&i.v(n),0===s.x&&0===s.y||i.se(-s.x,-s.y),e.lastDrawnPart=null,e.setDiagramPosScale(i.m11,i.m12,i.m21,i.m22,i.dx,i.dy),1!==this._t&&(e.globalAlpha=this._t),this.AP(e),this.Gi);this.xt.gi.setTransform(n,0,0,n,0,0),this.xt.gi.clearRect(0,0,this.Ct,this.At);for(let t=0;t<a;t++)r[t].Ji(e,this);let t=!1;this.Hf?this.Hf.Ju(this)&&(t=this.p1()):t=!0,t&&(H.prototype.rs=H.prototype.Pw),this.Kf=!1,this.qe=!1}}}}T1(e,t,i,s,n,r,a,o,h){if(null!==this.Ot){null===this.xt&&Xt.n("No canvas specified"),void 0===r&&(r=null),void 0===a&&(a=null),void 0===o&&(o=!1),void 0===h&&(h=!1),this.m0(),this.ai.clearContextCache(!0),this.oh(),this.sa=!0;var l=this.v,u=(this.v=s,this.Jt.h),d=u.length;try{var c=new Z(n.x,n.y,i.width/s,i.height/s),g=c.copy(),m=(g.addMargin(t),this._r(g),this.Fi(),this.Gs(u,d,this,c),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,i.width,i.height),null!==a&&""!==a&&(e.fillStyle=a,e.fillBackground(0,0,i.width,i.height)),this.Gi),f=(e.scale(m,m),H.a()),p=(f.ti(),f.se(t.left,t.top),f.v(s),0===n.x&&0===n.y||f.se(-n.x,-n.y),e.setTransform(f.m11,f.m12,f.m21,f.m22,f.dx,f.dy),e.commitTransform(),e instanceof _t&&e.setDiagramPosScale(f.m11,f.m12,f.m21,f.m22,f.dx,f.dy),H.o(f),this.AP(e),e.globalAlpha=this._t,this.findLayer("Grid"));if(r){var v=new C,y=r.iterator;for(y.reset();y.next();){var x=y.value;x instanceof Y&&(!h&&x.layer===p||(x.Bu(),v.add(x)))}for(let t=0;t<d;t++)u[t].PF(e,this,v,o);v.each(t=>t.Bu())}else for(let t=0;t<d;t++){var A=u[t];A===p?h&&A.Ji(e,this,!0):A.Ji(e,this,o)}this.sa=!1,this.Hf&&this.Hf.Ju(this)&&this.p1()}finally{this.v=l,this.ai.clearContextCache(!0),this.oh(),this.Gs(u,d,this,this.viewportBounds),this._r(),this.ai instanceof _t&&(this.ai.diagramGroup.replaceChildren(),this.redraw())}}}getRenderingHint(t){return this.Rr[t]}setRenderingHint(t,e){"minDrawingLength"===t&&(this.Hm=e),this.Rr[t]=e,this.redraw()}resetRenderingHints(){this.Rr=new h,this.Rr.drawShadows=!0,this.Rr.textGreeking=!0,this.Rr.viewportOptimizations=!Xt.dr,this.Rr.temporaryPixelRatio=!0,this.Rr.pictureRatioOptimization=!0,this.Rr.minDrawingLength=1,this.Hm=1}AP(t){var e,i=this.Rr;null!==i&&(void 0!==i.imageSmoothingEnabled&&(e=!!i.imageSmoothingEnabled,t.setImageSmoothingEnabled(e)),null!=(e=i.defaultFont))&&(t.font=e)}getInputOption(t){return this.zu[t]}setInputOption(t,e){this.zu[t]=e}GF(){this.zu=new h,this.zu.extraTouchArea=10,this.zu.extraTouchThreshold=10,this.zu.hasGestureZoom=!0}set(t){Yt;for(const e in t)!e.startsWith("_")&&-1===e.indexOf(".")||Xt.n("Property with underscore or period passed to Diagram.set. Did you mean to use Diagram.assign?");return Object.assign(this,t),this}attach(t){return this.setProperties(t)}setProperties(t){return K.p0(this,t),this}static p0(i,s){var n,r=i instanceof jt,a=i instanceof K;for(const h in s){""===h&&Xt.n("Setting properties requires non-empty property names");let t=i,e=h;if((r||a)&&0<(o=h.indexOf("."))&&(n=h.substring(0,o),r?t=i.findObject(n):null==(t=i[n])&&(t=i.toolManager[n]),Xt.Mt(t)?e=h.substring(o+1):Xt.n("Unable to find object named: "+n+" in "+i.toString()+" when trying to set property: "+h)),"_"!==e[0]&&!Xt.yw(t,e)){if(a&&"ModelChanged"===e){i.addModelChangedListener(s[e]);continue}if(a&&"Changed"===e){i.addChangedListener(s[e]);continue}if(a&&Xt.yw(i.toolManager,e))t=i.toolManager;else{if(a&&i.NA(e)){i.addDiagramListener(e,s[e]);continue}if(i instanceof x&&"Changed"===e){i.addChangedListener(s[e]);continue}Xt.n('Trying to set undefined property "'+e+'" on object: '+t.toString())}}var o=s[h];t[e]=o,"_"===e[0]&&t instanceof y&&t.addCopyProperty(e)}}yR(){if(0!==this.sh.count&&!(1<this.undoManager.transactionLevel)){for(;0<this.sh.count;)for(var t=this.sh,e=(this.sh=new L,t.iterator);e.next();){var i=e.key;i.invalidateOtherJumpOvers(e.value),i.fe()}this.T()}}T(t){var e;(void 0===t||(e=this.viewportBounds,t.isReal()&&e.intersectsRect(t)))&&(this.qe=!0,this.requestUpdate()),this.V("InvalidateDraw")}invalidateViewport(t,e){!0!==this.qe&&(this.qe=!0,"svg"!==this.Yf&&!0===this.getRenderingHint("temporaryPixelRatio")?(this.vw(),this.maybeUpdate(),this.NS(!0)):this.maybeUpdate())}ca(){this.Gu=!0}oh(){this.Kf=!0}m0(){!1!==this.Xu&&(this.Xu=!1,this.xA(this.Ct,this.At))}xA(t,e){this.$r();var i=this.Gi;this.xt.resize(t*i,e*i,t,e)&&(this.qe=!0,this.ai.clearContextCache(!0))}kA(){var t=this.xt;if(null===t||this.Hu.isReal())return!0;var e=this.Ct,i=this.At,s=this.Ot;let n=!1,r=this.io?this.wi:0,a=this.kn?this.wi:0,o=s.clientWidth||e+r,h=s.clientHeight||i+a;var s=this.viewportBounds,l=s.x,O=s.y,E=s.width,H=s.height;if(o===e+r&&h===i+a||(this.io=!1,this.kn=!1,r=0,a=0,this.Ct=o,this.At=h,this.Xu=!0,n=!0,this.$r()),!this.eo||!this.viewportBounds.isReal())return!0;var u=this.g1,d=this.m1;if(this.Gu=!1,!(n||this.io||this.kn||this.Ku||this.Uu))return!0;var c=this.documentBounds;let g=0,m=0,f=0,p=0;var v=s.width,y=s.height,x=this.Vf,x=(this.contentAlignment.isSpot()?(c.width>v&&(g=x.left,m=x.right),c.height>y&&(f=x.top,p=x.bottom)):(g=x.left,m=x.right,f=x.top,p=x.bottom),c.width+g+m),A=c.height+f+p,w=this.scale,I=w,b=o/w<x,P=h/w<A;if(!(n||this.io||this.kn||b||P))return!0;var S=c.x-g,k=s.x,M=c.right+m;let N=s.right+r;var C=c.y-f,L=s.y,c=c.bottom+p;let D=s.bottom+a,T="1px",B="1px";if(1===this.scrollMode&&(b||P)){if(b&&this.hasHorizontalScrollbar&&this.allowHorizontalScroll){let t=1;1+S<k&&(t=Math.max((k-S)*w+this.Ct,t)),M>N+1&&(t=Math.max((M-N)*w+this.Ct,t)),v+r+1<x&&(t=Math.max((x-v)*w+this.Ct,t)),T=t.toString()+"px"}if(P&&this.hasVerticalScrollbar&&this.allowVerticalScroll){let t=1;1+C<L&&(t=Math.max((L-C)*w+this.At,t)),c>D+1&&(t=Math.max((c-D)*w+this.At,t)),y+a+1<A&&(t=Math.max((A-y)*w+this.At,t)),B=t.toString()+"px"}}let G="1px"!==T,F="1px"!==B;if((!G||!F)&&(G||F)){if(b=!(x<v+r),P=!(A<y+a),F&&(N-=this.wi),G&&(D-=this.wi),b&&this.hasHorizontalScrollbar&&this.allowHorizontalScroll){let t=1;1+S<k&&(t=Math.max((k-S)*w+this.Ct,t)),M>N+1&&(t=Math.max((M-N)*w+this.Ct,t)),v+1<x&&(t=Math.max((x-v)*w+this.Ct,t)),T=t.toString()+"px"}G="1px"!==T;let e=this.At;if(G!==this.kn&&(e=G?this.At-this.wi:this.At+this.wi),P&&this.hasVerticalScrollbar&&this.allowVerticalScroll){let t=1;1+C<L&&(t=Math.max((L-C)*w+e,t)),c>D+1&&(t=Math.max((c-D)*w+e,t)),y+1<A&&(t=Math.max((A-y)*w+e,t)),B=t.toString()+"px"}F="1px"!==B}if(this.$m&&G===this.kn&&F===this.io)return e===this.Ct&&i===this.At||this.maybeUpdate(),!1;G!==this.kn&&("1px"===T?this.At=this.At+this.wi:this.At=Math.max(this.At-this.wi,1),n=!0),this.kn=G,d.style.width=T,F!==this.io&&("1px"===B?this.Ct=this.Ct+this.wi:this.Ct=Math.max(this.Ct-this.wi,1),n=!0,this.ju)&&(s=U.a(),F?(t.style.left=this.wi+"px",this.position=s.e(this.lt.x+this.wi/this.scale,this.lt.y)):(t.style.left="0px",this.position=s.e(this.lt.x-this.wi/this.scale,this.lt.y)),U.o(s)),n&&this.$r(),this.io=F,d.style.height=B,this.s1=!0,n&&(this.Xu=!0);let R=u.scrollLeft;if(this.hasHorizontalScrollbar&&this.allowHorizontalScroll&&(v+1<x?R=(this.position.x-S)*w:1+S<k?R=u.scrollWidth-u.clientWidth:M>N+1&&(R=this.position.x*w)),this.ju)switch(this.Cx){case"negative":R=-(u.scrollWidth-R-u.clientWidth);break;case"reverse":R=u.scrollWidth-R-u.clientWidth}return u.scrollLeft=R,this.hasVerticalScrollbar&&this.allowVerticalScroll&&(y+1<A?u.scrollTop=(this.position.y-C)*w:1+C<L?u.scrollTop=u.scrollHeight-u.clientHeight:c>D+1&&(u.scrollTop=this.position.y*w)),o=this.Ct,h=this.At,u.style.width=o+(this.io?this.wi:0)+"px",u.style.height=h+(this.kn?this.wi:0)+"px",e===o&&i===h&&!this.animationManager.Mi||(b=Z.H(l,O,E,H),this.onViewportBoundsChanged(b,this.viewportBounds,I,n),Z.o(b),!1)}add(e){Xt.s(e,Y,K,"add:part");var i=e.diagram;if(i!==this){null!==i&&Xt.n("Cannot add part "+e.toString()+" to "+this.toString()+". It is already a part of "+i.toString());let t=this.findLayer(e.layerName);null===(t=null===t?this.findLayer(""):t)&&Xt.n('Cannot add a Part when unable find a Layer named "'+e.layerName+'" and there is no default Layer'),e.layer!==t&&(0<=(i=t.Qh(99999999,e,e.diagram===this))&&this.raiseChangedEvent(3,"parts",t,null,e,null,i),t.isTemporary||this.invalidateDocumentBounds(),e.invalidateLayout(1),null!==(i=e.layerChanged))&&i(e,null,t)}}Qh(t){this.partManager.Qh(t);const e=this;t.il(t=>e.CA(t)),t.data||t.Uo(),t.hasPlaceholder()&&t.u(),null!==t.data&&t.il(t=>e.partManager.LP(t,null)),!0!==t.hs()&&!0!==t.rh()||this.d0(t),t.AA(!0,this),t.LA()?(t.actualBounds.isReal()&&this.T(t.$h(t.actualBounds)),this.invalidateDocumentBounds()):t.isVisible()&&t.actualBounds.isReal()&&this.T(t.$h(t.actualBounds)),this.requestUpdate()}re(t){t.clearAdornments(),this.partManager.re(t);const e=this;null!==t.data&&t.il(t=>e.partManager.TP(t,e)),this._n.delete(t),t instanceof q&&this.Or.delete(t),t.LA()?(t.actualBounds.isReal()&&this.T(t.$h(t.actualBounds)),this.invalidateDocumentBounds()):t.isVisible()&&t.actualBounds.isReal()&&this.T(t.$h(t.actualBounds)),this.requestUpdate()}remove(t){Xt.s(t,Y,K,"remove:part"),this.DP(t,!0)}DP(t,e){var i=t.layer;null!==i&&i.diagram===this&&(t.isSelected=!1,t.isHighlighted=!1,t.invalidateLayout(2),e&&t.Wf(),0<=(e=i.re(-1,t,!1))&&this.raiseChangedEvent(4,"parts",i,t,null,e,null),null!==(e=t.layerChanged))&&e(t,i,null)}removeParts(e,i){if(void 0===i&&(i=!1),Array.isArray(e)){var s=e.length;for(let t=0;t<s;t++){var n=e[t];i&&!n.canDelete()||this.remove(n)}}else for(var t=new C,r=(t.addAll(e),t.iterator);r.next();){var a=r.value;i&&!a.canDelete()||this.remove(a)}}copyParts(t,e,i){return this.partManager.copyParts(t,e,i=void 0===i?!1:i)}moveParts(e,t,i,s){if(void 0===i&&(i=!1),void 0===s&&(s=this.y0()),Xt.s(t,U,K,"moveParts:offset"),null!==this.toolManager){var n=new L;if(null!==e)if(Array.isArray(e))for(let t=0;t<e.length;t++)this.el(n,e[t],i,s);else for(var r=e.iterator;r.next();)this.el(n,r.value,i,s);else{let t=this.parts;for(;t.next();){var a=t.value;this.el(n,a,i,s)}for(t=this.nodes;t.next();){var o=t.value;this.el(n,o,i,s)}for(t=this.links;t.next();){var h=t.value;this.el(n,h,i,s)}}this.LS(n,t,s,i)}}el(t,e,i,s,n){if(!t.contains(e)&&(void 0===n&&(n=!1),!i||n||e.canMove()||e.canCopy()))if(void 0===s&&(s=this.y0()),e instanceof D){if(t.add(e,this.Us(s,e,e.location)),e instanceof j&&(e.hasPlaceholder()||s.dragsMembers))for(var r=e.memberParts;r.next();){var a=r.value;this.el(t,a,i,s,s.groupsAlwaysMove)}for(var o=e.linksConnected;o.next();){var h,l,u=o.value;t.contains(u)||(h=u.fromNode,l=u.toNode,null!==h&&t.contains(h)&&null!==l&&t.contains(l)&&this.el(t,u,i,s))}if(s.dragsTree)for(var d=e.findTreeChildrenNodes();d.next();){var c=d.value;this.el(t,c,i,s)}}else if(e instanceof q){t.add(e,this.Us(s,e));for(var g=e.labelNodes;g.next();){var m=g.value;this.el(t,m,i,s)}}else e instanceof X||t.add(e,this.Us(s,e,e.location))}LS(i,t,s,n){if(null!==i&&(Xt.s(i,L,K,"moveParts:parts"),0!==i.count)){var r=U.a(),a=U.a(),t=(a.c(t),isNaN(a.x)&&(a.x=0),isNaN(a.y)&&(a.y=0),this.k1),o=(t||this.qw(i),Xt.ct()),h=Xt.ct(),l=i.iterator;let e=U.a();for(;l.next();){var u,d=l.key,c=l.value;d.De()?null!==(u=this.TA(d,i))?o.push(new Rt(d,c,u)):n&&!d.canMove()||(u=c.point,r.c(u),this.computeMove(d,r.add(a),s,e),d.location=e,void 0===c.shifted&&(c.shifted=new U),c.shifted.c(e.subtract(u))):l.key instanceof q&&h.push(new T(l.key,l.value))}U.o(e);var g=o.length;for(let t=0;t<g;t++){var m=o[t],f=m.DA.point;r.c(f),void 0===m.D1.shifted&&(m.D1.shifted=new U),m.be.location=r.add(m.D1.shifted)}var p=U.a(),v=U.a(),y=h.length;for(let t=0;t<y;t++){var x=h[t],A=x.key;if(A instanceof q)if(A.wn){A.Dr=null;var w=A.fromNode,b=A.toNode;if(null!==this.draggedLink&&s.dragsLink){var P=x.value.point;if(null===A.dragComputation){i.add(A,this.Us(s,A,a));var S=a.x-P.x,k=a.y-P.y;A.Mr(S,k)}else{S=U.H(0,0),k=A.getPoint(0);k&&k.isReal()&&S.c(k);let t=e=U.a().c(S).add(a);s.isGridSnapEnabled&&(s.isGridSnapRealtime||this.lastInput.up)&&(t=U.a(),this.mM(A,e,t,s)),e.c(A.dragComputation(A,e,t)).subtract(S),i.add(A,this.Us(s,A,e));var M=e.x-P.x,P=e.y-P.y;A.Mr(M,P),U.o(S),U.o(e),t!==e&&U.o(t)}}else if(null!==w&&(p.c(w.location),null!==(M=i.getValue(w)))&&p.subtract(M.point),null!==b&&(v.c(b.location),null!==(P=i.getValue(b)))&&v.subtract(P.point),null!==w&&null!==b)p.equalsApprox(v)?(N=x.value.point,(C=r).c(p),C.subtract(N),i.add(A,this.Us(s,A,p)),A.Mr(C.x,C.y)):(A.wn=!1,A.invalidateRoute());else{var N=x.value.point;let t;t=null!==w?p:null!==b?v:a,i.add(A,this.Us(s,A,t));var C=t.x-N.x,w=t.y-N.y;A.Mr(C,w)}}else null!==A.fromNode&&null!==A.toNode||(b=x.value.point,i.add(A,this.Us(s,A,a)),w=a.x-b.x,x=a.y-b.y,A.Mr(w,x))}U.o(r),U.o(a),U.o(p),U.o(v),Xt.ot(o),Xt.ot(h),t||(this.Fi(),this.Lm(i))}}computeMove(r,a,o,h){if((h=void 0===h?new U:h).c(a),null!==r){let t=a;var l=o.isGridSnapEnabled,o=(l&&(o.isGridSnapRealtime||this.lastInput.up)&&(t=U.a(),this.mM(r,a,t,o)),null!==r.dragComputation?r.dragComputation(r,a,t):t),u=r.minLocation;let e=u.x,i=(isNaN(e)&&(e=l?Math.round(1e3*r.location.x)/1e3:r.location.x),u.y);isNaN(i)&&(i=l?Math.round(1e3*r.location.y)/1e3:r.location.y);u=r.maxLocation;let s=u.x,n=(isNaN(s)&&(s=l?Math.round(1e3*r.location.x)/1e3:r.location.x),u.y);isNaN(n)&&(n=l?Math.round(1e3*r.location.y)/1e3:r.location.y),h.e(Math.max(e,Math.min(o.x,s)),Math.max(i,Math.min(o.y,n))),t!==a&&U.o(t)}return h}y0(){var t=this.toolManager.findTool("Dragging");return t instanceof d?t.dragOptions:this.M1}mM(n,r,a,o){if(void 0===o&&(o=this.y0()),a.c(r),null!==n){var n=this.grid,h=o.gridSnapCellSize;let t=h.width,e=h.height;h=o.gridSnapOrigin;let i=h.x,s=h.y;h=o.gridSnapCellSpot,n=(null!==n&&(o=n.gridCellSize,isNaN(t)&&(t=o.width),isNaN(e)&&(e=o.height),o=n.gridOrigin,isNaN(i)&&(i=o.x),isNaN(s))&&(s=o.y),U.H(0,0));n.setSpot(0,0,t,e,h),I.vg(r.x,r.y,i+n.x,s+n.y,t,e,a),U.o(n)}return a}qw(t){if(null!==t){this.k1=!0;for(var e=t.iterator;e.next();){var i=e.key;i instanceof q&&(i.wn=!0)}}}Lm(t){if(null!==t){for(var e=t.iterator;e.next();){var i=e.key;i instanceof q&&(i.wn=!1,i.FA())&&i.invalidateRoute()}this.k1=!1}}get draggedLink(){return this.S1}set draggedLink(t){this.S1!==t&&null!==(this.S1=t)&&(this.P1=t.fromPort,this.N1=t.toPort)}get FS(){return this.P1}set FS(t){this.P1=t}get RS(){return this.N1}set RS(t){this.N1=t}TA(e,i){e=e.containingGroup;if(null!==e){let t=this.TA(e,i);if(null!==t||null!==(t=i.getValue(e)))return t}return null}Us(t,e,i){if(void 0===i)return new Ft(U.To);let s=t.isGridSnapEnabled;return(s=t.groupsSnapMembers||null===e.containingGroup?s:!1)?new Ft(new U(Math.round(1e3*i.x)/1e3,Math.round(1e3*i.y)/1e3)):new Ft(i.copy())}FP(t,e){if(Xt.s(t,Lt,K,"addLayer:layer"),null!==t.diagram&&t.diagram!==this&&Xt.n("Cannot share a Layer with another Diagram: "+t+" of "+t.diagram),null===e?null!==t.diagram&&Xt.n("Cannot add an existing Layer to this Diagram again: "+t):(Xt.s(e,Lt,K,"addLayer:existingLayer"),e.diagram!==this&&Xt.n("Existing Layer must be in this Diagram: "+e+" not in "+e.diagram),t===e&&Xt.n("Cannot move a Layer before or after itself: "+t)),t.diagram!==this){var i=t.name,s=this.Jt,n=s.count;for(let t=0;t<n;t++)s.elt(t).name===i&&Xt.n("Cannot add Layer with the name '"+i+"'; a Layer with the same name is already present in this Diagram.")}}addLayer(t){this.FP(t,null),t.Vo(this);var e=this.Jt;let i=e.count-1;if(!t.isTemporary)for(;0<=i&&e.elt(i).isTemporary;)i--;return e.insertAt(i+1,t),null!==this.Li&&this.raiseChangedEvent(3,"layers",this,null,t,null,i+1),this.T(),this.invalidateDocumentBounds(),this}addLayerBefore(t,e){this.FP(t,e),t.Vo(this);var i=this.Jt,s=i.indexOf(t),n=(0<=s&&(i.remove(t),null!==this.Li)&&this.raiseChangedEvent(4,"layers",this,t,null,s,null),i.count);let r;for(r=0;r<n;r++)if(i.elt(r)===e){i.insertAt(r,t);break}return null!==this.Li&&this.raiseChangedEvent(3,"layers",this,null,t,null,r),this.T(),s<0&&this.invalidateDocumentBounds(),this}addLayerAfter(t,e){this.FP(t,e),t.Vo(this);var i=this.Jt,s=i.indexOf(t),n=(0<=s&&(i.remove(t),null!==this.Li)&&this.raiseChangedEvent(4,"layers",this,t,null,s,null),i.count);let r;for(r=0;r<n;r++)if(i.elt(r)===e){i.insertAt(r+1,t);break}return null!==this.Li&&this.raiseChangedEvent(3,"layers",this,null,t,null,r+1),this.T(),s<0&&this.invalidateDocumentBounds(),this}Qr(t,e){t.Vo(this),this.Jt.insertAt(e,t)}RA(t){this.Jt.removeAt(t)}removeLayer(t){if(Xt.s(t,Lt,K,"removeLayer:layer"),t.diagram!==this&&Xt.n("Cannot remove a Layer from another Diagram: "+t+" of "+t.diagram),""!==t.name){var e=this.Jt,i=e.indexOf(t);if(e.remove(t)){for(var s=t.It.copy().iterator;s.next();){var n=s.value,r=n.layerName;r!==t.name?n.layerName=r:n.layerName=""}null!==this.Li&&this.raiseChangedEvent(4,"layers",this,t,null,i,null),this.T(),this.invalidateDocumentBounds()}}}findLayer(t){for(var e=this.layers;e.next();){var i=e.value;if(i.name===t)return i}return null}findRouter(t){for(const e of this.vf)if(e.name===t)return e;return null}addModelChangedListener(t){return Xt.t(t,"function",K,"addModelChangedListener:listener"),null===this.to&&(this.to=new O),this.to.add(t),this.model.addChangedListener(t),this}removeModelChangedListener(t){Xt.t(t,"function",K,"removeModelChangedListener:listener"),null!==this.to&&(this.to.remove(t),0===this.to.count)&&(this.to=null),this.model.removeChangedListener(t)}addChangedListener(t){return Xt.t(t,"function",K,"addChangedListener:listener"),null===this.Er&&(this.Er=new O),this.Er.add(t),this}removeChangedListener(t){Xt.t(t,"function",K,"removeChangedListener:listener"),null!==this.Er&&(this.Er.remove(t),0===this.Er.count)&&(this.Er=null)}Gw(e){if(this.skipsUndoManager||this.model.skipsUndoManager||this.model.undoManager.handleChanged(e),1!==e.change&&(this.isModified=!0),null!==this.Er){var i=this.Er,s=i.length;for(let t=0;t<s;t++)i.elt(t)(e)}}raiseChangedEvent(t,e,i,s,n,r,a){void 0===r&&(r=null),void 0===a&&(a=null);var o=new F;o.diagram=this,o.change=t,o.propertyName=e,o.object=i,o.oldValue=s,o.oldParam=r,o.newValue=n,o.newParam=a,this.Gw(o)}raiseChanged(t,e,i,s,n){this.raiseChangedEvent(2,t,this,e,i,s,n)}i(t,e,i,s,n){this.raiseChangedEvent(2,t,this,e,i,s,n)}get animationManager(){return this.bs}get undoManager(){return this.Li.undoManager}get skipsUndoManager(){return this.Xo}set skipsUndoManager(t){Xt.t(t,"boolean",K,"skipsUndoManager"),this.Xo=t,this.Li.skipsUndoManager=t}get delaysLayout(){return this.qx}set delaysLayout(t){this.qx=t}CC(t,e){if(null!==t&&t.diagram===this){var i=this.xe;try{this.xe=!0;var s,n,r,a,o,h,l,u,d,c,g,m,f,p=t.change;2===p?(s=t.object,n=t.propertyName,r=t.getValue(e),x.dt(s,n,r),s instanceof y&&null!==(a=s.part)&&a.invalidateAdornments(),this.isModified=!0):3===p?(o=t.object,h=t.newParam,l=t.newValue,o instanceof jt?"number"==typeof h&&l instanceof y?(e?o.re(h):o.insertAt(h,l),null!==(u=o.part)&&u.invalidateAdornments()):"number"==typeof h&&l instanceof we&&(l.isRow?o.IA(h,e?void 0:l):o.OA(h,e?void 0:l)):o instanceof Lt?(d=!0===t.oldParam,"number"==typeof h&&l instanceof Y&&(e?(l.isSelected=!1,l.isHighlighted=!1,l.invalidateAdornments(),o.re(d?h:-1,l,d)):o.Qh(h,l,d))):o instanceof K?"number"==typeof h&&l instanceof Lt&&(e?this.RA(h):this.Qr(l,h)):Xt.n("unknown ChangeType.Insert object: "+t.toString()),this.isModified=!0):4===p?(c=t.object,g=t.oldParam,m=t.oldValue,c instanceof jt?"number"==typeof g&&m instanceof y?e?c.insertAt(g,m):c.re(g):"number"==typeof g&&m instanceof we&&(m.isRow?c.IA(g,e?m:void 0):c.OA(g,e?m:void 0)):c instanceof Lt?(f=!0===t.newParam,"number"==typeof g&&m instanceof Y&&(e?c.It.indexOf(m)<0&&c.Qh(g,m,f):(m.isSelected=!1,m.isHighlighted=!1,m.invalidateAdornments(),c.re(f?g:-1,m,f)))):c instanceof K?"number"==typeof g&&m instanceof Lt&&(e?this.Qr(m,g):this.RA(g)):Xt.n("unknown ChangeType.Remove object: "+t.toString()),this.isModified=!0):1!==p&&Xt.n("unknown ChangedEvent: "+t.toString())}finally{this.xe=i}}}startTransaction(t){return this.undoManager.startTransaction(t)}commitTransaction(t){return this.undoManager.commitTransaction(t)}rollbackTransaction(){return this.undoManager.rollbackTransaction()}commit(t,e){let i=e;void 0===i&&(i="");e=this.skipsUndoManager;null===i&&(this.skipsUndoManager=!0,i=""),this.undoManager.startTransaction(i);let s=!1;try{t(this),s=!0}finally{s?this.undoManager.commitTransaction(i):this.undoManager.rollbackTransaction(),this.skipsUndoManager=e}}updateAllTargetBindings(t){this.partManager.updateAllTargetBindings(t)}updateAllThemeBindings(){var t;this.partManager.updateAllThemeBindings(),null!==this.ls&&null!==(t=this.ls.part)&&t.Uo()}setDivBackground(t){this.div&&(this.div.style.backgroundColor=t)}updateAllRelationshipsFromData(){this.partManager.updateAllRelationshipsFromData()}EA(i,s){var n=this.animationManager;if(this.$t||this.Ps)this.v=s,this.$r(),this.T(),this.ca(),n.iA(i,this.v);else if(null===this.xt)this.v=s,this.$r();else{this.$t=!0;var r=this.viewportBounds.copy(),a=this.Ct,o=this.At;let t=this.zoomPoint.x,e=this.zoomPoint.y;var h=this.contentAlignment,a=(isNaN(t)&&(h.isSide()?h.includesSide(J.LeftSide)?t=0:h.includesSide(J.RightSide)&&(t=a-1):t=h.isSpot()?h.x*(a-1):a/2),isNaN(e)&&(h.isSide()?h.includesSide(J.TopSide)?e=0:h.includesSide(J.BottomSide)&&(e=o-1):e=h.isSpot()?h.y*(o-1):o/2),(s=(s=null===this.scaleComputation||this.animationManager.defaultAnimation.isAnimating?s:this.scaleComputation(this,s))<this.minScale?this.minScale:s)>this.maxScale&&(s=this.maxScale),U.H(this.lt.x+t/i-t/s,this.lt.y+e/i-e/s));this.position=a,U.o(a),this.v=s,this.$r(),this.$t=!1,this.onViewportBoundsChanged(r,this.viewportBounds,i,!1),this.Hs(!1),n.iA(i,this.v),this.T()}}hR(){var e=this.Jt.h;for(let t=0;t<e.length;t++)e[t].lA()}onViewportBoundsChanged(t,e,i,s){var n;t.equals(e)||((s=void 0===s?!1:s)||this.ca(),this.oh(),null===(n=this.layout)||!n.isViewportSized||1!==this.autoScale||t.width===e.width&&t.height===e.height||n.invalidateLayout(),n=this.currentTool,!0===this.Gf&&n instanceof st&&!this.animationManager.isTicking&&(this.lastInput.documentPoint=this.transformViewToDoc(this.lastInput.viewPoint),n.standardMouseActivity(this)),this.$t||this.invalidateViewport(t,e),this._r(),this.Ui.scale=i,this.Ui.position.x=t.x,this.Ui.position.y=t.y,this.Ui.bounds.c(t),this.Ui.canvasSize.width=Math.round(t.width*i),this.Ui.canvasSize.height=Math.round(t.height*i),this.Ui.newCanvasSize.width=this.Ct,this.Ui.newCanvasSize.height=this.At,this.Ui.isScroll=s,this.V("ViewportBoundsChanged",this.Ui,t),this.isVirtualized&&this.links.each(t=>{t.isAvoiding&&t.actualBounds.intersectsRect(e)&&t.invalidateRoute()}))}_r(t){var e,i,s,n=this.ls;null!==n&&n.visible&&null!==n.layer&&(t=void 0!==t?t:this.a1).isReal()&&(s=t.width,e=t.height,n.scale=1,n.angle=0,n.layer.isViewportAligned?(n.width=s*this.scale,n.height=e*this.scale,n.part.alignment=J.TopLeft):(null===n.Pi&&(n.Pi=new ye),(i=n.Pi.jf).isReal()&&(n.width=s+2*i.width,n.height=e+2*i.height,s=U.a(),I.vg(t.x,t.y,0,0,i.width,i.height,s),s.offset(-i.width,-i.height),n.part.location=s,U.o(s))))}clearSelection(t){void 0===t&&(t=!1);var e=this.selection;if(0!==e.count){t||this.V("ChangingSelection",e);var i=e.toArray(),s=i.length;for(let t=0;t<s;t++)i[t].isSelected=!1;e.ut(),e.clear(),e.w(),t||this.V("ChangedSelection",e)}}select(t){null!==t&&(Xt.s(t,Y,K,"select:part"),t.diagram===this)&&(!t.isSelected||1<this.selection.count)&&(this.V("ChangingSelection",this.selection),this.clearSelection(!0),t.isSelected=!0,this.V("ChangedSelection",this.selection))}selectCollection(e){if(this.V("ChangingSelection",this.selection),this.clearSelection(!0),Array.isArray(e)){var i=e.length;for(let t=0;t<i;t++){var s=e[t];s instanceof Y||Xt.n("Diagram.selectCollection given something that is not a Part: "+s),s.isSelected=!0}}else for(var t=e.iterator;t.next();){var n=t.value;n instanceof Y||Xt.n("Diagram.selectCollection given something that is not a Part: "+n),n.isSelected=!0}this.V("ChangedSelection",this.selection)}clearHighlighteds(){var t=this.highlighteds;if(0<t.count){var e=t.toArray(),i=e.length;for(let t=0;t<i;t++)e[t].isHighlighted=!1;t.ut(),t.clear(),t.w()}}highlight(t){null!==t&&t.diagram===this&&(Xt.s(t,Y,K,"highlight:part"),!t.isHighlighted||1<this.highlighteds.count)&&(this.clearHighlighteds(),t.isHighlighted=!0)}highlightCollection(t){for(var t=(new C).addAll(t),e=this.highlighteds.copy().removeAll(t).iterator;e.next();)e.value.isHighlighted=!1;for(var i=t.iterator;i.next();){var s=i.value;s instanceof Y||Xt.n("Diagram.highlightCollection given something that is not a Part: "+s),s.isHighlighted=!0}}scroll(t,e,i){void 0===i&&(i=1);var s="up"===e||"down"===e;let n=0;var r=U.a();if("pixel"===t)n=i;else if("line"===t)n=i*(s?this.scrollVerticalLineChange:this.scrollHorizontalLineChange);else if("page"===t){var a=s?this.viewportBounds.height:this.viewportBounds.width;0!=(a*=this.scale)&&(a=Math.max(a-(s?this.scrollVerticalLineChange:this.scrollHorizontalLineChange),0),n=i*a)}else{if("document"===t)return s=this.documentBounds,i=this.viewportBounds,"up"===e?this.position=r.e(i.x,s.y):"left"===e?this.position=r.e(s.x,i.y):"down"===e?this.position=r.e(i.x,s.bottom-i.height):"right"===e&&(this.position=r.e(s.right-i.width,i.y)),void U.o(r);Xt.n("scrolling unit must be 'pixel', 'line', 'page', or 'document', not: "+t)}n/=this.scale;a=this.position;"up"===e?this.position=r.e(a.x,a.y-n):"down"===e?this.position=r.e(a.x,a.y+n):"left"===e?this.position=r.e(a.x-n,a.y):"right"===e?this.position=r.e(a.x+n,a.y):Xt.n("scrolling direction must be 'up', 'down', 'left', or 'right', not: "+e),U.o(r)}scrollToRect(t){var e=this.viewportBounds;e.containsRect(t)||((t=t.center).x-=e.width/2,t.y-=e.height/2,this.position=t)}centerRect(t){var e=this.viewportBounds,t=t.center;t.x-=e.width/2,t.y-=e.height/2,this.position=t}transformDocToView(t){var e=this.D,i=(e.ti(),1!==this.v&&e.v(this.v),this.lt);return(0!==i.x||0!==i.y)&&isFinite(i.x)&&isFinite(i.y)&&e.se(-i.x,-i.y),t.copy().D(e)}transformViewToDoc(t){var e=this.D,i=(e.ti(),1!==this.v&&e.v(this.v),this.lt);return(0!==i.x||0!==i.y)&&isFinite(i.x)&&isFinite(i.y)&&e.se(-i.x,-i.y),t.copy().Ge(e)}FF(t){var e=this.D,i=(e.ti(),1!==this.v&&e.v(this.v),this.lt);return(0!==i.x||0!==i.y)&&isFinite(i.x)&&isFinite(i.y)&&e.se(-i.x,-i.y),t.Ge(this.D)}static None=1;static Uniform=2;static UniformToFill=3;static CycleAll=1;static CycleNotDirected=2;static CycleNotDirectedFast=3;static CycleNotUndirected=4;static CycleDestinationTree=5;static CycleSourceTree=6;static DocumentScroll=1;static InfiniteScroll=2;static TreeParentCollapsed=1;static AllParentsCollapsed=2;static AnyParentsCollapsed=3;get opacity(){return this._t}set opacity(t){var e=this._t;e!==t&&(Xt.t(t,"number",K,"opacity"),(t<0||1<t)&&Xt.G(t,"0 <= value <= 1",K,"opacity"),this._t=t,this.i("opacity",e,t),this.T())}get validCycle(){return this.Yx}set validCycle(t){var e=this.Yx;e!==t&&(Xt.it(t,Tt,"CycleMode"),this.Yx=t,this.i("validCycle",e,t))}get layers(){return this.Jt.iterator}get isModelReadOnly(){var t=this.Li;return null!==t&&t.isReadOnly}set isModelReadOnly(t){var e=this.Li;null!==e&&(e.isReadOnly=t)}get isReadOnly(){return this.Yo}set isReadOnly(t){var e=this.Yo;e!==t&&(Xt.t(t,"boolean",K,"isReadOnly"),this.Yo=t,this.i("isReadOnly",e,t))}get isEnabled(){return this.Xi}set isEnabled(t){var e=this.Xi;e!==t&&(Xt.t(t,"boolean",K,"isEnabled"),this.Xi=t,this.i("isEnabled",e,t))}get allowClipboard(){return this.Wx}set allowClipboard(t){var e=this.Wx;e!==t&&(Xt.t(t,"boolean",K,"allowClipboard"),this.Wx=t,this.i("allowClipboard",e,t))}get allowCopy(){return this.Xl}set allowCopy(t){var e=this.Xl;e!==t&&(Xt.t(t,"boolean",K,"allowCopy"),this.Xl=t,this.i("allowCopy",e,t))}get allowDelete(){return this.Yl}set allowDelete(t){var e=this.Yl;e!==t&&(Xt.t(t,"boolean",K,"allowDelete"),this.Yl=t,this.i("allowDelete",e,t))}get allowDragOut(){return this.jx}set allowDragOut(t){var e=this.jx;e!==t&&(Xt.t(t,"boolean",K,"allowDragOut"),this.jx=t,this.i("allowDragOut",e,t))}get allowDrop(){return this.Jx}set allowDrop(t){var e=this.Jx;e!==t&&(Xt.t(t,"boolean",K,"allowDrop"),this.Jx=t,this.i("allowDrop",e,t))}get allowTextEdit(){return this.Kl}set allowTextEdit(t){var e=this.Kl;e!==t&&(Xt.t(t,"boolean",K,"allowTextEdit"),this.Kl=t,this.i("allowTextEdit",e,t))}get allowGroup(){return this.Ul}set allowGroup(t){var e=this.Ul;e!==t&&(Xt.t(t,"boolean",K,"allowGroup"),this.Ul=t,this.i("allowGroup",e,t))}get allowUngroup(){return this.Gl}set allowUngroup(t){var e=this.Gl;e!==t&&(Xt.t(t,"boolean",K,"allowUngroup"),this.Gl=t,this.i("allowUngroup",e,t))}get allowInsert(){return this.Zx}set allowInsert(t){var e=this.Zx;e!==t&&(Xt.t(t,"boolean",K,"allowInsert"),this.Zx=t,this.i("allowInsert",e,t))}get allowLink(){return this.Hl}set allowLink(t){var e=this.Hl;e!==t&&(Xt.t(t,"boolean",K,"allowLink"),this.Hl=t,this.i("allowLink",e,t))}get allowRelink(){return this.vl}set allowRelink(t){var e=this.vl;e!==t&&(Xt.t(t,"boolean",K,"allowRelink"),this.vl=t,this.i("allowRelink",e,t))}get allowMove(){return this.ql}set allowMove(t){var e=this.ql;e!==t&&(Xt.t(t,"boolean",K,"allowMove"),this.ql=t,this.i("allowMove",e,t))}get allowReshape(){return this.Wl}set allowReshape(t){var e=this.Wl;e!==t&&(Xt.t(t,"boolean",K,"allowReshape"),this.Wl=t,this.i("allowReshape",e,t))}get allowResize(){return this.jl}set allowResize(t){var e=this.jl;e!==t&&(Xt.t(t,"boolean",K,"allowResize"),this.jl=t,this.i("allowResize",e,t))}get allowRotate(){return this.Jl}set allowRotate(t){var e=this.Jl;e!==t&&(Xt.t(t,"boolean",K,"allowRotate"),this.Jl=t,this.i("allowRotate",e,t))}get allowSelect(){return this.Zl}set allowSelect(t){var e=this.Zl;e!==t&&(Xt.t(t,"boolean",K,"allowSelect"),this.Zl=t,this.i("allowSelect",e,t))}get allowUndo(){return this.$x}set allowUndo(t){var e=this.$x;e!==t&&(Xt.t(t,"boolean",K,"allowUndo"),this.$x=t,this.i("allowUndo",e,t))}get allowZoom(){return this.Qx}set allowZoom(t){var e=this.Qx;e!==t&&(Xt.t(t,"boolean",K,"allowZoom"),this.Qx=t,this.i("allowZoom",e,t))}get hasVerticalScrollbar(){return this.Uu}set hasVerticalScrollbar(t){var e=this.Uu;e!==t&&(Xt.t(t,"boolean",K,"hasVerticalScrollbar"),this.Uu=t,this.ca(),this.T(),this.i("hasVerticalScrollbar",e,t),this.Hs(!1))}get hasHorizontalScrollbar(){return this.Ku}set hasHorizontalScrollbar(t){var e=this.Ku;e!==t&&(Xt.t(t,"boolean",K,"hasHorizontalScrollbar"),this.Ku=t,this.ca(),this.T(),this.i("hasHorizontalScrollbar",e,t),this.Hs(!1))}get allowHorizontalScroll(){return this._x}set allowHorizontalScroll(t){var e=this._x;e!==t&&(Xt.t(t,"boolean",K,"allowHorizontalScroll"),this._x=t,this.i("allowHorizontalScroll",e,t),this.Hs(!1))}get allowVerticalScroll(){return this.t1}set allowVerticalScroll(t){var e=this.t1;e!==t&&(Xt.t(t,"boolean",K,"allowVerticalScroll"),this.t1=t,this.i("allowVerticalScroll",e,t),this.Hs(!1))}get scrollHorizontalLineChange(){return this.i1}set scrollHorizontalLineChange(t){var e=this.i1;e!==t&&(Xt.t(t,"number",K,"scrollHorizontalLineChange"),t<0&&Xt.G(t,">= 0",K,"scrollHorizontalLineChange"),this.i1=t,this.i("scrollHorizontalLineChange",e,t))}get scrollVerticalLineChange(){return this.e1}set scrollVerticalLineChange(t){var e=this.e1;e!==t&&(Xt.t(t,"number",K,"scrollVerticalLineChange"),t<0&&Xt.G(t,">= 0",K,"scrollVerticalLineChange"),this.e1=t,this.i("scrollVerticalLineChange",e,t))}get lastInput(){return this.ia}set lastInput(t){Yt,Xt.s(t,N,K,"lastInput"),this.ia=t}get previousInput(){return this.jr}set previousInput(t){Yt,Xt.s(t,N,K,"previousInput"),this.jr=t}get firstInput(){return this.e0}set firstInput(t){Yt,Xt.s(t,N,K,"firstInput"),this.e0=t}get currentCursor(){return this.Kx}set currentCursor(t){var e,i,s;""===t&&(t=this.Zm),this.Kx!==t&&(Xt.t(t,"string",K,"currentCursor"),e=this.xt,i=this.Ot,null!==e)&&null!==i&&(this.Kx=t,s=e.style.cursor,e.style.cursor=t,i.style.cursor=t,e.style.cursor===s)&&(e.style.cursor="-webkit-"+t,i.style.cursor="-webkit-"+t,e.style.cursor===s)&&(e.style.cursor="-moz-"+t,i.style.cursor="-moz-"+t,e.style.cursor===s)&&(e.style.cursor=t,i.style.cursor=t)}get defaultCursor(){return this.Zm}set defaultCursor(t){var e=this.Zm;e!==(t=""===t?"auto":t)&&(Xt.t(t,"string",K,"defaultCursor"),this.Zm=t,this.i("defaultCursor",e,t))}get click(){return this.Vr}set click(t){var e=this.Vr;e!==t&&(null!==t&&Xt.t(t,"function",K,"click"),this.Vr=t,this.i("click",e,t))}get doubleClick(){return this.Br}set doubleClick(t){var e=this.Br;e!==t&&(null!==t&&Xt.t(t,"function",K,"doubleClick"),this.Br=t,this.i("doubleClick",e,t))}get contextClick(){return this.zr}set contextClick(t){var e=this.zr;e!==t&&(null!==t&&Xt.t(t,"function",K,"contextClick"),this.zr=t,this.i("contextClick",e,t))}get mouseOver(){return this.Xr}set mouseOver(t){var e=this.Xr;e!==t&&(null!==t&&Xt.t(t,"function",K,"mouseOver"),this.Xr=t,this.i("mouseOver",e,t))}get mouseHover(){return this.Yr}set mouseHover(t){var e=this.Yr;e!==t&&(null!==t&&Xt.t(t,"function",K,"mouseHover"),this.Yr=t,this.i("mouseHover",e,t))}get mouseHold(){return this.Kr}set mouseHold(t){var e=this.Kr;e!==t&&(null!==t&&Xt.t(t,"function",K,"mouseHold"),this.Kr=t,this.i("mouseHold",e,t))}get mouseDragOver(){return this.Ux}set mouseDragOver(t){var e=this.Ux;e!==t&&(null!==t&&Xt.t(t,"function",K,"mouseDragOver"),this.Ux=t,this.i("mouseDragOver",e,t))}get mouseDrop(){return this.Ur}set mouseDrop(t){var e=this.Ur;e!==t&&(Yt,null!==t&&Xt.t(t,"function",K,"mouseDrop"),this.Ur=t,this.i("mouseDrop",e,t))}get handlesDragDropForTopLevelParts(){return this.Gx}set handlesDragDropForTopLevelParts(t){var e=this.Gx;e!==t&&(Xt.t(t,"boolean",K,"handlesDragDropForTopLevelParts"),this.Gx=t,this.i("handlesDragDropForTopLevelParts",e,t))}get mouseEnter(){return this.Gr}set mouseEnter(t){var e=this.Gr;e!==t&&(null!==t&&Xt.t(t,"function",K,"mouseEnter"),this.Gr=t,this.i("mouseEnter",e,t))}get mouseLeave(){return this.Hr}set mouseLeave(t){var e=this.Hr;e!==t&&(null!==t&&Xt.t(t,"function",K,"mouseLeave"),this.Hr=t,this.i("mouseLeave",e,t))}get toolTip(){return this.vr}set toolTip(t){var e=this.vr;e!==t&&(Yt,null===t||(t instanceof X||t instanceof pt)||Xt.n("Diagram.toolTip must be an Adornment or HTMLInfo."),this.vr=t,this.i("toolTip",e,t))}get contextMenu(){return this.qr}set contextMenu(t){var e=this.qr;e!==t&&(Yt,t instanceof X||t instanceof pt||Xt.n("Diagram.contextMenu must be an Adornment or HTMLInfo."),this.qr=t,this.i("contextMenu",e,t))}get commandHandler(){return this.tP}set commandHandler(t){this.tP!==t&&(this.tP=t).Vo(this)}get toolManager(){return this.$M}set toolManager(t){this.$M!==t&&(Xt.s(t,st,K,"toolManager"),(this.$M=t).diagram=this)}get defaultTool(){return this.QM}set defaultTool(t){var e=this.QM;e!==t&&(Xt.s(t,_,K,"defaultTool"),((this.QM=t).diagram=this).currentTool===e)&&(this.currentTool=t)}get currentTool(){return this._M}set currentTool(t){var e=this._M;e&&(e.isActive&&e.doDeactivate(),e.cancelWaitAfter(),e.doStop()),null!==(t=null===t?this.defaultTool:t)&&(Xt.s(t,_,K,"currentTool"),(this._M=t).diagram=this,t.doStart())}get selection(){return this.lP}get maxSelectionCount(){return this.h1}set maxSelectionCount(t){var e=this.h1;if(e!==t)if(Xt.t(t,"number",K,"maxSelectionCount"),0<=t&&!isNaN(t)){if(this.h1=t,this.i("maxSelectionCount",e,t),!this.undoManager.isUndoingRedoing){var i=this.selection.count-t;if(0<i){this.V("ChangingSelection",this.selection);var s=this.selection.toArray();for(let t=0;t<i;t++)s[t].isSelected=!1;this.V("ChangedSelection",this.selection)}}}else Xt.G(t,">= 0",K,"maxSelectionCount")}get nodeSelectionAdornmentTemplate(){return this._m}set nodeSelectionAdornmentTemplate(t){var e=this._m;e!==t&&(Xt.s(t,X,K,"nodeSelectionAdornmentTemplate"),this._m=t,this.i("nodeSelectionAdornmentTemplate",e,t))}get groupSelectionAdornmentTemplate(){return this.c1}set groupSelectionAdornmentTemplate(t){var e=this.c1;e!==t&&(Xt.s(t,X,K,"groupSelectionAdornmentTemplate"),this.c1=t,this.i("groupSelectionAdornmentTemplate",e,t))}get linkSelectionAdornmentTemplate(){return this.u1}set linkSelectionAdornmentTemplate(t){var e=this.u1;e!==t&&(Xt.s(t,X,K,"linkSelectionAdornmentTemplate"),this.u1=t,this.i("linkSelectionAdornmentTemplate",e,t))}get highlighteds(){return this.hP}get isModified(){var t=this.undoManager;return t.isEnabled?null!==t.currentTransaction||this.vu&&this.Ys!==t.historyIndex:this.vu}set isModified(t){var e;this.vu!==t&&(Xt.t(t,"boolean",K,"isModified"),this.vu=t,e=this.undoManager,!t&&e.isEnabled&&(this.Ys=e.historyIndex),t||this.VA())}VA(){var t=this.isModified;this.oP!==t&&(this.oP=t,this.V("Modified"))}get model(){return this.Li}set model(e){const i=this.Li;if(i!==e){Xt.s(e,x,K,"model"),this.currentTool.doCancel(),i&&i.undoManager!==e.undoManager&&i.undoManager.isInTransaction&&Xt.n("Do not replace a Diagram.model while a transaction is in progress."),this.animationManager.stopAnimation(!0);var s=this.yA(!0),t=(this.eo=!1,this.Yu=!0,this.Ys=-2,this.Tr=!1,this.$t);this.$t=!0,this.animationManager.zl("Model"),i&&(null!==this.to&&this.to.each(t=>i.removeChangedListener(t)),i.removeChangedListener(this.nP)),this.Li=e,this.partManager=this.wR(this.Li.type),this.initializePartManager(this.partManager);for(let t=0;t<s.length;t++)this.add(s[t]);e.addChangedListener(this.sP),this.partManager.RP(),e.removeChangedListener(this.sP),e.addChangedListener(this.nP),null!==this.to&&this.to.each(t=>e.addChangedListener(t)),this.$t=t,this.invalidateDocumentBounds(),this.$t||this.T(),i&&e.undoManager.copyProperties(i.undoManager)}}get themeManager(){return this.C1}set themeManager(t){var e=this.C1;e!==t&&(Xt.s(t,zi,x,"themeManager"),null!==e&&e.removeDiagram(this),null!==(this.C1=t))&&t.addDiagram(this)}initializePartManager(t){}static xP(t,e){K.cA.add(t,e)}static get licenseKey(){return K.IP.last()}static set licenseKey(t){K.IP.add(t.replace(/\s/g,""))}static get version(){return K.xR}static IP=new O;static xR="3.0.2";wR(t){t=K.cA.get(t);return new(null!==t?t:ei)}get W(){return this.eP}set W(t){this.eP=t}get Mx(){return this.hA}bR(t){if(t.model===this.model){var e,i=t.change,s=t.propertyName;if(1===i&&"S"===s[0])if("StartingFirstTransaction"===s){const a=this,o=this.toolManager;o.mouseDownTools.each(t=>t.diagram=a),o.mouseMoveTools.each(t=>t.diagram=a),o.mouseUpTools.each(t=>t.diagram=a),this.routers.each(t=>t.diagram=a),this.Ps||this.eo||(this.Xf=!0,!this.Yu)||(this.Tr=!0)}else"StartingUndo"===s||"StartingRedo"===s?(e=this.animationManager,this.skipsUndoManager||(e.defaultAnimation.isAnimating&&e.stopAnimation(),e.getBundleAnimation().isAnimating&&e.getBundleAnimation().stop()),this.V("ChangingSelection",this.selection)):"StartedTransaction"===s&&(e=this.animationManager).defaultAnimation.isAnimating&&!this.skipsUndoManager&&e.stopAnimation();else if(this.W){this.W=!1;try{if(""===t.modelChange&&1===i){"FinishedUndo"!==s&&"FinishedRedo"!==s||(this.V("ChangedSelection",this.selection),this.Fi());var n=this.animationManager,r=("RolledBackTransaction"===s&&n.stopAnimation(),this.yR(),this.Xf=!0,this.maybeUpdate(),0!==this.undoManager.transactionLevel&&1!==this.undoManager.transactionLevel||n.FM(),"CommittedTransaction"===s&&this.undoManager.isJustDiscarded&&(this.Ys=Math.min(this.Ys,this.undoManager.historyIndex-1)),"CommittedTransaction"!==s&&"RolledBackTransaction"!==s||!this.undoManager.Uw||setTimeout(()=>{this.isModified=!1},1),t.isTransactionFinished);if(r&&(this.VA(),this.Mx.clear(),this.animationManager.mF()),!this.Hx&&r&&this.lastInput.targetDiagram){this.Hx=!0;const h=this;Xt.Xh(()=>{h.currentTool.standardMouseOver(),h.Hx=!1},10)}}}finally{this.W=!0}}}}get xe(){return this.iP}set xe(t){this.iP=t}get Am(){return this.vx}set Am(t){this.vx=t}CA(t){for(const e of t.F.h)e instanceof Le&&this.OP(e)}OP(e){var t=e.element;if(null!==t&&t instanceof HTMLImageElement&&(t.as instanceof C&&t.as.add(this),e.kR(),t.w0)){var i=t.getAttribute("src")||"",s=this.eh.getValue(i);if(null===s){Le.BA(e,t);t=[];t.push(e),this.eh.add(i,t)}else{for(let t=0;t<s.length;t++)if(s[t]===e)return;s.push(e)}}}SR(t){var e=t.F.h,i=e.length;for(let t=0;t<i;t++)this.EP(e[t])}EP(e){if(e instanceof Le){var i=e.element;if(null!==i&&i instanceof HTMLImageElement&&i.w0){var s=i.getAttribute("src")||"",n=this.eh.getValue(s);if(null!==n)for(let t=0;t<n.length;t++)if(n[t]===e)return n.splice(t,1),void(0===n.length&&(this.eh.remove(s),Le.MR(i),i.as instanceof C&&i.as.remove(this),Le.clearCache(s)))}}}wA(){Le.clearCache(),this.eh.clear()}rebuildParts(){this.partManager.rebuildParts()}Rf(t,e){this.bs.Rf(t,e)}Ff(t,e){this.bs.Ff(t,e)}findPartForKey(t){return this.partManager.findPartForKey(t)}findNodeForKey(t){return this.partManager.findNodeForKey(t)}findLinkForKey(t){return this.partManager.findLinkForKey(t)}findPartForData(t){return this.partManager.findPartForData(t)}findNodeForData(t){return this.partManager.findNodeForData(t)}findLinkForData(t){return this.partManager.findLinkForData(t)}findNodesByExample(...t){return this.partManager.findNodesByExample(...t)}findLinksByExample(...t){return this.partManager.findLinksByExample(...t)}get nodeTemplate(){return this.Wr.getValue("")}set nodeTemplate(t){var e=this.Wr.getValue("");e!==t&&(Xt.s(t,Y,K,"nodeTemplate"),this.Wr.add("",t),this.i("nodeTemplate",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get nodeTemplateMap(){return this.Wr}set nodeTemplateMap(t){var e=this.Wr;e!==t&&(Xt.s(t,L,K,"nodeTemplateMap"),this.Wr=t,this.i("nodeTemplateMap",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get groupTemplate(){return this.ta.getValue("")}set groupTemplate(t){var e=this.ta.getValue("");e!==t&&(Xt.s(t,j,K,"groupTemplate"),this.ta.add("",t),this.i("groupTemplate",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get groupTemplateMap(){return this.ta}set groupTemplateMap(t){var e=this.ta;e!==t&&(Xt.s(t,L,K,"groupTemplateMap"),this.ta=t,this.i("groupTemplateMap",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get linkTemplate(){return this.th.getValue("")}set linkTemplate(t){var e=this.th.getValue("");e!==t&&(Xt.s(t,q,K,"linkTemplate"),this.th.add("",t),this.i("linkTemplate",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get linkTemplateMap(){return this.th}set linkTemplateMap(t){var e=this.th;e!==t&&(Xt.s(t,L,K,"linkTemplateMap"),this.th=t,this.i("linkTemplateMap",e,t),this.undoManager.isUndoingRedoing||this.rebuildParts())}get isMouseCaptured(){return this.rP}set isMouseCaptured(t){var e=this.xt;null===e||(e=e.Bt)instanceof SVGElement||(t?(this.lastInput.bubbles=!1,this.Ti(e,"pointermove",this.ra,!1),this.Ti(e,"pointerdown",this.nh,!1),this.Ti(e,"pointerup",this.la,!1),this.Ti(e,"pointerout",this.ha,!1),this.Ti(e,"pointercancel",this.aa,!1),this.Ht(v,"pointermove",this.ra,!0),this.Ht(v,"pointerdown",this.nh,!0),this.Ht(v,"pointerup",this.la,!0),this.Ht(v,"pointerout",this.ha,!0),this.Ht(v,"pointercancel",this.aa,!0),this.Ti(e,"wheel",this.oa,!1),this.Ht(v,"wheel",this.oa,!0),this.Ht(v,"selectstart",this.jh,!1)):(this.Ti(v,"pointermove",this.ra,!0),this.Ti(v,"pointerdown",this.nh,!0),this.Ti(v,"pointerup",this.la,!0),this.Ti(v,"pointerout",this.ha,!0),this.Ti(v,"pointercancel",this.aa,!0),this.Ht(e,"pointermove",this.ra,!1),this.Ht(e,"pointerdown",this.nh,!1),this.Ht(e,"pointerup",this.la,!1),this.Ht(e,"pointerout",this.ha,!1),this.Ht(e,"pointercancel",this.aa,!1),this.Ti(v,"wheel",this.oa,!0),this.Ti(v,"selectstart",this.jh,!1),this.Ht(e,"wheel",this.oa,!1)),this.rP=t)}get position(){return this.lt}set position(t){var e,i,s;this.lt.equals(t)||(e=U.a().c(this.lt),i=this.viewportBounds.copy(),this.lt.c(t),this.animationManager.tA(e,this.lt),this.$t||null===this.xt&&!this.Hu.isReal()?this.$r():(this.$t=!0,t=this.scale,s=this.Ct/t,t=this.At/t,this.MP(this.Qm,s,t,this.Bf,!1),this.$t=!1),this.$t||(s=this.viewportBounds,this.onViewportBoundsChanged(i,s,this.v,!1)),U.o(e))}get initialPosition(){return this.Ax}set initialPosition(t){this.Ax.equals(t)||(Xt.s(t,U,K,"initialPosition"),this.Ax=t.L())}get initialScale(){return this.Lx}set initialScale(t){this.Lx!==t&&(Xt.t(t,"number",K,"initialScale"),this.Lx=t)}get grid(){return null===this.ls&&(this.ls=this.bA()),this.ls}set grid(t){let e=this.ls;var i;e!==t&&(null===e&&(this.ls=this.bA(),e=this.ls),Xt.s(t,jt,K,"grid"),t.type!==jt.Grid&&Xt.n("Diagram.grid must be a Panel of type Panel.Grid"),null!==(i=e.panel)&&i.remove(e),(this.ls=t).name="GRID",null!==i&&i.add(t),this._r(),this.T(),this.i("grid",e,t))}get viewportBounds(){return this.a1}$r(){var t=this.a1,e=this.lt,i=this.v;t.e(e.x,e.y,Math.max(this.Ct,0)/i,Math.max(this.At,0)/i),this.oh()}get viewSize(){return this.Hu}set viewSize(i){var s=this.viewSize;if(!s.equals(i)){Xt.s(i,qt,K,"viewSize"),i=i.L();let t=0,e=0;(this.Hu=i).isReal()?(t=i.width,e=i.height):null!==this.Ot&&(t=this.Ot.clientWidth||1,e=this.Ot.clientHeight||1),this.Ct=t,this.At=e,this.$r(),this.invalidateDocumentBounds(),this.i("viewSize",s,i),this.T()}}get fixedBounds(){return this.Rx}set fixedBounds(t){var e=this.Rx;e.equals(t)||(Xt.s(t,Z,K,"fixedBounds"),Yt,t.width!==1/0&&t.width!==-1/0&&t.height!==1/0&&t.height!==-1/0||Xt.n("fixedBounds width/height must not be Infinity"),t=t.L(),this.Rx=t,this.invalidateDocumentBounds(),this.i("fixedBounds",e,t))}get scrollMargin(){return this.Vf}set scrollMargin(t){"number"==typeof t?t=new E(t):Xt.s(t,E,K,"scrollMargin");var e=this.Vf;e.equals(t)||(t=t.L(),this.Vf=t,this.i("scrollMargin",e,t),this.Pu())}get scrollMode(){return this.Zh}set scrollMode(t){var e=this.Zh;e!==t&&(Xt.it(t,Bt,"ScrollMode"),1===(this.Zh=t)&&this.Hs(!1),this.i("scrollMode",e,t),this.ca(),this.T())}get scrollsPageOnFocus(){return this.Ix}set scrollsPageOnFocus(t){var e=this.Ix;e!==t&&(Xt.t(t,"boolean",K,"scrollsPageOnFocus"),this.Ix=t,this.i("scrollsPageOnFocus",e,t))}get positionComputation(){return this.Ox}set positionComputation(t){var e=this.Ox;e!==t&&(null!==t&&Xt.t(t,"function",K,"positionComputation"),this.Ox=t,this.Hs(!1),this.i("positionComputation",e,t))}get scaleComputation(){return this.Ex}set scaleComputation(t){var e=this.Ex;e!==t&&(null!==t&&Xt.t(t,"function",K,"scaleComputation"),this.Ex=t,this.EA(this.scale,this.scale),this.i("scaleComputation",e,t))}get documentBounds(){return this.Qm}zA(t){this.ea=!1;let e=this.Qm;e.equals(t)||(e=e.copy(),this.Qm.c(t),this.Hs(!1),this.V("DocumentBoundsChanged",void 0,e),this.ca(),this.T())}ensureBounds(){var t;this.ea&&(t=Z.a(),this.zA(this.computeBounds(t)),Z.o(t))}get isVirtualized(){return this.f1}set isVirtualized(t){var e=this.f1;e!==t&&(Xt.t(t,"boolean",K,"isVirtualized"),this.f1=t,this.i("isVirtualized",e,t))}get scale(){return this.v}set scale(t){var e=this.v;Xt.r(t,K,"scale"),e!==t&&this.EA(e,t)}get defaultScale(){return this.s0}set defaultScale(t){Yt,Xt.r(t,K,"defaultScale"),Yt,0<t||Xt.n("defaultScale must be larger than zero, not: "+t),this.s0=t}get autoScale(){return this.Ql}set autoScale(t){var e=this.Ql;e!==t&&(Xt.it(t,Dt,"AutoScale"),this.Ql=t,this.i("autoScale",e,t),1!==t)&&this.Hs(!1)}get initialAutoScale(){return this.Ir}set initialAutoScale(t){var e=this.Ir;e!==t&&(Xt.it(t,Dt,"AutoScale"),this.Ir=t,this.i("initialAutoScale",e,t))}get initialViewportSpot(){return this.Bx}set initialViewportSpot(t){var e=this.Bx;e!==t&&(Xt.s(t,J,K,"initialViewportSpot"),t.isSpot()||Xt.n("initialViewportSpot must be a specific Spot: "+t),this.Bx=t,this.i("initialViewportSpot",e,t))}get initialDocumentSpot(){return this.Vx}set initialDocumentSpot(t){var e=this.Vx;e!==t&&(Xt.s(t,J,K,"initialDocumentSpot"),t.isSpot()||Xt.n("initialViewportSpot must be a specific Spot: "+t),this.Vx=t,this.i("initialDocumentSpot",e,t))}get minScale(){return this.Tx}set minScale(t){Xt.r(t,K,"minScale");var e=this.Tx;e!==t&&(0<t?(this.Tx=t,this.i("minScale",e,t),t>this.scale&&(this.scale=t)):Xt.G(t,"> 0",K,"minScale"))}get maxScale(){return this.Dx}set maxScale(t){Xt.r(t,K,"maxScale");var e=this.Dx;e!==t&&(0<t?(this.Dx=t,this.i("maxScale",e,t),t<this.scale&&(this.scale=t)):Xt.G(t,"> 0",K,"maxScale"))}get zoomPoint(){return this.Fx}set zoomPoint(t){this.Fx.equals(t)||(Xt.s(t,U,K,"zoomPoint"),t=t.L(),this.Fx=t)}get contentAlignment(){return this.Bf}set contentAlignment(t){var e=this.Bf;e.equals(t)||(Xt.s(t,J,K,"contentAlignment"),t=t.L(),this.Bf=t,this.i("contentAlignment",e,t),this.Hs(!1))}get initialContentAlignment(){return this.Wm}set initialContentAlignment(t){var e=this.Wm;e.equals(t)||(Xt.s(t,J,K,"initialContentAlignment"),t=t.L(),this.Wm=t,this.i("initialContentAlignment",e,t))}get padding(){return this.ei}set padding(t){"number"==typeof t?t=new E(t):Xt.s(t,E,K,"padding");var e=this.ei;e.equals(t)||(t=t.L(),this.ei=t,this.invalidateDocumentBounds(),this.i("padding",e,t))}get partManager(){return this.cP}set partManager(t){var e=this.cP;e!==t&&(Xt.s(t,ei,K,"partManager"),null!==t.diagram&&Xt.n("Cannot share PartManagers between Diagrams: "+t.toString()),e&&e.Vo(null),(this.cP=t).Vo(this))}get nodes(){return this.partManager.nodes.iterator}get links(){return this.partManager.links.iterator}get parts(){return this.partManager.parts.iterator}findTopLevelNodesAndLinks(){for(var t=new C,e=this.nodes;e.next();){var i=e.value;i.isTopLevel&&t.add(i)}for(var s=this.links;s.next();){var n=s.value;n.isTopLevel&&t.add(n)}return t.iterator}findTopLevelGroups(){return this.Zr.iterator}get routers(){return this.vf}doLinkRouting(e){this.zo=!0;var i=this.vf.h;for(let t=0;t<i.length;t++)i[t].canRoute(e)&&i[t].routeLinks(this.Or,e);this.zo=!1}get layout(){return this.le}set layout(t){var e=this.le;e!==t&&(Xt.s(t,Qe,K,"layout"),(this.le=t).diagram=this,t.group=null,this.Jr=!0,this.i("layout",e,t),this.requestUpdate())}layoutDiagram(t){this.Fi(),t&&this.F1(!0),this.Ps?this.CP(!1,this.Al||0!==this.vf.count&&0!==this._n.size):(this.Xf=!0,this.Pr())}F1(t){for(var e=this.Zr.iterator;e.next();)this.XA(e.value,t);this.layout&&(t?this.layout.isValidLayout=!1:this.layout.invalidateLayout())}XA(t,e){if(null!==t){for(var i=t.ua.iterator;i.next();){var s=i.value;this.XA(s,e)}null!==t.layout&&(e?t.layout.isValidLayout=!1:t.layout.invalidateLayout())}}CP(i,s){if(!this.qx){var t=this.W,n=(this.W=!0,"Layout"),r=this.undoManager.transactionLevel,a=this.layout,o=this.animationManager;try{0===r&&(this.undoManager.Cl=!0,this.startTransaction(n)),r<=1&&!o.defaultAnimation.isAnimating&&!o.Mi&&!i&&o.zl(n),this.Jr=!1;let e=this.Zr.iterator;for(;e.next();)this.YA(e.value,i,r,s);let t=!1;if(a.isValidLayout||(!i||a.isRealtime||null===a.isRealtime||0===r?(a.doLayout(this),this.g0(this),t=!0,a.isValidLayout=!0):this.Jr=!0),t||this.g0(this),this.doLinkRouting(this),this.Or.clear(),0!==this._h.size){for(let t=0;t<23&&0!==this._h.size;t++){for(e=this.Zr.iterator;e.next();)this.KA(e.value);var h=this.Or;this.Or=this._h,this._h=h,this.g0(this),this.doLinkRouting(this)}this.Or.clear(),this._h.clear()}}finally{var e=this.undoManager.Cl;0===r&&(this.commitTransaction(n),this.undoManager.Cl=!1),!e||0!==r&&1!==r||o.FM(),this.Jr&&(this.Jr=!a.isValidLayout),this.W=t}}}YA(t,e,i,s){for(var n=t.ua.iterator;n.next();)this.YA(n.value,e,i,s);var r=t.layout;null===r||r.isValidLayout?s&&this.doLinkRouting(t):!e||r.isRealtime||0===i?(t.sl=!t.location.isReal(),r.doLayout(t),t.invalidateLayout(32),this.L1(t),this.g0(t),this.doLinkRouting(t),r.isValidLayout=!0):(this.doLinkRouting(t),this.Jr=!0)}KA(t){for(var e=t.ua.iterator;e.next();)this.KA(e.value);this.g0(t),this.doLinkRouting(t)}get isTreePathToChildren(){return this.zx}set isTreePathToChildren(t){var e=this.zx;if(e!==t&&(Xt.t(t,"boolean",K,"isTreePathToChildren"),this.zx=t,this.i("isTreePathToChildren",e,t),!this.undoManager.isUndoingRedoing))for(var i=this.nodes;i.next();)i.value.x0()}findTreeRoots(){for(var t=new O,e=this.nodes;e.next();){var i=e.value;i.isTopLevel&&null===i.findTreeParentLink()&&t.add(i)}return t.iterator}get treeCollapsePolicy(){return this.Xx}set treeCollapsePolicy(t){var e=this.Xx;e!==t&&(1!==t&&2!==t&&3!==t&&Xt.n("Unknown Diagram.treeCollapsePolicy: "+t),this.Xx=t,this.i("treeCollapsePolicy",e,t))}get isCollapsingExpanding(){return this.ZM}set isCollapsingExpanding(t){this.ZM=t}HF(){const s=new L,n=new L;function t(t){var e=t.toLowerCase(),i=new O;s.add(t,i),s.add(e,i),n.add(t,t),n.add(e,t)}t("InitialAnimationStarting"),t("AnimationStarting"),t("AnimationFinished"),t("BackgroundSingleClicked"),t("BackgroundDoubleClicked"),t("BackgroundContextClicked"),t("ClipboardChanged"),t("ClipboardPasted"),t("DocumentBoundsChanged"),t("ExternalObjectsDropped"),t("GainedFocus"),t("InitialLayoutCompleted"),t("LayoutCompleted"),t("LinkDrawn"),t("LinkRelinked"),t("LinkReshaped"),t("LostFocus"),t("Modified"),t("ObjectSingleClicked"),t("ObjectDoubleClicked"),t("ObjectContextClicked"),t("PartCreated"),t("PartResized"),t("PartRotated"),t("SelectionMoved"),t("SelectionCopied"),t("SelectionDeleting"),t("SelectionDeleted"),t("SelectionGrouped"),t("SelectionUngrouped"),t("ChangingSelection"),t("ChangedSelection"),t("SubGraphCollapsed"),t("SubGraphExpanded"),t("TextEdited"),t("ThemeChanged"),t("TreeCollapsed"),t("TreeExpanded"),t("ViewportBoundsChanged"),t("InvalidateDraw"),this.jM=s,this.JM=n}NA(t){var e=this.JM.getValue(t);return null!==e?e:this.JM.getValue(t.toLowerCase())}VP(t){var e,i=this.jM.getValue(t);return null!==i||(e=t.toLowerCase(),null!==(i=this.jM.getValue(e)))?i:void Xt.n("Unknown DiagramEvent name: "+t)}addDiagramListener(t,e){Xt.t(t,"string",K,"addDiagramListener:name"),Xt.t(e,"function",K,"addDiagramListener:listener");t=this.VP(t);return null!==t&&t.add(e),this}removeDiagramListener(t,e){Xt.t(t,"string",K,"removeDiagramListener:name"),Xt.t(e,"function",K,"addDiagramListener:listener");t=this.VP(t);null!==t&&t.remove(e)}raiseDiagramEvent(t,e,i){this.V(t,e,i)}V(t,e,i){Yt,Xt.t(t,"string",K,"raiseDiagramEvent:name");var s=this.VP(t),n=new B,t=(n.diagram=this).NA(t),r=(null!==t&&(n.name=t),void 0!==e&&(n.subject=e),void 0!==i&&(n.parameter=i),s.length);if(1===r)s.elt(0)(n);else if(0!==r){var a=s.toArray();for(let t=0;t<r;t++)(0,a[t])(n)}}isUnoccupied(t,e){return this.getPositions(!1,null,e||null).isUnoccupied(t.x,t.y,t.width,t.height)}computeOccupiedArea(t){return this.isVirtualized?this.viewportBounds.copy():this.ea?this.SA(t):t.c(this.documentBounds)}getPositions(t,e,i){let s=this._l,n=(null===s&&(this._l=s=new Ve(this.avoidanceCellSize)),e);if(s.Go||s.da!==n||s.BP!==i){if(s.zP=Math.max(s.Jf+1,Math.floor(this.avoidanceLimit/this.avoidanceCellSize.width)),s.XP=Math.max(s.Jf+1,Math.floor(this.avoidanceLimit/this.avoidanceCellSize.height)),null===(n=null!==n?this.UA(n):n)){for(var r=Z.a(),a=(this.computeOccupiedArea(r),r.inflate(100,100),s.R1(r),this.nodes);a.next();){var o=a.value,h=o.layer;null!==h&&h.visible&&!h.isTemporary&&this.YP(o,i,r)}Z.o(r)}else{0<n.memberParts.count&&((e=this.computePartsBounds(n.memberParts,!1)).inflate(20,20),s.R1(e));for(var l=Z.a(),u=n.memberParts;u.next();){var d=u.value;d instanceof D&&this.YP(d,i,l)}Z.o(l)}s.da=n,s.BP=i,s.Go=!1}else t&&s.GA();return s}get avoidanceCellSize(){return this.aP}set avoidanceCellSize(t){this._l=null,this.aP=new qt(Math.max(1,t.width),Math.max(1,t.height))}get avoidanceLimit(){return this.fP}set avoidanceLimit(t){this.fP=Math.max(1,t)}UA(t){return t.canAvoid()?t:null!==t.containingGroup?this.UA(t.containingGroup):null}YP(t,e,i){if(t!==e&&t.isVisible()){var s,n=t.canAvoid();if(n&&(s=t.getAvoidableRect(i),this._l.PR(s.x,s.y,s.width,s.height)),t instanceof j&&(!n||t.avoidableMembers))for(var r=t.memberParts;r.next();){var a=r.value;a instanceof D&&this.YP(a,e,i)}}}KP(t){null===this._l||this._l.Go||void 0!==t&&!t.canAvoid()||(this._l.Go=!0)}get autoScrollInterval(){return this.jm}set autoScrollInterval(t){var e=this.jm;Xt.r(t,K,"scale"),e!==t&&(this.jm=t,this.i("autoScrollInterval",e,t))}get autoScrollRegion(){return this.Jm}set autoScrollRegion(t){"number"==typeof t?t=new E(t):Xt.s(t,E,K,"autoScrollRegion");var e=this.Jm;e.equals(t)||(t=t.L(),this.Jm=t,this.invalidateDocumentBounds(),this.i("autoScrollRegion",e,t))}doAutoScroll(t){this.i0.c(t),this.computeAutoScrollPosition(this.i0).equalsApprox(this.position)?this.stopAutoScroll():this.HA()}HA(){if(-1===this.zf){const t=this.jm,e=this;this.zf=Xt.Xh(()=>{var t;-1===e.zf||(e.stopAutoScroll(),null===e.lastInput.event)||(t=e.computeAutoScrollPosition(e.i0)).equalsApprox(e.position)||(e.position=t,e.lastInput.documentPoint=e.transformViewToDoc(e.i0),e.doMouseMove(),e.ea=!0,t=Z.a(),e.computeBounds(t),t.unionRect(e.documentBounds),e.zA(t),Z.o(t),e.qe=!0,e.maybeUpdate(),e.HA())},t)}}stopAutoScroll(){-1!==this.zf&&(Xt.Gg(this.zf),this.zf=-1)}computeAutoScrollPosition(t){let e=this.position;var i,s,n,r,a=this.Jm;return a.top<=0&&a.left<=0&&a.right<=0&&a.bottom<=0||(s=this.viewportBounds,i=this.scale,s=Z.H(0,0,s.width*i,s.height*i),n=U.H(0,0),t.x>=s.x&&t.x<s.x+a.left&&this.allowHorizontalScroll?(r=Math.max(this.scrollHorizontalLineChange,1),n.x-=r|=0,t.x<s.x+a.left/2&&(n.x-=r),t.x<s.x+a.left/4&&(n.x-=4*r)):t.x<=s.x+s.width&&t.x>s.x+s.width-a.right&&this.allowHorizontalScroll&&(r=Math.max(this.scrollHorizontalLineChange,1),n.x+=r|=0,t.x>s.x+s.width-a.right/2&&(n.x+=r),t.x>s.x+s.width-a.right/4)&&(n.x+=4*r),t.y>=s.y&&t.y<s.y+a.top&&this.allowVerticalScroll?(r=Math.max(this.scrollVerticalLineChange,1),n.y-=r|=0,t.y<s.y+a.top/2&&(n.y-=r),t.y<s.y+a.top/4&&(n.y-=4*r)):t.y<=s.y+s.height&&t.y>s.y+s.height-a.bottom&&this.allowVerticalScroll&&(r=Math.max(this.scrollVerticalLineChange,1),n.y+=r|=0,t.y>s.y+s.height-a.bottom/2&&(n.y+=r),t.y>s.y+s.height-a.bottom/4)&&(n.y+=4*r),n.equalsApprox(U.To)||(e=new U(e.x+n.x/i,e.y+n.y/i)),Z.o(s),U.o(n)),e}makeSvg(t){this.ih.contains("SVG")||this.addRenderer("SVG",new Jt(this,v.document));const i=new Jt(this,v.document,!0),s=this;return this.qA(function(t,e){return t=null!==(t=s.vA(t,"SVG",i))?t.svg:null,"function"==typeof e?(e(t),null):t},t=void 0===t?{}:t)}makeSVG(t){return this.makeSvg(t)}addRenderer(t,e){this.ih.add(t,e)}removeRenderer(t){this.ih.remove(t)}cacheGroupExternalLinks(t){(this.wP=t)||this.nodes.each(t=>{t instanceof j&&(t.b0=null)})}qA(e,i){const s=i.callback;let n=!0;const r=this.eh.iterator;for(;r.next();)if(!r.value[0].Sn){n=!1;break}if("function"!=typeof s||n)return e(i,s,this);const a=this;function o(){var t=+new Date;for(n=!0,r.reset();r.next();)if(!r.value[0].Sn){n=!1;break}n||t-l>h?e(i,s,a):v.requestAnimationFrame(o)}const h=i.callbackTimeout||300,l=+new Date;return v.requestAnimationFrame(()=>o()),null}makeImage(t){return K.isUsingDOM()?((t=void 0===t?{}:t).returnType="Image",this.makeImageData(t)):null}makeImageData(t){return this.qA(this.NR,t=void 0===t?{}:t)}static img="image";NR(e,i,t){var s=t.vA(e,"canvas",null);if(null===s)return null;var n=s.Y.canvas;let r=null;if(null!==n){let t=e.returnType;switch(t=void 0===t?"string":t.toLowerCase()){case K.img+"data":r=s.getImageData(0,0,n.width,n.height);break;case K.img:var a=(e.document||document).createElement("img");a.src=n.toDataURL(e.type,e.details),r=a;break;case"blob":a=n;return"function"!=typeof i&&(r="",Xt.n('Error: Diagram.makeImageData called with "returnType: toBlob", but no required "callback" function property defined.')),"function"==typeof a.toBlob?(a.toBlob(i,e.type,e.details),"toBlob"):(i(null),null);default:r=n.toDataURL(e.type,e.details)}}return"function"==typeof i?(i(r),null):r}static WA=!1;vA(t,i,e){if(this.animationManager.stopAnimation(),this.maybeUpdate(),null===this.xt)return null;"object"!=typeof t&&Xt.n("properties argument must be an Object.");let s=!1,n=t.size||null,r=t.scale||null,a=(void 0!==t.scale&&isNaN(t.scale)&&(r="NaN"),t.maxSize);void 0===t.maxSize&&(s=!0,a="SVG"===i?new qt(1/0,1/0):new qt(2e3,2e3));var o=t.position||null;let h=t.parts||null,l=(Array.isArray(h)&&(h=new O(h)),void 0===t.padding?1:t.padding);var u=t.background||null;let d=t.omitTemporary;void 0===d&&(d=!0);var c=t.document||document,g=t.elementFinished||null;let m=t.showTemporary,f=(void 0===m&&(m=!d),t.showGrid);void 0===f&&(f=m),null!==n&&isNaN(n.width)&&isNaN(n.height)&&(n=null),"number"==typeof l?l=new E(l):l instanceof E||Xt.n("MakeImage padding must be a Margin or a number."),l.left=Math.max(l.left,0),l.right=Math.max(l.right,0),l.top=Math.max(l.top,0),l.bottom=Math.max(l.bottom,0),this.ai.clearContextCache(!0);var t=new $t(null,c,void 0,!0),p=t.gi;if(!(n||r||h||o))return t.width=this.Ct+Math.ceil(l.left+l.right),t.height=this.At+Math.ceil(l.top+l.bottom),"SVG"===i?null===e?null:(e.resize(t.width,t.height,t.width,t.height),e.ga=c,e.$u=g,this.T1(e.gi,l,new qt(t.width,t.height),this.v,this.lt,h,u,m,f),e.gi):(this.qu=!1,this.T1(p,l,new qt(t.width,t.height),this.v,this.lt,h,u,m,f),this.qu=!0,t.gi);var v=this.s0,y=this.documentBounds.copy();if(y.subtractMargin(this.ei),m){var x=this.Jt.h,A=x.length;for(let t=0;t<A;t++){var w=x[t];if(w.visible&&w.isTemporary){var b=w.It.h,P=b.length;for(let t=0;t<P;t++){var S=b[t];S.isInDocumentBounds&&S.isVisible()&&(S=S.actualBounds).isReal()&&y.unionRect(S)}}}}let k=new U(y.x,y.y);if(null!==h){var M=new Z(0,0,0,0);let t=!0;var N=h.iterator;for(N.reset();N.next();){var C,L=N.value;L instanceof Y&&(null!==(C=L.layer)&&!C.visible||null!==C&&!m&&C.isTemporary||!L.isVisible()||(C=L.actualBounds).isReal()&&(t?(t=!1,M.c(C)):M.unionRect(C)))}y.width=M.width,y.height=M.height,k.x=M.x,k.y=M.y}null!==o&&o.isReal()&&(k=o,r=r||v);let D=0,T=0,B=(null!==l&&(D=l.left+l.right,T=l.top+l.bottom),0),G=0,F=(null!==n&&(B=n.width,G=n.height,isFinite(B)&&(B=Math.max(0,B-D)),isFinite(G))&&(G=Math.max(0,G-T)),0),R=0;if(R=null!==n&&null!==r?("NaN"===r&&(r=v),n.isReal()?(F=B,G):isNaN(G)?(F=B,y.height*r):(F=y.width*r,G)):null!==n?n.isReal()?(r=Math.min(B/y.width,G/y.height),F=B,G):isNaN(G)?(r=B/y.width,F=B,y.height*r):(r=G/y.height,F=y.width*r,G):null!==r?"NaN"===r&&a.isReal()?((r=Math.min((a.width-D)/y.width,(a.height-T)/y.height))>v?(r=v,F=y.width,y):(F=a.width,a)).height:(F=y.width*r,y.height*r):(r=v,F=y.width,y.height),null!==l?(F+=D,R+=T):l=new E(0),null!==a){let t=a.width,e=a.height;"SVG"!==i&&s&&!K.WA&&(Yt,F>t||R>e)&&(Xt.ft("Diagram.makeImage(data): Diagram width or height is larger than the default max size. ("+Math.ceil(F)+"x"+Math.ceil(R)+" vs 2000x2000) Consider increasing the max size."),K.WA=!0),isNaN(t)&&(t=2e3),isNaN(e)&&(e=2e3),isFinite(t)&&(F=Math.min(F,t)),isFinite(e)&&(R=Math.min(R,e))}return t.width=Math.ceil(F),t.height=Math.ceil(R),"SVG"===i?null===e?null:(e.resize(t.width,t.height,t.width,t.height),e.ga=c,e.$u=g,this.T1(e.gi,l,new qt(Math.ceil(F),Math.ceil(R)),r,k,h,u,m,f),e.gi):(this.qu=!1,this.T1(p,l,new qt(Math.ceil(F),Math.ceil(R)),r,k,h,u,m,f),this.qu=!0,t.gi)}static Ju=null;static jA="5da73c80a36555d4038e4972187c3cae51fd22";static ww=!1;static Hk=()=>{if(void 0===K.jA[5]&&(H.prototype.rs=H.prototype.Pw),K.isUsingDOM()){var t=v.document.createElement("canvas"),e=t.getContext("2d"),i=Xt.Os("7ca11abfd022028846"),s=(e[i]=Xt.Os("398c3597c01238"),"7ca11abfd7330390"),n=[K.jA,Xt.ww+"4ae6247590da4bb21c324ba3a84e385776",H.Hk+"fb236cdfda5de14c134ba1a95a2d4c7cc6f93c1387",I.za];for(let t=1;t<5;t++)e[Xt.Os(s)](Xt.Os(n[t-1]),10,15*t+0);e[i]=Xt.Os("39f046ebb36e4b");for(let t=1;t<5;t++)e[Xt.Os(s)](Xt.Os(n[t-1]),10,15*t+0);4===n.length&&"5"===n[0][0]&&"7"===n[3][0]||(H.prototype.rs=H.prototype.Pw),K.Ju=t}}}class Gt{JA;ZA;UP;Ie;constructor(t){this.JA=null,this.ZA="63ad05bbe23a1786468a4c741b6d2",this.UP="@onz",this.ZA===this._tk?(this.UP=!0,this.Ie=this.UP):this.Ie=null}CR(t,e){let i="f";var s=v[Xt.Os("76a715b2f73f148a")][Xt.Os("72ba13b5")]||"",n=Xt.Os;if(this.Ie=!0,K.isUsingDOM())if(K[n("76a115b6ed251eaf4692")])for(var r=K.IP.iterator;r.next();){var a=n(r.value).split(n("39e9"));if(a.length<6)return;var o=n(a[1]).split(".");if("7da71ca0"!==a[4])return;var h=n(Xt[n("6cae19")]).split(".");if(o[0]>h[0]||o[0]===h[0]&&o[1]>=h[1]){var o="73a612b6fb191d",h=v[n("74a900bae4370f8b51")][n("6fbb13a1c2311e8a57")].toLowerCase(),l=h[n(o)](n("3aad1ab6e022098b4dc4")),u=n(a[2]);if(-1<l){h=h[n(o)](u.toLowerCase()+"/");if(this.Ie=!(-1<h&&h<l),!this.Ie)return}var d=s[n("76ad18b4f73e")];for(let t=s[n(o)](n("35e7"))+2;t<d;t++)i+=s[t];let t=i[n(o)](u);if((t=(t=(t=t<0&&u!==n("7da71ca0ad381e90")?i[n(o)](n("76a715b2ef3e149757")):t)<0?i[n(o)](n("76a715b2ef3e149757")):t)<0?i[n(o)](n("2bfa41fdb3784bca12")):t)<0&&(t=s[n(o)](n("7baa19a6f76c1988428554"))),this.Ie=!(0<=t&&t<i[n(o)](n("35"))||-1===i[n(o)](n("35"))),!this.Ie||s[n(o)](n("7fb002b6ed25128b4da25b2e"))&&(this.Ie=!(-1<s[n(o)](u)),!this.Ie))return;h=v[Xt.Os("76a715b2f73f148a")][Xt.Os("69ad17a1e03e")],l=h[n(o)](n("7fb002b6ed25128b4da25b2e"));if(-1<l&&(this.Ie=!(h[n(o)](u)>l),!this.Ie))return;h=u;if("#"===h[0]){o=v.document.createElement("div");let t=a[0].replace(/[A-Za-z]/g,"");for(;t.length<4;)t+="9";var l=t,c=(t=t.substring(t.length-4),""),u=["Header","Background","Display","Feedback"],c=(c+=["gsh","gsf"][parseInt(t.substring(0,1),10)%2])+u[parseInt(t.substring(0,1),10)%4];if(o[n("79a417a0f0181a8946")]=c,v.document[n("78a712aa")]){v.document[n("78a712aa")][n("7bb806b6ed32388c4a875b")](o);a=v.getComputedStyle(o).getPropertyValue(n("78a704b7e62456904c9b12701b6532a8")),u=v.getComputedStyle(o).getPropertyValue(n("75b817b0ea2202"));if(v.document[n("78a712aa")][n("68ad1bbcf533388c4a875b")](o),a){o=v[n("77a902b0eb1b1e804a8a")];if(u==="0."+parseInt(l,10)%100||-1!==a.indexOf(parseInt(h[1]+h[2],16))&&-1!==a.indexOf(parseInt(h[3]+h[4],16)))return void(this.Ie=!1);if(o&&o(n("32ae19a1e0331fc94084537c067a67fa59f1386b89d006")).matches){c="."+c;for(let t=0;t<document.styleSheets.length;t++){var g=document.styleSheets[t].rules||document.styleSheets[t].cssRules;for(const p in g)if(c===g[p].selectorText)return void(this.Ie=!1)}}}}else this.Ie=null,e&&(this.Ie=!1)}}}else{var m=s[n("76ad18b4f73e")];for(let t=s[n("73a612b6fb191d")](n("35e7"))+2;t<m;t++)i+=s[t];var f=i[n("73a612b6fb191d")](n("7da71ca0ad381e90"));this.Ie=!(0<=f&&f<i[n("73a612b6fb191d")](n("35")))}}Ju(t){return t.ai.setTransform(t.Gi,0,0,t.Gi,0,0),t.ai.commitTransform(),null===this.Ie&&this.CR(t,!0),0<this.Ie&&this!==this.JA}}class Ft{GP;HP;constructor(t){this.GP=void 0===t?new U:t,this.HP=new U}get point(){return this.GP}set point(t){this.GP=t}get shifted(){return this.HP}set shifted(t){this.HP=t}}class Rt{be;DA;D1;constructor(t,e,i){this.be=t,this.DA=e,this.D1=i}}class Ot{isGridSnapEnabled;isGridSnapRealtime;gridSnapCellSize;gridSnapCellSpot;gridSnapOrigin;dragsLink;dragsTree;groupsSnapMembers;groupsAlwaysMove;dragsMembers;constructor(t){this.ti(),t&&Object.assign(this,t)}ti(){this.isGridSnapEnabled=!1,this.isGridSnapRealtime=!0,this.gridSnapCellSize=new qt(NaN,NaN).w(),this.gridSnapCellSpot=J.TopLeft,this.gridSnapOrigin=new U(NaN,NaN).w(),this.dragsLink=!1,this.dragsTree=!1,this.groupsSnapMembers=!1,this.groupsAlwaysMove=!0,this.dragsMembers=!0}}class Et extends K{constructor(t,e){return"string"==typeof t||v.Element&&t instanceof Element?super(t):(super(),e=t),this.$A(),e&&this.setProperties(e),this}$A(){this.allowDragOut=!0,this.allowMove=!1,this.isReadOnly=!0,this.contentAlignment=J.TopCenter,this.layout=new ti}setupRouters(){}reset(){super.reset(),this.$A()}}class Ht extends K{I1;O1;E1;V1;k0;Zf;El;vP;qP;B1;WP;constructor(t,e){return"string"==typeof t||v.Element&&t instanceof Element?super(t):(super(),e=t),this.animationManager.isEnabled=!1,this.$t=!0,this.I1=null,this.Ku=!1,this.Uu=!1,this.O1=!0,this.E1=!0,this.V1=0,this.k0=!1,this.Zf=null,this.setRenderingHint("drawShadows",!1),this.El=new Y({selectable:!0,selectionAdorned:!1,selectionObjectName:"BOXSHAPE",locationObjectName:"BOXSHAPE",resizeObjectName:"BOXSHAPE",cursor:"move"}).add(new V({name:"BOXSHAPE",fill:"transparent",stroke:"magenta",strokeWidth:2}).theme("stroke","overviewBox")).ui(),this.allowCopy=!1,this.allowDelete=!1,this.allowSelect=!0,this.autoScrollRegion=new E(0,0,0,0),this.lt.e(0,0),this.toolManager.ii("Dragging",new It,this.toolManager.mouseMoveTools),this.click=()=>{var t,e,i=this.observed;null!==i&&(t=i.viewportBounds,e=this.lastInput.documentPoint,i.position=new U(e.x-t.width/2,e.y-t.height/2))},this.vP=t=>{this.invalidateDocumentBounds(),this.S0()},this.qP=t=>{null!==this.observed&&(this.invalidateDocumentBounds(),this.T())},this.B1=t=>{this.updateDelay<1?this.T():this.k0||(this.k0=!0,setTimeout(()=>this.redraw(),this.updateDelay))},this.WP=t=>{null!==this.observed&&this.S0()},this.autoScale=2,this.$t=!1,e&&Object.assign(this,e),this}setupRouters(){}computePixelRatio(){return 1}redraw(){this.k0&&1<=this.updateDelay&&(this.k0=!1,this.AR()),super.redraw()}Ji(){if(null===this.Ot&&Xt.n("No div specified"),null===this.xt&&Xt.n("No canvas specified"),!(this.xt instanceof Jt)&&(this.box.qM(),this.qe)){var t=this.observed;if(null!==t&&!t.animationManager.defaultAnimation.isAnimating&&t.Uh){this.m0();var t=this.xt,e=this.ai,i=(e.clearContextCache(!0),e.setTransform(1,0,0,1,0,0),e.clearRect(0,0,t.width,t.height),this.updateDelay<1?this.QA():null!==this.Zf&&(e.drawImage(this.Zf.Bt,0,0),(t=this.D).ti(),1!==this.scale&&t.v(this.scale),0===this.position.x&&0===this.position.y||t.se(-this.position.x,-this.position.y),e.scale(this.Gi,this.Gi),e.transform(t.m11,t.m12,t.m21,t.m22,t.dx,t.dy),e.commitTransform()),this.Jt.h),s=i.length;for(let t=0;t<s;t++)i[t].Ji(e,this);this.Kf=!1,this.qe=!1}}}AR(){var t,e=this.xt,i=this.ai;if(null!==e&&null!==i){this.m0(),null===this.Zf&&((t=new $t(null)).width=e.width,t.height=e.height,this.Zf=t);try{this.xt=this.Zf,this.ai=this.xt.gi,this.ai.clearContextCache(!0),this.ai.setTransform(1,0,0,1,0,0),this.ai.clearRect(0,0,this.xt.width,this.xt.height),this.QA()}finally{this.xt=e,this.ai=i}}}QA(){var t=this.observed;if(null!==t){var e=this.drawsTemporaryLayers,i=this.drawsGrid&&e,s=t.grid,s=(i&&null!==s&&s.visible&&!isNaN(s.width)&&!isNaN(s.height)&&(s=Z.a().c(this.viewportBounds).unionRect(t.viewportBounds),t._r(s),Z.o(s),t.Fi()),this.D),n=(s.ti(),1!==this.scale&&s.v(this.scale),0===this.position.x&&0===this.position.y||s.se(-this.position.x,-this.position.y),this.ai),r=(n.scale(this.Gi,this.Gi),n.transform(s.m11,s.m12,s.m21,s.m22,s.dx,s.dy),n.commitTransform(),this.viewportBounds),a=t.Jt.h,o=a.length;for(let t=0;t<o;t++)a[t].NF(n,r,this,e,i)}}get observed(){return this.I1}set observed(t){var e,i,s=this.I1;null!==t&&Xt.s(t,K,Ht,"observed"),t instanceof Ht&&Xt.n("Overview.observed Diagram may not be an Overview itself: "+t),s!==t&&(this.LR(s),this.I1=t,this.TR(t),this.invalidateDocumentBounds(),null===t?(this.Zf=null,e=this.xt,i=this.ai,e&&i&&(i.setTransform(1,0,0,1,0,0),i.clearRect(0,0,e.width,e.height))):(this.B1(null),this.S0(),this.T()),this.i("observed",s,t))}get box(){return this.El}set box(t){var e=this.El;e!==t&&(t.ui(),this.El=t,this.remove(e),this.add(this.El),this.S0(),this.i("box",e,t))}get drawsTemporaryLayers(){return this.O1}set drawsTemporaryLayers(t){this.O1!==t&&(this.O1=t,this.redraw())}get drawsGrid(){return this.E1}set drawsGrid(t){this.E1!==t&&(this.E1=t,this.redraw())}get updateDelay(){return this.V1}set updateDelay(t){this.V1!==(t=t<0?0:t)&&(this.V1=t)}TR(t){null!==t&&(t.addDiagramListener("ViewportBoundsChanged",this.vP),t.addDiagramListener("DocumentBoundsChanged",this.qP),t.addDiagramListener("InvalidateDraw",this.B1),t.addDiagramListener("AnimationFinished",this.WP),this.add(this.box))}LR(t){null!==t&&(this.remove(this.box),t.removeDiagramListener("ViewportBoundsChanged",this.vP),t.removeDiagramListener("DocumentBoundsChanged",this.qP),t.removeDiagramListener("InvalidateDraw",this.B1),t.removeDiagramListener("AnimationFinished",this.WP))}S0(){var t,e,i,s=this.box;null!==s&&null!==(t=this.observed)&&(this.qe=!0,t=t.viewportBounds,e=s.selectionObject,(i=qt.a()).e(t.width,t.height),e.desiredSize=i,qt.o(i),i=2/this.scale,e instanceof V&&(e.strokeWidth=i),s.location=new U(t.x-i/2,t.y-i/2),s.isSelected=!0)}computeBounds(){var t,e=this.observed;return null===e?Z.Xk:((t=e.documentBounds.copy()).unionRect(e.viewportBounds),t)}invalidateViewport(t,e){!0!==this.qe&&(this.qe=!0,this.requestUpdate())}onViewportBoundsChanged(t,e,i,s){this.$t||(this.oh(),this.T(),this.ca(),this.invalidateDocumentBounds(),this.S0(),this.Ui.scale=i,this.Ui.position.x=t.x,this.Ui.position.y=t.y,this.Ui.bounds.c(t),this.Ui.isScroll=s,this.V("ViewportBoundsChanged",this.Ui,t))}}class It extends d{lh;constructor(){super(),this.lh=null}canStart(){var t,e,i;return!!this.isEnabled&&!(null===(t=this.diagram)||!t.allowMove||!t.allowSelect||null===(e=t.observed)||!(i=t.lastInput).left||t.currentTool!==this&&(!this.isBeyondDragSize()||i.isTouchEvent&&i.timestamp-t.firstInput.timestamp<this.delay)||(null===this.findDraggablePart()&&(i=e.viewportBounds,this.lh=new U(i.width/2,i.height/2),i=t.firstInput.documentPoint,e.position=new U(i.x-this.lh.x,i.y-this.lh.y)),0))}doActivate(){this.lh=null,super.doActivate()}doUpdateCursor(t){var e=this.diagram,i=e.box;null!==i&&i.cursor&&(e.currentCursor=i.cursor)}moveParts(t,e,i){void 0===i&&(i=!1);var s,n,i=this.diagram,r=i.observed;null!==r&&null!==(s=i.box)&&(null===this.lh&&(n=i.firstInput.documentPoint,s=s.location,this.lh=new U(n.x-s.x,n.y-s.y)),n=i.lastInput.documentPoint,r.position=new U(n.x-this.lh.x,n.y-this.lh.y))}}class Kt{b;jP;JP;ZP;$P;QP;_P;t2;i2;hh;e2;z1;s2;X1;Y1;o2;Ho;l2;constructor(t){C.ji(this),this.b=K.Pm(),this.jP=!0,this.JP=!0,this.ZP=!0,this.$P=!1,this.QP=!1,this._P=!1,this.t2=!1,this.i2=null,this.hh=null,this.e2=1.05,this.z1=NaN,this.s2=null,this.X1=NaN,this.Y1=Z.Xk,this.o2=!1,this.Ho=null,this.l2=200,t&&Object.assign(this,t)}toString(){return"CommandHandler"}get diagram(){return this.b}Vo(t){this.b=t}doKeyDown(){var t=this.diagram,e=t.lastInput,i=Xt.dr?e.meta:e.control,s=e.shift,n=e.alt,r=e.code;!i||"KeyC"!==r&&"Insert"!==r?i&&"KeyX"===r||s&&"Delete"===r?this.canCutSelection()&&this.cutSelection():i&&"KeyV"===r||s&&"Insert"===r?this.canPasteSelection()&&this.pasteSelection():i&&"KeyY"===r||n&&s&&"Backspace"===r?this.canRedo()&&this.redo():i&&"KeyZ"===r||n&&"Backspace"===r?this.canUndo()&&this.undo():"Delete"===r||"Backspace"===r?this.canDeleteSelection()&&this.deleteSelection():i&&"KeyA"===r?this.canSelectAll()&&this.selectAll():"Escape"===r?this.canStopCommand()&&this.stopCommand():"ArrowUp"===r?t.allowVerticalScroll&&(i?t.scroll("pixel","up"):t.scroll("line","up")):"ArrowDown"===r?t.allowVerticalScroll&&(i?t.scroll("pixel","down"):t.scroll("line","down")):"ArrowLeft"===r?t.allowHorizontalScroll&&(i?t.scroll("pixel","left"):t.scroll("line","left")):"ArrowRight"===r?t.allowHorizontalScroll&&(i?t.scroll("pixel","right"):t.scroll("line","right")):"PageUp"===r?s&&t.allowHorizontalScroll?t.scroll("page","left"):t.allowVerticalScroll&&t.scroll("page","up"):"PageDown"===r?s&&t.allowHorizontalScroll?t.scroll("page","right"):t.allowVerticalScroll&&t.scroll("page","down"):"Home"===r?i&&t.allowVerticalScroll?t.scroll("document","up"):!i&&t.allowHorizontalScroll&&t.scroll("document","left"):"End"===r?i&&t.allowVerticalScroll?t.scroll("document","down"):!i&&t.allowHorizontalScroll&&t.scroll("document","right"):"Space"===r?this.canScrollToPart()&&this.scrollToPart():"Minus"===r||"NumpadSubtract"===r?this.canDecreaseZoom()&&this.decreaseZoom():"Equal"===r||"NumpadAdd"===r?this.canIncreaseZoom()&&this.increaseZoom():i&&"Digit0"===r?this.canResetZoom()&&this.resetZoom():s&&"KeyZ"===r?this.canZoomToFit()&&this.zoomToFit():i&&!s&&"KeyG"===r?this.canGroupSelection()&&this.groupSelection():i&&s&&"KeyG"===r?this.canUngroupSelection()&&this.ungroupSelection():"F2"===r?this.canEditTextBlock()&&this.editTextBlock():"ContextMenu"===r?this.canShowContextMenu()&&this.showContextMenu():e.bubbles=!0:this.canCopySelection()&&this.copySelection()}doKeyUp(){this.diagram.lastInput.bubbles=!0}stopCommand(){var t=this.diagram,e=t.currentTool;e instanceof st&&t.allowSelect&&t.clearSelection(),null!==e&&e.doCancel()}canStopCommand(){return!0}selectAll(){var t=this.diagram;t.T();try{t.currentCursor="wait",t.V("ChangingSelection",t.selection);for(var e=t.parts;e.next();){var i=e.value;i.canSelect()&&!i.layer.isTemporary&&(i.isSelected=!0)}for(var s=t.nodes;s.next();){var n=s.value;n.canSelect()&&!n.layer.isTemporary&&(n.isSelected=!0)}for(var r=t.links;r.next();){var a=r.value;a.canSelect()&&!a.layer.isTemporary&&(a.isSelected=!0)}}finally{t.V("ChangedSelection",t.selection),t.currentCursor=""}}canSelectAll(){return this.diagram.allowSelect}deleteSelection(){var t=this.diagram;try{t.currentCursor="wait",t.V("ChangingSelection",t.selection),t.startTransaction("Delete"),t.V("SelectionDeleting",t.selection);for(var e=new C,i=t.selection.iterator;i.next();){var s=i.value;Y.ah(e,s,!0,this.deletesTree?1/0:0,!!this.deletesConnectedLinks&&null,t=>t.canDelete())}t.removeParts(e,!0),t.V("SelectionDeleted",e)}finally{t.commitTransaction("Delete"),t.V("ChangedSelection",t.selection),t.currentCursor=""}}canDeleteSelection(){var t=this.diagram;return!(t.isReadOnly||t.isModelReadOnly||!t.allowDelete||0===t.selection.count)}copySelection(){for(var t=this.diagram,e=new C,i=t.selection.iterator;i.next();){var s=i.value;Y.ah(e,s,!0,this.copiesTree?1/0:0,this.copiesConnectedLinks,t=>t.canCopy())}this.copyToClipboard(e)}canCopySelection(){var t=this.diagram;return!(!t.allowCopy||!t.allowClipboard||0===t.selection.count)}cutSelection(){this.copySelection(),this.deleteSelection()}canCutSelection(){var t=this.diagram;return!(t.isReadOnly||t.isModelReadOnly||!t.allowCopy||!t.allowDelete||!t.allowClipboard||0===t.selection.count)}copyToClipboard(s){var n=this.diagram;let r=null;if(null===s)K.pA();else{var a=n.model;let t=!1,e=!1,i=null;try{a.Qu()&&(t=a.copiesParentKeyOfNodeData,a.copiesParentKeyOfNodeData=this.copiesParentKey),(a.bf()||a._u())&&(e=a.copiesGroupKeyOfNodeData,a.copiesGroupKeyOfNodeData=this.copiesGroupKey),i=n.copyParts(s,null,!0)}finally{a.Qu()&&(a.copiesParentKeyOfNodeData=t),(a.bf()||a._u())&&(a.copiesGroupKeyOfNodeData=e),(r=new O).addAll(i.iteratorValues),K.c0=r,K.A1=n.model.dataFormat}}n.V("ClipboardChanged",r)}pasteFromClipboard(){var s=new C,n=K.c0;if(null!==n){var r=this.diagram;if(K.A1===r.model.dataFormat){var a=r.model;let t=!1,e=!1,i=null;try{a.Qu()&&(t=a.copiesParentKeyOfNodeData,a.copiesParentKeyOfNodeData=this.copiesParentKey),(a.bf()||a._u())&&(e=a.copiesGroupKeyOfNodeData,a.copiesGroupKeyOfNodeData=this.copiesGroupKey),i=r.copyParts(n,r,!1)}finally{a.Qu()&&(a.copiesParentKeyOfNodeData=t),(a.bf()||a._u())&&(a.copiesGroupKeyOfNodeData=e);for(var o=i.iterator;o.next();){var h=o.value,l=o.key;h.location.isReal()||(l.location.isReal()?h.location=l.location:!h.position.isReal()&&l.position.isReal()&&(h.position=l.position)),s.add(h)}}}}return s}pasteSelection(t){void 0===t&&(t=null);var e=this.diagram;try{e.currentCursor="wait",e.V("ChangingSelection",e.selection),e.startTransaction("Paste");for(var i,s,n=this.pasteFromClipboard(),r=(0<n.count&&e.clearSelection(!0),n.iterator);r.next();)r.value.isSelected=!0;null!==t&&(i=e.computePartsBounds(e.selection)).isReal()&&(s=this.computeEffectiveCollection(e.selection,e.M1),e.LS(s,new U(t.x-i.centerX,t.y-i.centerY),e.M1,!1)),e.V("ClipboardPasted",n)}finally{e.commitTransaction("Paste"),e.V("ChangedSelection",e.selection),e.currentCursor=""}}canPasteSelection(t){var e=this.diagram;return!(e.isReadOnly||e.isModelReadOnly||!e.allowInsert||!e.allowClipboard||null===K.c0||0===K.c0.count||K.A1!==e.model.dataFormat)}undo(){this.diagram.undoManager.undo()}canUndo(){var t=this.diagram;return!t.isReadOnly&&!t.isModelReadOnly&&t.allowUndo&&t.undoManager.canUndo()}redo(){this.diagram.undoManager.redo()}canRedo(){var t=this.diagram;return!t.isReadOnly&&!t.isModelReadOnly&&t.allowUndo&&t.undoManager.canRedo()}decreaseZoom(t){void 0===t&&(t=1/this.zoomFactor),Xt.r(t,Kt,"decreaseZoom:factor");var e=this.diagram;1!==e.autoScale||(t=e.scale*t)<e.minScale||t>e.maxScale||(e.scale=t)}canDecreaseZoom(t){void 0===t&&(t=1/this.zoomFactor),Xt.r(t,Kt,"canDecreaseZoom:factor");var e=this.diagram;return 1===e.autoScale&&!((t=e.scale*t)<e.minScale||t>e.maxScale)&&e.allowZoom}increaseZoom(t){void 0===t&&(t=this.zoomFactor),Xt.r(t,Kt,"increaseZoom:factor");var e=this.diagram;1!==e.autoScale||(t=e.scale*t)<e.minScale||t>e.maxScale||(e.scale=t)}canIncreaseZoom(t){void 0===t&&(t=this.zoomFactor),Xt.r(t,Kt,"canIncreaseZoom:factor");var e=this.diagram;return 1===e.autoScale&&!((t=e.scale*t)<e.minScale||t>e.maxScale)&&e.allowZoom}resetZoom(t){void 0===t&&(t=this.defaultScale),Xt.r(t,Kt,"resetZoom:newscale");var e=this.diagram;t<e.minScale||t>e.maxScale||(e.scale=t)}canResetZoom(t){void 0===t&&(t=this.defaultScale),Xt.r(t,Kt,"canResetZoom:newscale");var e=this.diagram;return!(t<e.minScale||t>e.maxScale)&&e.allowZoom}zoomToFit(){var t=this.diagram,e=t.animationManager,i=(e.stopAnimation(),t.redraw(),t.position),s=t.scale;e.zl("Zoom To Fit"),this.isZoomToFitRestoreEnabled&&s===this.X1&&!isNaN(this.z1)&&t.documentBounds.equals(this.Y1)?(t.scale=this.z1,t.position=this.s2,this.X1=NaN,this.Y1=Z.Xk):(this.z1=s,this.s2=i.copy(),t.zoomToFit(),this.X1=t.scale,this.Y1=t.documentBounds.copy()),e.FM()}canZoomToFit(){return this.diagram.allowZoom}scrollToPart(t){null!==(t=void 0===t?null:t)&&Xt.s(t,Y,Kt,"part");const e=this.diagram;if(e.ensureBounds(),null===t){try{null!==this.Ho&&(this.Ho.next()?t=this.Ho.value:this.Ho=null)}catch{this.Ho=null}null===t&&(0<e.highlighteds.count?this.Ho=e.highlighteds.iterator:0<e.selection.count&&(this.Ho=e.selection.iterator),null!==this.Ho)&&this.Ho.next()&&(t=this.Ho.value)}if(null!==t){const s=e.animationManager,n=(s.zl("Scroll To Part"),this.scrollToPartPause);if(0<n){const r=this.$f(t,[t]);if(1===r.length)e.startTransaction(),e.centerRect(t.actualBounds),e.commitTransaction("Scroll To Part");else{const a=()=>{e.startTransaction();let t=r.pop();for(;0<r.length&&t instanceof D&&t.isTreeExpanded&&(!(t instanceof j)||t.isSubGraphExpanded);)t=r.pop();0<r.length?(t instanceof Y&&e.scrollToRect(t.actualBounds),t instanceof D&&!t.isTreeExpanded&&(t.isTreeExpanded=!0),t instanceof j&&!t.isSubGraphExpanded&&(t.isSubGraphExpanded=!0)):(t instanceof Y&&e.centerRect(t.actualBounds),e.removeDiagramListener("LayoutCompleted",o)),e.commitTransaction("Scroll To Part")},o=()=>{Xt.Xh(a,(s.isEnabled?s.duration:0)+n)};e.addDiagramListener("LayoutCompleted",o),a()}}else{var i=e.position.copy();e.centerRect(t.actualBounds),i.equalsApprox(e.position)&&s.stopAnimation()}}}$f(t,e){var i;return t.isVisible()||(t instanceof X?this.$f(t.adornedPart,e):t instanceof q?(null!==(i=t.fromNode)&&this.$f(i,e),null!==(i=t.toNode)&&this.$f(i,e)):(t instanceof D&&(null!==(i=t.labeledLink)&&this.$f(i,e),null!==(i=t.findTreeParentNode()))&&(i.isTreeExpanded||i.wasTreeExpanded||e.push(i),this.$f(i,e)),null!==(i=t.containingGroup)&&(i.isSubGraphExpanded||i.wasSubGraphExpanded||e.push(i),this.$f(i,e)))),e}canScrollToPart(t){return(null===(t=void 0===t?null:t)||t instanceof Y)&&(0!==(t=this.diagram).selection.count||0!==t.highlighteds.count)&&t.allowHorizontalScroll&&t.allowVerticalScroll}collapseTree(t){void 0===t&&(t=null);var e=this.diagram,i="Collapse Tree";try{e.startTransaction(i),e.animationManager.zl(i);var s=new O;if(null!==t&&t.isTreeExpanded)t.collapseTree(),s.add(t);else if(null===t)for(var n=e.selection.iterator;n.next();){var r=n.value;r instanceof D&&r.isTreeExpanded&&(r.collapseTree(),s.add(r))}e.V("TreeCollapsed",s)}finally{e.commitTransaction(i)}}canCollapseTree(t){void 0===t&&(t=null);var e=this.diagram;if(!e.isReadOnly)if(null!==t){if(!(t instanceof D&&t.isTreeExpanded))return!1;if(0<t.findTreeChildrenLinks().count)return!0}else for(var i=e.selection.iterator;i.next();){var s=i.value;if(s instanceof D&&s.isTreeExpanded&&0<s.findTreeChildrenLinks().count)return!0}return!1}expandTree(t){void 0===t&&(t=null);var e=this.diagram,i="Expand Tree";try{e.startTransaction(i),e.animationManager.zl(i);var s=new O;if(null===t||t.isTreeExpanded){if(null===t)for(var n=e.selection.iterator;n.next();){var r=n.value;r instanceof D&&(r.isTreeExpanded||(r.expandTree(),s.add(r)))}}else t.expandTree(),s.add(t);e.V("TreeExpanded",s)}finally{e.commitTransaction(i)}}canExpandTree(t){void 0===t&&(t=null);var e=this.diagram;if(!e.isReadOnly)if(null!==t){if(!(t instanceof D)||t.isTreeExpanded)return!1;if(0<t.findTreeChildrenLinks().count)return!0}else for(var i=e.selection.iterator;i.next();){var s=i.value;if(s instanceof D&&!s.isTreeExpanded&&0<s.findTreeChildrenLinks().count)return!0}return!1}groupSelection(){var i=this.diagram,s=i.model;if(s.ma()){var n=this.archetypeGroupData;if(null!==n){let t=null;try{i.currentCursor="wait",i.V("ChangingSelection",i.selection),i.startTransaction("Group");for(var e=new O,r=i.selection.iterator;r.next();){var a=r.value;a.De()&&a.canGroup()&&e.add(a)}for(var o,h=new O,l=e.iterator;l.next();){var u=l.value;let t=!1;for(var d=e.iterator;d.next();){var c=d.value;if(u.isMemberOf(c)){t=!0;break}}t||h.add(u)}if(0<h.count){let e=h.first().containingGroup;if(null!==e)for(;null!==e;){let t=!1;for(var g=h.iterator;g.next();)if(!g.value.isMemberOf(e)){t=!0;break}if(!t)break;e=e.containingGroup}if(n instanceof j?(n.ui(),null!==(t=n.copy())&&i.add(t)):s.isGroupForData(n)&&(o=s.copyNodeData(n),Xt.Mt(o))&&(s.addNodeData(o),t=i.findNodeForData(o)),null!==t){null!==e&&this.isValidMember(e,t)&&(t.containingGroup=e);for(var m=h.iterator;m.next();){var f=m.value;this.isValidMember(t,f)&&(f.containingGroup=t)}i.clearSelection(!0),t.isSelected=!0}}i.V("SelectionGrouped",t)}finally{i.commitTransaction("Group"),i.V("ChangedSelection",i.selection),i.currentCursor=""}}}}canGroupSelection(){var t=this.diagram;if(!t.isReadOnly&&!t.isModelReadOnly&&t.allowInsert&&t.allowGroup&&t.model.ma()&&null!==this.archetypeGroupData)for(var e=t.selection.iterator;e.next();){var i=e.value;if(i.De()&&i.canGroup())return!0}return!1}h2(t){const i=Xt.ct();if(Array.isArray(t))t.forEach(t=>{t instanceof q||t instanceof Y&&i.push(t)});else for(var e=t.iterator;e.next();){var s=e.value;s instanceof q||s instanceof Y&&i.push(s)}var n=new C,r=i.length;for(let t=0;t<r;t++){var a=i[t];let e=!0;for(let t=0;t<r;t++)if(a.isMemberOf(i[t])){e=!1;break}e&&n.add(a)}return Xt.ot(i),n}isValidMember(t,e){if(null===e||t===e||e instanceof q)return!1;let i;return(null===t||!(t===e||t.isMemberOf(e)||null!==(i=t.memberValidation)&&!i(t,e)||null===t.data&&null!==e.data||null!==t.data&&null===e.data))&&(null===(i=this.memberValidation)||i(t,e))}ungroupSelection(t){void 0===t&&(t=null);var e=this.diagram,i=e.model;if(i.ma())try{e.currentCursor="wait",e.V("ChangingSelection",e.selection),e.startTransaction("Ungroup");var s=new O;if(null!==t)s.add(t);else for(var n=e.selection.iterator;n.next();){var r=n.value;r instanceof j&&r.canUngroup()&&s.add(r)}var a=new O;if(0<s.count){e.clearSelection(!0);for(var o=s.iterator;o.next();){for(var h=o.value,l=(h.expandSubGraph(),h.containingGroup),u=null!==l&&null!==l.data?i.getKeyForNodeData(l.data):void 0,d=(a.addAll(h.memberParts),a.iterator);d.next();){var c,g=d.value;g.isSelected=!0,g instanceof q||(null!==(c=g.data)?i.setGroupForData(c,u):g.containingGroup=l)}e.remove(h)}}e.V("SelectionUngrouped",s,a)}finally{e.commitTransaction("Ungroup"),e.V("ChangedSelection",e.selection),e.currentCursor=""}}canUngroupSelection(t){void 0===t&&(t=null);var e=this.diagram;if(!e.isReadOnly&&!e.isModelReadOnly&&e.allowDelete&&e.allowUngroup&&e.model.ma())if(null!==t){if(!(t instanceof j))return!1;if(t.canUngroup())return!0}else for(var i=e.selection.iterator;i.next();){var s=i.value;if(s instanceof j&&s.canUngroup())return!0}return!1}addTopLevelParts(t,e){let i=!0;for(var s=this.h2(t).iterator;s.next();){var n=s.value;null!==n.containingGroup&&(!e||this.isValidMember(null,n)?n.containingGroup=null:i=!1)}return i}collapseSubGraph(t){void 0===t&&(t=null);var e=this.diagram,i="Collapse SubGraph";try{e.startTransaction(i),e.animationManager.zl(i);var s=new O;if(null!==t&&t.isSubGraphExpanded)t.collapseSubGraph(),s.add(t);else if(null===t)for(var n=e.selection.iterator;n.next();){var r=n.value;r instanceof j&&r.isSubGraphExpanded&&(r.collapseSubGraph(),s.add(r))}e.V("SubGraphCollapsed",s)}finally{e.commitTransaction(i)}}canCollapseSubGraph(t){void 0===t&&(t=null);var e=this.diagram;if(!e.isReadOnly){if(null!==t)return!!(t instanceof j&&t.isSubGraphExpanded);for(var i=e.selection.iterator;i.next();){var s=i.value;if(s instanceof j&&s.isSubGraphExpanded)return!0}}return!1}expandSubGraph(t){void 0===t&&(t=null);var e=this.diagram,i="Expand SubGraph",s=new O;try{if(e.startTransaction(i),e.animationManager.zl(i),null===t||t.isSubGraphExpanded){if(null===t)for(var n=e.selection.iterator;n.next();){var r=n.value;r instanceof j&&(r.isSubGraphExpanded||(r.expandSubGraph(),s.add(r)))}}else t.expandSubGraph(),s.add(t);e.V("SubGraphExpanded",s)}finally{for(const a of s)this._A(e,a);t&&this._A(e,t),e.commitTransaction(i)}}_A(t,e){for(const i of e.memberParts)i instanceof D&&t.Ff(i,e)}canExpandSubGraph(t){void 0===t&&(t=null);var e=this.diagram;if(!e.isReadOnly){if(null!==t)return!(!(t instanceof j)||t.isSubGraphExpanded);for(var i=e.selection.iterator;i.next();){var s=i.value;if(s instanceof j&&!s.isSubGraphExpanded)return!0}}return!1}editTextBlock(e){null!==(e=void 0===e?null:e)&&Xt.s(e,z,Kt,"editTextBlock");var i=this.diagram,t=i.toolManager.findTool("TextEditing");if(null!==t){if(null===e){let t=null;for(var s=i.selection.iterator;s.next();){var n=s.value;if(n.canEdit()){t=n;break}}if(null===t)return;e=t.findInVisualTree(t=>t instanceof z&&t.editable)}null!==e&&(i.currentTool=null,t.textBlock=e,i.currentTool=t)}}canEditTextBlock(t){void 0===t&&(t=null);var e=this.diagram;if(!e.isReadOnly&&!e.isModelReadOnly&&e.allowTextEdit&&null!==e.toolManager.findTool("TextEditing"))if(null!==t){if(!(t instanceof z))return!1;var i=t.part;if(null!==i&&i.canEdit())return!0}else for(var s=e.selection.iterator;s.next();){var n=s.value;if(n.canEdit()&&null!==(t=n.findInVisualTree(t=>t instanceof z&&t.editable)))return!0}return!1}showContextMenu(e){var i=this.diagram,s=i.toolManager.findTool("ContextMenu");if(null!==s){void 0===e&&(e=0<i.selection.count?i.selection.first():i);e=s.findObjectWithContextMenu(e);if(null!==e){var n,r=i.lastInput;let t=null;e instanceof y?t=e.getDocumentPoint(J.Center):i.viewportBounds.containsPoint(r.documentPoint)||(n=i.viewportBounds,t=new U(n.x+n.width/2,n.y+n.height/2)),null!==t&&(r.viewPoint=i.transformDocToView(t),r.documentPoint=t,r.left=!1,r.right=!0,r.up=!0),(i.currentTool=s).openMenu(!1,e)}}}canShowContextMenu(t){var e=this.diagram,i=e.toolManager.findTool("ContextMenu");return!(null===i||(void 0===t&&(t=0<e.selection.count?e.selection.first():e),null===i.findObjectWithContextMenu(t)))}get copiesClipboardData(){return this.jP}set copiesClipboardData(t){Xt.t(t,"boolean",Kt,"copiesClipboardData"),this.jP=t}get copiesConnectedLinks(){return this.JP}set copiesConnectedLinks(t){Xt.t(t,"boolean",Kt,"copiesConnectedLinks"),this.JP=t}get deletesConnectedLinks(){return this.ZP}set deletesConnectedLinks(t){Xt.t(t,"boolean",Kt,"deletesConnectedLinks"),this.ZP=t}get copiesTree(){return this.$P}set copiesTree(t){Xt.t(t,"boolean",Kt,"copiesTree"),this.$P=t}get deletesTree(){return this.QP}set deletesTree(t){Xt.t(t,"boolean",Kt,"deletesTree"),this.QP=t}get copiesParentKey(){return this._P}set copiesParentKey(t){Xt.t(t,"boolean",Kt,"copiesParentKey"),this._P=t}get copiesGroupKey(){return this.t2}set copiesGroupKey(t){Xt.t(t,"boolean",Kt,"copiesGroupKey"),this.t2=t}get archetypeGroupData(){return this.i2}set archetypeGroupData(t){null!==t&&Xt.t(t,"object",Kt,"archetypeGroupData");var e=this.diagram,e=(Yt,e.model);!e.ma()||t instanceof j||e.isGroupForData(t)||Xt.n("CommandHandler.archetypeGroupData must be either a Group or a data object for which GraphLinksModel.isGroupForNodeData is true: "+t),this.i2=t}get memberValidation(){return this.hh}set memberValidation(t){null!==t&&Xt.t(t,"function",Kt,"memberValidation"),this.hh=t}get defaultScale(){return this.diagram.defaultScale}set defaultScale(t){this.diagram.defaultScale=t}get zoomFactor(){return this.e2}set zoomFactor(t){Xt.r(t,Kt,"zoomFactor"),1<t||Xt.n("zoomFactor must be larger than 1.0, not: "+t),this.e2=t}get isZoomToFitRestoreEnabled(){return this.o2}set isZoomToFitRestoreEnabled(t){Xt.t(t,"boolean",Kt,"isZoomToFitRestoreEnabled"),this.o2=t}get scrollToPartPause(){return this.l2}set scrollToPartPause(t){Xt.r(t,Kt,"scrollToPartPause"),this.l2=t}computeEffectiveCollection(e,i){var s=this.diagram,t=s.toolManager.findTool("Dragging"),n=s.currentTool===t,r=(void 0===i&&(i=s.y0()),new L);if(null!==e){let t=e.iterator;for(;t.next();){var a=t.value;s.el(r,a,n,i)}if(null===s.draggedLink||!i.dragsLink)for(t=e.iterator;t.next();){var o,h=t.value;h instanceof q&&(null!==(o=h.fromNode)&&!r.contains(o)||null!==(o=h.toNode)&&!r.contains(o))&&r.remove(h)}}return r}}(i={})[i.None=0]="None",i[i.Default=1]="Default",i[i.Vertical=4]="Vertical",i[i.Horizontal=5]="Horizontal",i[i.Fill=2]="Fill";var Vt=i,zt=((i={})[i.None=0]="None",i[i.Along=21]="Along",i[i.Plus90=22]="Plus90",i[i.Minus90=23]="Minus90",i[i.Opposite=24]="Opposite",i[i.Upright=25]="Upright",i[i.Plus90Upright=26]="Plus90Upright",i[i.Minus90Upright=27]="Minus90Upright",i[i.Upright45=28]="Upright45",i),Qt=((i={})[i.None=0]="None",i[i.Vertical=1]="Vertical",i[i.Horizontal=2]="Horizontal",i[i.Both=3]="Both",i);class y{l;td;ed;vo;g;fh;$;lt;ce;_t;sd;vs;Ft;We;nl;ch;Ni;Qf;v;qt;ol;Ri;Hi;nd;fi;_f;Ut;hi;rl;a2;od;constructor(){C.ji(this),this.l=30723,this._t=1,this.sd="",this.vs=null,this.Ft=null,this.lt=new U(NaN,NaN).w(),this.We=qt.xw,this.nl=new H,this.ch=new H,this.Ni=null,this.Qf=1,this.v=1,this.qt=0,this.ol=E.qg,this.ce=new Z(NaN,NaN,NaN,NaN).w(),this.Ri=new Z(NaN,NaN,NaN,NaN).w(),this.Hi=new Z(0,0,NaN,NaN).w(),this.nd=null,this.td=null,this.$=null,this.fi=J.Default,this._f=J.Default,this.ed=0,this.vo=0,this.Ut=null,this.g=null,this.fh=null,this.hi=null,this.a2=null,this.rl=null,this.od=null}cloneProtected(t){t.l=-32769&(6144|this.l),t._t=this._t,t.sd=this.sd,t.Ft=this.Ft,t.lt.c(this.lt),t.We=this.We.L(),null!==this.Ni?t.Ni=this.Ni.copy():t.Ni=null,t.v=this.v,t.qt=this.qt,t.ol=this.ol.L(),t.ce.c(this.ce),t.Ri.c(this.Ri),t.Hi.c(this.Hi),t.td=this.td,null!==this.$&&(t.$=this.$.copy()),t.fi=this.fi.L(),t._f=this._f.L(),t.ed=this.ed,t.vo=this.vo,null!==this.Ut&&(t.Ut=this.Ut.copy()),null!==this.g&&(this.g.xi?t.g=this.g:t.g=this.g.copy()),null!==this.fh&&(t.fh=this.fh.slice()),null!==this.hi&&(t.hi=this.hi.copy())}addCopyProperty(e){let i=this.fh;if(Array.isArray(i)){for(let t=0;t<i.length;t++)if(i[t]===e)return}else i=[],this.fh=i;i.push(e)}qo(t){t.nd=null,t.rl=null,t.u()}clone(){var e=new this.constructor;if(this.cloneProtected(e),null!==this.fh)for(let t=0;t<this.fh.length;t++){var i=this.fh[t];e[i]=this[i]}return e}copy(){return this.clone()}Tm(){var t=this.Ii;if(null!==t){this.Ii=null;for(const e of t)e.rd()&&(e.isToData?this.themeData(e.targetProperty,e.sourceProperty,e.themeSource,e.converter,e.themeConverter):e.isToObject?this.themeObject(e.targetProperty,e.sourceProperty,e.themeSource,e.converter,e.themeConverter,e.sourceName):e.isToModel?this.themeModel(e.targetProperty,e.sourceProperty,e.themeSource,e.converter,e.themeConverter):this.theme(e.targetProperty,e.sourceProperty,e.themeSource,e.converter,e.themeConverter))}return this}ci(t){t in zt?this.segmentOrientation=t:t in Vt?this.stretch=t:Xt.gr(this,t)}toString(){return Xt.an(this.constructor)+"#"+C.ps(this)}static None=0;static Default=1;static Fill=2;static Vertical;static Horizontal;static Uniform=6;static UniformToFill=7;static FlipVertical=1;static FlipHorizontal=2;static FlipBoth=3;uh(){null!==this.g&&(this.g.xi=!0)}Zt(){null===this.g?this.g=new Ut:this.g.xi&&(this.g=this.g.copy())}je(){var t;null===this.$&&((t=new Xe).pa=J.None,t.ya=J.None,t.wa=10,t.xa=10,t.ba=0,t.ka=0,this.$=t)}raiseChangedEvent(e,i,t,s,n,r,a){var o=this.part;if(null!==o){o.tc(e,i,t,s,n,r,a),t===this&&2===e&&this.ic()&&this.Sa(o,i);r=this.diagram;if(null!==this.Ns&&null!==r&&r.Uh&&!r.undoManager.isUndoingRedoing&&!r.animationManager.Nu){var h,a=this.Ns.get(i);if(null!==a&&r.animationManager.isEnabled&&!r.animationManager.isTicking){null===this.od&&(this.od=new L);let t=0===r.undoManager.transactionLevel;2===a.startCondition?t=!0:3===a.startCondition&&(t=!1),t?(e=new kt,a.SF(e),null!==(h=this.od.get(a))&&h.stop(),this.od.add(a,e),e.xx=this,e.zM=a,e.add(this,i,s,n),e.start()):r.animationManager.getBundleAnimation().add(this,i,s,n)}}if(this instanceof jt&&t===o&&o.f2()&&null!==o.data){var l=this.F.h,u=l.length;for(let t=0;t<u;t++){var d=l[t];d instanceof jt&&d.il(t=>{null!==t.data&&t.f2()&&t.updateTargetBindings(i)})}}}}wF(t){this.od.remove(t)}Uo(){if(null!==this.diagram&&null===this.findBindingPanel()&&null!==this.Ii)for(var t=this.Ii.iterator;t.next();){var i=t.value;if(i.isToTheme){let t=null;var s=i.sourceName;i.isToObject&&(t=this.tL(s));let e=this;var n=i.targetId;-1!==n&&null===(e=this.M0(n))||("/"===s?t=e.part:"."===s?t=e:".."===s&&(t=e.panel),i.updateTarget(e,t))}}}Sa(e,i){var s=this.findBindingPanel();if(null!==s)for(var n=this.Ii.iterator;n.next();){var r,a=n.value;let t=null;if(a.isToObject){if(null===(t=a.iL(s,this)))continue;a.updateSource(this,t,i,null)}else if(a.isToModel){var o=e.diagram;null===o||o.xe||a.updateSource(this,o.model.modelData,i,s)}else if(!a.isToTheme){o=s.data;if(null===o)continue;var h=e.diagram;null===h||h.xe||a.updateSource(this,o,i,s)}t===this&&(h=a.targetId,null!==(r=s.M0(h)))&&a.updateTarget(r,t,i)}}M0(t){return this.so===t?this:null}tL(t){let e;return""===t||"/"===t||"."===t||".."===t?e=this:null===(e=this.part.findObject(t))&&(Yt,Xt.ft("Binding error: missing GraphObject named "+t+" in "+this.part.toString())),e}get so(){return null!==this.g?this.g.so:-1}set so(t){this.so!==t&&(null===this.g&&(this.g=new Ut),this.g.so=t)}get Ii(){return null!==this.g?this.g.Ii:null}set Ii(t){this.Ii!==t&&(null===this.g&&(this.g=new Ut),this.g.Ii=t)}get no(){return null!==this.g?this.g.no:null}set no(t){this.no!==t&&(null===this.g&&(this.g=new Ut),this.g.no=t)}raiseChanged(t,e,i){this.raiseChangedEvent(2,t,this,e,i)}i(t,e,i){this.raiseChangedEvent(2,t,this,e,i)}oo(t,e,i,s){var n,r=this.ce;r.e(t,e,i,s),1===this.v&&0===this.qt||(null===this.Ni&&(this.Ni=new H),(n=this.Ni).ti(),this.P0(n,t,e,i,s),n.Nw(r))}eL(t,e,i){return!1!==this.pickable&&(i.hf(this.D),e?this.intersectsRect(t,i):this.containedInRect(t,i))}sL(t,e,i){var s;return!1!==this.pickable&&(s=this.naturalBounds,e=t.distanceSquaredPoint(e),i?U.distanceLineSegmentSquared(t.x,t.y,0,0,0,s.height)<=e||U.distanceLineSegmentSquared(t.x,t.y,0,s.height,s.width,s.height)<=e||U.distanceLineSegmentSquared(t.x,t.y,s.width,s.height,s.width,0)<=e||U.distanceLineSegmentSquared(t.x,t.y,s.width,0,0,0)<=e:t.distanceSquared(0,0)<=e&&t.distanceSquared(0,s.height)<=e&&t.distanceSquared(s.width,0)<=e&&t.distanceSquared(s.width,s.height)<=e)}Mn(){return!0}containsPoint(t){Yt,Xt.s(t,U,y,"containsPoint:p");var e=U.a(),i=(e.c(t),this.D.Pt(e),this.actualBounds);if(!i.isReal())return U.o(e),!1;var s=this.diagram;if(null!==s&&s.r0){var n=s.getInputOption("extraTouchThreshold"),r=s.getInputOption("extraTouchArea"),a=r/2,o=this.naturalBounds,s=this.getDocumentScale()*s.scale,h=1/s;if(o.width*s<n&&o.height*s<n)return o=Z.contains(i.x-a*h,i.y-a*h,i.width+r*h,i.height+r*h,e.x,e.y),U.o(e),o}let l=!1;return(this instanceof X||this instanceof V?Z.contains(i.x-5,i.y-5,i.width+10,i.height+10,e.x,e.y):i.containsPoint(e))&&(l=!(this.hi&&!this.hi.containsPoint(e))&&(!(null===this.Ft||!this.Hi.containsPoint(t))||this.dh(t))),U.o(e),l}dh(t){var e=this.naturalBounds;return Z.contains(0,0,e.width,e.height,t.x,t.y)}containsRect(t){if(0===this.angle)return this.actualBounds.containsRect(t);var e=this.naturalBounds,e=Z.H(0,0,e.width,e.height),i=this.D;let s=!1;var n=U.H(t.x,t.y);return e.containsPoint(i.rs(n))&&(n.e(t.x,t.bottom),e.containsPoint(i.rs(n)))&&(n.e(t.right,t.bottom),e.containsPoint(i.rs(n)))&&(n.e(t.right,t.y),e.containsPoint(i.rs(n)))&&(s=!0),U.o(n),Z.o(e),s}containedInRect(t,e){if(Yt,Xt.s(t,Z,y,"containedInRect:r"),void 0===e)return t.containsRect(this.actualBounds);var i=this.naturalBounds;let s=!1;var n=U.H(0,0);return t.containsPoint(e.Pt(n))&&(n.e(0,i.height),t.containsPoint(e.Pt(n)))&&(n.e(i.width,i.height),t.containsPoint(e.Pt(n)))&&(n.e(i.width,0),t.containsPoint(e.Pt(n)))&&(s=!0),U.o(n),s}intersectsRect(t,e){if(Yt,Xt.s(t,Z,y,"intersectsRect:r"),void 0===e&&(e=this.D,0===this.angle))return t.intersectsRect(this.actualBounds);var i,s=this.naturalBounds,n=U.H(0,0),r=U.H(0,s.height),a=U.H(s.width,s.height),o=U.H(s.width,0);let h=!1;return t.containsPoint(e.Pt(n))||t.containsPoint(e.Pt(r))||t.containsPoint(e.Pt(a))||t.containsPoint(e.Pt(o))?h=!0:(s=Z.H(0,0,s.width,s.height),i=U.H(t.x,t.y),(s.containsPoint(e.rs(i))||(i.e(t.x,t.bottom),s.containsPoint(e.rs(i)))||(i.e(t.right,t.bottom),s.containsPoint(e.rs(i)))||(i.e(t.right,t.y),s.containsPoint(e.rs(i))))&&(h=!0),U.o(i),Z.o(s),h||(I.Lw(t,n,r)||I.Lw(t,r,a)||I.Lw(t,a,o)||I.Lw(t,o,n))&&(h=!0)),U.o(n),U.o(r),U.o(a),U.o(o),h}getDocumentPoint(t,e){var i,s;return void 0===e&&(e=new U),t instanceof J?(i=t,Yt,i.isNoSpot()&&Xt.n("getDocumentPoint:s Spot must be specific: "+i.toString()),s=this.naturalBounds,e.e(i.x*s.width+i.offsetX,i.y*s.height+i.offsetY)):e.set(t),this.Ms.Pt(e),e}getDocumentBounds(t){void 0===t&&(t=new Z);var e=this.naturalBounds,i=this.Ms,s=U.H(0,0).D(i);return t.e(s.x,s.y,0,0),s.e(e.width,0).D(i),t.unionNoCheck(s.x,s.y,0,0),s.e(e.width,e.height).D(i),t.unionNoCheck(s.x,s.y,0,0),s.e(0,e.height).D(i),t.unionNoCheck(s.x,s.y,0,0),U.o(s),t}getDocumentAngle(){return this.Ms.ID()}getDocumentScale(){var t;return!1===this.N0()?this.Qf:(t=this.v,null!==this.panel?t*this.panel.getDocumentScale():t)}getLocalPoint(t,e){return(e=void 0===e?new U:e).c(t),this.Ms.rs(e),e}getNearestIntersectionPoint(t,e,i){return this.ec(t.x,t.y,e.x,e.y,i)}ec(t,e,i,s,n){var r=this.D,a=1/(r.m11*r.m22-r.m12*r.m21),o=r.m22*a,h=-r.m12*a,l=-r.m21*a,u=r.m11*a,d=a*(r.m21*r.dy-r.m22*r.dx),a=a*(r.m12*r.dx-r.m11*r.dy),c=t*o+e*l+d,t=t*h+e*u+a,e=i*o+s*l+d,o=i*h+s*u+a,l=(n.e(0,0),this.naturalBounds),d=I.Ml(0,0,l.width,l.height,c,t,e,o,n);return n.D(r),d}wt(i,s,n,r){if(!1!==this.Ko()){var a=this.ol,o=a.right+a.left,a=a.top+a.bottom,o=(i=Math.max(i-o,0),s=Math.max(s-a,0),n=n||0,r=r||0,n=Math.max(n-o,0),r=Math.max(r-a,0),this.angle),a=this.desiredSize,h=this.K1();s=90===o||270===o?(i=isFinite(a.height)?a.height+h:i,isFinite(a.width)?a.width+h:s):(i=isFinite(a.width)?a.width+h:i,isFinite(a.height)?a.height+h:s);let t=n||0,e=r||0;var l=this instanceof jt;switch(this.qs(!0)){case 0:t=0,e=0,l&&(s=i=1/0);break;case 2:isFinite(i)&&n<i&&(t=i),isFinite(s)&&r<s&&(e=s);break;case 5:isFinite(i)&&n<i&&(t=i),e=0,l&&(s=1/0);break;case 4:isFinite(s)&&r<s&&(e=s),t=0,l&&(i=1/0)}var a=this.maxSize,h=this.minSize;t>a.width&&h.width<a.width&&(t=a.width),e>a.height&&h.height<a.height&&(e=a.height),n=Math.max(t,h.width),r=Math.max(e,h.height),a.width<n&&(n=Math.min(h.width,n)),a.height<r&&(r=Math.min(h.height,r)),i=Math.min(a.width,i),s=Math.min(a.height,s),i=Math.max(n,i),s=Math.max(r,s),90!==o&&270!==o||(h=i,i=s,s=h,h=n,n=r,r=h),this.ce.ut(),this.ld(i,s,n,r),this.ce.w(),this.ce.isReal()||Xt.n("Non-real measuredBounds has been set. Object "+this+", measuredBounds: "+this.ce.toString()),this.ae(!1)}}ld(t,e,i,s){}Ws(){return!1}vt(e,i,s,n,r){this.hd();var t=Z.a();t.c(this.Ri),this.Ri.ut(),!1===this.hs()?this.Ri.e(e,i,s,n):this.gh(e,i,s,n),this.Ri.w(),this.hi=void 0===r?null:r;let a=!1;if(void 0!==r)a=!0;else{let t=this.panel;null!==(t=null!==t&&t.ll()?t.panel:t)&&(s=t.Hi,r=i+(n=this.measuredBounds).height,n=e+n.width,a=!(0<=e+.05&&n<=s.width+.05&&0<=i+.05&&r<=s.height+.05),this instanceof z)&&(e=this.naturalBounds,this.C0>e.height||this.bi>e.width)&&(a=!0)}a?this.l|=256:this.l&=-257,this.Ri.isReal()||Xt.n("Non-real actualBounds has been set. Object "+this+", actualBounds: "+this.Ri.toString()),this.ad(t,this.Ri),this.ro(!1),Z.o(t)}gh(t,e,i,s){}commonArrange(e,i,s,n){if(this.Ri.e(e,i,s,n),!this.desiredSize.isReal()){var e=this.ce,i=this.ol,r=i.right+i.left,i=i.top+i.bottom,a=e.width+r,o=e.height+i;s+=r,n+=i;let t=this.qs(!0);switch(t=a===s&&o===n?0:t){case 0:(s<a||n<o)&&(this.ae(!0),this.wt(s<a?s:a,n<o?n:o,0,0));break;case 2:this.ae(!0),this.wt(s,n,0,0);break;case 5:this.ae(!0),this.wt(s,o,0,0);break;case 4:this.ae(!0),this.wt(a,n,0,0)}}}ad(t,e){var i=this.part;null===i||null===i.diagram||(i.selectionObject!==this&&i.resizeObject!==this&&i.rotateObject!==this||i.c2(!0),this.T(),t.equalsApproxClose(e))||(i.mh(),this.A0(i))}A0(t){null!==this.portId&&(t.c2(!0),t instanceof D)&&t.nL(this)}get shadowVisible(){return null!==this.g?this.g.L0:null}set shadowVisible(t){var e=this.shadowVisible;e!==t&&(Yt,null!==t&&Xt.t(t,"boolean",y,"shadowVisible"),this.Zt(),this.g.L0=t,this.fs(!0),this.T(),this.i("shadowVisible",e,t))}DR(t,e){var i,s,n,r=this.naturalBounds,a=this.ch,o=a.m11,h=a.m21,l=a.dx,u=a.m12,d=a.m22,a=a.dy,c=0*o+0*h+l,g=0*u+0*d+a,m=(i=(y=r.width+e)*o+0*h+l,s=y*u+0*d+a,Math.min(c,i)),f=Math.min(g,s),p=Math.max(c+0,i)-m,v=Math.max(g+0,s)-f,c=m,g=f,y=(i=(y=r.width+e)*o+(n=r.height+e)*h+l,s=y*u+n*d+a,m=Math.min(c,i),f=Math.min(g,s),p=Math.max(c+p,i)-m,v=Math.max(g+v,s)-f,c=m,g=f,i=0*o+(n=r.height+e)*h+l,s=0*u+n*d+a,m=Math.min(c,i),f=Math.min(g,s),p=Math.max(c+p,i)-m,v=Math.max(g+v,s)-f,g=f,t.viewportBounds),o=y.x,r=y.y,e=y.width,h=y.height;return e+o<(c=m)||p+c<o||h+r<f||v+f<r}Ji(a,i){if(!this.FR(a,i)&&this.visible){var o=this.opacity;if(0!==o){let n=1,r=(1!==o&&(n=a.globalAlpha,a.globalAlpha=n*o),"");""!==this.filter&&(r=a.filter,a.filter=this.filter);var s=this.D,h=this.panel,l=(!0===this.N0()&&this.U1(),this.part);let e=!1,t=0;l&&i.getRenderingHint("drawShadows")&&(e=l.isShadowed)&&(u=l.shadowOffset,t=Math.max(u.y,u.x)*i.scale*i.Gi);var u=this instanceof jt&&this.ll(),d=this.Ri;if(u&&(this.oL(e,a,!1,h),this.RR(a,i),this.rL(e,a,!1,h),this.lL(e,a,!1)),!u&&0!==d.width&&0!==d.height&&!isNaN(d.x)&&!isNaN(d.y)){u=this.Ws();if(i.sa||!u||!this.DR(i,t)){let t=0!=(256&this.l);if(a.clipInsteadOfFill&&(t=!1),this instanceof z&&(a.font=this.font),t){var c=h.Mn()?h.naturalBounds:h.actualBounds;let t=Math.max(d.x,c.x),e=Math.max(d.y,c.y),i=Math.min(d.right,c.right)-t,s=Math.min(d.bottom,c.bottom)-e;var g=this.hi;if(null!==g&&(t=g.x,e=g.y,i=g.width,s=g.height),t>d.width+d.x||d.x>c.width+c.x)return 1!==o&&(a.globalAlpha=n),void(""!==this.filter&&(a.filter=r));a.save(),a.beginPath(),a.rect(t,e,i,s),a.clip()}if(u){if(!l.isVisible())return 1!==o&&(a.globalAlpha=n),void(""!==this.filter&&(a.filter=r));e&&(g=l.shadowOffset,a.shadowsSet(g.x*i.scale*this.scale*i.Gi,g.y*i.scale*this.scale*i.Gi,l.shadowBlur),a.shadowsOn(),a.shadowColor=l.shadowColor)}c=this.naturalBounds;a.transform(s.m11,s.m12,s.m21,s.m22,s.dx,s.dy),this.oL(e,a,u,h),null!==this.Ft&&(a.commitTransform(),this.G1(a,c,d)),this.rL(e,a,u,h),this.ph(a,i),this.lL(e,a,u),t&&(a.restore(),a.clearContextCache(this instanceof jt)),s.Gk()||(g=1/(s.m11*s.m22-s.m12*s.m21),a.transform(s.m22*g,-s.m12*g,-s.m21*g,s.m11*g,g*(s.m21*s.dy-s.m22*s.dx),g*(s.m12*s.dx-s.m11*s.dy)))}}1!==o&&(a.globalAlpha=n),""!==this.filter&&(a.filter=r)}}}oL(t,e,i,s){t&&!0===this.shadowVisible?e.shadowsOn():t&&!1===this.shadowVisible&&e.shadowsOff(),t&&this.H1(s)&&null===this.shadowVisible&&e.shadowsOff()}rL(t,e,i,s){t&&(null!==this.Ft||this.H1(s))?(this.v1(!0),null===this.shadowVisible&&e.shadowsOff()):this.v1(!1)}lL(t,e,i){t&&!0===this.u2()&&e.shadowsOn(),i&&t&&e.shadowsOff()}IR(t,e,i){var s=this.part;let n=!1;s&&t.getRenderingHint("drawShadows")&&(n=s.isShadowed),e.clipInsteadOfFill&&(n=!1),this.Ws()&&n&&e.shadowsOn(),n&&!0===this.shadowVisible?e.shadowsOn():n&&!1===this.shadowVisible&&e.shadowsOff();s=this.panel;return n&&this.H1(s)&&null===this.shadowVisible&&e.shadowsOff(),e.hl&&(t=t.computePixelRatio(),t=`drop-shadow(${e.shadowOffsetX/t}px ${e.shadowOffsetY/t}px ${e.shadowBlur/t/2}px ${e.shadowColor})`,null!==this.background)&&i.Ft.setAttributeNS(null,"filter",t),n&&(null!==this.Ft||this.H1(s))?(this.v1(!0),null===this.shadowVisible&&e.shadowsOff()):this.v1(!1),n}OR(t,e,i,s){i.hl&&(e=e.computePixelRatio(),e=`drop-shadow(${i.shadowOffsetX/e}px ${i.shadowOffsetY/e}px ${i.shadowBlur/e/2}px ${i.shadowColor})`,this.d2(t,e)),s&&!0===this.u2()&&i.shadowsOn(),this.Ws()&&i.shadowsOff()}H1(t){return null!==t&&((t=t.ll()?t.panel:t).u2()||(t.type===jt.Auto||t.type===jt.Spot)&&t.findMainElement()!==this)}d2(t,e){}G1(t,e,i){var s=this.K1(),n=e.x,r=e.y,a=e.width+s,o=e.height+s;this.bn(t,this.Ft,!0,!1,e,i),this.Ft instanceof m&&3===this.Ft.type?(t.beginPath(),t.rect(n-s/2,r-s/2,a,o),t.fillContext(this.Ft,!1,null)):t.fillRect(n-s/2,r-s/2,a,o)}hL(t,e){let i=t.ER(this);if(-1!==i)if(0===i)t.svg.Ft?t.svg.Ft.after(e):t.type===jt.Table?null!==(s=0!==(s=t.svg.getElementsByClassName("gojs-ts")).length?s[0]:null)&&s.after(e):t.svg.prepend(e);else{for(;0!==i&&!t.elt(i-1).isVisibleObject();)i--;var s;0===i?t.svg.prepend(e):null!==(s=t.elt(i-1).svg)?s.after(e):t.svg.appendChild(e)}}FR(t,e){var i,s,n,r,a,o,h;return t instanceof _t&&(!this.visible||0===this.opacity||this.Ws()&&!this.isVisible()?null!==this.svg&&null!==this.svg.parentNode&&this.svg.remove():(i=this.panel,a=this.fd(t),this.sc(t,e,a)?(this.aL(this.svg),null!==this.svg.parentElement?this.Ws()&&(t.lastDrawnPart=this.svg):this.Ws()?(null!==t.lastDrawnPart?t.lastDrawnPart.after(this.svg):t.diagramGroup.prepend(this.svg),t.lastDrawnPart=this.svg):i&&this.hL(i,this.svg)):(this.Ws()&&this.isShadowed&&(r=this.shadowOffset,t.shadowsSet(r.x*e.scale*this.scale*e.Gi,r.y*e.scale*this.scale*e.Gi,this.shadowBlur),t.shadowsOn(),t.shadowColor=this.shadowColor),this instanceof z&&(t.font=this.font),t.currentElement=null,r=this.D,h=this instanceof jt,o=this instanceof jt&&this.ll(),s=this.svg,!0===this.N0()&&this.U1(),n=this.Ri,t.setCurrentTransform(1,0,0,1,0,0),t.outerGroup=!1,a&&(t.outerGroup=!0,h&&o?(t.newGroup(1,0,0,1,0,0),this.svg=t.lastCreatedElement):h?(t.newGroup(r.m11,r.m12,r.m21,r.m22,r.dx,r.dy),this.svg=t.lastCreatedElement):t.newGroup(1,0,0,1,0,0)),a=this.naturalBounds,h||t.setCurrentTransform(r.m11,r.m12,r.m21,r.m22,r.dx,r.dy),null!==this.background&&(h?(o&&t.setCurrentTransform(r.m11,r.m12,r.m21,r.m22,r.dx,r.dy),this.G1(t,a,n),o&&t.setCurrentTransform(1,0,0,1,0,0)):(t.setCurrentTransform(r.m11,r.m12,r.m21,r.m22,r.dx,r.dy),this.G1(t,a,n)),t.currentElement.Ft=t.lastCreatedElement,t.currentElement.prepend(t.lastCreatedElement)),o=this.IR(e,t,t.currentElement),this.ph(t,e),h&&t.endGroup(),t.outerGroup&&t.endGroup(),r=t.surface.$u,a=h?this.svg:t.currentElement,h||null===s||a===s||s.parentNode!==this.panel.svg?(this.svg=a,null!==r&&null===a&&t.dummyGroup(),null!==a&&(this.T0(t,i,n,a),this.OR(a,e,t,o),1!==(h=this.Ws()?this.opacity*t.globalAlpha:this.opacity)&&a.setAttributeNS(null,"opacity",h.toString()),""!==this.filter&&a.setAttributeNS(null,"filter",this.filter),this.Ws()?(null!==s&&a!==s&&s.parentNode===t.diagramGroup?(null!==(e=s.getAttribute("filter"))&&a.setAttribute("filter",e),s.replaceWith(a)):t.lastDrawnPart?t.lastDrawnPart.after(a):t.diagramGroup.prepend(a),t.lastDrawnPart=a):null!==i&&this.hL(i,a),null!==r&&r(this,a),this.aL(a))):(null!==(o=this.svg.getAttribute("filter"))&&a.setAttribute("filter",o),this.svg.replaceWith(a),null!==(this.svg=a)&&this.T0(t,i,n,a),this.fL(t,s)))),!0)}aL(t){var e=this,t=t.dataset;e instanceof y&&(null!==e.portId&&(t.portId=e.portId),e instanceof jt)&&(isNaN(e.itemIndex)||(t.itemIndex=e.itemIndex.toString()),e instanceof Y)&&(t.className=Xt.an(e),void 0!==e.key&&(t.key=e.key.toString()),e instanceof q)&&(null!==e.fromNode&&void 0!==e.fromNode.key&&(t.fromKey=e.fromNode.key.toString()),""!==e.fromPortId&&(t.fromPortId=e.fromPortId),null!==e.toNode&&void 0!==e.toNode.key&&(t.toKey=e.toNode.key.toString()),""!==e.toPortId)&&(t.toPortId=e.toPortId)}T0(r,a,o,h){let t=0!=(256&this.l);if(t=r.clipInsteadOfFill?!1:t){a=a.Mn()?a.naturalBounds:a.actualBounds;let t=Math.max(o.x,a.x),e=Math.max(o.y,a.y),i=Math.min(o.right,a.right)-t,s=Math.min(o.bottom,a.bottom)-e;var l,u,o=this.hi,a=(null!==o&&(t=o.x,e=o.y,i=o.width,s=o.height),h.getAttribute("clip-path"));let n=null;null===(n=null!==a?r.svg.getElementById(a.split("#")[1].slice(0,-1)):n)?(o="CLIP"+C.fu++,a=r.makeElement("clipPath",{id:o}),l=r.makeElement("rect",{x:t,y:e,width:i,height:s}),this instanceof jt&&(u=this.D.copy().Mw(),l.setAttribute("transform",`matrix(${u.m11}, ${u.m12}, ${u.m21}, ${u.m22}, ${u.dx}, ${u.dy})`)),a.appendChild(l),r.svg.appendChild(a),h.setAttributeNS(null,"clip-path","url(#"+o+")")):((u=n.firstElementChild).setAttribute("x",t.toString()),u.setAttribute("y",e.toString()),u.setAttribute("width",i.toString()),u.setAttribute("height",s.toString()))}else h.removeAttributeNS(null,"clip-path"),this.fL(r,h)}fL(t,e){e=e.getAttribute("clip-path");null!==e&&null!==(t=t.svg.getElementById(e.split("#")[1].slice(0,-1)))&&t.remove()}VR(){if(null!==this.svg){var t=this.svg.innerHTML.match(/url\(#((CLIP|GRAD).+?)\)/g),e=this.svg.ownerDocument;if(null!==t)for(const s of t){var i=e.getElementById(s.split("#")[1].slice(0,-1));null!==i&&i.remove()}this.svg.remove()}}RR(t,e){var i=this.Ri,s=this.Hi,n=this.Ft;null!==n&&t.commitTransform(),null!==n&&(this.bn(t,n,!0,!1,s,i),n instanceof m&&3===n.type?(t.beginPath(),t.rect(i.x,i.y,i.width,i.height),t.fillContext(n,!1,null)):t.fillRect(i.x,i.y,i.width,i.height)),this.ph(t,e)}ph(t,e){}g2(){this.fs(!0)}sc(t,e,i){var s=this.svg;if(this.BR())return this.g2(),this.fs(!1),null!==s&&(null!==(r=this.svg.getAttribute("clip-path"))&&null!==(a=t.svg.getElementById(r.split("#")[1].slice(0,-1))))&&a.remove(),!1;if(null===s)return!1;if(!this.visible)return s.remove(),!1;if("g"!==s.nodeName&&i||"g"===s.nodeName&&!i)return!1;var n=this.D,r=this instanceof jt,a=this instanceof jt&&this.ll();if(!r||!a)if(this instanceof Le){r=this.q1;t.setCurrentTransform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),null!==r&&t.amendImageTransform(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7]),(i?s.lastElementChild:s).setAttributeNS(null,"transform",t.getCurrentTransform())}else if(!i||this instanceof jt)s.setAttributeNS(null,"transform","matrix("+n.m11+", "+n.m12+", "+n.m21+", "+n.m22+", "+n.dx+", "+n.dy+")");else if(this instanceof V){var o=s.getElementsByTagName("path");for(let t=0;t<o.length;t++)o[t].setAttributeNS(null,"transform","matrix("+n.m11+", "+n.m12+", "+n.m21+", "+n.m22+", "+n.dx+", "+n.dy+")")}else(s.lastElementChild||s).setAttributeNS(null,"transform","matrix("+n.m11+", "+n.m12+", "+n.m21+", "+n.m22+", "+n.dx+", "+n.dy+")");var r=this.Ws()?this.opacity*t.globalAlpha:this.opacity;return 1===r?s.removeAttribute("opacity"):s.setAttributeNS(null,"opacity",r.toString()),t.setCurrentTransform(1,0,0,1,0,0),null===this.background&&void 0===s.Ft||(r=s.Ft,null===this.background?(t.removeOldGradient(this,s.Ft,"fill"),s.Ft.remove(),s.Ft=void 0):(!a&&(!i||this instanceof jt)||t.setCurrentTransform(n.m11,n.m12,n.m21,n.m22,n.dx,n.dy),this.G1(t,this.naturalBounds,this.actualBounds),s.Ft?(t.removeOldGradient(this,s.Ft,"fill"),null!==(a=s.Ft.getAttribute("filter"))&&t.lastCreatedElement.setAttribute("filter",a),s.Ft.replaceWith(t.lastCreatedElement)):s.prepend(t.lastCreatedElement),s.Ft=t.lastCreatedElement),r&&t.removeOldGradient(this,r,"fill")),this.T0(t,this.panel,this.actualBounds,s),!0}fd(t){if(null!==this.background)return!0;let e=0!=(256&this.l);return!!(e=t.clipInsteadOfFill?!1:e)}static cE(e,i,s,t,n,r,a){let o=.001;var h=r.length;e.moveTo(i,s);let l=t-i;var t=n-s,u=t/(l=0===l?.001:l);let d=Math.sqrt(l*l+t*t),c=0,g=!0,m=(o=r[c%h],0!==a);for(;.1<=d;){if(m){for(o=r[c++%h],o-=a;o<0;)o+=r[c++%h],g=!g;m=!1}else o=r[c++%h];o>d&&(o=d);let t=Math.sqrt(o*o/(1+u*u));i+=t=l<0?-t:t,s+=u*t,g?e.lineTo(i,s):e.moveTo(i,s),d-=o,g=!g}}bn(l,u,d,c,g,m){let f=1,p=1;if("string"==typeof u)d?l.fillStyle=u:l.strokeStyle=u;else if(1===u.type)d?l.fillStyle=u.color:l.strokeStyle=u.color;else{let h;var v=this.K1(),g=(f=g.width,p=g.height,c?(f=m.width,p=m.height):d||(f+=v,p+=v),l instanceof te);if(g&&u.Pn&&(4===u.type||u.nc===f&&u.W1===p))h=u.Pn;else{let t,e,i,s,n=0,r=0,a=0,o=0;if(c?(a=m.x,o=m.y):d||(a-=v/2,o-=v/2),t=u.start.x*f+u.start.offsetX+a,e=u.start.y*p+u.start.offsetY+o,i=u.end.x*f+u.end.offsetX+a,s=u.end.y*p+u.end.offsetY+o,2===u.type)h=l.createLinearGradient(t,e,i,s);else if(3===u.type)r=isNaN(u.endRadius)?Math.max(f,p)/2:u.endRadius,isNaN(u.startRadius)?(n=0,r=Math.max(f,p)/2):n=u.startRadius,h=l.createRadialGradient(t,e,n,i,s,r);else if(4===u.type)try{h=l.createPattern(u.pattern,"repeat")}catch{h=null}else Xt.Bi(u.type,"Brush type");if(4!==u.type){c=u.colorStops;if(null!==c)for(var y=c.iterator;y.next();)h.addColorStop(y.key,y.value)}if(g&&(null!==(u.Pn=h)&&(u.nc=f,u.W1=p),null===h)&&4===u.type&&-1!==u.nc){u.nc=-1;const x=this.diagram;null!==x&&-1===u.nc&&Xt.Xh(()=>{x.redraw()},600)}}d?l.fillStyle=h:l.strokeStyle=h}}isContainedBy(t){return t instanceof jt&&this.zR(this,t)}zR(e,i){if(e!==i&&null!==i){let t=e.panel;for(;null!==t;){if(t===i)return!0;t=t.panel}}return!1}isVisibleObject(){var t;return!!this.visible&&(null===(t=this.panel)||t.isVisibleObject())}isEnabledObject(){let t=this instanceof jt?this:this.panel;for(;null!==t&&t.isEnabled;)t=t.panel;return null===t}get enabledChanged(){return null!==this.g?this.g.D0:null}set enabledChanged(t){var e=this.enabledChanged;e!==t&&(null!==t&&Xt.t(t,"function",y,"enabledChanged"),this.Zt(),this.g.D0=t,this.i("enabledChanged",e,t))}U1(){if(!0===this.j1()){var t=this.nl;if(t.ti(),!this.Ri.isReal()||!this.ce.isReal())return void this.cd(!1);t.se(this.Ri.x-this.ce.x,this.Ri.y-this.ce.y),1===this.scale&&0===this.angle||(e=this.naturalBounds,this.P0(t,e.x,e.y,e.width,e.height)),this.cd(!1),this.Ma(!0)}var e;!0===this.N0()&&(null===(t=this.panel)?(this.ch.set(this.nl),this.Qf=this.scale):null!==t.Ms&&((e=this.ch).ti(),t.Mn()?e.hf(t.ch):null!==t.panel&&e.hf(t.panel.ch),e.hf(this.nl),this.Qf=this.scale*t.Qf),this.Ma(!1))}P0(t,e,i,s,n){var r;1!==this.v&&t.v(this.v),0!==this.qt&&((r=U.a()).setSpot(e,i,s,n,J.Center),t.ys(this.qt,r.x,r.y),U.o(r))}u(t){var e;this.Ko()||(void 0===t&&(t=!1),this.ae(!0),this.ro(!0),null===(e=this.panel))||t||e.u()}oc(){this.Ko()||(this.ae(!0),this.ro(!0))}rc(t){var e;this.hs()||(e=this.panel,t||null===e||e.u(),this.ro(!0))}hd(){!1===this.j1()&&(this.cd(!0),this.Ma(!0))}m2(){this.Ma(!0)}T(){var t=this.part;null!==t&&t.T()}qs(t){var e=this.stretch,i=this.panel;return null!==i&&i.type===jt.Table?this.F0(i.getRowDefinition(this.row),i.getColumnDefinition(this.column),t):null!==i&&i.type===jt.Auto&&i.findMainElement()===this?this.Wo(2,t):1===e?null!==i?i.type===jt.Spot&&i.findMainElement()===this?this.Wo(2,t):1===(i=i.defaultStretch)?this.Wo(0,t):this.Wo(i,t):this.Wo(0,t):this.Wo(e,t)}F0(t,e,i){var s=this.stretch;if(1!==s)return this.Wo(s,i);let n=null,r=null;switch(t.stretch){case 1:case 5:break;case 4:case 2:r=!0}switch(e.stretch){case 1:case 4:break;case 5:case 2:n=!0}s=this.panel.defaultStretch;return null===n&&(n=5===s||2===s),null===r&&(r=4===s||2===s),!0===n&&!0===r?this.Wo(2,i):!0===n?this.Wo(5,i):!0===r?this.Wo(4,i):this.Wo(0,i)}Wo(t,e){if(!e){if(0===t)return 0;e=this.desiredSize;if(e.isReal())return 0;var i=!isNaN(e.width),e=!isNaN(e.height),s=this.angle;if(i)if(90!==s&&270!==s){if(5===t)return 0;if(2===t)return 4}else{if(4===t)return 0;if(2===t)return 5}if(e)if(90!==s&&270!==s){if(4===t)return 0;if(2===t)return 5}else{if(5===t)return 0;if(2===t)return 4}}return t}get segmentOrientation(){return null!==this.Ut?this.Ut.R0:0}set segmentOrientation(t){var e=this.segmentOrientation;e!==t&&(Yt,Xt.it(t,zt,"Orientation"),null===this.Ut&&(this.Ut=new qe),this.Ut.R0=t,this.u(),this.i("segmentOrientation",e,t),0===t)&&(this.angle=0)}XR(){this.segmentOrientation=21}get segmentIndex(){return null!==this.Ut?this.Ut.I0:-1/0}set segmentIndex(t){Yt,Xt.t(t,"number",y,"segmentIndex"),t=Math.round(t);var e=this.segmentIndex;e!==t&&(null===this.Ut&&(this.Ut=new qe),this.Ut.I0=t,this.u(),this.i("segmentIndex",e,t))}get segmentFraction(){return null!==this.Ut?this.Ut.O0:0}set segmentFraction(t){Yt,Xt.t(t,"number",y,"segmentFraction"),isNaN(t)||t<0?t=0:1<t&&(t=1);var e=this.segmentFraction;e!==t&&(null===this.Ut&&(this.Ut=new qe),this.Ut.O0=t,this.u(),this.i("segmentFraction",e,t))}get segmentOffset(){return null!==this.Ut?this.Ut.E0:U.To}set segmentOffset(t){var e=this.segmentOffset;e.equals(t)||(Yt,Xt.s(t,U,y,"segmentOffset"),t=t.L(),null===this.Ut&&(this.Ut=new qe),this.Ut.E0=t,this.u(),this.i("segmentOffset",e,t))}get stretch(){return null!==this.g?this.g.lo:1}set stretch(t){var e=this.stretch;e!==t&&(this.Zt(),this.g.lo=t,this.u(),this.i("stretch",e,t))}get name(){return null!==this.g?this.g.Tt:""}set name(t){var e=this.name;e!==t&&(Yt,Xt.t(t,"string",y,"name"),this.Zt(),this.g.Tt=t,null!==this.part&&this.part.V0(),this.i("name",e,t))}get opacity(){return this._t}set opacity(t){var e=this._t;e!==t&&(Xt.t(t,"number",y,"opacity"),(t<0||1<t)&&Xt.G(t,"0 <= value <= 1",y,"opacity"),this._t=t,this.i("opacity",e,t),e=this.diagram,t=this.part,null!==e)&&null!==t&&e.T(t.$h(t.actualBounds))}get filter(){return this.sd}set filter(t){Yt,Xt.t(t,"string",y,"filter");var e=this.sd;e!==t&&(this.sd=t,this.fs(!0),this.i("filter",e,t),e=this.diagram,t=this.part,null!==e)&&null!==t&&e.T(t.$h(t.actualBounds))}get visible(){return 0!=(1&this.l)}set visible(t){var e=0!=(1&this.l);e!==t&&(Yt,Xt.t(t,"boolean",y,"visible"),this.l=1^this.l,this.i("visible",e,t),null!==(e=this.panel)?e.u():this.Ws()&&this.Ki(t),this.T(),this.cL())}get pickable(){return 0!=(2&this.l)}set pickable(t){var e=0!=(2&this.l);e!==t&&(Yt,Xt.t(t,"boolean",y,"pickable"),this.l=2^this.l,this.i("pickable",e,t))}get fromLinkableDuplicates(){return 0!=(4&this.l)}set fromLinkableDuplicates(t){var e=0!=(4&this.l);e!==t&&(Yt,Xt.t(t,"boolean",y,"fromLinkableDuplicates"),this.l=4^this.l,this.i("fromLinkableDuplicates",e,t))}get fromLinkableSelfNode(){return 0!=(8&this.l)}set fromLinkableSelfNode(t){var e=0!=(8&this.l);e!==t&&(Yt,Xt.t(t,"boolean",y,"fromLinkableSelfNode"),this.l=8^this.l,this.i("fromLinkableSelfNode",e,t))}get toLinkableDuplicates(){return 0!=(16&this.l)}set toLinkableDuplicates(t){var e=0!=(16&this.l);e!==t&&(Yt,Xt.t(t,"boolean",y,"toLinkableDuplicates"),this.l=16^this.l,this.i("toLinkableDuplicates",e,t))}get toLinkableSelfNode(){return 0!=(32&this.l)}set toLinkableSelfNode(t){var e=0!=(32&this.l);e!==t&&(Yt,Xt.t(t,"boolean",y,"toLinkableSelfNode"),this.l=32^this.l,this.i("toLinkableSelfNode",e,t))}get isPanelMain(){return 0!=(64&this.l)}set isPanelMain(t){var e=0!=(64&this.l);e!==t&&(Yt,Xt.t(t,"boolean",y,"isPanelMain"),this.l=64^this.l,this.u(),this.i("isPanelMain",e,t))}get isActionable(){return 0!=(128&this.l)}set isActionable(t){var e=0!=(128&this.l);e!==t&&(Yt,Xt.t(t,"boolean",y,"isActionable"),this.l=128^this.l,this.i("isActionable",e,t))}get background(){return this.Ft}set background(t){var e=this.Ft;e!==t&&(null!==t&&m.ud(t,"GraphObject.background"),t instanceof m&&t.w(),this.Ft=t,this.T(),this.i("background",e,t))}u2(){return 0!=(512&this.l)}v1(t){t?this.l|=512:this.l&=-513}ic(){return 0!=(1024&this.l)}p2(t){t?this.l|=1024:this.l&=-1025}j1(){return 0!=(2048&this.l)}cd(t){t?this.l|=2048:this.l&=-2049}N0(){return 0!=(4096&this.l)}Ma(t){t?this.l|=4096:this.l&=-4097}Ko(){return 0!=(8192&this.l)}ae(t){t?this.l|=8192:this.l&=-8193}hs(){return 0!=(16384&this.l)}ro(t){t?this.l|=16384:this.l&=-16385}BR(){return 0!=(32768&this.l)}fs(t){t?this.l|=32768:this.l&=-32769}get part(){if(this.Ws())return this;if(null!==this.rl)return this.rl;let t=this;for(t=t.panel;t;){if(t instanceof Y)return this.rl=t;t=t.panel}return null}get svg(){return this.a2}set svg(t){this.a2=t}Bu(){this.svg=null}get panel(){return this.vs}Pa(t){this.vs=t,null!==this.svg&&this.svg.remove()}get layer(){var t=this.part;return null!==t?t.layer:null}get diagram(){var t=this.part;return null!==t?t.diagram:null}get position(){return this.lt}set position(t){Yt,Xt.s(t,U,y,"position");var e=t.x,i=t.y,s=this.lt,n=s.x,s=s.y;(n===e||isNaN(n)&&isNaN(e))&&(s===i||isNaN(s)&&isNaN(i))?this.b2():(t=t.copy(),this.w2(t,n,s)&&this.i("position",new U(n,s),t))}b2(){}w2(t,e,i){return this.lt=t,this.rc(),!0}Nf(t,e,i){this.lt.x===t&&this.lt.y===e||(this.lt.e(t,e),this.hd())}get actualBounds(){return this.Ri}get scale(){return this.v}set scale(t){var e=this.v;e!==t&&(Yt,Xt.r(t,y,"scale"),t<=0&&Xt.n("GraphObject.scale for "+this+" must be greater than zero, not: "+t),this.v=t,this.u(),this.i("scale",e,t))}get angle(){return this.qt}set angle(t){var e=this.qt;e!==t&&(Yt,Xt.r(t,y,"angle"),(t%=360)<0&&(t+=360),e!==t)&&(this.qt=t,this.cL(),this.u(),this.i("angle",e,t))}get desiredSize(){return this.We}set desiredSize(t){Yt,Xt.s(t,qt,y,"desiredSize");var e=t.width,i=t.height,s=this.We,n=s.width,r=s.height;(n===e||isNaN(n)&&isNaN(e))&&(r===i||isNaN(r)&&isNaN(i))||(t=t.L(),this.We=t,this.u(),this instanceof V&&this.fe(),this.i("desiredSize",s,t),!this.ic())||null!==(n=this.part)&&(this.Sa(n,"width"),this.Sa(n,"height"))}get width(){return this.We.width}set width(t){var e=this.We.width;e===t||isNaN(e)&&isNaN(t)||(Yt,Xt.t(t,"number",y,"width"),e=this.We,t=new qt(t,this.We.height).w(),this.We=t,this.u(),this instanceof V&&this.fe(),this.i("desiredSize",e,t),this.ic()&&null!==(e=this.part)&&this.Sa(e,"width"))}get height(){return this.We.height}set height(t){var e=this.We.height;e===t||isNaN(e)&&isNaN(t)||(Yt,Xt.t(t,"number",y,"height"),e=this.We,t=new qt(this.We.width,t).w(),this.We=t,this.u(),this instanceof V&&this.fe(),this.i("desiredSize",e,t),this.ic()&&null!==(e=this.part)&&this.Sa(e,"height"))}get minSize(){return null!==this.g?this.g.Cr:qt.lf}set minSize(t){var e=this.minSize;e.equals(t)||(Yt,Xt.s(t,qt,y,"minSize"),t=t.copy(),isNaN(t.width)&&(t.width=0),isNaN(t.height)&&(t.height=0),t.w(),this.Zt(),this.g.Cr=t,this.u(),this.i("minSize",e,t))}get maxSize(){return null!==this.g?this.g.Ar:qt.zk}set maxSize(t){var e=this.maxSize;e.equals(t)||(Yt,Xt.s(t,qt,y,"maxSize"),t=t.copy(),isNaN(t.width)&&(t.width=1/0),isNaN(t.height)&&(t.height=1/0),t.w(),this.Zt(),this.g.Ar=t,this.u(),this.i("maxSize",e,t))}get measuredBounds(){return this.ce}get naturalBounds(){return this.Hi}K1(){return 0}get margin(){return this.ol}set margin(t){"number"==typeof t?t=new E(t):(Yt,Xt.s(t,E,y,"margin"));var e=this.ol;e.equals(t)||(t=t.L(),this.ol=t,this.u(),this.i("margin",e,t))}get D(){return!0===this.j1()&&this.U1(),this.nl}get Ms(){return!0===this.N0()&&this.U1(),this.ch}trigger(t){return null===(t.Te=this).Ns&&(this.Ns=new L),this.Ns.add(t.propertyName,t),this}get Ns(){return null!==this.g?this.g.Ns:null}set Ns(t){this.Ns!==t&&(this.Zt(),this.g.Ns=t)}get Nr(){return null!==this.g?this.g.Nr:0}set Nr(t){this.Nr!==t&&(this.Zt(),this.g.Nr=t)}get alignment(){return this.fi}set alignment(t){var e=this.fi;e.equals(t)||(Yt,Xt.s(t,J,y,"alignment"),t.isNoSpot()&&!t.isDefault()&&Xt.n("GraphObject.alignment for "+this+" must be a real Spot or Spot.Default, not: "+t),t=t.L(),this.fi=t,this.rc(),this.i("alignment",e,t))}get column(){return this.vo}set column(t){Yt,Xt.r(t,y,"column"),t=Math.round(t);var e=this.vo;e!==t&&(t<0&&Xt.G(t,">= 0",y,"column"),this.vo=t,this.u(),this.i("column",e,t),null!==this.svg)&&this.svg.remove()}get columnSpan(){return null!==this.g?this.g.B0:1}set columnSpan(t){Yt,Xt.t(t,"number",y,"columnSpan"),t=Math.round(t);var e=this.columnSpan;e!==t&&(t<1&&Xt.G(t,">= 1",y,"columnSpan"),this.Zt(),this.g.B0=t,this.u(),this.i("columnSpan",e,t))}get row(){return this.ed}set row(t){Yt,Xt.r(t,y,"row"),t=Math.round(t);var e=this.ed;e!==t&&(t<0&&Xt.G(t,">= 0",y,"row"),this.ed=t,this.u(),this.i("row",e,t),null!==this.svg)&&this.svg.remove()}get rowSpan(){return null!==this.g?this.g.z0:1}set rowSpan(t){Yt,Xt.t(t,"number",y,"rowSpan"),t=Math.round(t);var e=this.rowSpan;e!==t&&(t<1&&Xt.G(t,">= 1",y,"rowSpan"),this.Zt(),this.g.z0=t,this.u(),this.i("rowSpan",e,t))}get spanAllocation(){return null!==this.g?this.g.X0:null}set spanAllocation(t){var e=this.spanAllocation;e!==t&&(null!==t&&Xt.t(t,"function",y,"spanAllocation"),this.Zt(),this.g.X0=t,this.u(),this.i("spanAllocation",e,t))}get alignmentFocus(){return this._f}set alignmentFocus(t){var e=this._f;e.equals(t)||(Yt,Xt.s(t,J,y,"alignmentFocus"),Yt,!t.isNoSpot()||t.isDefault()||t.isNone()&&this instanceof D||Xt.n("GraphObject.alignmentFocus must be a real Spot or Spot.Default, not: "+t),t=t.L(),this._f=t,this.u(),this.i("alignmentFocus",e,t))}get portId(){return this.td}set portId(t){var e,i=this.td;i!==t&&(Yt,null!==t&&Xt.t(t,"string",y,"portId"),null===(e=this.part)||e instanceof D||Xt.n("Cannot set portID on a Link: "+t),e=e,null!==i&&null!==e&&e.k2(this),null!==(this.td=t)&&null!==e&&(e.Nn=!0,e.uL(this)),this.i("portId",i,t))}Na(){var t,e=this.part;e instanceof D&&(null!==this.portId||this===e.port)&&null!==(t=e.diagram)&&!t.undoManager.isUndoingRedoing&&e.nL(this)}cL(){var t=this.diagram;null===t||t.undoManager.isUndoingRedoing||(this instanceof jt?this instanceof D?this.invalidateConnectedLinks():this.walkVisualTreeFrom(this,t=>{t.Na()}):this.Na())}get toSpot(){return null!==this.$?this.$.ya:J.None}set toSpot(t){var e=this.toSpot;e.equals(t)||(Yt,Xt.s(t,J,y,"toSpot"),t=t.L(),this.je(),this.$.ya=t,this.i("toSpot",e,t),this.Na())}get toEndSegmentLength(){return null!==this.$?this.$.xa:10}set toEndSegmentLength(t){var e=this.toEndSegmentLength;e!==t&&(Yt,Xt.t(t,"number",y,"toEndSegmentLength"),t<0&&Xt.G(t,">= 0",y,"toEndSegmentLength"),this.je(),this.$.xa=t,this.i("toEndSegmentLength",e,t),this.Na())}get toShortLength(){return null!==this.$?this.$.ka:0}set toShortLength(t){var e=this.toShortLength;e!==t&&(Yt,Xt.t(t,"number",y,"toShortLength"),this.je(),this.$.ka=t,this.i("toShortLength",e,t),this.Na())}get toLinkable(){return null!==this.$?this.$.Y0:null}set toLinkable(t){var e=this.toLinkable;e!==t&&(Yt,null!==t&&Xt.t(t,"boolean",y,"toLinkable"),this.je(),this.$.Y0=t,this.i("toLinkable",e,t))}get toMaxLinks(){return null!==this.$?this.$.K0:1/0}set toMaxLinks(t){var e=this.toMaxLinks;e!==t&&(Yt,Xt.t(t,"number",y,"toMaxLinks"),t<0&&Xt.G(t,">= 0",y,"toMaxLinks"),this.je(),this.$.K0=t,this.i("toMaxLinks",e,t))}get fromSpot(){return null!==this.$?this.$.pa:J.None}set fromSpot(t){var e=this.fromSpot;e.equals(t)||(Yt,Xt.s(t,J,y,"fromSpot"),t=t.L(),this.je(),this.$.pa=t,this.i("fromSpot",e,t),this.Na())}get fromEndSegmentLength(){return null!==this.$?this.$.wa:10}set fromEndSegmentLength(t){var e=this.fromEndSegmentLength;e!==t&&(Yt,Xt.t(t,"number",y,"fromEndSegmentLength"),t<0&&Xt.G(t,">= 0",y,"fromEndSegmentLength"),this.je(),this.$.wa=t,this.i("fromEndSegmentLength",e,t),this.Na())}get fromShortLength(){return null!==this.$?this.$.ba:0}set fromShortLength(t){var e=this.fromShortLength;e!==t&&(Yt,Xt.t(t,"number",y,"fromShortLength"),this.je(),this.$.ba=t,this.i("fromShortLength",e,t),this.Na())}get fromLinkable(){return null!==this.$?this.$.U0:null}set fromLinkable(t){var e=this.fromLinkable;e!==t&&(Yt,null!==t&&Xt.t(t,"boolean",y,"fromLinkable"),this.je(),this.$.U0=t,this.i("fromLinkable",e,t))}get fromMaxLinks(){return null!==this.$?this.$.G0:1/0}set fromMaxLinks(t){var e=this.fromMaxLinks;e!==t&&(Yt,Xt.t(t,"number",y,"fromMaxLinks"),t<0&&Xt.G(t,">= 0",y,"fromMaxLinks"),this.je(),this.$.G0=t,this.i("fromMaxLinks",e,t))}get cursor(){return null!==this.g?this.g.Dl:""}set cursor(t){var e=this.cursor;e!==t&&(Xt.t(t,"string",y,"cursor"),this.Zt(),this.g.Dl=t,this.i("cursor",e,t))}get click(){return null!==this.g?this.g.Vr:null}set click(t){var e=this.click;e!==t&&(null!==t&&Xt.t(t,"function",y,"click"),this.Zt(),this.g.Vr=t,this.i("click",e,t))}get doubleClick(){return null!==this.g?this.g.Br:null}set doubleClick(t){var e=this.doubleClick;e!==t&&(null!==t&&Xt.t(t,"function",y,"doubleClick"),this.Zt(),this.g.Br=t,this.i("doubleClick",e,t))}get contextClick(){return null!==this.g?this.g.zr:null}set contextClick(t){var e=this.contextClick;e!==t&&(null!==t&&Xt.t(t,"function",y,"contextClick"),this.Zt(),this.g.zr=t,this.i("contextClick",e,t))}get mouseEnter(){return null!==this.g?this.g.Gr:null}set mouseEnter(t){var e=this.mouseEnter;e!==t&&(null!==t&&Xt.t(t,"function",y,"mouseEnter"),this.Zt(),this.g.Gr=t,this.i("mouseEnter",e,t))}get mouseLeave(){return null!==this.g?this.g.Hr:null}set mouseLeave(t){var e=this.mouseLeave;e!==t&&(null!==t&&Xt.t(t,"function",y,"mouseLeave"),this.Zt(),this.g.Hr=t,this.i("mouseLeave",e,t))}get mouseOver(){return null!==this.g?this.g.Xr:null}set mouseOver(t){var e=this.mouseOver;e!==t&&(null!==t&&Xt.t(t,"function",y,"mouseOver"),this.Zt(),this.g.Xr=t,this.i("mouseOver",e,t))}get mouseHover(){return null!==this.g?this.g.Yr:null}set mouseHover(t){var e=this.mouseHover;e!==t&&(null!==t&&Xt.t(t,"function",y,"mouseHover"),this.Zt(),this.g.Yr=t,this.i("mouseHover",e,t))}get mouseHold(){return null!==this.g?this.g.Kr:null}set mouseHold(t){var e=this.mouseHold;e!==t&&(null!==t&&Xt.t(t,"function",y,"mouseHold"),this.Zt(),this.g.Kr=t,this.i("mouseHold",e,t))}get mouseDragEnter(){return null!==this.g?this.g.H0:null}set mouseDragEnter(t){var e=this.mouseDragEnter;e!==t&&(null!==t&&Xt.t(t,"function",y,"mouseDragEnter"),this.Zt(),this.g.H0=t,this.i("mouseDragEnter",e,t))}get mouseDragLeave(){return null!==this.g?this.g.v0:null}set mouseDragLeave(t){var e=this.mouseDragLeave;e!==t&&(null!==t&&Xt.t(t,"function",y,"mouseDragLeave"),this.Zt(),this.g.v0=t,this.i("mouseDragLeave",e,t))}get mouseDrop(){return null!==this.g?this.g.Ur:null}set mouseDrop(t){var e=this.mouseDrop;e!==t&&(null!==t&&Xt.t(t,"function",y,"mouseDrop"),this.Zt(),this.g.Ur=t,this.i("mouseDrop",e,t))}get actionDown(){return null!==this.g?this.g.q0:null}set actionDown(t){var e=this.actionDown;e!==t&&(null!==t&&Xt.t(t,"function",y,"actionDown"),this.Zt(),this.g.q0=t,this.i("actionDown",e,t))}get actionMove(){return null!==this.g?this.g.W0:null}set actionMove(t){var e=this.actionMove;e!==t&&(null!==t&&Xt.t(t,"function",y,"actionMove"),this.Zt(),this.g.W0=t,this.i("actionMove",e,t))}get actionUp(){return null!==this.g?this.g.j0:null}set actionUp(t){var e=this.actionUp;e!==t&&(null!==t&&Xt.t(t,"function",y,"actionUp"),this.Zt(),this.g.j0=t,this.i("actionUp",e,t))}get actionCancel(){return null!==this.g?this.g.J0:null}set actionCancel(t){var e=this.actionCancel;e!==t&&(null!==t&&Xt.t(t,"function",y,"actionCancel"),this.Zt(),this.g.J0=t,this.i("actionCancel",e,t))}get toolTip(){return null!==this.g?this.g.vr:null}set toolTip(t){var e=this.toolTip;e!==t&&(Yt,null===t||(t instanceof X||t instanceof pt)||Xt.n("GraphObject.toolTip must be an Adornment or HTMLInfo."),this.Zt(),this.g.vr=t,this.i("toolTip",e,t))}get contextMenu(){return null!==this.g?this.g.qr:null}set contextMenu(t){var e=this.contextMenu;e!==t&&(Yt,t instanceof X||t instanceof pt||Xt.n("GraphObject.contextMenu must be an Adornment or HTMLInfo."),this.Zt(),this.g.qr=t,this.i("contextMenu",e,t))}findBindingPanel(){let t=this instanceof jt?this:this.panel;for(;null!==t;){if(t.S2())return t;t=t.panel}return null}bind(t,e,i,s){return this.lc(t,e,i,s),this}bindTwoWay(t,e,i,s){return this.lc(t,e,i,s).makeTwoWay(),this}bindModel(t,e,i,s){return this.lc(t,e,i,s).ofModel(),this}bindObject(t,e,i,s,n){return this.lc(t,e,i,s).ofObject(n),this}theme(t,e,i,s,n){return this.yh(t,e,i,s,n),this}themeData(t,e,i,s,n){return this.yh(t,e,i,s,n).ofData(),this}themeObject(t,e,i,s,n,r){return this.yh(t,e,i,s,n).ofObject(r),this}themeModel(t,e,i,s,n){return this.yh(t,e,i,s,n).ofModel(),this}lc(t,e,i,s){let n=null;return n="string"==typeof t?new ri(t,e,i,s):t,this.Z0(n),n}yh(t,e,i,s,n){let r=null;return r="string"==typeof t?new ai(t,e,i,s,n):t,this.Z0(r),r}Z0(t){var e=(t.Te=this).findBindingPanel();null!==e&&e.dL()&&Xt.n("Cannot add a Binding to a template that has already been copied: "+t),null===this.Ii&&(this.Ii=new O),this.Ii.add(t)}set(t){Yt;for(const e in t)!e.startsWith("_")&&-1===e.indexOf(".")||Xt.n("Property with underscore or period passed to GraphObject.set. Did you mean to use GraphObject.attach?");return Object.assign(this,t),this}attach(t){return y.M2(this,t),this}apply(t){return t(this),this}setProperties(t){return K.p0(this,t),this}static build(t,e,...i){var s=y.$0.getValue(t);if("function"==typeof s){s=s([t].concat(i));if(s instanceof y)return e&&s.setProperties(e),s}Xt.n('GraphObject.build invoked object builder "'+t+'", but it did not return an Object')}static make(t){let e=arguments,i=null,s=null;var n;"function"==typeof t?s=t:"string"==typeof t&&("function"==typeof(n=y.$0.getValue(t))?(e=Array.prototype.slice.call(e),i=n(e),Xt.Mt(i)||Xt.n('GraphObject.make invoked object builder "'+t+'", but it did not return an Object')):s=v.go[t]),null===i&&(null!=s&&s.constructor||Xt.n("GraphObject.make requires a class function or GoJS class name or name of an object builder, not: "+t),i=new s);let r=1;i instanceof K&&1<e.length&&(n=i,"string"==typeof(t=e[1])||t instanceof HTMLDivElement)&&(n.bP(t),r++);for(let t=r;t<e.length;t++){var a=e[t];void 0===a?Xt.n("Undefined value at argument "+t+" for object being constructed by GraphObject.make: "+i):y.M2(i,a)}return i}static M2(e,i){if("number"==typeof i)y.YR(e,i);else if("string"==typeof i)y.KR(e,i);else if(i instanceof y)e instanceof jt||Xt.n("A GraphObject can only be added to a Panel, not to: "+e),e.add(i);else if(i instanceof we){let t;i.isRow&&"function"==typeof e.getRowDefinition?t=e.getRowDefinition(i.index):i.isRow||"function"!=typeof e.getColumnDefinition||(t=e.getColumnDefinition(i.index)),t instanceof we?t.J1(i):Xt.n("A RowColumnDefinition can only be added to an object that implements getRowDefinition/getColumnDefinition, not to: "+e)}else if(i instanceof se)e.type=i;else if(i instanceof ri)e instanceof y||e instanceof we?e.bind(i):Xt.n("A Binding can only be applied to a GraphObject or RowColumnDefinition, not to: "+e);else if(i instanceof Ct)e instanceof y?e.trigger(i):Xt.n("An AnimationTrigger can only be applied to a GraphObject, not to: "+e);else if(i instanceof k)e instanceof W&&4===e.type?e.figures.add(i):Xt.n("A PathFigure can only be added to a Path Geometry, not to: "+e);else if(i instanceof b)e instanceof k?e.segments.add(i):Xt.n("A PathSegment can only be added to a PathFigure, not to: "+e);else if(i instanceof Qe)e instanceof K||e instanceof j?e.layout=i:Xt.n("A Layout can only be assigned to a Diagram or a Group, not to: "+e);else if(Array.isArray(i))for(let t=0;t<i.length;t++){var s=i[t];y.M2(e,s)}else"object"==typeof i&&null!==i?y.UR(e,i):Xt.n('Unknown initializer "'+i+'" for object being constructed by GraphObject.make: '+e)}static KR(t,e){var i;t instanceof z?t.text=e:t instanceof V?t.figure=e:t instanceof Le?t.source=e:t instanceof jt?null!==(i=se.Layouts.getValue(e))?t.type=i:(Yt,Xt.n("Unknown Panel type as an argument to GraphObject.make: "+e+". If building from source, you may need to call Panel.definePanelLayout.")):t instanceof m?null!==(i=Xt.Yh(ee,e))?t.type=i:Xt.n("Unknown Brush type as an argument to GraphObject.make: "+e):t instanceof W?null!==(i=Xt.Yh(P,e))?t.type=i:(Yt,Xt.n("Unknown Geometry type as an argument to GraphObject.make: "+e)):t instanceof b?null!==(i=Xt.Yh(M,e))?t.type=i:(Yt,Xt.n("Unknown PathSegment type as an argument to GraphObject.make: "+e)):(Yt,Xt.n("Unable to use a string as an argument to GraphObject.make: "+e))}static YR(t,e){"function"==typeof t.ci?t.ci(e):Xt.gr(t,e)}static UR(t,e){if(t instanceof m){var i=new h;for(const a in e){var s=parseFloat(a);isNaN(s)?i[a]=e[a]:t.addColorStop(s,e[a])}K.p0(t,i)}else if(t instanceof we){void 0!==e.row?((null==(n=e.row)||n===1/0||isNaN(n)||n<0)&&Xt.n("Must specify non-negative integer row for RowColumnDefinition "+e+", not: "+n),t.isRow=!0,t.index=n):void 0!==e.column&&((null==(n=e.column)||n===1/0||isNaN(n)||n<0)&&Xt.n("Must specify non-negative integer column for RowColumnDefinition "+e+", not: "+n),t.isRow=!1,t.index=n);var n,r=new h;for(const o in e)"row"!==o&&"column"!==o&&(r[o]=e[o]);K.p0(t,r)}else K.p0(t,e)}static uE(){var t,e=new L;for(const i in y.$0)i!==i.toLowerCase()&&"function"==typeof(t=y.$0.getValue(i))&&e.add(i,t);return e.w(),e}static defineBuilder(t,e){Xt.t(t,"string",y,"defineBuilder:name"),Xt.t(e,"function",y,"defineBuilder:func");var i=t.toLowerCase();Yt,""!==t&&"none"!==i&&t!==i||Xt.n("Shape.defineFigureGenerator name must not be empty or None or all-lower-case: "+t),y.$0.add(t,e)}static takeBuilderArgument(t,e,i){var s=t[1];if("function"==typeof(i=void 0===i?null:i)?i(s):"string"==typeof s)return t.splice(1,1),s;if(void 0===e)throw new Error("no "+("function"==typeof i?"satisfactory":"string")+" argument for GraphObject builder "+t[0]);return e}static $0=new L;static{y.Vertical=4,y.Horizontal=5,y.defineBuilder("Button",t=>{var e=2.76142374915397,i=2.761423749153969,e=new jt(jt.Auto,{isActionable:!0,enabledChanged:(t,e)=>{var i;t instanceof jt&&null!==(i=t.findObject("ButtonBorder"))&&(e?(t._buttonFillDisabled=i.fill,i.fill=t._buttonFillNormal):(t._buttonFillNormal=i.fill,i.fill=t._buttonFillDisabled))},cursor:"pointer"}).attach({_buttonFillNormal:"#f5f5f5",_buttonStrokeNormal:"#737373",_buttonFillOver:"#d4d4d4",_buttonStrokeOver:"#737373",_buttonFillDisabled:"#a3a3a3"}).add(new V("RoundedRectangle",{name:"ButtonBorder",spot1:new J(0,0,e,i),spot2:new J(1,1,-e,-i),parameter1:2,fill:"#f5f5f5",stroke:"#737373"}));return e.mouseEnter=(t,e,i)=>{var s;e.isEnabledObject()&&e instanceof jt&&(s=e.findObject("ButtonBorder"))instanceof V&&(e._buttonFillNormal=s.fill,s.fill=e._buttonFillOver,e._buttonStrokeNormal=s.stroke,s.stroke=e._buttonStrokeOver)},e.mouseLeave=(t,e,i)=>{var s;e.isEnabledObject()&&e instanceof jt&&(s=e.findObject("ButtonBorder"))instanceof V&&(s.fill=e._buttonFillNormal,s.stroke=e._buttonStrokeNormal)},e}),y.defineBuilder("TreeExpanderButton",t=>{var e=y.build("Button");return e.attach({_treeExpandedFigure:"MinusLine",_treeCollapsedFigure:"PlusLine",visible:!1}),e.add(new V("MinusLine",{name:"ButtonIcon",stroke:"#0a0a0a",strokeWidth:2,desiredSize:qt.du}).bindObject("figure","isTreeExpanded",(t,e)=>{e=e.panel;return t?e._treeExpandedFigure:e._treeCollapsedFigure})),e.bindObject("visible","isTreeLeaf",t=>!t),e.click=(t,e)=>{let i=e.part;if((i=i instanceof X?i.adornedPart:i)instanceof D){e=i.diagram;if(null!==e){e=e.commandHandler;if(i.isTreeExpanded){if(!e.canCollapseTree(i))return}else if(!e.canExpandTree(i))return;t.handled=!0,i.isTreeExpanded?e.collapseTree(i):e.expandTree(i)}}},e}),y.defineBuilder("SubGraphExpanderButton",t=>{var e=y.build("Button");return e.attach({_subGraphExpandedFigure:"MinusLine",_subGraphCollapsedFigure:"PlusLine"}),e.add(new V("MinusLine",{name:"ButtonIcon",stroke:"#0a0a0a",strokeWidth:2,desiredSize:qt.du}).bindObject("figure","isSubGraphExpanded",(t,e)=>{e=e.panel;return t?e._subGraphExpandedFigure:e._subGraphCollapsedFigure})),e.click=(t,e)=>{let i=e.part;if((i=i instanceof X?i.adornedPart:i)instanceof j){e=i.diagram;if(null!==e){e=e.commandHandler;if(i.isSubGraphExpanded){if(!e.canCollapseSubGraph(i))return}else if(!e.canExpandSubGraph(i))return;t.handled=!0,i.isSubGraphExpanded?e.collapseSubGraph(i):e.expandSubGraph(i)}}},e}),y.defineBuilder("ToolTip",t=>new X(jt.Auto,{isShadowed:!0,shadowColor:"rgba(0, 0, 0, .4)",shadowOffset:new U(0,2)}).add(new V("RoundedRectangle",{name:"Border",parameter1:1,fill:"#f5f5f5",strokeWidth:0,spot1:new J(0,0,4,6),spot2:new J(1,1,-4,-4)}))),y.defineBuilder("ContextMenu",t=>new X(jt.Vertical,{background:"#f5f5f5",isShadowed:!0,shadowColor:"rgba(0, 0, 0, .4)",shadowOffset:new U(0,2)}).bindObject("background","",t=>null!==t.adornedPart&&t.hasPlaceholder()?null:"#f5f5f5")),y.defineBuilder("ContextMenuButton",t=>{var e=y.build("Button"),i=(e.stretch=5,e.findObject("ButtonBorder"));return i instanceof V&&(i.figure="Rectangle",i.strokeWidth=0,i.spot1=new J(0,0,4,6),i.spot2=new J(1,1,-4,-4)),e}),y.defineBuilder("PanelExpanderButton",t=>{const n=y.takeBuilderArgument(t,"COLLAPSIBLE"),e=y.build("Button");e.attach({_buttonExpandedFigure:"M0 0 M0 6 L4 2 8 6 M8 8",_buttonCollapsedFigure:"M0 0 M0 2 L4 6 8 2 M8 8",_buttonFillNormal:"rgba(0, 0, 0, 0)",_buttonStrokeNormal:null,_buttonFillOver:"rgba(0, 0, 0, .2)",_buttonStrokeOver:null}),e.add(new V({name:"ButtonIcon",strokeWidth:2}).bindObject("geometryString","visible",t=>t?e._buttonExpandedFigure:e._buttonCollapsedFigure,void 0,n));t=e.findObject("ButtonBorder");return t instanceof V&&(t.stroke=null,t.fill="rgba(0, 0, 0, 0)"),e.click=(e,i)=>{if(i instanceof jt){var s=i.diagram;if(null!==s&&!s.isReadOnly){let t=i.findBindingPanel();null!==(t=null===t?i.part:t)&&null!==(i=t.findObject(n))&&(e.handled=!0,s.startTransaction("Collapse/Expand Panel"),i.visible=!i.visible,s.commitTransaction("Collapse/Expand Panel"))}}},e}),y.defineBuilder("CheckBoxButton",t=>{const n=y.takeBuilderArgument(t),e=y.build("Button",{desiredSize:new qt(14,14)});e.attach({"ButtonBorder.spot1":new J(0,0,1,1),"ButtonBorder.spot2":new J(1,1,-1,-1)});t=new V({name:"ButtonIcon",geometryString:"M0 0 M0 8.85 L4.9 13.75 16.2 2.45 M16.2 16.2",strokeWidth:2,stretch:2,geometryStretch:6,visible:!1});return""!==n&&t.bindTwoWay("visible",n),e.add(t),e.click=(t,e)=>{var i,s;e instanceof jt&&(null===(i=t.diagram)||i.isReadOnly||""!==n&&i.model.isReadOnly||(t.handled=!0,s=e.findObject("ButtonIcon"),i.startTransaction("checkbox"),null!==s&&(s.visible=!s.visible),"function"==typeof e._doClick&&e._doClick(t,e),i.commitTransaction("checkbox")))},e}),y.defineBuilder("CheckBox",t=>{var t=y.takeBuilderArgument(t),t=y.build("CheckBoxButton",{name:"Button",isActionable:!1,margin:new E(0,1,0,0)},t),e=new jt("Horizontal",{isActionable:!0,cursor:t.cursor,margin:new E(1),mouseEnter:t.mouseEnter,mouseLeave:t.mouseLeave,click:t.click}).attach({_buttonFillNormal:t._buttonFillNormal,_buttonStrokeNormal:t._buttonStrokeNormal,_buttonFillOver:t._buttonFillOver,_buttonStrokeOver:t._buttonStrokeOver,_buttonFillDisabled:t._buttonFillDisabled,_buttonClick:t.click});return e.add(t),t.mouseEnter=null,t.mouseLeave=null,t.click=null,e})}}class Ut{xi;Tt;so;Ii;no;js;Dl;Vr;Br;zr;Gr;Hr;Xr;Yr;Kr;H0;v0;Ur;q0;W0;j0;J0;vr;qr;D0;X0;Ns;Cr;Ar;lo;z0;B0;Nr;L0;Q0;_0;constructor(){this.xi=!1,this.Tt="",this.so=-1,this.Ii=null,this.no=null,this.js=null,this.Dl="",this.Vr=null,this.Br=null,this.zr=null,this.Gr=null,this.Hr=null,this.Xr=null,this.Yr=null,this.Kr=null,this.H0=null,this.v0=null,this.Ur=null,this.q0=null,this.W0=null,this.j0=null,this.J0=null,this.vr=null,this.qr=null,this.D0=null,this.X0=null,this.Ns=null,this.Cr=qt.lf,this.Ar=qt.zk,this.lo=1,this.z0=1,this.B0=1,this.Nr=0,this.L0=null,this.Q0=null,this._0="category"}copy(){var t=new Ut;return t.Tt=this.Tt,t.so=this.so,t.Ii=this.Ii,t.js=this.js,t.Dl=this.Dl,t.Vr=this.Vr,t.Br=this.Br,t.zr=this.zr,t.Gr=this.Gr,t.Hr=this.Hr,t.Xr=this.Xr,t.Yr=this.Yr,t.Kr=this.Kr,t.H0=this.H0,t.v0=this.v0,t.Ur=this.Ur,t.q0=this.q0,t.W0=this.W0,t.j0=this.j0,t.J0=this.J0,t.vr=this.vr,t.qr=this.qr,t.D0=this.D0,t.X0=this.X0,t.Ns=this.Ns,t.Cr=this.Cr.L(),t.Ar=this.Ar.L(),t.lo=this.lo,t.z0=this.z0,t.B0=this.B0,t.Nr=this.Nr,t.L0=this.L0,t.Q0=this.Q0,t._0=this._0,t}}class Wt{m;constructor(){this.m=[1,0,0,1,0,0]}copy(){var t=new Wt;return t.m[0]=this.m[0],t.m[1]=this.m[1],t.m[2]=this.m[2],t.m[3]=this.m[3],t.m[4]=this.m[4],t.m[5]=this.m[5],t}translate(t,e){this.m[4]+=this.m[0]*t+this.m[2]*e,this.m[5]+=this.m[1]*t+this.m[3]*e}scale(t,e){this.m[0]*=t,this.m[1]*=t,this.m[2]*=e,this.m[3]*=e}rotate(i,s,n){if(360<=i?i-=360:i<0&&(i+=360),0!==i){this.translate(s,n);let t=0,e=0;e=90===i?(t=0,1):180===i?(t=-1,0):270===i?(t=0,-1):(i=i*Math.PI/180,t=Math.cos(i),Math.sin(i));var i=this.m[0]*t+this.m[2]*e,r=this.m[1]*t+this.m[3]*e,a=this.m[0]*-e+this.m[2]*t,o=this.m[1]*-e+this.m[3]*t;this.m[0]=i,this.m[1]=r,this.m[2]=a,this.m[3]=o,this.translate(-s,-n)}}}class Zt{type;x1;y1;r1;x2;y2;r2;colors;pattern;constructor(t){this.type=t,this.x1=0,this.y1=0,this.r1=0,this.x2=0,this.y2=0,this.r2=0,this.colors=[],this.pattern=null}addColorStop(t,e){this.colors.push({offset:t,color:e})}}class Jt{Bt;gi;ga;$u;P2;constructor(t,e,i){var e=void 0===e?v.document:e,s=(this.ga=e,this.P2="http://www.w3.org/2000/svg","http://www.w3.org/2000/xmlns/");void 0!==e&&(this.Bt=this.makeElement("svg",{width:"1px",height:"1px",viewBox:"0 0 1 1"}),this.style.display="block",this.style.letterSpacing="normal",this.style.wordSpacing="normal",i||(this.style.position="absolute"),this.Bt.setAttributeNS(s,"xmlns",this.P2),this.Bt.setAttributeNS(s,"xmlns:xlink","http://www.w3.org/1999/xlink")),this.$u=null,this.gi=new _t(this,i)}resize(t,e,i,s){return(this.width!==t||this.height!==e)&&(this.width=t,this.height=e,this.style.width=i+"px",this.style.height=s+"px",this.Bt.setAttributeNS(null,"width",i+"px"),this.Bt.setAttributeNS(null,"height",s+"px"),this.Bt.setAttributeNS(null,"viewBox","0 0 "+i+" "+s),this.gi.N2.firstElementChild.setAttributeNS(null,"width",i+"px"),this.gi.N2.firstElementChild.setAttributeNS(null,"height",s+"px"),!0)}makeElement(t,e,i){var s=this.ga.createElementNS(this.P2,t);if(Xt.Mt(e))for(const n in e)s.setAttributeNS("href"===n?"http://www.w3.org/1999/xlink":"",n,e[n]);return void 0!==i&&(s.textContent=i),s}getBoundingClientRect(){return this.Bt.getBoundingClientRect()}focus(){this.Bt.focus()}get width(){return this.Bt.width.baseVal.value}set width(t){this.Bt.setAttribute("width",t+"px")}get height(){return this.Bt.height.baseVal.value}set height(t){this.Bt.setAttribute("height",t+"px")}dispose(){this.ga=null}get style(){return this.Bt.style}}class _t{hc;ac;Cn;Oi;Je;fillStyle;font;globalAlpha;lineCap;lineDashOffset;lineJoin;lineWidth;miterLimit;shadowBlur;shadowColor;shadowOffsetX;shadowOffsetY;strokeStyle;textAlign;imageSmoothingEnabled;clipInsteadOfFill;lastCreatedElement;fc;cc;surface;svg;N2;gL;Z1;jo;wh;Ca;currentElement;clipPathGroup;diagramGroup;lastDrawnPart;currentPath;outerGroup;pathAttributes;hl;Fr;filter;partClipRect;constructor(t,e){this.surface=t,this.svg=t.Bt,this.fc=[],this.cc=[],this.fillStyle="#000000",this.font="10px sans-serif",this.globalAlpha=1,this.lineCap="butt",this.lineDashOffset=0,this.lineJoin="miter",this.lineWidth=1,this.miterLimit=10,this.shadowBlur=0,this.shadowColor="rgba(0, 0, 0, 0)",this.shadowOffsetX=0,this.shadowOffsetY=0,this.hl=!1,this.strokeStyle="#000000",this.textAlign="start",this.clipInsteadOfFill=!1,this.hc=0,this.ac=0,this.Cn=0,this.lastCreatedElement=null,this.currentElement=null,this.Oi=[],this.pathAttributes={},this.Z1=!1,this.jo=null,this.wh=0,this.Je=new Wt,this.clipPathGroup=this.newGroup2(),this.diagramGroup=this.newGroup2("gojs-diagram"),this.lastDrawnPart=null,this.currentPath=null;var i=C.fu++,s=this.makeElement("clipPath",{id:"mainClip"+i}),t={x:0,y:0,width:t.width,height:t.height};s.appendChild(this.makeElement("rect",t)),this.N2=s,this.svg.appendChild(this.clipPathGroup),this.clipPathGroup.appendChild(this.diagramGroup),this.svg.appendChild(s),this.clipPathGroup.setAttributeNS(null,"clip-path","url(#mainClip"+i+")"),this.gL={},this.Fr=!!e,this.filter="",this.partClipRect=null}setDiagramPosScale(t,e,i,s,n,r){void 0===this.diagramGroup?this.newGroup(t,e,i,s,n,r):this.diagramGroup.setAttribute("transform","matrix("+t+", "+e+", "+i+", "+s+", "+n+", "+r+")")}resetInnerSVG(){null!==this.diagramGroup&&(this.diagramGroup.innerHTML="")}arc(t,e,i,s,n,r,a,o){var h=2*Math.PI,l=h-1e-6,u=i*Math.cos(s),d=i*Math.sin(s),c=t+u,g=e+d,m=r?0:1;let f=r?s-n:n-s;(1e-6<Math.abs(a-c)||1e-6<Math.abs(o-g))&&this.Oi.push(["L",c,+g]),(f=f<0?f%h+h:f)>l?(this.Oi.push(["A",i,i,0,1,m,t-u,e-d]),this.Oi.push(["A",i,i,0,1,m,c,g])):1e-6<f&&this.Oi.push(["A",i,i,0,+(f>=Math.PI),m,t+i*Math.cos(n),e+i*Math.sin(n)])}beginPath(){this.Oi=[],this.pathAttributes={stroke:"none",fill:"none"}}endPath(t){this.GR(this.Oi,this.Je,t||0)}bezierCurveTo(t,e,i,s,n,r){this.Oi.push(["C",t,e,i,s,n,r])}clearRect(t,e,i,s){}clip(){this.pathAttributes.clipPath=!0}closePath(){this.Oi.push(["z"])}createLinearGradient(t,e,i,s){var n=new Zt("linear");return n.x1=t,n.y1=e,n.x2=i,n.y2=s,n}createPattern(t,e){let i="";t instanceof HTMLCanvasElement&&(i=t.toDataURL()),t instanceof HTMLImageElement&&(i=t.getAttribute("src"));var s,n,r=this.gL;return r[i]?"url(#"+r[i]+")":(s="PATTERN"+C.fu++,n={width:t.width,height:t.height,id:s,patternUnits:"userSpaceOnUse"},t={x:0,y:0,width:t.width,height:t.height,href:i},(n=this.makeElement("pattern",n)).appendChild(this.makeElement(K.img,t)),this.svg.appendChild(n),"url(#"+(r[i]=s)+")")}createRadialGradient(t,e,i,s,n,r){var a=new Zt("radial");return a.x1=t,a.y1=e,a.r1=i,a.x2=s,a.y2=n,a.r2=r,a}amendImageTransform(t,e,i,s,n,r,a,o){a/=i,i=o/s;0===n&&0===r||this.Je.translate(n,r),1==a&&1==i||this.Je.scale(a,i),0===t&&0===e||this.Je.translate(-t,-e)}drawImage(t,e,i,s,n,r,a,o,h){let l="";t instanceof HTMLCanvasElement&&(l=t.toDataURL()),t instanceof HTMLImageElement&&(l=t.getAttribute("src"));var u=t instanceof HTMLImageElement?t.naturalWidth:t.width,t=t instanceof HTMLImageElement?t.naturalHeight:t.height,r=(void 0===s&&(r=e,a=i,o=s=u,h=n=t),this.amendImageTransform(e,i,s=s||0,n=n||0,r=r||0,a=a||0,o=o||0,h=h||0),{x:0,y:0,width:u||s,height:t||n,href:l});I.q(s,o)&&I.q(n,h)?-1===l.toLowerCase().indexOf(".svg")&&-1===l.toLowerCase().indexOf("data:image/svg")&&(r.preserveAspectRatio="xMidYMid slice"):r.preserveAspectRatio="none",0===e&&0===i&&s===u&&n===t||(r["clip-path"]=`path('M ${e},${i} L ${s+=e} ${i} L ${s} ${n+=i} L ${e} ${n} z')`),this.processCommon(K.img,r,this.Je),this.dd(K.img,r)}fill(t,e){t&&(this.pathAttributes["fill-rule"]="evenodd"),this.setFill(this.pathAttributes)}fillContext(t,e,i){this.clipInsteadOfFill?this.clip():this.fill(e,i)}fillRect(t,e,i,s){this.addRect("fill",[t,e,i,s],this.Je)}fillBackground(t,e,i,s){t={x:t,y:e,width:i,height:s};this.processCommon("fill",t,this.Je),this.setFill(t),this.svg.prepend(this.makeElement("rect",t))}fillText(t,e,i){this.addText("fill",[t,e,i],this.Je)}lineTo(t,e){this.Oi.push(["L",t,e])}moveTo(t,e){this.Oi.push(["M",t,e])}quadraticCurveTo(t,e,i,s){this.Oi.push(["Q",t,e,i,s])}rect(t,e,i,s){this.Oi.push(["M",t,e],["L",t+i,e],["L",t+i,e+s],["L",t,e+s],["z"])}restore(){this.Je=this.fc.pop(),this.Oi=this.fc.pop();var t=this.fc.pop();this.fillStyle=t.fillStyle,this.font=t.font,this.globalAlpha=t.globalAlpha,this.lineCap=t.lineCap,this.lineDashOffset=t.lineDashOffset,this.lineJoin=t.lineJoin,this.lineWidth=t.lineWidth,this.miterLimit=t.miterLimit,this.shadowBlur=t.shadowBlur,this.shadowColor=t.shadowColor,this.shadowOffsetX=t.shadowOffsetX,this.shadowOffsetY=t.shadowOffsetY,this.strokeStyle=t.strokeStyle,this.textAlign=t.textAlign,this.partClipRect=t.partClipRect}save(){var t={fillStyle:this.fillStyle,font:this.font,globalAlpha:this.globalAlpha,lineCap:this.lineCap,lineDashOffset:this.lineDashOffset,lineJoin:this.lineJoin,lineWidth:this.lineWidth,miterLimit:this.miterLimit,shadowBlur:this.shadowBlur,shadowColor:this.shadowColor,shadowOffsetX:this.shadowOffsetX,shadowOffsetY:this.shadowOffsetY,strokeStyle:this.strokeStyle,textAlign:this.textAlign,partClipRect:this.partClipRect},e=(this.fc.push(t),[]);for(let t=0;t<this.Oi.length;t++)e.push(this.Oi[t]);this.fc.push(e),this.fc.push(this.Je.copy())}setTransform(t,e,i,s,n,r){1===t&&0===e&&0===i&&1===s&&0===n&&0===r||this.newGroup(t,e,i,s,n,r)}setCurrentTransform(t,e,i,s,n,r){this.Je.m=[t,e,i,s,n,r]}getCurrentTransform(){var t=this.Je.m;return"matrix("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"}scale(t,e){this.Je.scale(t,e)}translate(t,e){this.Je.translate(t,e)}transform(t,e,i,s,n,r){}commitTransform(){}stroke(){this.setStroke(this.pathAttributes)}strokeContext(){this.clipInsteadOfFill||this.stroke()}strokeRect(t,e,i,s){this.addRect("stroke",[t,e,i,s],this.Je)}makeElement(t,e,i){return this.surface.makeElement(t,e,i)}dd(t,e,i){t=this.makeElement(t,e,i);return null!==this.currentElement?this.currentElement.appendChild(t):this.currentElement=t,this.lastCreatedElement=t}processCommon(t,e,i){"fill"===t?this.setFill(e):"stroke"===t&&this.setStroke(e),null!==i&&(t=i.m,e.transform="matrix("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")")}setFill(t){var e;this.fillStyle instanceof Zt?t.fill=this.addGradient(this.fillStyle,!0):/^rgba\(/.test(this.fillStyle)?(e=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.fillStyle),t.fill="rgb("+e[1]+","+e[2]+","+e[3]+")",t["fill-opacity"]=e[4]):t.fill=this.fillStyle}setFillOrStrokeInPlace(t,e){var i,e=e?"fill":"stroke";this.fillStyle instanceof Zt?t.setAttributeNS(null,"fill",this.addGradient(this.fillStyle,!0)):/^rgba\(/.test(this.fillStyle)?(i=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.fillStyle),t.setAttributeNS(null,e,"rgb("+i[1]+","+i[2]+","+i[3]+")"),t.setAttributeNS(null,e+"-opacity",i[4])):t.setAttributeNS(null,e,this.fillStyle)}setStroke(t){var e;this.strokeStyle instanceof Zt?t.stroke=this.addGradient(this.strokeStyle,!1):/^rgba\(/.test(this.strokeStyle)?(e=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(this.strokeStyle),t.stroke="rgb("+e[1]+","+e[2]+","+e[3]+")",t["stroke-opacity"]=e[4]):t.stroke=this.strokeStyle,t["stroke-width"]=this.lineWidth,t["stroke-linecap"]=this.lineCap,t["stroke-linejoin"]=this.lineJoin,t["stroke-miterlimit"]=this.miterLimit,this.Z1&&(t["stroke-dasharray"]=this.jo.toString(),t["stroke-dashoffset"]=this.wh)}addGradient(t,e){let i="";var e=null!==this.currentPath?this.currentPath.getAttribute(e?"fill":"stroke"):null;null!==e&&-1!==e.indexOf("GRAD")?(i=e.split("#")[1].slice(0,-1),null!==(e=this.svg.getElementById(i))&&e.remove()):i="GRAD"+C.fu++;let s;if("linear"===t.type){e={x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2,id:i,gradientUnits:"userSpaceOnUse"};s=this.makeElement("linearGradient",e)}else{if("radial"!==t.type)throw new Error("invalid gradient");e={x1:t.x1,x2:t.x2,y1:t.y1,y2:t.y2,r1:t.r1,r2:t.r2,id:i};s=this.makeElement("radialGradient",e)}var n=t.colors,r=n.length,a=[];for(let t=0;t<r;t++){var o=n[t],h=o.color,o={offset:o.offset,"stop-color":h};/^rgba\(/.test(h)&&(h=/^\s*rgba\s*\(([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\s*,\s*([^,\s]+)\)\s*$/i.exec(h),o["stop-color"]="rgb("+h[1]+","+h[2]+","+h[3]+")",o["stop-opacity"]=h[4]),a.push(o)}a.sort((t,e)=>t.offset>e.offset?1:-1);for(let t=0;t<r;t++)s.appendChild(this.makeElement("stop",a[t]));return this.svg.appendChild(s),"url(#"+i+")"}addRect(t,e,i){e={x:e[0],y:e[1],width:e[2],height:e[3]};this.processCommon(t,e,i),this.dd("rect",e)}addText(t,e,i){let s=this.textAlign;"left"===s?s="start":"right"===s?s="end":"center"===s&&(s="middle");var n={x:e[1],y:e[2],style:"font: "+this.font,"text-anchor":s};this.processCommon(t,n,i),this.dd("text",n,e[0])}GR(t,e,i){var t=this.HR(t),s=this.pathAttributes;if(s.clipPath)0<this.cc.length&&this.cc[this.cc.length-1].setAttributeNS(null,"clip-path",'path("'+t+'")');else if(s.d=t,this.processCommon("",s,e),null!==this.currentPath){var n=this.currentPath;if("g"!==n.nodeName)for(const a in s)"transform"!==a&&n.setAttributeNS(null,a,s[a]);else{var r=n.getElementsByTagName("path");for(const o in s)"transform"!==o&&r[i].setAttributeNS(null,o,s[o])}}else this.dd("path",s)}HR(e){var i=[];for(let t=0;t<e.length;t++){var s=e[t].slice(),n=[s.shift()];if("A"===n[0])n.push(s.shift()+","+s.shift(),s.shift(),s.shift()+","+s.shift(),s.shift()+","+s.shift());else for(;s.length;)n.push(s.shift()+","+s.shift());i.push(n.join(" "))}return i.join(" ")}newGroup(t,e,i,s,n,r){var a=new Wt,t=(a.m=[t,e,i,s,n,r],{}),e=(this.processCommon("g",t,a),this.dd("g",t));return this.cc.push(e),e}newGroup2(t){var e={},t=(t&&(e.class=t),this.dd("g",e));return this.cc.push(t),t}endGroup(){return this.cc.pop()}dummyGroup(){return this.newGroup2(),this.endGroup()}shadowsSet(t,e,i){this.hc=t,this.ac=e,this.Cn=i}shadowsOff(){this.hl=!1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0}shadowsOn(){this.hl=!0,this.shadowOffsetX=this.hc,this.shadowOffsetY=this.ac,this.shadowBlur=this.Cn}enableDash(t,e){this.Z1=!0,this.jo=t,this.wh=e}disableDash(){this.Z1=!1}clearContextCache(t){}setImageSmoothingEnabled(t){}rotate(t){this.Je.rotate(57.2958*t,0,0)}getImageData(t,e,i,s){return null}measureText(t){return null}removeOldGradient(t,e,i){var s,e=e.getAttribute(i);null!==e&&1!==(i=e.split("#")).length&&null!==(s=this.svg.getElementById(i[1].slice(0,-1)))&&(e=new RegExp(s.id,"g"),1===this.svg.innerHTML.match(e).length)&&s.remove()}removePartFromView(t){null!==t.svg&&t.svg.parentNode===this.diagramGroup&&t.svg.remove()}}class $t{Bt;gi;ga;$u;constructor(t,e,i,s){e=void 0===e?v.document:e,this.ga=e,this.$u=null,e=e.createElement("canvas");e.tabIndex=0,this.Bt=e,this.gi=new te(e,i,s),K.he.set(e,t)}resize(t,e,i,s){return(this.width!==t||this.height!==e)&&(this.width=t,this.height=e,this.style.width=i+"px",this.style.height=s+"px",!0)}toDataURL(t,e){return this.Bt.toDataURL(t,e)}getBoundingClientRect(){return this.Bt.getBoundingClientRect()}focus(){this.Bt.focus()}get width(){return this.Bt.width}set width(t){this.Bt.width=t}get height(){return this.Bt.height}set height(t){this.Bt.height=t}dispose(){K.he.delete(this.Bt),this.ga=null}get style(){return this.Bt.style}}class te{Y;$1;Q1;_1;tp;hc;ac;Cn;Ca;hl;Fr;constructor(t,e,i){this.Y=t.getContext?t.getContext("2d",e):null,null===this.Y&&Xt.n("Browser does not support HTML Canvas Element"),this.$1="",this.Q1="",this._1="",this.tp=!1,this.hc=0,this.ac=0,this.Cn=0,this.hl=!1,this.Ca=new H,this.Fr=!!i}setImageSmoothingEnabled(t){this.Y.imageSmoothingEnabled=t}get fillStyle(){return this.Y.fillStyle}set fillStyle(t){this._1!==t&&(this.Y.fillStyle=t,this._1=t)}get font(){return this.Y.font}set font(t){this.$1!==t&&(this.Y.font=t,this.$1=t)}get globalAlpha(){return this.Y.globalAlpha}set globalAlpha(t){this.Y.globalAlpha=t}get lineCap(){return this.Y.lineCap}set lineCap(t){this.Y.lineCap=t}get lineDashOffset(){return this.Y.lineDashOffset}set lineDashOffset(t){this.Y.lineDashOffset=t}get lineJoin(){return this.Y.lineJoin}set lineJoin(t){this.Y.lineJoin=t}get lineWidth(){return this.Y.lineWidth}set lineWidth(t){this.Y.lineWidth=t}get miterLimit(){return this.Y.miterLimit}set miterLimit(t){this.Y.miterLimit=t}get shadowBlur(){return this.Y.shadowBlur}set shadowBlur(t){this.Y.shadowBlur=t}get shadowColor(){return this.Y.shadowColor}set shadowColor(t){this.Y.shadowColor=t}get shadowOffsetX(){return this.Y.shadowOffsetX}set shadowOffsetX(t){this.Y.shadowOffsetX=t}get shadowOffsetY(){return this.Y.shadowOffsetY}set shadowOffsetY(t){this.Y.shadowOffsetY=t}get strokeStyle(){return this.Y.strokeStyle}set strokeStyle(t){this.Q1!==t&&(this.Y.strokeStyle=t,this.Q1=t)}get textAlign(){return this.Y.textAlign}set textAlign(t){this.Y.textAlign=t}get imageSmoothingEnabled(){return this.Y.imageSmoothingEnabled}set imageSmoothingEnabled(t){this.Y.imageSmoothingEnabled=t}get filter(){return this.Y.filter}set filter(t){this.Y.filter=""===t?"none":t}arc(t,e,i,s,n,r,a,o){this.Y.arc(t,e,i,s,n,r)}beginPath(){this.Y.beginPath()}endPath(){}bezierCurveTo(t,e,i,s,n,r){this.Y.bezierCurveTo(t,e,i,s,n,r)}clearRect(t,e,i,s){this.commitTransform(),this.Y.clearRect(t,e,i,s)}clip(t){t?this.Y.clip(t):this.Y.clip()}closePath(){this.Y.closePath()}createLinearGradient(t,e,i,s){return this.Y.createLinearGradient(t,e,i,s)}createPattern(t,e){return this.Y.createPattern(t,e)}createRadialGradient(t,e,i,s,n,r){return this.Y.createRadialGradient(t,e,i,s,n,r)}drawImage(t,e,i,s,n,r,a,o,h){void 0===s?this.Y.drawImage(t,e,i):this.Y.drawImage(t,e,i,s,n,r,a,o,h)}fill(t,e){e?this.Y.fill(e,t?"evenodd":"nonzero"):this.Y.fill(t?"evenodd":"nonzero")}fillRect(t,e,i,s){this.Y.fillRect(t,e,i,s)}fillBackground(t,e,i,s){this.Y.fillRect(t,e,i,s)}fillText(t,e,i){this.Y.fillText(t,e,i)}getImageData(t,e,i,s){return this.Y.getImageData(t,e,i,s)}lineTo(t,e){this.Y.lineTo(t,e)}measureText(t){return this.Y.measureText(t)}moveTo(t,e){this.Y.moveTo(t,e)}quadraticCurveTo(t,e,i,s){this.Y.quadraticCurveTo(t,e,i,s)}rect(t,e,i,s){this.Y.rect(t,e,i,s)}restore(){this.Y.restore()}save(){this.commitTransform(),this.Y.save()}rotate(t){this.Ca.ys(57.2958*t,0,0)}setTransform(t,e,i,s,n,r){this.Ca.setTo(t,e,i,s,n,r)}scale(t,e){this.Ca.v(t,e)}translate(t,e){this.Ca.se(t,e)}stroke(t){t?this.Y.stroke(t):this.Y.stroke()}transform(t,e,i,s,n,r){var a,o;1===t&&0===e&&0===i&&1===s&&0===n&&0===r||(o=(a=this.Ca).m11*t+a.m21*e,t=a.m12*t+a.m22*e,e=a.m11*i+a.m21*s,i=a.m12*i+a.m22*s,a.dx=a.m11*n+a.m21*r+a.dx,a.dy=a.m12*n+a.m22*r+a.dy,a.m11=o,a.m12=t,a.m21=e,a.m22=i)}commitTransform(){var t=this.Ca;this.Y.setTransform(t.m11,t.m12,t.m21,t.m22,t.dx,t.dy)}fillContext(t,e,i){this.radialFill(t,e,i)||this.fillOrClip(e,i)}radialFill(t,e,i){var s;return t instanceof m&&3===t.type&&((s=t.nc)<(t=t.W1)?(this.scale(s/t,1),this.translate((t-s)/2,0)):t<s&&(this.scale(1,t/s),this.translate(0,(s-t)/2)),this.fillOrClip(e,i),s<t?(this.translate(-(t-s)/2,0),this.scale(1/(s/t),1)):t<s&&(this.translate(0,-(s-t)/2),this.scale(1,1/(t/s))),!0)}strokeContext(){this.tp||this.stroke()}fillOrClip(t,e){this.tp?this.clip(e):this.fill(t,e)}get clipInsteadOfFill(){return this.tp}set clipInsteadOfFill(t){this.tp=t}shadowsSet(t,e,i){this.hc=t,this.ac=e,this.Cn=i}shadowsOff(){this.hl=!1,this.shadowOffsetX=0,this.shadowOffsetY=0,this.shadowBlur=0}shadowsOn(){this.hl=!0,this.shadowOffsetX=this.hc,this.shadowOffsetY=this.ac,this.shadowBlur=this.Cn}enableDash(t,e){var i=this.Y;void 0!==i.setLineDash&&(i.setLineDash(t),i.lineDashOffset=e)}disableDash(){var t=this.Y;void 0!==t.setLineDash&&(t.setLineDash(te.EmptyArray),t.lineDashOffset=0)}clearContextCache(t){t&&(this.$1=""),this.Q1="",this._1=""}removePartFromView(t){}static EmptyArray=Object.freeze([])}(i=ee||{})[i.Solid=1]="Solid",i[i.Linear=2]="Linear",i[i.Radial=3]="Radial",i[i.Pattern=4]="Pattern";var i,ee=i;(i={})[i.Lab=1]="Lab",i[i.HSL=2]="HSL",i[i.Oklch=3]="Oklch";class ie{n0;n1;n2;n3;constructor(){this.n0=0,this.n1=0,this.n2=0,this.n3=0}}class m{f;nt;Aa;li;ks;ip;ep;An;sp;Pn;nc;W1;constructor(t,e){C.ji(this),this.f=!1,void 0===t?(this.nt=1,this.Aa="black"):"string"==typeof t?null!==(i=Xt.Yh(ee,t))?(this.nt=i,this.Aa="black"):(this.nt=1,Yt,m.isValidColor(t)||Xt.n('Color "'+t+'" is not a valid color string for Brush constructor'),this.Aa=t):(Yt,Xt.it(t,ee,"BrushType"),this.nt=t,this.Aa="black");var i=this.nt;if(2===i?(this.li=J.TopCenter,this.ks=J.BottomCenter):3===i?(this.li=J.Center,this.ks=J.Center):(this.li=J.None,this.ks=J.None),this.ip=0,this.ep=NaN,this.An=null,this.sp=null,this.Pn=null,this.nc=0,this.W1=0,e){var s={};for(const n in e)isFinite(parseFloat(n))?this.addColorStop(parseFloat(n),e[n]):s[n]=e[n];Object.assign(this,s)}}copy(){var t=new m;return t.nt=this.nt,t.Aa=this.Aa,t.li=this.li.L(),t.ks=this.ks.L(),t.ip=this.ip,t.ep=this.ep,null!==this.An&&(t.An=this.An.copy()),t.sp=this.sp,t}w(){return this.f=!0,null!==this.An&&this.An.w(),this}ut(){return Object.isFrozen(this)&&Xt.n("cannot thaw constant: "+this),this.f=!1,null!==this.An&&this.An.ut(),this}ci(t){t in ee?this.type=t:Xt.gr(this,t)}toString(){let t="Brush(";if(1===this.type)t+=this.color;else if(2===this.type?t+="Linear ":3===this.type?t+="Radial ":4===this.type?t+="Pattern ":t+="(unknown) ",t+=this.start+" "+this.end,null!==this.colorStops)for(var e=this.colorStops.iterator;e.next();){var i=e.key,s=e.value;t+=" "+i+":"+s}return t+=")"}addColorStop(t,e){return this.f&&Xt.O(this),("number"!=typeof t||!isFinite(t)||1<t||t<0)&&Xt.G(t,"0 <= loc <= 1",m,"addColorStop:loc"),Xt.t(e,"string",m,"addColorStop:color"),Yt,m.isValidColor(e)||Xt.n('Color "'+e+'" is not a valid color string for Brush.addColorStop'),null===this.An&&(this.An=new L),this.An.add(t,e),1===this.nt&&(this.type=2),this.Pn=null,this}get type(){return this.nt}set type(t){this.f&&Xt.O(this,t),Xt.it(t,ee,"BrushType"),this.nt=t,this.start.isNoSpot()&&(2===t?this.start=J.TopCenter:3===t&&(this.start=J.Center)),this.end.isNoSpot()&&(2===t?this.end=J.BottomCenter:3===t&&(this.end=J.Center)),this.Pn=null}get color(){return this.Aa}set color(t){this.f&&Xt.O(this,t),Yt,m.isValidColor(t)||Xt.n('Color "'+t+'" is not a valid color string for Brush.color'),this.Aa=t,this.Pn=null}get start(){return this.li}set start(t){this.f&&Xt.O(this,t),Xt.s(t,J,m,"start"),this.li=t.L(),this.Pn=null}get end(){return this.ks}set end(t){this.f&&Xt.O(this,t),Xt.s(t,J,m,"end"),this.ks=t.L(),this.Pn=null}get startRadius(){return this.ip}set startRadius(t){this.f&&Xt.O(this,t),Xt.r(t,m,"startRadius"),t<0&&Xt.G(t,">= zero",m,"startRadius"),this.ip=t,this.Pn=null}get endRadius(){return this.ep}set endRadius(t){this.f&&Xt.O(this,t),Xt.r(t,m,"endRadius"),t<0&&Xt.G(t,">= zero",m,"endRadius"),this.ep=t,this.Pn=null}get colorStops(){return this.An}set colorStops(t){this.f&&Xt.O(this,t),Yt,Xt.s(t,L,m,"colorStops"),this.An=t,this.Pn=null}get pattern(){return this.sp}set pattern(t){this.f&&Xt.O(this,t),this.sp=t,this.Pn=null}static randomColor(t,e){void 0===t&&(t=128),(Yt,Xt.r(t,m,"randomColor:min"),t<0||255<t)&&Xt.G(t,"0 <= min <= 255",m,"randomColor:min"),void 0===e&&(e=Math.max(t,255)),(Yt,Xt.r(e,m,"randomColor:max"),e<t||255<e)&&Xt.G(e,"min <= max <= 255",m,"randomColor:max");e=Math.abs(e-t);let i=Math.floor(t+Math.random()*e).toString(16),s=Math.floor(t+Math.random()*e).toString(16),n=Math.floor(t+Math.random()*e).toString(16);return i.length<2&&(i="0"+i),s.length<2&&(s="0"+s),n.length<2&&(n="0"+n),"#"+i+s+n}static isValidColor(t){return!v.CSS||v.CSS.supports("color",t)}static lighten(t){return m.lightenBy(t)}lightenBy(t,e){this.f&&Xt.O(this);var i=void 0===t||"number"!=typeof t?.2:t,s=void 0===e?3:e;if(1===this.type)m.Bo(this.color),this.color=m.gd(i,s);else if((2===this.type||3===this.type)&&null!==this.colorStops)for(var n=this.colorStops.iterator;n.next();)m.Bo(n.value),this.addColorStop(n.key,m.gd(i,s));return this}static lightenBy(t,e,i){e=void 0===e||"number"!=typeof e?.2:e,i=void 0===i?3:i;return m.Bo(t),m.gd(e,i)}static darken(t){return m.darkenBy(t)}darkenBy(t,e){this.f&&Xt.O(this);var i=void 0===t||"number"!=typeof t?.2:t,s=void 0===e?3:e;if(1===this.type)m.Bo(this.color),this.color=m.gd(-i,s);else if((2===this.type||3===this.type)&&null!==this.colorStops)for(var n=this.colorStops.iterator;n.next();)m.Bo(n.value),this.addColorStop(n.key,m.gd(-i,s));return this}static darkenBy(t,e,i){e=void 0===e||"number"!=typeof e?.2:e,i=void 0===i?3:i;return m.Bo(t),m.gd(-e,i)}static mix(t,e,i){m.Bo(t);var t=m.j.n0,s=m.j.n1,n=m.j.n2,r=m.j.n3,e=(m.Bo(e),void 0===i&&(i=.5),Math.round((m.j.n0-t)*i+t));return`rgba(${e}, ${Math.round((m.j.n1-s)*i+s)}, ${Math.round((m.j.n2-n)*i+n)}, ${Math.round((m.j.n3-r)*i+r)})`}isDark(){if(1===this.type)return m.isDark(this.color);if(2!==this.type&&3!==this.type||null===this.colorStops)return!1;{var n=this.colorStops;if(3===this.type)return m.isDark(n.first().value);if(null!==n.get(.5))return m.isDark(n.get(.5));if(2===n.count)return h=n.toArray(),m.isDark(m.mix(h[0].value,h[1].value));var r=n.iterator;let t=-1,e=-1,i=1,s=1;for(;r.next();){var a=r.key,o=Math.abs(.5-r.key);i>s&&o<i?(t=a,i=o):s>=i&&o<s&&(e=a,s=o)}t>e&&(h=t,t=e,e=h,h=i,i=s,s=h);var h=e-t;return m.isDark(m.mix(n.get(t),n.get(e),1-s/h))}}static isDark(t){return!!t&&(t instanceof m?t.isDark():(m.Bo(t),(299*m.j.n0+587*m.j.n1+114*m.j.n2)/1e3<128))}static gd(t,e){switch(e){case 1:return m.vR(),m.ho.n0=Math.min(100,Math.max(0,m.ho.n0+100*t)),m.qR(),"rgba("+m.j.n0+", "+m.j.n1+", "+m.j.n2+", "+m.j.n3+")";case 2:return m.UM(),m.Yi.n2=Math.min(100,Math.max(0,m.Yi.n2+100*t)),"hsla("+m.Yi.n0+", "+m.Yi.n1+"%, "+m.Yi.n2+"%, "+m.Yi.n3+")";case 3:return m.WR(),m.ao.n0=Math.min(100,Math.max(0,m.ao.n0+100*t)),m.jR(),"rgba("+m.j.n0+", "+m.j.n1+", "+m.j.n2+", "+m.j.n3+")";default:Xt.n("Unknown color space: "+e)}}static Bo(t){var e,i=m.al;null!==i&&(i.clearRect(0,0,1,1),i.fillStyle="#000000",e=i.fillStyle,i.fillStyle=t,i.fillStyle!==e?(i.fillRect(0,0,1,1),e=i.getImageData(0,0,1,1).data,m.j.n0=e[0],m.j.n1=e[1],m.j.n2=e[2],m.j.n3=e[3]/255):(i.fillStyle="#FFFFFF",e=i.fillStyle,i.fillStyle=t,i.fillStyle===e&&(Yt,Xt.n('Color "'+t+'" is not a valid color string for RGBA color conversion')),m.j.n0=0,m.j.n1=0,m.j.n2=0,m.j.n3=1))}static UM(){var t=m.j.n0/255,e=m.j.n1/255,i=m.j.n2/255,s=Math.max(t,e,i),n=Math.min(t,e,i),r=s-n;let a,o;n=(s+n)/2;if(0==r)a=o=0;else{switch(s){case t:a=(e-i)/r%6;break;case e:a=(i-t)/r+2;break;case i:a=(t-e)/r+4}(a*=60)<0&&(a+=360),o=r/(1-Math.abs(2*n-1))}m.Yi.n0=Math.round(a),m.Yi.n1=Math.round(100*o),m.Yi.n2=Math.round(100*n),m.Yi.n3=m.j.n3}static dE(){var t=m.Yi.n0,e=m.Yi.n1/100,i=m.Yi.n2/100;let s,n,r;var e=(1-Math.abs(2*i-1))*e,t=t/60,a=e*(1-Math.abs(t%2-1)),t=(0<=t&&t<1?(s=e,n=a,r=0):1<=t&&t<2?(s=a,n=e,r=0):2<=t&&t<3?(s=0,n=e,r=a):3<=t&&t<4?(s=0,n=a,r=e):4<=t&&t<5?(s=a,n=0,r=e):5<=t&&t<6&&(s=e,n=0,r=a),i-.5*e);s+=t,n+=t,r+=t,m.j.n0=Math.round(255*s),m.j.n1=Math.round(255*n),m.j.n2=Math.round(255*r),m.j.n3=m.Yi.n3}static vR(){m.mL(),m.JR()}static qR(){m.ZR(),m.pL()}static C2(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}static A2(t){return t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055}static mL(){var t=m.C2(m.j.n0),e=m.C2(m.j.n1),i=m.C2(m.j.n2);m.zt.n0=.4124564*t+.3575761*e+.1804375*i,m.zt.n1=.2126729*t+.7151522*e+.072175*i,m.zt.n2=.0193339*t+.119192*e+.9503041*i,m.zt.n3=m.j.n3}static pL(){var t=3.2404542*m.zt.n0+-1.5371385*m.zt.n1+-.4985314*m.zt.n2,e=-.969266*m.zt.n0+1.8760108*m.zt.n1+.041556*m.zt.n2,i=.0556434*m.zt.n0+-.2040259*m.zt.n1+1.0572252*m.zt.n2;m.j.n0=255*m.A2(t),m.j.n1=255*m.A2(e),m.j.n2=255*m.A2(i),m.j.n3=m.zt.n3,m.j.n0=Math.round(m.j.n0),255<m.j.n0?m.j.n0=255:m.j.n0<0&&(m.j.n0=0),m.j.n1=Math.round(m.j.n1),255<m.j.n1?m.j.n1=255:m.j.n1<0&&(m.j.n1=0),m.j.n2=Math.round(m.j.n2),255<m.j.n2?m.j.n2=255:m.j.n2<0&&(m.j.n2=0)}static L2=216/24389;static tb=24389/27;static md=[95.047,100,108.883];static T2(t){return t>m.L2?Math.pow(t,1/3):(m.tb*t+16)/116}static JR(){var t=m.T2(100*m.zt.n0/m.md[0]),e=m.T2(100*m.zt.n1/m.md[1]),i=m.T2(100*m.zt.n2/m.md[2]);m.ho.n0=116*e-16,m.ho.n1=500*(t-e),m.ho.n2=200*(e-i),m.ho.n3=m.zt.n3}static yL(t){var e=t*t*t;return e>m.L2?e:(116*t-16)/m.tb}static ZR(){var t=(m.ho.n0+16)/116,e=m.ho.n1/500+t,i=t-m.ho.n2/200;m.zt.n0=m.md[0]/100*m.yL(e),m.zt.n1=m.md[1]/100*(m.ho.n0>m.tb*m.L2?Math.pow(t,3):m.ho.n0/m.tb),m.zt.n2=m.md[2]/100*m.yL(i),m.zt.n3=m.ho.n3}static $R(){var t=.8190224*m.zt.n0+.3619062*m.zt.n1+-.1288737*m.zt.n2,e=.03298366*m.zt.n0+.9292868*m.zt.n1+.03614466*m.zt.n2,i=.04817719*m.zt.n0+.2642395*m.zt.n1+.6335478*m.zt.n2,t=Math.cbrt(t),e=Math.cbrt(e),i=Math.cbrt(i);m.mi.n0=.2104542*t+.7936177*e+-.004072046*i,m.mi.n1=1.977998*t+-2.428592*e+.4505937*i,m.mi.n2=.02590403*t+.7827717*e+-.8086757*i,m.mi.n3=m.zt.n3,m.mi.n0*=100}static QR(){m.mi.n0/=100;var t=(.9999999*m.mi.n0+.3963377*m.mi.n1+.2158037*m.mi.n2)**3,e=(1.000000009*m.mi.n0+-.1055613*m.mi.n1+-.06385417*m.mi.n2)**3,i=(1.00000005*m.mi.n0+-.08948418*m.mi.n1+-1.291485*m.mi.n2)**3;m.zt.n0=1.2268798*t+-.5578149*e+.281391*i,m.zt.n1=-.04057576*t+1.112286*e+-.07171106*i,m.zt.n2=-.07637294*t+-.4214933*e+1.586924*i,m.zt.n3=m.mi.n3}static _R(){var t=180*Math.atan2(m.mi.n2,m.mi.n1)/Math.PI;m.ao.n0=m.mi.n0,m.ao.n1=Math.sqrt(m.mi.n1**2+m.mi.n2**2),m.ao.n2=0<=t?t:360+t,m.ao.n3=m.mi.n3}static tI(){m.mi.n0=m.ao.n0,m.mi.n1=m.ao.n1*Math.cos(m.ao.n2*Math.PI/180),m.mi.n2=m.ao.n1*Math.sin(m.ao.n2*Math.PI/180),m.mi.n3=m.ao.n3}static WR(){m.mL(),m.$R(),m._R()}static jR(){m.tI(),m.QR(),m.pL()}static ud(t,e){"string"==typeof t?(Yt,m.isValidColor(t)||Xt.n('Color "'+t+'" is not a valid color string for '+e)):t instanceof m||Xt.n("Value for "+e+" must be a color string or a Brush, not "+t)}static Solid=1;static Linear=2;static Radial=3;static Pattern=4;static Lab=1;static HSL=2;static al=K.isUsingDOM()?new $t(null,void 0,{willReadFrequently:!0}).gi:null;static j=new ie;static Yi=new ie;static zt=new ie;static ho=new ie;static mi=new ie;static ao=new ie}class se{Tt="Base";static Layouts=new L;static definePanelLayout(t,e){e.name=t,se.Layouts.add(t,e)}get name(){return this.Tt}set name(t){this.Tt=t}constructor(){}get classType(){return jt}measure(t,e,i,s,n,r,a){}measureElement(t,e,i,s,n){t.wt(e,i,s,n)}arrange(t,e,i){}arrangeElement(t,e,i,s,n,r){t.vt(e,i,s,n,r)}remeasureObject(t){t.oc()}Ji(t,e,i){}}class ne extends se{constructor(){super()}measure(t,i,s,e,n,r,a){var o=e.length,h=t.Jo();for(let t=0;t<o;t++){var l=e[t];if(l.visible||l===h){var u=l.margin,d=u.right+u.left,u=u.top+u.bottom,c=(l.wt(i,s,r,a),l.measuredBounds),d=Math.max(c.width+d,0),c=Math.max(c.height+u,0);let t=l.position.x,e=l.position.y;isFinite(t)||(t=0),isFinite(e)||(e=0),l instanceof V&&l.isGeometryPositioned&&(u=l.strokeWidth/2,t-=u,e-=u),n.unionNoCheck(t,e,d,c)}}}arrange(t,s,e){var n=s.length,t=t.padding,r=e.x-t.left,a=e.y-t.top;for(let i=0;i<n;i++){var o=s[i],h=o.measuredBounds,l=o.margin,u=o.position.x,d=o.position.y;let t=isNaN(u)?-r:u-r,e=isNaN(d)?-a:d-a;o instanceof V&&o.isGeometryPositioned&&(u=o.strokeWidth/2,t-=u,e-=u),o.visible&&o.vt(t+l.left,e+l.top,h.width,h.height)}}}se.definePanelLayout("Position",new ne);class re extends se{constructor(){super()}measure(t,e,i,s,n,r,a){var o=s.length,h=Xt.ct(),l=t.Jo();for(let t=0;t<o;t++){var u,d,c=s[t];!c.visible&&c!==l||(0!==(u=c.qs(!1))&&5!==u?h.push(c):(c.wt(1/0,i,0,a),u=c.margin,c=c.measuredBounds,d=Math.max(c.width+u.right+u.left,0),c=Math.max(c.height+u.top+u.bottom,0),n.width+=d,n.height=Math.max(n.height,c)))}var g=h.length;t.desiredSize.height?i=Math.min(t.desiredSize.height,t.maxSize.height):0!==n.height&&(i=Math.min(n.height,t.maxSize.height));for(let t=0;t<g;t++){var m,f,p=h[t];!p.visible&&p!==l||(f=(m=p.margin).right+m.left,m=m.top+m.bottom,p.wt(1/0,i,0,a),p=p.measuredBounds,f=Math.max(p.width+f,0),p=Math.max(p.height+m,0),n.width+=f,n.height=Math.max(n.height,p))}Xt.ot(h)}arrange(i,e,s){var n=e.length,r=i.padding,a=r.top,o=i.isOpposite;let h=o?s.width:r.left;for(let t=0;t<n;t++){var l=a,u=e[t];if(u.visible){var d=u.measuredBounds,c=u.margin,g=c.top+c.bottom,m=a+r.bottom;let t=d.height;var f=u.qs(!1),f=(t=isNaN(u.desiredSize.height)&&2===f||4===f?Math.max(s.height-g-m,0):t)+g+m;let e=u.alignment;(e=e.isDefault()?i.defaultAlignment:e).isSpot()||(e=J.Center),o&&(h-=d.width+c.left+c.right),u.vt(h+e.offsetX+c.left,l+e.offsetY+c.top+(s.height*e.y-f*e.y),d.width,t),o||(h+=d.width+c.left+c.right)}}}}se.definePanelLayout("Horizontal",new re);class ae extends se{constructor(){super()}measure(t,e,i,s,n,r,a){var o=s.length,h=Xt.ct(),l=t.Jo();for(let t=0;t<o;t++){var u,d,c=s[t];!c.visible&&c!==l||(0!==(u=c.qs(!1))&&4!==u?h.push(c):(d=(u=c.margin).right+u.left,u=u.top+u.bottom,c.wt(e,1/0,r,0),c=c.measuredBounds,d=Math.max(c.width+d,0),c=Math.max(c.height+u,0),n.Do(Math.max(n.width,d),n.height+c)))}var g=h.length;if(0!==g){t.desiredSize.width?e=Math.min(t.desiredSize.width,t.maxSize.width):0!==n.width&&(e=Math.min(n.width,t.maxSize.width));for(let t=0;t<g;t++){var m,f,p=h[t];!p.visible&&p!==l||(f=(m=p.margin).right+m.left,m=m.top+m.bottom,p.wt(e,1/0,r,0),p=p.measuredBounds,f=Math.max(p.width+f,0),p=Math.max(p.height+m,0),n.width=Math.max(n.width,f),n.height+=p)}Xt.ot(h)}}arrange(i,e,s){var n=e.length,r=i.padding,a=r.left,o=i.isOpposite;let h=o?s.height:r.top;for(let t=0;t<n;t++){var l=a,u=e[t];if(u.visible){var d=u.measuredBounds,c=u.margin,g=c.left+c.right,m=a+r.right;let t=d.width;var f=u.qs(!1),f=(t=isNaN(u.desiredSize.width)&&2===f||5===f?Math.max(s.width-g-m,0):t)+g+m;let e=u.alignment;(e=e.isDefault()?i.defaultAlignment:e).isSpot()||(e=J.Center),o&&(h-=d.height+c.bottom+c.top),u.vt(l+e.offsetX+c.left+(s.width*e.x-f*e.x),h+e.offsetY+c.top,t,d.height),o||(h+=d.height+c.bottom+c.top)}}}}se.definePanelLayout("Vertical",new ae);class oe extends se{constructor(){super()}measure(A,e,i,s,w,t,n){var r=s.length;if(0!==r){var a=A.findMainElement();let l=a.margin,u=0,d=0;var o=l.right+l.left,h=l.top+l.bottom;a.wt(e,i,t,n);let c=a.measuredBounds,g=c.width,m=c.height,f=Math.max(g+o,0),p=Math.max(m+h,0);t=A.isClipping,n=Z.H(-l.left,-l.top,f,p);let v=Z.H(0,0,g,m),y=(this.D2(a,v,!0),g=v.width,m=v.height,!0);var b=A.Jo();let x;for(let t=0;t<r;t++){var P=s[t];let o=e,h=i;if(P!==a&&(P.visible||P===b)){let t=(l=P.margin).left,e=l.top;switch(u=l.right+l.left,d=l.top+l.bottom,x=P.qs(!1)){case 2:o=g,h=m,u=0,d=0,t=0,e=0;break;case 5:o=g,u=0,t=0;break;case 4:h=m,d=0,e=0}P.wt(o,h,0,0),c=P.measuredBounds,f=Math.max(c.width+u,0),p=Math.max(c.height+d,0);let i=P.alignment,s=((i=i.isDefault()?A.defaultAlignment:i).isSpot()||(i=J.Center),P.alignmentFocus),n=(s.isDefault()&&(s=J.Center),null),r=(P instanceof jt&&""!==P.fo&&(n=P.findObject(P.fo))===P&&(n=null),v.x-t),a=v.y-e;if(null!==n){P.vt(0,0,c.width,c.height);var S=n.actualBounds,k=U.H(S.x+(s.x*S.width-s.offsetX),S.y+(s.y*S.height-s.offsetY));for(n=n.panel;n!==P;)n.D.Pt(k),n=n.panel;r+=i.x*g+i.offsetX-k.x,a+=i.y*m+i.offsetY-k.y,U.o(k)}else r+=i.x*g+i.offsetX-(s.x*c.width+s.offsetX),a+=i.y*m+i.offsetY-(s.y*c.height+s.offsetY);y?(y=!1,w.e(r,a,f,p)):w.unionNoCheck(r,a,f,p)}}switch(y?w.c(n):t?w.intersect(v.x,v.y,v.width,v.height):w.unionNoCheck(n.x,n.y,n.width,n.height),Z.o(n),Z.o(v),x=1===(x=a.stretch)?a.qs(!1):x){case 0:return;case 2:if(isFinite(e)||isFinite(i))break;return;case 5:if(isFinite(e))break;return;case 4:if(isFinite(i))break;return}c=a.measuredBounds,g=c.width,m=c.height,f=Math.max(g+o,0),p=Math.max(m+h,0),l=a.margin,v=Z.H(-l.left,-l.top,f,p),this.D2(a,v,!0),g=v.width,m=v.height;for(let t=0;t<r;t++){var M=s[t];if(M!==a&&(M.visible||M===b)){l=M.margin,u=l.right+l.left,d=l.top+l.bottom,c=M.measuredBounds,f=Math.max(c.width+u,0),p=Math.max(c.height+d,0);let t=M.alignment,e=((t=t.isDefault()?A.defaultAlignment:t).isSpot()||(t=J.Center),M.alignmentFocus);e.isDefault()&&(e=J.Center),y?(y=!1,w.e(t.x*g+t.offsetX-(e.x*c.width+e.offsetX)-l.left,t.y*m+t.offsetY-(e.y*c.height+e.offsetY)-l.top,f,p)):w.unionNoCheck(t.x*g+t.offsetX-(e.x*c.width+e.offsetX)-l.left,t.y*m+t.offsetY-(e.y*c.height+e.offsetY)-l.top,f,p)}}y?w.c(n):t?w.intersect(v.x,v.y,v.width,v.height):w.unionNoCheck(n.x,n.y,n.width,n.height),Z.o(v)}}arrange(r,e,a){var i=e.length;if(0!==i){var o=r.findMainElement(),t=o.measuredBounds,h=t.width,t=t.height,l=r.padding,u=l.left,d=l.top;let s=u-a.x,n=d-a.y;o.vt(s,n,h,t);var c=Z.H(0,0,h,t);this.D2(o,c,!1);for(let t=0;t<i;t++){var g=e[t];if(g!==o){var m=g.measuredBounds,f=m.width,m=m.height;let t=g.alignment,e=((t=t.isDefault()?r.defaultAlignment:t).isSpot()||(t=J.Center),g.alignmentFocus),i=(e.isDefault()&&(e=J.Center),null);if(null!==(i=g instanceof jt&&""!==g.fo&&(i=g.findObject(g.fo))===g?null:i)){var p=i.actualBounds,v=U.H(p.x+(e.x*p.width-e.offsetX),p.y+(e.y*p.height-e.offsetY));for(i=i.panel;i!==g;)i.D.Pt(v),i=i.panel;s=t.x*c.width+t.offsetX-v.x,n=t.y*c.height+t.offsetY-v.y,U.o(v)}else s=t.x*c.width+t.offsetX-(e.x*f+e.offsetX),n=t.y*c.height+t.offsetY-(e.y*m+e.offsetY);s+=c.x-a.x,n+=c.y-a.y,g.visible&&g.vt(u+s,d+n,f,m)}}Z.o(c)}}D2(t,e,i){let s=null;if(null!==(s=t instanceof jt&&""!==t.fo&&(s=t.findObject(t.fo))===t?null:s))for(i&&t.vt(0,0,e.width,e.height),e.c(s.actualBounds),s=s.panel;s!==t;)s.D.Nw(e),s=s.panel}}se.definePanelLayout("Spot",new oe);class he extends se{constructor(){super()}measure(c,g,m,f,p,v,y){var x=f.length;if(0!==x){var A=c.findMainElement();let e=A.margin,i=g,s=m;var w=e.right+e.left,b=e.top+e.bottom;A.wt(g,m,v,y);let n=A.measuredBounds,r=0,a=null,o=(A instanceof V&&(a=A,r=a.strokeWidth*a.scale),Math.max(n.width+w,0)),h=Math.max(n.height+b,0),l=c.F2(A);var t=l.x*o+l.offsetX,P=l.y*h+l.offsetY,S=c.R2(A),k=S.x*o+S.offsetX,M=S.y*h+S.offsetY;isFinite(g)&&(i=Math.max(Math.abs(t-k)-r,0)),isFinite(m)&&(s=Math.max(Math.abs(P-M)-r,0));let u=0,d=0;0<v&&(u=Math.max(Math.abs(l.x*v+l.offsetX-(S.x*v+S.offsetX))-r,0)),0<y&&(d=Math.max(Math.abs(l.y*y+l.offsetY-(S.y*y+S.offsetY))-r,0));var N=qt.a(),C=(N.e(0,0),c.Jo());for(let t=0;t<x;t++){var L,D,T=f[t];T===A||!T.visible&&T!==C||(L=(e=T.margin).right+e.left,D=e.top+e.bottom,T.wt(i,s,u,d),n=T.measuredBounds,o=Math.max(n.width+L,0),h=Math.max(n.height+D,0),N.e(Math.max(o,N.width),Math.max(h,N.height)))}if(1===x)n=A.measuredBounds,p.width=o,p.height=h,qt.o(N);else{l=c.F2(A);let t=0,e=0,i=((S=c.R2(A)).x!==l.x&&S.y!==l.y&&(t=N.width/Math.abs(S.x-l.x),e=N.height/Math.abs(S.y-l.y)),qt.o(N),r=0,null!==a&&(r=a.strokeWidth*a.scale,6===a.lM())&&(t=e=Math.max(t,e)),t+=Math.abs(l.offsetX)+Math.abs(S.offsetX)+r,e+=Math.abs(l.offsetY)+Math.abs(S.offsetY)+r,A.stretch);switch(i=1===i?A.qs(!1):i){case 0:y=v=0;break;case 2:isFinite(g)&&(t=g),isFinite(m)&&(e=m);break;case 5:isFinite(g)&&(t=g),y=0;break;case 4:v=0,isFinite(m)&&(e=m)}A.oc(),A.wt(t,e,v,y),p.width=A.measuredBounds.width+w,p.height=A.measuredBounds.height+b}}}arrange(e,i,t){var s=i.length;if(0!==s){var n=e.findMainElement(),r=n.measuredBounds,a=Z.a();a.e(0,0,1,1);var o=(v=n.margin).left,h=v.top,l=e.padding,u=l.left,l=l.top,d=r.width,c=r.height,d=(n.vt(u+o,l+h,d,c),e.F2(n)),c=e.R2(n),g=0+d.x*r.width+d.offsetX,d=0+d.y*r.height+d.offsetY,m=0+c.x*r.width+c.offsetX,r=0+c.y*r.height+c.offsetY;a.x=g,a.y=d,a.unionNoCheck(m,r,0,0),a.x+=o+u,a.y+=h+l;for(let t=0;t<s;t++){var f=i[t];if(f!==n){var p=f.measuredBounds,v=f.margin,y=Math.max(p.width+v.right+v.left,0),x=Math.max(p.height+v.top+v.bottom,0);let t=f.alignment;(t=t.isDefault()?e.defaultAlignment:t).isSpot()||(t=J.Center),y=a.width*t.x+t.offsetX-y*t.x+v.left+a.x,x=a.height*t.y+t.offsetY-x*t.y+v.top+a.y,a.width,a.height,f.visible&&(Z.contains(a.x,a.y,a.width,a.height,y,x,p.width,p.height)?f.vt(y,x,p.width,p.height):f.vt(y,x,p.width,p.height,new Z(a.x,a.y,a.width,a.height)))}}Z.o(a)}}}se.definePanelLayout("Auto",new he);class le extends se{constructor(){super(),this.name="Table"}measure(a,r,o,E,s,t,H){let e=E.length;var I=Xt.ct(),K=Xt.ct();for(let t=0;t<e;t++){var i=E[t],n=i instanceof jt?i:null;if(null!==n&&n.ll()&&i.visible){Yt,n.desiredSize.isReal()&&Xt.n(n.toString()+" TableRow/TableColumn Panels cannot set a desiredSize: "+n.desiredSize.toString()),n.minSize.equals(qt.lf)||Xt.n(n.toString()+" TableRow/TableColumn Panels cannot set a minSize: "+n.minSize.toString()),n.maxSize.equals(qt.zk)||Xt.n(n.toString()+" TableRow/TableColumn Panels cannot set a maxSize: "+n.maxSize.toString()),K.push(n);var V=n.F.h,z=V.length;for(let t=0;t<z;t++){var Y=V[t];n.type===jt.TableRow?Y.row=i.row:n.type===jt.TableColumn&&(Y.column=i.column),I.push(Y)}}else I.push(i)}0===(e=I.length)&&(a.getRowDefinition(0),a.getColumnDefinition(0));var h=[];for(let t=0;t<e;t++){var l=I[t];l.visible&&(l.ae(!0),l.ro(!0),h[l.row]||(h[l.row]=[]),h[l.row][l.column]||(h[l.row][l.column]=[]),h[l.row][l.column].push(l))}Xt.ot(I);var X=Xt.ct(),q=Xt.ct(),j=Xt.ct(),u={count:0},d={count:0};let c=r,g=o;var Q=a.Ze,U=a.$e;let m=null;e=Q.length;for(let t=0;t<e;t++)void 0!==(m=Q[t])&&(m.actual=0);e=U.length;for(let t=0;t<e;t++)void 0!==(m=U[t])&&(m.actual=0);let W=h.length,f=0;for(let t=0;t<W;t++)h[t]&&(f=Math.max(f,h[t].length));var Z=Math.min(a.topIndex,W-1),J=Math.min(a.leftIndex,f-1);let p=0,v;W=h.length;var _=a.Jo();for(let i=0;i<W;i++)if(h[i]){f=h[i].length;var $=a.getRowDefinition(i);$.actual=0;for(let e=$.Zi=0;e<f;e++)if(h[i][e]){var tt=a.getColumnDefinition(e),et=(void 0===X[e]&&(tt.actual=0,tt.Zi=0,X[e]=!0),h[i][e]),it=et.length;for(let t=0;t<it;t++){var st,nt,y,x,A,w,b=et[t];!b.visible&&b!==_||(st=1<b.rowSpan,nt=1<b.columnSpan,!st&&!nt||i<Z||e<J||q.push(b),A=(w=b.margin).right+w.left,w=w.top+w.bottom,v=b.F0($,tt,!1),y=b.desiredSize,x=!isNaN(y.width),y=!isNaN(y.height),0===v||x&&y||i<Z||e<J||(nt||void 0!==u[e]||2!==v&&5!==v||(u[e]=-1,u.count++),st||void 0!==d[i]||2!==v&&4!==v||(d[i]=-1,d.count++),st)||nt||j.push(b),b.wt(1/0,1/0,0,0),i<Z||e<J)||(x=b.measuredBounds,y=Math.max(x.width+A,0),A=Math.max(x.height+w,0),1!==b.rowSpan||0!==v&&5!==v||(x=(m=a.getRowDefinition(i)).computeEffectiveSpacing(),w=0===m.at,(p=Math.max(A-m.actual,0))+(w?x:0)>g&&(p=Math.max(g-x,0)),m.Zi=m.Zi+p,m.actual=m.at+p,g=Math.max(g-(p+(w?x:0)),0)),1!==b.columnSpan||0!==v&&4!==v||(A=(m=a.getColumnDefinition(e)).computeEffectiveSpacing(),w=0===m.at,(p=Math.max(y-m.actual,0))+(w?A:0)>c&&(p=Math.max(c-A,0)),m.Zi=m.Zi+p,m.actual=m.at+p,c=Math.max(c-(p+(w?A:0)),0)),(st||nt)&&b.oc())}}}Xt.ot(X);let P=0,S=0;e=a.columnCount;for(let t=0;t<e;t++){var k=U[t];void 0!==k&&(P+=isNaN(k.ke)?k.Zi:k.ke,0!==k.Zi)&&(P+=k.computeEffectiveSpacing())}e=a.rowCount;for(let t=0;t<e;t++){var M=Q[t];void 0!==M&&(S+=isNaN(M.ke)?M.Zi:M.ke,0!==M.Zi)&&(S+=M.computeEffectiveSpacing())}c=Math.max(r-P,0);let rt=g=Math.max(o-S,0),at=c;e=j.length;for(let t=0;t<e;t++){var N=j[t],ot=a.getRowDefinition(N.row),ht=a.getColumnDefinition(N.column),lt=N.measuredBounds,ut=N.margin,dt=ut.right+ut.left,ut=ut.top+ut.bottom;0===ht.Zi&&void 0!==u[N.column]?u[N.column]=Math.max(lt.width+dt,u[N.column]):u[N.column]=null,0===ot.Zi&&void 0!==d[N.row]?d[N.row]=Math.max(lt.height+ut,d[N.row]):d[N.row]=null}let ct=0,gt=0,mt;for(mt in d)"count"!==mt&&(ct+=d[mt]);for(mt in u)"count"!==mt&&(gt+=u[mt]);var C=qt.a();for(let t=0;t<e;t++){var L=j[t];if(L.visible||L===_){var D=a.getRowDefinition(L.row),T=a.getColumnDefinition(L.column);let t=0,e=(t=isFinite(T.width)?T.width:(t=isFinite(c)&&null!==u[L.column]?0===gt?T.actual+c:u[L.column]/gt*at:null===u[L.column]&&T.actual||c,Math.max(0,t-T.computeEffectiveSpacing())),0);switch(e=isFinite(D.height)?D.height:(e=isFinite(g)&&null!==d[L.row]?0===ct?D.actual+g:d[L.row]/ct*rt:null===d[L.row]&&D.actual||g,Math.max(0,e-D.computeEffectiveSpacing())),C.e(Math.max(T.minimum,Math.min(t,T.maximum)),Math.max(D.minimum,Math.min(e,D.maximum))),v=L.F0(D,T,!1)){case 5:C.height=Math.max(C.height,D.actual+g);break;case 4:C.width=Math.max(C.width,T.actual+c)}var ft=L.margin,pt=ft.right+ft.left,ft=ft.top+ft.bottom;L.oc();let i=T.minimum,s=D.minimum;var vt=L.measuredBounds,vt=(0===vt.width&&null!==u[L.column]&&(i=Math.max(i,u[L.column])),0===vt.height&&null!==d[L.row]&&(s=Math.max(i,d[L.row])),L.wt(C.width,C.height,i,s),L.measuredBounds);let n=Math.max(vt.width+pt,0),r=Math.max(vt.height+ft,0);isFinite(c)&&(n=Math.min(n,C.width)),isFinite(g)&&(r=Math.min(r,C.height));pt=D.actual;D.actual=Math.max(D.actual,r),D.Zi=Math.max(D.Zi,r),p=D.actual-pt,g=Math.max(g-p,0),null===d[L.row]&&(rt=Math.max(rt-p,0)),pt=T.actual,T.actual=Math.max(T.actual,n),T.Zi=Math.max(T.Zi,n),p=T.actual-pt,c=Math.max(c-p,0),null===u[L.column]&&(at=Math.max(at-p,0))}}Xt.ot(j);var yt=qt.a(),B=Xt.ct(),G=Xt.ct();if(0!==(e=q.length))for(let e=0;e<W;e++)if(h[e]){f=h[e].length;var xt,At=a.getRowDefinition(e);B[e]=At.actual;for(let t=0;t<f;t++)h[e][t]&&(xt=a.getColumnDefinition(t),G[t]=xt.actual)}for(let t=0;t<e;t++){var F=q[t];if(F.visible||F===_){var R=a.getRowDefinition(F.row),O=a.getColumnDefinition(F.column);switch(C.e(Math.max(O.minimum,Math.min(r,O.maximum)),Math.max(R.minimum,Math.min(o,R.maximum))),v=F.F0(R,O,!1)){case 2:0!==G[O.index]&&(C.width=Math.min(C.width,G[O.index])),0!==B[R.index]&&(C.height=Math.min(C.height,B[R.index]));break;case 5:0!==G[O.index]&&(C.width=Math.min(C.width,G[O.index]));break;case 4:0!==B[R.index]&&(C.height=Math.min(C.height,B[R.index]))}isFinite(O.width)&&(C.width=O.width),isFinite(R.height)&&(C.height=R.height),yt.e(0,0);let e=O.minimum,i=R.minimum;for(let t=1;t<F.rowSpan&&!(F.row+t>=a.rowCount);t++)m=a.getRowDefinition(F.row+t),p=0,p=2===v||4===v?Math.max(m.minimum,0===B[F.row+t]?m.maximum:Math.min(B[F.row+t],m.maximum)):Math.max(m.minimum,isNaN(m.ke)?m.maximum:Math.min(m.ke,m.maximum)),yt.height+=p,i+=m.minimum;for(let t=1;t<F.columnSpan&&!(F.column+t>=a.columnCount);t++)m=a.getColumnDefinition(F.column+t),p=0,p=2===v||5===v?Math.max(m.minimum,0===G[F.column+t]?m.maximum:Math.min(G[F.column+t],m.maximum)):Math.max(m.minimum,isNaN(m.ke)?m.maximum:Math.min(m.ke,m.maximum)),yt.width+=p,e+=m.minimum;C.width+=yt.width,C.height+=yt.height;var wt=F.margin,bt=wt.right+wt.left,wt=wt.top+wt.bottom,Pt=(F.wt(C.width,C.height,e,i),F.measuredBounds),bt=Math.max(Pt.width+bt,0),Pt=Math.max(Pt.height+wt,0);let s=0;for(let t=0;t<F.rowSpan&&!(F.row+t>=a.rowCount);t++)m=a.getRowDefinition(F.row+t),s+=m.total||0;if(s<Pt){let e=Pt-s;var St=Pt-s;if(null!==F.spanAllocation){var kt=F.spanAllocation;for(let t=0;t<F.rowSpan&&!(e<=0||F.row+t>=a.rowCount);t++){var Mt=(m=a.getRowDefinition(F.row+t)).at||0,Nt=kt(F,m,St);Yt,"number"!=typeof Nt&&Xt.n(F+" spanAllocation does not return a number: "+Nt),m.actual=Math.min(m.maximum,Mt+Nt),m.at!==Mt&&(e-=m.at-Mt)}}for(;0<e;){var Ct=m.at||0;if(isNaN(m.height)&&m.maximum>Ct&&(m.actual=Math.min(m.maximum,Ct+e),m.at!==Ct)&&(e-=m.at-Ct),0===m.index)break;m=a.getRowDefinition(m.index-1)}}let n=0;for(let t=0;t<F.columnSpan&&!(F.column+t>=a.columnCount);t++)m=a.getColumnDefinition(F.column+t),n+=m.total||0;if(n<bt){let e=bt-n;var Lt=bt-n;if(null!==F.spanAllocation){var Dt=F.spanAllocation;for(let t=0;t<F.columnSpan&&!(e<=0||F.column+t>=a.columnCount);t++){var Tt=(m=a.getColumnDefinition(F.column+t)).at||0,Bt=Dt(F,m,Lt);Yt,"number"!=typeof Bt&&Xt.n(F+" spanAllocation does not return a number: "+Bt),m.actual=Math.min(m.maximum,Tt+Bt),m.at!==Tt&&(e-=m.at-Tt)}}for(;0<e;){var Gt=m.at||0;if(isNaN(m.width)&&m.maximum>Gt&&(m.actual=Math.min(m.maximum,Gt+e),m.at!==Gt)&&(e-=m.at-Gt),0===m.index)break;m=a.getColumnDefinition(m.index-1)}}}}Xt.ot(q),qt.o(yt),qt.o(C),void 0!==B&&Xt.ot(B),void 0!==G&&Xt.ot(G);let Ft=0,Rt=0;var Ot=a.desiredSize,Et=a.maxSize;v=a.qs(!0),P=0;let Ht=S=0,It=0;e=a.columnCount;for(let t=0;t<e;t++)if(void 0!==U[t]){if(m=a.getColumnDefinition(t),isFinite(m.width)){Ht=(Ht+=m.width)+m.computeEffectiveSpacing();continue}if(2===m.ib()){Ht=(Ht+=m.at)+m.computeEffectiveSpacing();continue}0!==m.at&&(P=(P+=m.at)+m.computeEffectiveSpacing())}Ft=isFinite(Ot.width)?Math.min(Ot.width,Et.width):0!==v&&isFinite(r)?r:P,Ft=Math.max(Ft,isFinite(r)?Math.min(t,r):t),Ft=Math.max(Ft-Ht,0);var Kt=0===P?1:Math.max(Ft/P,1);for(let t=0;t<e;t++)void 0!==U[t]&&(m=a.getColumnDefinition(t),isFinite(m.width)||2===m.ib()||(m.actual=m.at*Kt),m.position=s.width,0!==m.at)&&(s.width+=m.at,s.width+=m.computeEffectiveSpacing());e=a.rowCount;for(let t=0;t<e;t++)if(void 0!==Q[t]){if(m=a.getRowDefinition(t),isFinite(m.height)){It=(It+=m.height)+m.computeEffectiveSpacing();continue}if(2===m.ib()){It=(It+=m.at)+m.computeEffectiveSpacing();continue}0!==m.at&&(S=(S+=m.at)+m.computeEffectiveSpacing())}Rt=isFinite(Ot.height)?Math.min(Ot.height,Et.height):0!==v&&isFinite(o)?o:S,Rt=Math.max(Rt,isFinite(o)?Math.min(H,o):H),Rt=Math.max(Rt-It,0);var Vt=0===S?1:Math.max(Rt/S,1);for(let t=0;t<e;t++)void 0!==Q[t]&&(m=a.getRowDefinition(t),isFinite(m.height)||2===m.ib()||(m.actual=m.at*Vt),m.position=s.height,0!==m.at)&&(s.height+=m.at,s.height+=m.computeEffectiveSpacing());e=K.length;for(let i=0;i<e;i++){var zt=K[i];let t=0,e=0;e=zt.type===jt.TableRow?(t=s.width,(m=a.getRowDefinition(zt.row)).actual):(m=a.getColumnDefinition(zt.column),t=m.actual,s.height),zt.measuredBounds.e(0,0,t,e),zt.ae(!1)}Xt.ot(K),a.xh=h}arrange(m,u,f){var d=u.length,t=m.padding,p=t.left,v=t.top,y=m.xh;if(null!==y){let c=0,g=0;var x=y.length;let e=0;for(let t=0;t<x;t++)y[t]&&(e=Math.max(e,y[t].length));var A=m.Ze,w=m.$e;let i=0,s=0,n=Math.min(m.topIndex,x-1);if(0<A.length){for(;n!==x&&(void 0===A[n]||0===A[n].at);)n++;n=Math.max(Math.min(n,x-1),0),i=-A[n].position}let r=Math.min(m.leftIndex,e-1);if(0<w.length){for(;r!==e&&(void 0===w[r]||0===w[r].at);)r++;r=Math.max(Math.min(r,e-1),0),s=-w[r].position}let a=0,o=0;for(;a!==x&&void 0===A[a];)a++;for(;o!==x&&void 0===w[o];)o++;var b=m.part;let h=m.getRowDefinition(a),l=m.getColumnDefinition(o);for(let t=0;t<u.length;t++){var P,S,k,M=u[t];M instanceof jt&&M.visible&&M.ll()&&(l=M.type===jt.TableRow?(h=m.getRowDefinition(M.row),m.getColumnDefinition(o)):(h=m.getRowDefinition(a),m.getColumnDefinition(M.column)),g=h.position+i+v,0!==h.at&&(g+=h.computeEffectiveSpacingTop(Math.max(a,n))),c=l.position+s+p,0!==l.at&&(c+=l.computeEffectiveSpacingTop(Math.max(o,r))),P=M.measuredBounds,M.hd(),M.actualBounds.ut(),S=M.actualBounds,k=Z.H(S.x,S.y,S.width,S.height),S.x=M.type===jt.TableRow?p:c,S.y=M.type===jt.TableColumn?v:g,S.width=P.width,S.height=P.height,M.actualBounds.w(),M.ro(!1),k.equalsApproxClose(S)||null!==b&&(b.mh(),M.A0(b)),Z.o(k))}var N=qt.a();for(let d=0;d<x;d++)if(y[d]){e=y[d].length;var C=m.getRowDefinition(d);g=C.position+i+v,0!==C.at&&(g+=C.computeEffectiveSpacingTop(Math.max(a,n)));for(let u=0;u<e;u++)if(y[d][u]){var L=m.getColumnDefinition(u),D=(c=L.position+s+p,0!==L.at&&(c+=L.computeEffectiveSpacingTop(Math.max(o,r))),y[d][u]),Q=D.length;for(let l=0;l<Q;l++){var T=D[l],B=T.measuredBounds;N.e(0,0);for(let t=1;t<T.rowSpan&&!(d+t>=m.rowCount);t++){var G=m.getRowDefinition(d+t);0!==G.at&&(N.height+=G.total)}for(let t=1;t<T.columnSpan&&!(u+t>=m.columnCount);t++){var F=m.getColumnDefinition(u+t);0!==F.at&&(N.width+=F.total)}var R=L.at+N.width,O=C.at+N.height,E=c,H=g,U=R,W=O,I=c,K=g;let t=R,e=O,i=(c+R>f.width&&(t=Math.max(f.width-c,0)),g+O>f.height&&(e=Math.max(f.height-g,0)),T.alignment),s=0,n=0,r=0,a=0,o=(i.isDefault()?((i=m.defaultAlignment).isSpot()||(i=J.Center),s=i.x,n=i.y,r=i.offsetX,a=i.offsetY,V=L.alignment,z=C.alignment,V.isSpot()&&(s=V.x,r=V.offsetX),z.isSpot()&&(n=z.y,a=z.offsetY)):(s=i.x,n=i.y,r=i.offsetX,a=i.offsetY),(isNaN(s)||isNaN(n))&&(s=.5,n=.5,r=0,a=0),B.width),h=B.height;var V=T.margin,z=V.left+V.right,Y=V.top+V.bottom,X=T.F0(C,L,!1),R=(!isNaN(T.desiredSize.width)||2!==X&&5!==X||(o=Math.max(R-z,0)),!isNaN(T.desiredSize.height)||2!==X&&4!==X||(h=Math.max(O-Y,0)),T.maxSize),X=T.minSize,O=(o=Math.min(R.width,o),h=Math.min(R.height,h),o=Math.max(X.width,o),h=Math.max(X.height,h),o+z),R=h+Y;E+=U*s-O*s+r+V.left,H+=W*n-R*n+a+V.top,T.visible&&(Z.contains(I,K,t,e,E,H,B.width,B.height)?T.vt(E,H,o,h):T.vt(E,H,o,h,new Z(I,K,t,e)))}}}qt.o(N);for(let t=0;t<d;t++){var q=u[t],j=q instanceof jt?q:null;null!==j&&j.ll()&&(j=q.actualBounds,q.naturalBounds.ut(),q.naturalBounds.e(0,0,j.width,j.height),q.naturalBounds.w())}}}}se.definePanelLayout("Table",new le);class ue extends se{constructor(){super()}measure(t,e,i,s,n,r,a){}arrange(t,e,i){}}se.definePanelLayout("TableRow",new ue);class de extends se{constructor(){super()}measure(t,e,i,s,n,r,a){}arrange(t,e,i){}}se.definePanelLayout("TableColumn",new de);class ce extends se{constructor(){super()}measure(e,i,s,n,t,r,a){1<n.length&&Xt.n("Viewbox Panel cannot contain more than one GraphObject.");var n=n[0],o=(n.v=1,n.oc(),n.wt(1/0,1/0,r,a),n.measuredBounds),h=n.margin,l=h.right+h.left,h=h.top+h.bottom;if(isFinite(i)||isFinite(s)){var u=n.scale,d=o.width,c=o.height,g=Math.max(i-l,0),m=Math.max(s-h,0);let t=1;6===e.viewboxStretch?0!==d&&0!==c&&(t=Math.min(g/d,m/c)):0!==d&&0!==c&&(t=Math.max(g/d,m/c)),0===t&&(t=1e-4),n.v*=t,u!==n.scale&&(n.ae(!0),n.wt(1/0,1/0,r,a))}o=n.measuredBounds,t.width=isFinite(i)?i:Math.max(o.width+l,0),t.height=isFinite(s)?s:Math.max(o.height+h,0)}arrange(t,e,i){var e=e[0],s=e.measuredBounds,n=e.margin,r=n.right+n.left,n=n.top+n.bottom,r=Math.max(s.width+r,0),n=Math.max(s.height+n,0);let a=e.alignment;(a=a.isDefault()?t.defaultAlignment:a).isSpot()||(a=J.Center),e.vt(i.width*a.x-r*a.x+a.offsetX,i.height*a.y-n*a.y+a.offsetY,s.width,s.height)}}se.definePanelLayout("Viewbox",new ce);class ge extends se{constructor(){super()}measure(t,e,i,s,n,r,a){null===t.Pi&&(t.Pi=new ye),this.iI(t),this.eI(t)}arrange(t,e,i){}Ji(t,e,i){var s=t.naturalBounds,n=s.width,s=s.height;e.save(),e.beginPath(),e.rect(0,0,n,s),e.clip(),e.endPath(),this.sI(t,e,i),e.restore(),e.clearContextCache(!1)}sI(n,r,t){let e=n.getDocumentScale()*t.scale;e<=0&&(e=1);var t=n.gridCellSize,a=t.width,o=t.height,h=n.naturalBounds,l=n.actualBounds,u=h.width,d=h.height,c=Math.ceil(u/a),g=Math.ceil(d/o),t=n.gridOrigin,m=t.x,f=t.y,p=n.Pi.np,i=n.F.h,v=i.length;for(let s=0;s<v;s++){var y=i[s];if(y.visible){var x=y.interval||1,A=Math.abs(x);if(!(a*A*e<2)){let i=y.segmentIndex;(i=isFinite(i)&&!isNaN(i)?i:0)<0&&(i=A-Math.min(-i,A)),i=Math.round(i%A);A=y.opacity;let t=1;if(1!==A){if(0===A)continue;t=r.globalAlpha,r.globalAlpha=t*A}var w=p[s];let e=!1;var b=y.strokeDashArray;if(null!==b&&(e=!0,r.enableDash(b,y.strokeDashOffset)),null!==y.stroke&&0<y.strokeWidth&&("LineV"===y.figure||"LineH"===y.figure)){if(r.lineWidth=y.strokeWidth,n.bn(r,y.stroke,!1,!1,h,l),r.beginPath(),"LineV"===y.figure){var P=Math.floor((m-a)/a);for(let t=P;t<=P+c;t++){var S=t*a+m;0<=S&&S<=u&&this.eb(t,x,i,w)&&(r.moveTo(S,0),r.lineTo(S,d))}}else if("LineH"===y.figure){var k=Math.floor((f-o)/o);for(let t=k;t<=k+g;t++){var M=t*o+f;0<=M&&M<=d&&this.eb(t,x,i,w)&&(r.moveTo(0,M),r.lineTo(u,M))}}r.stroke(),r.endPath()}else if(null!==y.fill)if(n.bn(r,y.fill,!0,!1,h,l),"BarV"===y.figure){let e=y.width;isNaN(e)&&(e=a);var N=Math.floor((m-a)/a);for(let t=N;t<=N+c;t++){var C=t*a+m;0<=C+e&&C<=u&&this.eb(t,x,i,w)&&r.fillRect(C,0,e,d)}}else if("BarH"===y.figure){let e=y.height;isNaN(e)&&(e=o);var L=Math.floor((f-o)/o);for(let t=L;t<=L+g;t++){var D=t*o+f;0<=D+e&&D<=d&&this.eb(t,x,i,w)&&r.fillRect(0,D,u,e)}}e&&r.disableDash(),1!==A&&(r.globalAlpha=t)}}}}eb(e,t,i,s){if(t<0)return e%t===i;if(e%t!==i)return!1;var n=s.length;for(let t=0;t<n;t++)if(e%s[t]===i)return!1;return!0}eI(t){var i=[],s=t.F.h,n=s.length;for(let e=0;e<n;e++){var r=s[e],a=[];if(i.push(a),r.visible){var o=r.interval;if(!(o<0)){var h,l,u,r=r.figure,d=this.I2(r);for(let t=0;t<n;t++)t!==e&&((h=s[t]).visible&&(l=h.figure,this.I2(l)===d)&&o<(u=h.interval))&&a.push(u)}}}t.Pi.np=i}I2(t){return"LineV"===t||"BarV"===t}iI(t){let e=1,i=1;var s=t.F.h,n=s.length;for(let t=0;t<n;t++){var r=s[t],a=Math.abs(r.interval);a<2||(this.I2(r.figure)?i=i*a/I.yC(i,a):e=e*a/I.yC(e,a))}var o=t.gridCellSize,t=t.Pi;t.jf.isReal()?t.jf.e(i*o.width,e*o.height):t.jf=new qt(i*o.width,e*o.height)}}se.definePanelLayout("Grid",new ge);class me extends se{constructor(){super()}measure(i,t,e,s,n,O,E){var r=s.length;if(i instanceof X||i instanceof q){let t=null,e=null;if(i instanceof q&&(t=i),i instanceof X&&(e=i,t=e.adornedPart,null===i.uc)&&(i.uc=[]),t instanceof q){var h=t;if(0===r)i.naturalBounds.Do(0,0),i.measuredBounds.e(0,0,0,0);else{var a,o=i instanceof X?null:t.path,l=t.routeBounds,u=i.Zo,d=(u.e(0,0,l.width,l.height),h.points),c=t.pointsCount,g=(null!==e?e.pd(!1):null!==t&&t.pd(!1),l.width),m=l.height,f=i.uc,p=(f.length=0,null!==o&&(this.measureLinkPath(i,g,m,o),a=o.measuredBounds,u.unionRect(a),f.push(a)),H.a()),v=U.a(),y=U.a();for(let t=0;t<r;t++){var x=s[t];if(x!==o){let s=x.measuredBounds;if(x.isPanelMain&&x instanceof V)this.measureLinkPath(i,g,m,x),s=x.measuredBounds,u.unionRect(s),f.push(s);else if(c<2)x.wt(1/0,1/0,0,0),s=x.measuredBounds,u.unionRect(s),f.push(s);else{var A=x.segmentIndex,w=x.segmentFraction;let t=x.alignmentFocus;t.isNoSpot()&&(t=J.Center);var b=x.segmentOrientation,P=x.segmentOffset;let e=0,r=0,a=0,o=0;if(isNaN(A)){var S=h.yt,k=Xt.ct(),S=(S.getPointAndAngleAlongPath(w,k),U.H(k[0],k[1]));o=k[2],0!==b&&(a=h.computeAngle(x,b,o),x.qt=a,x.ae(!0),x.ro(!0)),e=S.x,r=S.y,U.o(S),Xt.ot(k)}else if(A<-c||c<=A){S=U.a();h.wL(S),o=h.midAngle,0!==b&&(a=h.computeAngle(x,b,o),x.qt=a,x.ae(!0),x.ro(!0)),e=S.x-l.x,r=S.y-l.y,U.o(S)}else{let i,s,n=0;if(s=0<=A?(i=d.elt(A),A<c-1?d.elt(A+1):i):(n=c+A,i=d.elt(n),0<n?d.elt(n-1):i),o=0,i.equalsApprox(s)){let t,e;e=0<=A?(t=0<A?d.elt(A-1):i,A<c-2?d.elt(A+2):s):(t=n<c-1?d.elt(n+1):i,1<n?d.elt(n-2):s);var k=t.distanceSquaredPoint(i),M=s.distanceSquaredPoint(e);o=M+10<k?0<=A?t.directionPoint(i):i.directionPoint(t):k+10<M?0<=A?s.directionPoint(e):e.directionPoint(s):0<=A?t.directionPoint(e):e.directionPoint(t)}else o=0<=A?i.directionPoint(s):s.directionPoint(i);0!==b&&(a=h.computeAngle(x,b,o),x.qt=a,x.ae(!0),x.ro(!0)),e=i.x+(s.x-i.x)*w-l.x,r=i.y+(s.y-i.y)*w-l.y}x.wt(1/0,1/0,0,0),s=x.measuredBounds;M=x.naturalBounds;let i=0;x instanceof V&&(i=x.strokeWidth);var N,C,L=M.width+i,D=M.height+i,T=(p.ti(),p.se(-s.x,-s.y),p.v(x.scale,x.scale),p.ys(0===b?x.angle:o,L/2,D/2),22!==b&&26!==b||p.ys(90,L/2,D/2),23!==b&&27!==b||p.ys(-90,L/2,D/2),28===b&&(45<o&&o<135||225<o&&o<315)&&p.ys(-o,L/2,D/2),new Z(0,0,L,D)),B=(v.setRectSpot(T,t),p.Pt(v),-v.x+i/2*x.scale),x=-v.y+i/2*x.scale,G=(y.c(P),isNaN(P.x)),F=isNaN(P.y);G||F?(L=L/2+3,D=D/2+3,N=45<=o&&o<=135,C=225<=o&&o<=315,0===b&&(N||C)?(y.x=F?L:P.y,y.y=G?D:P.x,N?0<=A||isNaN(A)&&w<.5||G&&(y.y=-D):C&&((0<=A||isNaN(A)&&w<.5)&&G&&(y.y=-D),F)&&(y.x=-L)):(G&&(0<=A||isNaN(A)&&w<.5?y.x=L:y.x=-L),F&&(y.y=-D),y.rotate(o))):y.rotate(o),e+=y.x,r+=y.y,T.e(e+B,r+x,s.width,s.height),f.push(T),u.unionRect(T)}}}if(null!==t)for(var R=t.labelNodes;R.next();)R.value.wt(1/0,1/0);i.Zo=u,i.position.e(l.x+u.x,l.y+u.y),n.Do(u.width||0,u.height||0),H.o(p),U.o(v),U.o(y)}}}}arrange(i,s,t){var n=s.length;if(i instanceof X||i instanceof q){let t=i,e=null;i instanceof X&&(e=i,t=e.adornedPart);var r=i,a=i instanceof X?null:t.path,o=i.uc;if(0!==o.length){let e=0;null!==a&&e<o.length&&(m=o[e],e++,a.vt(m.x-r.Zo.x,m.y-r.Zo.y,m.width,m.height));for(let t=0;t<n;t++){var h,l=s[t];l!==a&&e<o.length&&(h=o[e],e++,l.vt(h.x-r.Zo.x,h.y-r.Zo.y,h.width,h.height))}}var u=t.points,d=u.count;if(2<=d&&r instanceof q)for(var c=r.labelNodes;c.next();){var g=c.value;r.nI(g,d,u)}(null!==e?e:t).pd(!1);var m=i.xL(U.a());i.location.e(i.position.x+m.x,i.position.y+m.y),U.o(m)}}measureLinkPath(e,i,s,n){if(!1!==n.Ko()){let t=n.strokeWidth;var r;0===t&&e instanceof X&&e.type===jt.Link&&e.adornedObject instanceof V&&(t=e.adornedObject.strokeWidth),t*=n.v,e instanceof q&&null!==e.yt?(r=e.geometry.bounds,n.oo(r.x-t/2,r.y-t/2,r.width+t,r.height+t)):e instanceof X&&null!==e.adornedPart.yt?(r=e.adornedPart.yt.bounds,n.oo(r.x-t/2,r.y-t/2,r.width+t,r.height+t)):n.oo(-t/2,-t/2,i+t,s+t),n.oI(),n.ae(!1)}}}se.definePanelLayout("Link",new me);class fe extends se{constructor(){super()}measure(e,t,i,s,n,r,a){var o=e.findMainElement(),h=(e.Qe=[],o.margin),l=h.right+h.left,u=h.top+h.bottom,t=(o.wt(t,i,r,a),o.measuredBounds),i=t.width,r=t.height,a=Math.max(i+l,0),t=Math.max(r+u,0),i=new Z(-h.left,-h.top,a,t),d=(e.Qe.push(i),n.c(i),this.determineGraduatedMarks(e,o),e.Cs);if(null!==d){var c=s.length;for(let t=0;t<c;t++){var g=s[t],m=d[t];g.visible&&g!==o&&0!==m.length&&(g instanceof V?this.measureGraduatedTicks(e,g,m,n):g instanceof z&&this.measureGraduatedLabels(e,g,m,n),g.ae(!1))}}}arrange(t,s,n){if(null!==t.Qe){var r=t.findMainElement(),a=t.Cs;if(null!==a){var o=t.Qe;let e=0,i=o[e];e++,null!==r&&r.vt(i.x-n.x,i.y-n.y,i.width,i.height);var h=s.length;for(let t=0;t<h;t++){var l=s[t],u=a[t];l.visible&&l!==r&&0!==u.length&&(i=o[e],e++,l.vt(i.x-n.x,i.y-n.y,i.width,i.height))}t.Qe=null}}}measureGraduatedTicks(t,i,s,e){let n=i.alignmentFocus;n.isNoSpot()&&(n=J.TopCenter);var r=i.angle,r=(i.qt=0,i.wt(1/0,1/0,0,0),i.qt=r,i.measuredBounds),a=r.width,o=r.height,r=Z.H(0,0,a,o),h=U.a(),l=(h.setRectSpot(r,n),Z.o(r),-h.x),u=-h.y,d=new Z,c=s.length;for(let e=0;e<c;e++){var g=s[e],m=g.pt.x,f=g.pt.y,p=g.angle;for(let t=0;t<4;t++){switch(t){case 0:h.e(l,u);break;case 1:h.e(l+a,u);break;case 2:h.e(l,u+o);break;case 3:h.e(l+a,u+o)}h.rotate(p+i.angle),h.offset(m,f),0===e&&0===t?d.e(h.x,h.y,0,0):d.unionPoint(h),h.offset(-m,-f),h.rotate(-p-i.angle)}}U.o(h),null!==t.Qe&&t.Qe.push(d),e.unionNoCheck(d.x,d.y,d.width,d.height)}measureGraduatedLabels(t,e,i,s){null===t.Fe&&(t.Fe=new z);var n=t.Fe;this.bL(e,n);let r=e.alignmentFocus;r.isNoSpot()&&(r=J.TopCenter);var a=e.segmentOrientation,o=e.segmentOffset,h=new Z;let l,u,d,c=0,g=0;var m=i.length;for(let t=0;t<m;t++){var f=i[t],p=(l=f.pt.x,u=f.pt.y,d=f.angle,c=e.angle,g=e.angle,0!==a&&(g=21===a||25===a?d+e.angle:d,c=q.computeAngle(a,g)),n.qt=c,n.text=f.text||"",n.wt(1/0,1/0,0,0),n.measuredBounds),v=n.naturalBounds,y=v.width,x=v.height,A=H.a(),w=(A.ti(),A.se(-p.x,-p.y),A.v(n.scale,n.scale),A.ys(g,y/2,x/2),22!==a&&26!==a||A.ys(90,y/2,x/2),23!==a&&27!==a||A.ys(-90,y/2,x/2),28===a&&(45<d&&d<135||225<d&&d<315)&&A.ys(-d,y/2,x/2),Z.H(0,0,y,x)),b=U.a(),P=(b.setRectSpot(w,r),A.Pt(b),-b.x),S=-b.y,k=U.a(),y=(k.c(o),isNaN(k.x)&&(k.x=y/2+3),isNaN(k.y)&&(k.y=-(x/2+3)),k.rotate(d),l+=k.x+P,u+=k.y+S,new Z(l,u,p.width,p.height)),x=new Z(p.x,p.y,p.width,p.height),P=new Z(v.x,v.y,v.width,v.height);f.labelAngle=c,f.lineCount=n.lineCount,f.lines=n.getMetrics(),f.actualBounds=y,f.measuredBounds=x,f.naturalBounds=P,0===t?h.c(y):h.unionRect(y),U.o(k),U.o(b),Z.o(w),H.o(A)}null!==t.Qe&&t.Qe.push(h),s.unionNoCheck(h.x,h.y,h.width,h.height)}determineGraduatedMarks(e,a){var o=a.geometry,h=a.strokeWidth,l=o.flattenedSegments,u=o.flattenedLengths,d=o.flattenedTotalLength,i=l.length;let s=0,n=0;var c=Xt.ct();for(let t=0;t<i;t++){var r=l[t],g=[],m=(s=0,n=0,r.length);for(let t=0;t<m;t+=2){var f=r[t],p=r[t+1];if(0===t);else{let t=180*Math.atan2(p-n,f-s)/Math.PI;t<0&&(t+=360),g.push(t)}s=f,n=p}c.push(g)}var v=this.rI(e),y=e.F.h,x=y.length;let A=0,w,b;e.Cs=[];for(let t=0;t<x;t++){var P=y[t],S=[];if(P.visible&&P!==a){var k=Math.abs(P.interval),M=e.graduatedTickUnit;if(!(M*k*d/e.graduatedRange<2&&null===P.graduatedSkip)){let i=u[0][0],s=0,n=0;w=d*P.graduatedStart-1e-4,b=d*P.graduatedEnd+1e-4;var N=M*k;let r=e.graduatedTickBase;r<e.graduatedMin?(M=(M=(e.graduatedMin-r)/N)%1==0?M:Math.floor(1+M),r+=M*N):r>e.graduatedMin+N&&(k=Math.floor((r-e.graduatedMin)/N),r-=k*N);var C=v[t],L=r,D=1e-6*e.graduatedMax;for(let t=1;r<=e.graduatedMax+D;t++){if(this.lI(e,r-e.graduatedTickBase,C)&&(r>e.graduatedMax&&(r=e.graduatedMax),null===P.graduatedSkip||P instanceof z&&!P.graduatedSkip(r,P)||P instanceof V&&!P.graduatedSkip(r,P))&&w<=(A=(A=(r-e.graduatedMin)*d/e.graduatedRange)>d?d:A)&&A<=b){let e=c[s][n],t=u[s][n];for(;s<u.length;){for(;A>i&&n<u[s].length-1;)n++,e=c[s][n],t=u[s][n],i+=t;if(A<=i)break;s++,n=0,e=c[s][n],t=u[s][n],i+=t}var T=l[s],B=T[2*n],G=T[2*n+1],F=T[2*n+2],R=T[2*n+3],O=(A-(i-t))/t,F=new U(B+(F-B)*O+h/2-o.bounds.x,G+(R-G)*O+h/2-o.bounds.y);if(F.scale(a.scale,a.scale),e=this.hI(e,O,T,c[s],n),P instanceof z){let t="";""!==(t=null!==P.graduatedFunction?null!=(t=P.graduatedFunction(r,P))?t.toString():"":(+r.toFixed(2)).toString())&&S.push({pt:F,angle:e,text:t})}else S.push({pt:F,angle:e})}r=L+t*N}}}e.Cs.push(S)}Xt.ot(c)}hI(i,s,t,n,r){if(!(s<.5005&&.4995<s)){let e=i;if(s<.5?0<r?e=n[r-1]:I.q(t[0],t[t.length-2])&&I.q(t[1],t[t.length-1])&&(e=n[n.length-1]):.5<s&&(r+1<n.length?e=n[r+1]:I.q(t[0],t[t.length-2])&&I.q(t[1],t[t.length-1])&&(e=n[0])),i!==e){let t=Math.abs(i-e);if(180<t&&(i<e?i+=360:e+=360,t=Math.abs(i-e)),s<5e-4||.9995<s)return(i+e)/2%360;if(t<10)return(i*(r=1-Math.abs(.5-s))+e*(1-r))%360}}return i}rI(t){if(null===t.cs){var i=[],s=t.F.h,n=s.length;for(let e=0;e<n;e++){var r=s[e],a=[];if(i.push(a),r.visible){var o,h,l=r.interval;if(!(l<0))for(let t=0;t<n;t++)t!==e&&((o=s[t]).visible&&r.constructor===o.constructor&&l<(h=o.interval))&&a.push(h)}}t.cs=i}return t.cs}lI(e,i,s){var n=s.length;for(let t=0;t<n;t++){var r=i%(s[t]*e.graduatedTickUnit),a=1e-6*e.graduatedTickUnit;if(r<a&&-a<r)return!1}return!0}Ji(i,s,n){var t=n.sa,e=(n.sa=!0,i.naturalBounds),r=e.width,e=e.height,a=s instanceof _t,o=(s.save(),s.beginPath(),s.rect(-1,-1,r+1,e+1),s.clip(),s.endPath(),i.findMainElement());o.Ji(s,n);let h=i.getDocumentScale()*n.scale;h<=0&&(h=1);var l=o.actualBounds,u=i.F.h,d=i.Cs,c=u.length;for(let t=0;t<c;t++){var g=u[t],m=d[t],f=m.length;if(g.visible&&g!==o&&0!==m.length)if(g instanceof V){if(!(i.graduatedTickUnit*g.interval*o.geometry.flattenedTotalLength/i.graduatedRange*h<2&&null===g.graduatedSkip)){var p=g.measuredBounds,v=g.strokeWidth*g.scale;let e=g.alignmentFocus;e.isNoSpot()&&(e=J.TopCenter);for(let t=0;t<f;t++){var y=m[t].pt,x=m[t].angle;this.aI(g,y,l,x,p,v,e),g.Ji(s,n),a&&(i.svg.appendChild(g.svg),g.svg=null),g.nl.ti()}}}else if(g instanceof z){null===i.Fe&&(i.Fe=new z);var A=i.Fe;this.bL(g,A);for(let t=0;t<f;t++){var w,b=m[t];b.actualBounds&&b.measuredBounds&&b.naturalBounds&&(A.fI(b),w=b.actualBounds,A.vt(w.x,w.y,w.width,w.height),this.cI(A,l,w,b.measuredBounds,b.naturalBounds),A.rl=g.part,A.vs=g.panel,A.Ji(s,n),A.vs=null,A.rl=null,a)&&(i.svg.appendChild(A.svg),A.svg=null)}}}n.sa=t,s.restore(),s.clearContextCache(!0)}aI(t,e,i,s,n,r,a){var o=t.nl;o.ti(),o.se(e.x+i.x,e.y+i.y),o.ys(s+t.angle,0,0),o.se(-n.width*a.x+a.offsetX+r/2,-n.height*a.y+a.offsetY+r/2),o.v(t.scale,t.scale),t.cd(!1),t.ch.set(t.nl),t.Qf=t.scale,t.Ma(!1)}cI(t,e,i,s,n){var r=t.nl;r.ti(),r.se(i.x+e.x,i.y+e.y),r.se(-s.x,-s.y),t.P0(r,n.x,n.y,n.width,n.height),t.cd(!1),t.ch.set(t.nl),t.Qf=t.scale,t.Ma(!1)}bL(t,e){e.uI(t)}}se.definePanelLayout("Graduated",new fe);(pe={})[pe.Uniform=6]="Uniform",pe[pe.UniformToFill=7]="UniformToFill";var pe;class jt extends y{nt;F;ei;yd;Jn;fl;fo;Zo;O2;B;wd;gt;Pi;si;xd;bh;Js;constructor(t,e){var i;super(),this.nt=null,void 0===t?this.nt=jt.Position:"string"==typeof t?null!==(i=se.Layouts.getValue(t))&&(this.nt=i):t instanceof se?this.nt=t:t&&(this.nt=jt.Position,e=t),null===this.nt&&Xt.n("Panel type not specified or PanelLayout not loaded: "+t),this.l|=4194304|(this.nt===jt.Grid?1048576:0),this.F=new O,this.ei=E.qg,this.yd=J.Default,this.Jn=1,this.fl=null,this.fo="",this.Zo=new Z(NaN,NaN,NaN,NaN),this.O2=null,this.B=null,this.wd=6,this.Pi=null,this.gt=null,this.si=null,this.xd=NaN,this.bh=null,this.Js=null,e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),t.nt=this.nt,t.ei=this.ei.L(),t.yd=this.yd.L(),t.Jn=this.Jn,t.fo=this.fo,t.Zo.c(this.Zo),null!==this.B&&(t.B=this.B.copy(t)),t.wd=this.wd,null!==this.gt&&(t.gt=this.gt.copy()),null!==this.Pi&&(t.Pi=this.Pi.copy()),t.si=this.si,t.xd=this.xd,t.bh=this.bh}qo(e){super.qo(e),e.F=this.F;var i=e.F.h,s=i.length;for(let t=0;t<s;t++)i[t].vs=e;e.fl=null}copy(){var e=super.copy();if(null===e)return null;var i=this.F.h,s=i.length;for(let t=0;t<s;t++){var n=i[t].copy();e.dI(n)}return e}toString(){return"Panel("+this.type.name+")#"+C.ps(this)}get type(){return this.nt}set type(t){var e=this.nt;e!==t&&(this.nt=t,this.dc=this.nt===jt.Grid,this.u(),this.i("type",e,t))}get elements(){return this.F.iterator}get naturalBounds(){return this.Hi}get padding(){return this.ei}set padding(t){"number"==typeof t?(t<0&&Xt.G(t,">= 0",jt,"padding"),t=new E(t)):(Xt.s(t,E,jt,"padding"),t.left<0&&Xt.G(t.left,">= 0",jt,"padding:value.left"),t.right<0&&Xt.G(t.right,">= 0",jt,"padding:value.right"),t.top<0&&Xt.G(t.top,">= 0",jt,"padding:value.top"),t.bottom<0&&Xt.G(t.bottom,">= 0",jt,"padding:value.bottom"));var e=this.ei;e.equals(t)||(t=t.L(),this.ei=t,this.u(),this.i("padding",e,t))}get defaultAlignment(){return this.yd}set defaultAlignment(t){var e=this.yd;e.equals(t)||(Yt,Xt.s(t,J,jt,"defaultAlignment"),t=t.L(),this.yd=t,this.u(),this.i("defaultAlignment",e,t))}get defaultStretch(){return this.Jn}set defaultStretch(t){var e=this.Jn;e!==t&&(this.Jn=t,this.u(),this.i("defaultStretch",e,t))}get defaultSeparatorPadding(){return null!==this.B?this.B.op:E.qg}set defaultSeparatorPadding(t){"number"==typeof t?t=new E(t):(Yt,Xt.s(t,E,jt,"defaultSeparatorPadding"));var e=this.defaultSeparatorPadding;e.equals(t)||(t=t.L(),null===this.B&&(this.B=new xe),this.B.op=t,this.u(),this.i("defaultSeparatorPadding",e,t))}get defaultRowSeparatorStroke(){return null!==this.B?this.B.rp:null}set defaultRowSeparatorStroke(t){var e=this.defaultRowSeparatorStroke;e!==t&&(null===t||"string"==typeof t||t instanceof m)&&(t instanceof m&&t.w(),null===this.B&&(this.B=new xe),this.B.rp=t,this.T(),this.i("defaultRowSeparatorStroke",e,t))}get defaultRowSeparatorStrokeWidth(){return null!==this.B?this.B.lp:1}set defaultRowSeparatorStrokeWidth(t){var e=this.defaultRowSeparatorStrokeWidth;e!==t&&isFinite(t)&&0<=t&&(null===this.B&&(this.B=new xe),this.B.lp=t,this.u(),this.i("defaultRowSeparatorStrokeWidth",e,t))}get defaultRowSeparatorDashArray(){return null!==this.B?this.B.hp:null}set defaultRowSeparatorDashArray(i){var t=this.defaultRowSeparatorDashArray;if(t!==i){if(null===i||Array.isArray(i)||Xt.Bi(i,"Array",jt,"defaultRowSeparatorDashArray:value"),null!==i){var s=i.length;let e=0;for(let t=0;t<s;t++){var n=i[t];"number"==typeof n&&0<=n&&isFinite(n)||Xt.n("defaultRowSeparatorDashArray value "+n+" at index "+t+" must be a positive number or zero."),e+=n}if(0===e){if(null===t)return;i=null}}null===this.B&&(this.B=new xe),this.B.hp=i,this.T(),this.i("defaultRowSeparatorDashArray",t,i)}}get defaultColumnSeparatorStroke(){return null!==this.B?this.B.ap:null}set defaultColumnSeparatorStroke(t){var e=this.defaultColumnSeparatorStroke;e!==t&&(null===t||"string"==typeof t||t instanceof m)&&(t instanceof m&&t.w(),null===this.B&&(this.B=new xe),this.B.ap=t,this.T(),this.i("defaultColumnSeparatorStroke",e,t))}get defaultColumnSeparatorStrokeWidth(){return null!==this.B?this.B.fp:1}set defaultColumnSeparatorStrokeWidth(t){var e=this.defaultColumnSeparatorStrokeWidth;e!==t&&isFinite(t)&&0<=t&&(null===this.B&&(this.B=new xe),this.B.fp=t,this.u(),this.i("defaultColumnSeparatorStrokeWidth",e,t))}get defaultColumnSeparatorDashArray(){return null!==this.B?this.B.cp:null}set defaultColumnSeparatorDashArray(i){var t=this.defaultColumnSeparatorDashArray;if(t!==i){if(null===i||Array.isArray(i)||Xt.Bi(i,"Array",jt,"defaultColumnSeparatorDashArray:value"),null!==i){var s=i.length;let e=0;for(let t=0;t<s;t++){var n=i[t];"number"==typeof n&&0<=n&&isFinite(n)||Xt.n("defaultColumnSeparatorDashArray value "+n+" at index "+t+" must be a positive number or zero."),e+=n}if(0===e){if(null===t)return;i=null}}null===this.B&&(this.B=new xe),this.B.cp=i,this.T(),this.i("defaultColumnSeparatorDashArray",t,i)}}get xh(){return null!==this.B?this.B.xh:null}set xh(t){null===this.B&&(this.B=new xe),this.B.xh=t}get viewboxStretch(){return this.wd}set viewboxStretch(t){var e=this.wd;e!==t&&(this.wd=t,this.u(),this.i("viewboxStretch",e,t))}get gridCellSize(){return null!==this.Pi?this.Pi.bd:qt.oC}set gridCellSize(t){null===this.Pi&&(this.Pi=new ye);var e,i=this.Pi.bd;i.equals(t)||(t.isReal()&&0!==t.width&&0!==t.height||Xt.n("Invalid Panel.gridCellSize: "+t),this.Pi.bd=t.L(),null!==(e=this.diagram)&&this===e.grid&&e._r(),this.T(),this.i("gridCellSize",i,t))}get gridOrigin(){return null!==this.Pi?this.Pi.kd:U.To}set gridOrigin(t){null===this.Pi&&(this.Pi=new ye);var e,i=this.Pi.kd;i.equals(t)||(t.isReal()||Xt.n("Invalid Panel.gridOrigin: "+t),this.Pi.kd=t.L(),null!==(e=this.diagram)&&this===e.grid&&e._r(),this.T(),this.i("gridOrigin",i,t))}get graduatedMin(){return null!==this.gt?this.gt.dp:0}set graduatedMin(t){Xt.r(t,jt,"graduatedMin");var e=this.graduatedMin;e!==t&&(null===this.gt&&(this.gt=new ve),this.gt.dp=t,this.u(),this.i("graduatedMin",e,t),this.ic())&&null!==(e=this.part)&&this.Sa(e,"graduatedRange")}get graduatedMax(){return null!==this.gt?this.gt.gp:100}set graduatedMax(t){Xt.r(t,jt,"graduatedMax");var e=this.graduatedMax;e!==t&&(null===this.gt&&(this.gt=new ve),this.gt.gp=t,this.u(),this.i("graduatedMax",e,t),this.ic())&&null!==(e=this.part)&&this.Sa(e,"graduatedRange")}get graduatedRange(){return this.graduatedMax-this.graduatedMin}get graduatedTickUnit(){return null!==this.gt?this.gt.mp:10}set graduatedTickUnit(t){Xt.r(t,jt,"graduatedTickUnit");var e=this.graduatedTickUnit;e!==t&&0<t&&(null===this.gt&&(this.gt=new ve),this.gt.mp=t,this.u(),this.i("graduatedTickUnit",e,t))}get graduatedTickBase(){return null!==this.gt?this.gt.pp:0}set graduatedTickBase(t){Xt.r(t,jt,"graduatedTickBase");var e=this.graduatedTickBase;e!==t&&(null===this.gt&&(this.gt=new ve),this.gt.pp=t,this.u(),this.i("graduatedTickBase",e,t))}get Cs(){return null!==this.gt?this.gt.Cs:null}set Cs(t){null!==this.gt?this.gt.Cs=t:null!==t&&(this.gt=new ve,this.gt.Cs=t)}get Qe(){return null!==this.gt?this.gt.Qe:null}set Qe(t){null!==this.gt?this.gt.Qe=t:null!==t&&(this.gt=new ve,this.gt.Qe=t)}get cs(){return null!==this.gt?this.gt.cs:null}set cs(t){null!==this.gt?this.gt.cs=t:null!==t&&(this.gt=new ve,this.gt.cs=t)}get Fe(){return null!==this.gt?this.gt.Fe:null}set Fe(t){null!==this.gt?this.gt.Fe=t:null!==t&&(this.gt=new ve,this.gt.Fe=t)}A0(e){super.A0(e);var i=this.F.h,s=i.length;for(let t=0;t<s;t++)i[t].A0(e)}ph(e,i){if(this.nt===jt.Grid)e.commitTransform(),this.nt.Ji(this,e,i);else if(this.nt===jt.Graduated)e.commitTransform(),this.nt.Ji(this,e,i);else{this.nt===jt.Table&&(e.commitTransform(),e instanceof _t?(t=e.currentElement,e.currentElement=e.newGroup2("gojs-ts"),this.E2(e,i),e.endGroup(),e.currentElement=t):this.E2(e,i));var t,s=this.isClipping&&this.nt===jt.Spot,n=(s&&e.save(),this.findMainElement()),r=this.F.h,a=r.length;for(let t=0;t<a;t++){var o=r[t];s&&o===n&&(e.clipInsteadOfFill=!0),o.Ji(e,i),s&&o===n&&(e.clipInsteadOfFill=!1)}s&&(e.restore(),e.clearContextCache(!0))}}E2(t,e){t.lineCap="butt";var i=0<this.rowCount?this.Ze:null,s=0<this.columnCount?this.$e:null;null!==i&&this.sb(t,e,!0,i,!0),null!==s&&this.sb(t,e,!1,s,!0),null!==i&&this.kL(t,!0,i),null!==s&&this.kL(t,!1,s),null!==i&&this.sb(t,e,!0,i,!1),null!==s&&this.sb(t,e,!1,s,!1)}kL(r,a,e){var i=e.length,o=this.actualBounds,h=this.naturalBounds;let s=!0;for(let t=0;t<i;t++){var l=e[t];if(void 0!==l&&0!==l.actual)if(s)s=!1;else{if(a){if(l.position>h.height)continue}else if(l.position>h.width)continue;let s=l.separatorStrokeWidth,n=(isNaN(s)&&(s=a?this.defaultRowSeparatorStrokeWidth:this.defaultColumnSeparatorStrokeWidth),l.separatorStroke);if(null===n&&(n=a?this.defaultRowSeparatorStroke:this.defaultColumnSeparatorStroke),0!==s&&null!==n){this.bn(r,n,!1,!1,h,o);let t=!1,e=l.separatorDashArray;null!==(e=null===e?a?this.defaultRowSeparatorDashArray:this.defaultColumnSeparatorDashArray:e)&&(t=!0,r.enableDash(e,0)),r.beginPath();var u=l.position+s;a?u>h.height&&(s-=u-h.height):u>h.width&&(s-=u-h.width);let i=l.position+s/2;r.lineWidth=s;var d,u=this.ei;a?(i+=u.top,l=u.left,d=h.width-u.right,r.moveTo(l,i),r.lineTo(d,i)):(i+=u.left,l=u.top,d=h.height-u.bottom,r.moveTo(i,l),r.lineTo(i,d)),r.stroke(),r.endPath(),t&&r.disableDash()}}}}sb(n,t,r,e,i){var s=e.length,a=this.actualBounds,o=this.naturalBounds,h=this.SL(!0),l=this.SL(!1);for(let t=0;t<s;t++){var u=e[t];if(void 0!==u&&null!==u.background&&u.coversSeparators!==i&&0!==u.actual){var d=r?a.height:a.width;if(!(u.position>d)){let t=u.computeEffectiveSpacing(),e=u.separatorStrokeWidth,i=(isNaN(e)&&(e=r?this.defaultRowSeparatorStrokeWidth:this.defaultColumnSeparatorStrokeWidth),u.separatorStroke);null===i&&(i=r?this.defaultRowSeparatorStroke:this.defaultColumnSeparatorStroke),t-=e=null!==i&&u.index!==(r?h:l)?e:0;var c=u.position+e;let s=t+u.actual;(s=c+s>d?d-c:s)<=0||(d=this.ei,this.bn(n,u.background,!0,!1,o,a),r?n.fillRect(d.left,c+d.top,a.width-(d.left+d.right),s):n.fillRect(c+d.left,d.top,s,a.height-(d.top+d.bottom)))}}}}SL(e){var i=e?this.rowCount:this.columnCount;for(let t=0;t<i;t++){var s=(e?this.Ze:this.$e)[t];if(void 0!==s)return s.index}return 0}g2(){var e=this.F.h,i=e.length;for(let t=0;t<i;t++)e[t].g2();this.fs(!0)}sc(e,i,t){if(!super.sc(e,i,t))return!1;if(this.type===jt.Table){t=this.svg.getElementsByClassName("gojs-ts"),t=0!==t.length?t[0]:null;null!==t&&(t.innerHTML=""),e.currentElement=t,this.E2(e,i),e.currentElement=null}else{if(this.nt===jt.Grid)return this.svg.innerHTML="",this.svg.remove(),!1;if(this.nt===jt.Graduated)return this.svg.innerHTML="",this.svg.remove(),!1}var s=this.F.h,n=s.length;for(let t=0;t<n;t++)s[t].Ji(e,i);return!0}fd(t){return!0}T0(t,e,s,n){if(!this.isClipping)if(this.Ws()&&null!==t.partClipRect){var r,a=t.partClipRect,o=this.F.h;let e=0,i=0;for(let t=0;t<o.length;t++)o[t].isVisibleObject()&&(r=o[t].actualBounds,e=0===t?r.x:Math.min(r.x,e),i=0===t?r.y:Math.min(r.y,i));void n.setAttributeNS(null,"clip-path",`path('M ${a.x-s.x-e},${a.y-s.y-i} l ${a.width} 0 l 0 ${a.height} l -${a.width} 0 z')`)}else super.T0(t,e,s,n)}ec(r,a,o,h,l){var t,e,i,s,u=this.Mn(),d=this.D,c=1/(d.m11*d.m22-d.m12*d.m21);let g=d.m22*c,m=-d.m12*c,f=-d.m21*c,p=d.m11*c,v=c*(d.m21*d.dy-d.m22*d.dx),y=c*(d.m12*d.dx-d.m11*d.dy);if(null!==this.background)return c=r*g+a*f+v,t=r*m+a*p+y,e=o*g+h*f+v,i=o*m+h*p+y,l.e(0,0),s=this.naturalBounds,s=I.Ml(0,0,s.width,s.height,c,t,e,i,l),l.D(d),s;{u||(g=1,m=0,f=0,p=1,v=0,y=0);var x=r*g+a*f+v,A=r*m+a*p+y,w=o*g+h*f+v,b=o*m+h*p+y;l.e(w,b);let e=(w-x)*(w-x)+(b-A)*(b-A),i=!1;var P=this.F.h,S=P.length,k=U.a();let s=null,t=1/0,n=null;c=this.isClipping&&this.nt===jt.Spot;c&&(n=U.a(),s=this.findMainElement(),i=s.ec(x,A,w,b,n))&&(t=(x-n.x)*(x-n.x)+(A-n.y)*(A-n.y));for(let t=0;t<S;t++){var M=P[t];M.visible&&M!==s&&M.ec(x,A,w,b,k)&&(i=!0,(M=(x-k.x)*(x-k.x)+(A-k.y)*(A-k.y))<e)&&(e=M,l.set(k))}return c&&(t>e&&l.set(n),U.o(n)),U.o(k),u&&l.D(d),i}}Bu(){var e=this.F.h,i=e.length;for(let t=0;t<i;t++)e[t].Bu();super.Bu()}u(t){if(!this.Ko()){super.u(t);let e=null;this.nt!==jt.Auto&&this.nt!==jt.Link||(e=this.findMainElement());var i=this.F.h,s=i.length;for(let t=0;t<s;t++){var n,r=i[t];r!==e&&!r.isPanelMain||r.u(!0),!r.desiredSize.isReal()&&(n=r.qs(!1),r instanceof je||r instanceof jt||r instanceof z||0!==n)&&r.u(!0)}}}oc(){if(!this.Ko()){this.ae(!0),this.ro(!0);var e=this.F.h,i=e.length;for(let t=0;t<i;t++)e[t].oc()}}hd(){if(!1===this.j1()){this.cd(!0),this.Ma(!0);var e=this.F.h,i=e.length;for(let t=0;t<i;t++)e[t].m2()}}m2(){this.Ma(!0);var e=this.F.h,i=e.length;for(let t=0;t<i;t++)e[t].m2()}ld(t,e,i,s){var n=this.Zo,r=(n.e(0,0,0,0),this.desiredSize),a=this.minSize,o=(void 0===i&&(i=a.width,s=a.height),i=Math.max(i,a.width),s=Math.max(s,a.height),this.maxSize),h=(isNaN(r.width)||(t=Math.min(r.width,o.width)),isNaN(r.height)||(e=Math.min(r.height,o.height)),t=Math.max(i,t),e=Math.max(s,e),this.ei),l=(t=Math.max(t-h.left-h.right,0),e=Math.max(e-h.top-h.bottom,0),this.F.h);this.nt.measure(this,t,e,l,n,i,s);let u=n.width+h.left+h.right,d=n.height+h.top+h.bottom;isFinite(r.width)&&(u=r.width),isFinite(r.height)&&(d=r.height),u=Math.min(o.width,u),d=Math.min(o.height,d),u=Math.max(a.width,u),d=Math.max(a.height,d),u=Math.max(i,u),d=Math.max(s,d),n.Do(u,d),this.naturalBounds.Do(u,d),this.oo(0,0,u,d)}findMainElement(){if(null===this.fl){var e=this.F.h,i=e.length;if(0===i)return null;for(let t=0;t<i;t++){var s=e[t];if(!0===s.isPanelMain)return this.fl=s}this.fl=e[0]}return this.fl}Jo(){return null!==this.part?this.part.locationObject:null}get panelLayoutState(){return this.O2}set panelLayoutState(t){this.O2=t}gh(e,i,s,n){var t=this.F.h;if(this.actualBounds.e(e,i,s,n),!this.desiredSize.isReal()){let t=this.qs(!0);var e=this.measuredBounds,r=e.width,a=e.height,i=this.ol,o=i.left+i.right,h=i.top+i.bottom;switch(t=r===s&&a===n?0:t){case 0:(s<r||n<a)&&(this.u(),this.wt(s<r?s:r,n<a?n:a,0,0));break;case 2:this.u(!0),this.wt(s+o,n+h,0,0);break;case 5:this.u(!0),this.wt(s+o,a+h,0,0);break;case 4:this.u(!0),this.wt(r+o,n+h,0,0)}}this.nt.arrange(this,t,this.Zo)}dh(e){var i=this.naturalBounds,s=this.Jo();if(Z.contains(0,0,i.width,i.height,e.x,e.y)){var n=this.F.h,i=n.length,r=U.H(0,0);for(let t=i;t--;){var a=n[t];if((a.visible||a===s)&&(r.set(e).Ge(a.D),a.containsPoint(r)))return U.o(r),!0}return U.o(r),null!==this.Ft}return!1}M0(e){if(this.so===e)return this;var i=this.F.h,s=i.length;for(let t=0;t<s;t++){var n=i[t].M0(e);if(null!==n)return n}return null}walkVisualTreeFrom(t,e){if(e(this,t),t instanceof jt){var i=t.F.h,s=i.length;for(let t=0;t<s;t++)this.walkVisualTreeFrom(i[t],e)}}il(t){this.ML(this,t)}ML(t,e){e(t);var i=t.F.h,s=i.length;for(let t=0;t<s;t++){var n=i[t];n instanceof jt&&this.ML(n,e)}}gI(t){this.PL(this,t)}PL(t,e){if(e(t),t instanceof jt){var i=t.F.h,s=i.length;for(let t=0;t<s;t++)this.PL(i[t],e)}}findInVisualTree(t){return this.NL(this,t)}NL(t,e){if(e(t))return t;if(t instanceof jt){var i=t.F.h,s=i.length;for(let t=0;t<s;t++){var n=this.NL(i[t],e);if(null!==n)return n}}return null}findObject(e){if(this.name===e)return this;var i=this.F.h;let s=i.length;this.mI()&&(s=this.yp());for(let t=0;t<s;t++){var n=i[t];if(n instanceof jt){var r=n.findObject(e);if(null!==r)return r}if(n.name===e)return n}return null}CL(){var e=this.F.h,i=e.length;let s=0;for(let t=0;t<i;t++){var n=e[t];n instanceof jt?s=Math.max(s,n.CL()):n instanceof V&&(s=Math.max(s,n.pI()))}return s}Mn(){return!(this.type===jt.TableRow||this.type===jt.TableColumn)}ll(){return this.type===jt.TableRow||this.type===jt.TableColumn}sA(i,s,n){if(!1!==this.pickable&&(void 0===s&&(s=null),void 0===n&&(n=null),!this.hs())){var r=this.naturalBounds,a=1/this.getDocumentScale(),o=this.Mn(),h=o?i:U.H(i.x,i.y).Ge(this.D),l=this.diagram;let t=10,e=5;if(null!==l&&(t=l.getInputOption("extraTouchArea"),e=t/2),Z.contains(-e*a,-e*a,r.width+t*a,r.height+t*a,h.x,h.y)){if(!this.dc){var u=this.F.h,l=u.length,d=U.a(),c=this.isClipping&&this.nt===jt.Spot,g=c?this.findMainElement():null;if(c&&(g.Mn()?d.set(i).Ge(g.D):d.set(i),!g.containsPoint(d)))return U.o(d),o||U.o(h),null;var m=this.Jo();for(let t=l;t--;){var f=u[t];if((f.visible||f===m)&&(f.Mn()?d.set(i).Ge(f.D):d.set(i),!c||f!==g)){let t=null;if(f instanceof jt?t=f.sA(d,s,n):!0===f.pickable&&f.containsPoint(d)&&(t=f),null!==t&&null!==(t=null!==s?s(t):t)&&(null===n||n(t)))return U.o(d),o||U.o(h),t}}U.o(d)}return null===this.background?(o||U.o(h),null):(a=Z.contains(0,0,r.width,r.height,h.x,h.y)?this:null,o||U.o(h),a)}o||U.o(h)}return null}nA(e,i,s,n){if(!1!==this.pickable){void 0===i&&(i=null),void 0===s&&(s=null);var t=this.naturalBounds,r=this.Mn(),a=r?e:U.H(e.x,e.y).Ge(this.D),o=this.ll(),t=Z.contains(0,0,t.width,t.height,a.x,a.y);if(o||t){if(!this.dc){var h=this.F.h,o=h.length,l=U.a(),u=this.Jo();for(let t=o;t--;){var d=h[t];if(d.visible||d===u){d.Mn()?l.set(e).Ge(d.D):l.set(e);let t=d;d=d instanceof jt?d:null;(null!==d?d.nA(l,i,s,n):t.containsPoint(l))&&(!1===t.pickable||null===(t=null!==i?i(t):t)||null!==s&&!s(t)||n.add(t))}}U.o(l)}return r||U.o(a),t&&null!==this.background}r||U.o(a)}return!1}Um(i,s,n,r,a,t){if(!1!==this.pickable){void 0===s&&(s=null),void 0===n&&(n=null);let e=t;if(void 0===t&&(e=H.a()).ti(),e.hf(this.D),this.containedInRect(i,e))return this.V2(s,n,a),void 0===t&&H.o(e),!0;if(this.intersectsRect(i,e)){if(!this.dc){var o=this.Jo(),h=this.F.h;for(let t=h.length;t--;){var l=h[t];if(l.visible||l===o){var u=l.actualBounds,d=this.naturalBounds;if(!(u.x>d.width||u.y>d.height||u.x+u.width<0||u.y+u.height<0)){let t=l;d=l instanceof jt?l:null,u=H.a();u.set(e),(null!==d?d.Um(i,s,n,r,a,u):t.eL(i,r,u))&&null!==(t=null!==s?s(t):t)&&(null===n||n(t))&&a.add(t),H.o(u)}}}}return void 0===t&&H.o(e),r}void 0===t&&H.o(e)}return!1}V2(e,i,s){var n=this.F.h;for(let t=n.length;t--;){var r=n[t];if(r.visible){var a=r.actualBounds,o=this.naturalBounds;if(!(a.x>o.width||a.y>o.height||a.x+a.width<0||a.y+a.height<0)){r instanceof jt&&r.V2(e,i,s);let t=r;null===(t=null!==e?e(t):t)||null!==i&&!i(t)||s.add(t)}}}}oA(e,i,s,n,r,a){if(!1!==this.pickable){void 0===s&&(s=null),void 0===n&&(n=null);var t=this.naturalBounds,o=this.Mn(),h=o?e:U.H(e.x,e.y).Ge(this.D),l=o?i:U.H(i.x,i.y).Ge(this.D),u=h.distanceSquaredPoint(l),d=0<h.x&&h.x<t.width&&0<h.y&&h.y<t.height||U.distanceLineSegmentSquared(h.x,h.y,0,0,0,t.height)<=u||U.distanceLineSegmentSquared(h.x,h.y,0,t.height,t.width,t.height)<=u||U.distanceLineSegmentSquared(h.x,h.y,t.width,t.height,t.width,0)<=u||U.distanceLineSegmentSquared(h.x,h.y,t.width,0,0,0)<=u,t=h.distanceSquared(0,0)<=u&&h.distanceSquared(0,t.height)<=u&&h.distanceSquared(t.width,0)<=u&&h.distanceSquared(t.width,t.height)<=u;if(o||(U.o(h),U.o(l)),d){if(!this.dc){var c=U.a(),g=U.a(),m=this.Jo(),f=this.F.h;for(let t=f.length;t--;){var p=f[t];if(p.visible||p===m){var v=p.actualBounds,y=this.naturalBounds;if(!o||!(v.x>y.width||v.y>y.height||v.x+v.width<0||v.y+v.height<0)){p.Mn()?(y=p.D,c.set(e).Ge(y),g.set(i).Ge(y)):(c.set(e),g.set(i));let t=p;v=p instanceof jt?p:null;(null!==v?v.oA(c,g,s,n,r,a):t.sL(c,g,r))&&null!==(t=null!==s?s(t):t)&&(null===n||n(t))&&a.add(t)}}}U.o(c),U.o(g)}return r?d:t}}return!1}F2(t){let e=null;return e=null===(e=t instanceof V&&((e=t.spot1)===J.Default&&(e=null),null!==(t=t.geometry))&&null===e?t.spot1:e)?J.TopLeft:e}R2(t){let e=null;return e=null===(e=t instanceof V&&((e=t.spot2)===J.Default&&(e=null),null!==(t=t.geometry))&&null===e?t.spot2:e)?J.BottomRight:e}add(...e){for(let t=0;t<e.length;t++)this.insertAt(this.F.count,e[t]);return this}elt(t){return this.F.elt(t)}insertAt(t,i){i instanceof Y&&Xt.n("Cannot add a Part to a Panel: "+i+"; use a Panel instead"),this!==i&&!this.isContainedBy(i)||(this===i&&Xt.n("Cannot make a Panel contain itself: "+this.toString()),Xt.n("Cannot make a Panel indirectly contain itself: "+this.toString()+" already contains "+i.toString()));var s=i.panel,n=(null!==s&&s!==this&&Xt.n("Cannot add a GraphObject that already belongs to another Panel to this Panel: "+i.toString()+", already contained by "+s.toString()+", cannot be shared by this Panel: "+this.toString()),this.nt!==jt.Grid||i instanceof V||Xt.n("Can only add Shapes to a Grid Panel, not: "+i),this.nt!==jt.Graduated||i instanceof V||i instanceof z||Xt.n("Can only add Shapes or TextBlocks to a Graduated Panel, not: "+i),i.Pa(this),(i.rl=null)!==this.itemArray&&null!==(n=i.data)&&"object"==typeof n&&(null===this.Js&&(this.Js=new L),this.Js.add(n,i)),this.F);let r=-1;if(s===this){let e=-1;var a=this.F.h,o=a.length;for(let t=0;t<o;t++)if(a[t]===i){e=t;break}if(-1!==e){if(e===t||e+1>=n.count&&t>=n.count)return;n.removeAt(e),r=e}else Xt.n("element "+i.toString()+" has panel "+s.toString()+" but is not contained by it.")}(t<0||t>n.count)&&(t=n.count),n.insertAt(t,i),0!==t&&!i.isPanelMain||(this.fl=null),this.Ko()||this.u(),i.u(!1),(null!==i.portId||i instanceof jt&&!0===i.Nn)&&(this.Nn=!0),this.cs=null,this.isEnabledObject()||this.nb(i,!1);s=this.part;null!==s&&(s.V0(),s.gc(),this.Nn&&s instanceof D&&(s.Nn=!0),s.Nn&&s instanceof D&&(s.ue=null),null!==(n=this.diagram)&&n.undoManager.isUndoingRedoing||(-1!==r&&s.raiseChangedEvent(4,"elements",this,i,null,r,null),s.raiseChangedEvent(3,"elements",this,null,i,null,t)))}get Nn(){return 0!=(8388608&this.l)}set Nn(t){0!=(8388608&this.l)!==t&&(this.l=8388608^this.l)}f2(){return 0!=(16777216&this.l)}B2(t){t?this.l|=16777216:this.l&=-16777217}dI(t){t.Pa(this),t.rl=null;var e,i=this.F,s=i.count,i=(i.insertAt(s,t),this.part);null!==i&&(i.V0(),null!==t.portId&&i instanceof D&&(i.Nn=!0),null!==(e=this.diagram)&&e.undoManager.isUndoingRedoing||i.raiseChangedEvent(3,"elements",this,null,t,null,s))}ER(e){var i=this.F.h,s=i.length;let n=-1;for(let t=0;t<s;t++)if(i[t]===e){n=t;break}return n}remove(e){Xt.s(e,y,jt,"remove:element");var i=this.F.h,s=i.length;let n=-1;for(let t=0;t<s;t++)if(i[t]===e){n=t;break}-1!==n&&this.re(n,!0)}removeAt(t){Yt,Xt.r(t,jt,"removeAt:idx"),0<=t&&this.re(t,!0)}re(t,i){var e,s=this.F,n=s.elt(t);n.rl=null,n.Pa(null),null!==this.Js&&"object"==typeof(e=n.data)&&this.Js.remove(e),s.removeAt(t),this.ae(!1),this.u(),this.fl===n&&(this.fl=null),this.cs=null;const r=this.part;null!==r&&(r.V0(),r.gc(),r.invalidateAdornments(),r instanceof D&&(n instanceof jt?n.walkVisualTreeFrom(n,(t,e)=>r.k2(e,i)):r.k2(n,i)),null!==(e=this.diagram)&&e.undoManager.isUndoingRedoing||r.raiseChangedEvent(4,"elements",this,n,null,t,null))}get Ze(){return null===this.B&&(this.B=new xe),this.B.Ze}get rowCount(){return null===this.B?0:this.Ze.length}getRowDefinition(t){Yt,Xt.r(t,jt,"getRowDefinition:idx"),t<0&&Xt.G(t,">= 0",jt,"getRowDefinition:idx"),t=Math.round(t);var e,i=this.Ze;return void 0===i[t]&&((e=new we).Pa(this),e.isRow=!0,i[e.index=t]=e,this.raiseChangedEvent(3,"rowdefs",this,null,e,null,t)),i[t]}removeRowDefinition(e){if(Yt,Xt.r(e,jt,"removeRowDefinition:idx"),e<0&&Xt.G(e,">= 0",jt,"removeRowDefinition:idx"),0!==this.rowCount){e=Math.round(e);var i=this.Ze,s=i[e];if(s){i[e]=void 0;let t=i.length-1;for(;0<=t&&void 0===i[t--];)i.length--;this.raiseChangedEvent(4,"rowdefs",this,s,null,e,null),this.u()}}}IA(t,e){var i=this.Ze;if(!(t<0)){if(i[t]=e instanceof we?e:void 0,!e){let t=i.length-1;for(;0<=t&&void 0===i[t--];)i.length--}this.u()}}get $e(){return null===this.B&&(this.B=new xe),this.B.$e}get columnCount(){return null===this.B?0:this.$e.length}getColumnDefinition(t){Yt,Xt.r(t,jt,"getColumnDefinition:idx"),t<0&&Xt.G(t,">= 0",jt,"getColumnDefinition:idx"),t=Math.round(t);var e,i=this.$e;return void 0===i[t]&&((e=new we).Pa(this),e.isRow=!1,i[e.index=t]=e,this.raiseChangedEvent(3,"coldefs",this,null,e,null,t)),i[t]}removeColumnDefinition(e){if(Yt,Xt.r(e,jt,"removeColumnDefinition:idx"),e<0&&Xt.G(e,">= 0",jt,"removeColumnDefinition:idx"),0!==this.columnCount){e=Math.round(e);var i=this.$e,s=i[e];if(s){i[e]=void 0;let t=i.length-1;for(;0<=t&&void 0===i[t--];)i.length--;this.raiseChangedEvent(4,"coldefs",this,s,null,e,null),this.u()}}}OA(t,e){var i=this.$e;if(!(t<0)){if(i[t]=e instanceof we?e:void 0,!e){let t=i.length-1;for(;0<=t&&void 0===i[t--];)i.length--}this.u()}}addRowColumnDefinition(t){let e=null;return t.isRow?e=this.getRowDefinition(t.index):t.isRow||(e=this.getColumnDefinition(t.index)),e&&e.J1(t),this}addRowDefinition(t,e){t=this.getRowDefinition(t);return t&&t.J1(new we(e)),this}addColumnDefinition(t,e){t=this.getColumnDefinition(t);return t&&t.J1(new we(e)),this}get rowSizing(){return null!==this.B?this.B.wp:3}set rowSizing(t){var e=this.rowSizing;e!==t&&(Yt,3!==t&&2!==t&&Xt.n("Panel.rowSizing must be ProportionalExtra or None, not: "+t),null===this.B&&(this.B=new xe),this.B.wp=t,this.u(),this.i("rowSizing",e,t))}get columnSizing(){return null!==this.B?this.B.xp:3}set columnSizing(t){var e=this.columnSizing;e!==t&&(Yt,3!==t&&2!==t&&Xt.n("Panel.columnSizing must be ProportionalExtra or None, not: "+t),null===this.B&&(this.B=new xe),this.B.xp=t,this.u(),this.i("columnSizing",e,t))}get topIndex(){return null!==this.B?this.B.bp:0}set topIndex(t){var e=this.topIndex;e!==t&&((!isFinite(t)||t<0)&&Xt.n("Panel.topIndex must be greater than zero and a real number, not: "+t),null===this.B&&(this.B=new xe),this.B.bp=t,this.u(),this.i("topIndex",e,t))}get leftIndex(){return null!==this.B?this.B.kp:0}set leftIndex(t){var e=this.leftIndex;e!==t&&((!isFinite(t)||t<0)&&Xt.n("Panel.leftIndex must be greater than zero and a real number, not: "+t),null===this.B&&(this.B=new xe),this.B.kp=t,this.u(),this.i("leftIndex",e,t))}findRowForLocalY(t){if(t<0||this.type!==jt.Table||0===this.rowCount)return-1;let e=0;var i=this.Ze,s=i.length;let n=this.topIndex;for(;n<s;n++){var r=i[n];if(void 0!==r&&t<(e+=r.total))return n}return n}findColumnForLocalX(t){if(t<0||this.type!==jt.Table||0===this.columnCount)return-1;let e=0;var i=this.$e,s=i.length;let n=this.leftIndex;for(;n<s;n++){var r=i[n];if(void 0!==r&&t<(e+=r.total))return n}return n}graduatedPointForValue(t,e){if(void 0===e&&(e=new U(NaN,NaN)),this.type!==jt.Graduated)return e.e(NaN,NaN),e;t=Math.min(Math.max(t,this.graduatedMin),this.graduatedMax);var i=this.findMainElement();return i.geometry.getPointAlongPath((t-this.graduatedMin)/this.graduatedRange,e),i.D.Pt(e)}graduatedValueForPoint(t){var e;return this.type!==jt.Graduated?NaN:((e=this.findMainElement()).D.rs(t),e.geometry.getFractionForPoint(t)*this.graduatedRange+this.graduatedMin)}get data(){return this.si}set data(t){var e,i,s=this.si;s!==t&&((i=this instanceof Y&&!(this instanceof X))&&Xt.t(t,"object",jt,"data"),this.ui(),this.si=t,null!==(e=this.diagram)&&(i?e.partManager.yI(this,s,t):null!==(i=this.panel)&&null!==i.Js&&(null!==s&&i.Js.remove(s),null!==t)&&i.Js.add(t,this)),this.i("data",s,t),null!==e&&e.undoManager.isUndoingRedoing||null!==t&&this.updateTargetBindings())}get itemIndex(){return this.xd}set itemIndex(t){var e=this.xd;e!==t&&(this.xd=t,this.i("itemIndex",e,t))}get js(){return null!==this.g?this.g.js:null}set js(t){this.Ii!==t&&(null===this.g&&(this.g=new Ut),this.g.js=t)}S2(){return null!==this.js}dL(){var t=this.js;return null!==t&&t.f}ui(){let p=this.js;if(null===p)null!==this.data&&Xt.n("Template cannot have .data be non-null: "+this),this.js=p=new O;else if(p.f)return this;const v=new O;this.B2(!1),this.walkVisualTreeFrom(this,(t,e)=>{e.uh();var i=e.Ii;if(null!==i){e.p2(!1);for(var s=i.iterator;s.next();){var n=s.value,r=(2===n.mode&&e.p2(!0),n.sourceName);n.isToObject&&("/"===r&&t.B2(!0),null!==(r=n.iL(t,e)))&&(v.add(r),null===r.no&&(r.no=new O),r.no.add(n)),p.add(n)}}if(e instanceof jt&&e.type===jt.Table){if(0<e.rowCount){var a=e.Ze,o=a.length;for(let t=0;t<o;t++){var h=a[t];if(void 0!==h&&null!==h.Zs)for(var l=h.Zs.iterator;l.next();){var u=l.value;u.Te=h,u.Sd=2,u.mc=h.index,p.add(u)}}}if(0<e.columnCount){var d=e.$e,c=d.length;for(let t=0;t<c;t++){var g=d[t];if(void 0!==g&&null!==g.Zs)for(var m=g.Zs.iterator;m.next();){var f=m.value;f.Te=g,f.Sd=1,f.mc=g.index,p.add(f)}}}}});for(var t=v.iterator;t.next();){var e=t.value;if(null!==e.no){e.p2(!0);for(var i=e.no.iterator;i.next();){var s=i.value;null===e.Ii&&(e.Ii=new O),e.Ii.add(s)}}e.no=null}let n=p.iterator;for(;n.next();){var r,a,o,h=n.value;let t=h.Te;null!==t&&(h.Te=null,0<(a=(o=h.targetProperty).indexOf("."))&&t instanceof jt&&(r=o.substring(0,a),o=o.substring(a+1),null!==(a=t.findObject(r))?(t=a,h.targetProperty=o):(Xt.ft('Warning: unable to find GraphObject named "'+r+'" for Binding: '+h.toString()),t=null)),t instanceof we?(a=C.ps(t.panel),h.targetId=void 0===a?-1:a,t.panel.so=h.targetId):t instanceof y?(o=C.ps(t),h.targetId=void 0===o?-1:o,t.so=h.targetId):Xt.n("Unknown type of binding target: "+t),h.check(t))}return p.w(),this instanceof Y&&(this.De()&&this.ensureBounds(),Yt,!jt.AL)&&this.walkVisualTreeFrom(this,(e,i)=>{if(i instanceof jt&&(i.type===jt.Auto||i.type===jt.Spot||i.type===jt.Graduated)&&i.elements.count<=1&&!(i instanceof Y)){let t=!1;if(1===i.elements.count&&!(t=null!==i.itemArray))for(n=p.iterator;n.next();)if("itemArray"===n.value.targetProperty){t=!0;break}t||(Xt.ft("Auto, Spot, or Graduated Panel should not have zero or one elements: "+i.toString()+" in "+e.toString()),jt.AL=!0)}}),this}static AL=!1;copyTemplate(t){void 0===t&&(t=!1);var e=this.copy();return e.gI(e=>{e instanceof jt&&(e.js=null,e.si=null);var t=e.Ii,t=(null!==t&&(e.Ii=null,t.each(t=>e.bind(t.copy()))),e.Ns);null!==t&&(e.Ns=null,t.each(t=>e.trigger(t.value.copy())))}),t&&e.ui(),e}updateTargetBindings(t){var e=this.js;if(null!==e){void 0===t&&(t="");for(var i=e.iterator;i.next();){var s,n=i.value,r=this.LL(n,t);null===r||({data:r,elt:s}=r,n.isToTheme&&null===this.diagram)||void 0!==s&&n.updateTarget(s,r)}}}Uo(){if(null!==this.diagram)if(this.S2())for(var t=this.js.iterator;t.next();){var e,i,s=t.value;s.isToTheme&&null!==(e=this.LL(s))&&({data:e,elt:i}=e,void 0!==i)&&s.updateTarget(i,e)}else{var n=this.F.h,r=n.length;for(let t=0;t<r;t++)n[t].Uo()}}LL(t,e=""){var i=t.sourceProperty;if(""!==e&&""!==i&&i!==e)return null;i=t.targetProperty;if(null===t.converter&&""===i)return null;let s=this.data;e=t.sourceName;if(t.isToObject){if(null===(s=this.tL(e)))return null}else if(t.isToModel){i=this.diagram;if(null===i)return null;s=i.model.modelData}let n=this;i=t.targetId;if(-1!==i){if(null===(n=this.M0(i)))return null}else null!==t.Te&&(n=t.Te);"/"===e?s=n.part:"."===e?s=n:".."===e&&(s=n.panel);i=t.Sd;if(0!==i){if(!(n instanceof jt))return null;1===i?n=n.getColumnDefinition(t.mc):2===i&&(n=n.getRowDefinition(t.mc))}return{data:s,elt:n}}get itemArray(){return this.bh}set itemArray(t){Yt,null===t||Array.isArray(t)||Xt.n("Panel.itemArray must be an Array-like object or null, not: "+t);var e,i=this.bh;(i!==t||null!==t&&this.wI(t))&&(e=this.diagram,i!==t&&(null!==e&&null!==i&&e.partManager.TP(this,e),this.bh=t,null!==e)&&null!==t&&e.partManager.LP(this,e),this.i("itemArray",i,t),null!==e&&e.undoManager.isUndoingRedoing||this.TL(i,t))}findItemPanelForData(t){return null==t||null===this.Js?null:(Xt.t(t,"object",jt,"findItemPanelForData"),this.Js.getValue(t))}wI(t){var e=this.F.h,i=e.length,s=t.length;let n=0,r=null;for(;n<i&&(!((r=e[n])instanceof jt)||null===r.data);)n++,r=e[n];if(i-n!==s)return!0;if(null===r)return 0<s;let a=0;for(;n<i&&a<s;){if(!((r=e[n])instanceof jt)||r.data!==t[a])return!0;n++,a++}return!1}yp(){if(this.type===jt.Spot||this.type===jt.Auto)return Math.min(this.F.length,1);if(this.type===jt.Link){var e=this.F,i=e.length;let t=0;for(;t<i;t++){var s=e.elt(t);if(!(s instanceof V&&s.isPanelMain))return t}return t}if(this.type===jt.Table&&0<this.F.length){var t=this.F.elt(0);if(t.isPanelMain&&t instanceof jt&&t.ll())return 1}return 0}rebuildItemElements(){for(var t=this.yp();this.F.length>t;)this.re(this.F.length-1,!1);this.TL(null,this.itemArray)}TL(t,e){var s=this.yp(),n=e;if(null===n||0===n.length)for(;this.F.length>s;)this.re(this.F.length-1,!1);else if(this.F.length<=s){var i=n.length;for(let t=0;t<i;t++)this.ob(n[t],t,!0)}else{let i=s;for(let e=0;e<n.length;e++,i++){var r=n[e],a=i<this.F.length?this.F.elt(i):null;if(a instanceof jt){if(a.data!==r){var o=this.z2(a.data,e),h=this.z2(r,e);let t=h!==o;t||(o=this.X2(a.data,e,o),t=this.X2(r,e,h)!==o),t?(this.re(i,!1),this.ob(r,e,!1)):a.data=r}}else this.ob(r,e,!1)}for(;i<this.F.length;)this.re(i,!1);this.fl=null,this.Y2(s,0),this.Ko()||this.u(),this.cs=null,this.isEnabledObject()||this.nb(this,!1);e=this.part;null!==e&&(e.V0(),e.gc(),this.Nn&&e instanceof D&&(e.Nn=!0),e.Nn)&&e instanceof D&&(e.ue=null)}}ob(t,e,i){var s,n;return!(null==t||e<0)&&(s=this.z2(t,e),null!==(s=this.X2(t,e,s)))?(s.ui(),(s=s.copy()).f2()&&null!==(n=this.findBindingPanel())&&n.B2(!0),"object"==typeof t&&(null===this.Js&&(this.Js=new L),this.Js.add(t,s)),n=e+this.yp(),this.insertAt(n,s),i&&(s.si=t,this.Y2(n,e),s.si=null),s.data=t,s):null}xI(t){var e;t<0||(e=t+this.yp(),this.re(e,!0),this.Y2(e,t))}Y2(t,e){var i=this.F;let s=t,n=e;for(;s<i.length;){var r=i.elt(s);r instanceof jt&&r.bI(s,n),s++,n++}}bI(t,e){this.type===jt.TableRow?this.row=t:this.type===jt.TableColumn&&(this.column=t),this.itemIndex=e}mI(){return null!==this.bh||null!==this.itemTemplateMap}get itemTemplate(){return null===this.itemTemplateMap?null:this.itemTemplateMap.getValue("")}set itemTemplate(t){if(null===this.itemTemplateMap){if(null===t)return;this.itemTemplateMap=new L}var e=this.itemTemplateMap.getValue("");e!==t&&(Xt.s(t,jt,jt,"itemTemplate"),(t instanceof Y||t.isPanelMain)&&Xt.n("Panel.itemTemplate must not be a Part or be Panel.isPanelMain: "+t),this.itemTemplateMap.add("",t),this.i("itemTemplate",e,t),null!==(e=this.diagram)&&e.undoManager.isUndoingRedoing||this.rebuildItemElements())}get itemTemplateMap(){return null!==this.g?this.g.Q0:null}set itemTemplateMap(t){var e=this.itemTemplateMap;if(e!==t){Xt.s(t,L,jt,"itemTemplateMap");for(var i=t.iterator;i.next();){var s=i.value;Yt,(s instanceof Y||s.isPanelMain)&&Xt.n("Template in Panel.itemTemplateMap must not be a Part or be Panel.isPanelMain: "+s)}this.Zt(),this.g.Q0=t,this.i("itemTemplateMap",e,t);e=this.diagram;null!==e&&e.undoManager.isUndoingRedoing||this.rebuildItemElements()}}get itemCategoryProperty(){return null!==this.g?this.g._0:"category"}set itemCategoryProperty(t){var e=this.itemCategoryProperty;e!==t&&("string"!=typeof t&&"function"!=typeof t&&Xt.Bi(t,"string or function",jt,"itemCategoryProperty"),this.Zt(),this.g._0=t,this.i("itemCategoryProperty",e,t))}z2(t,e){if(null===t)return"";var i=this.itemCategoryProperty;let s="";if("function"==typeof i)s=i(t);else{if("string"!=typeof i||"object"!=typeof t)return"";if(""===i)return"";s=x.Xt(t,i)}return void 0===s?"":"string"==typeof s?s:void Xt.n("Panel.getCategoryForItemData found a non-string category for "+t+": "+s)}static DL=!1;static FL=null;X2(t,e,i){var s=this.itemTemplateMap;let n=null;return null===(n=null!==s?s.getValue(i):n)&&null===(n=null!==s?s.getValue(""):n)&&(jt.DL||(jt.DL=!0,Xt.ft('No item template Panel found for category "'+i+'" on '+this),Xt.ft("  Using default item template."),jt.FL=(new jt).add((new z).bind("text","",Xt.toString).theme("stroke","text"))),n=jt.FL),n}get dc(){return 0!=(1048576&this.l)}set dc(t){var e=0!=(1048576&this.l);e!==t&&(Xt.t(t,"boolean",jt,"isAtomic"),this.l=1048576^this.l,this.i("isAtomic",e,t))}get isClipping(){return 0!=(2097152&this.l)}set isClipping(t){var e=0!=(2097152&this.l);e!==t&&((Yt,Xt.t(t,"boolean",jt,"isClipping"),!t)||this.type===jt.Spot||this instanceof j||Xt.ft("Warning: Panel.isClipping set on non-Spot Panel: "+this.toString()),this.l=2097152^this.l,this instanceof j&&(this.hi=null),this.u(),this.i("isClipping",e,t))}get isOpposite(){return 0!=(33554432&this.l)}set isOpposite(t){var e=0!=(33554432&this.l);e!==t&&(Xt.t(t,"boolean",jt,"isOpposite"),this.l=33554432^this.l,this.u(),this.i("isOpposite",e,t))}get isEnabled(){return 0!=(4194304&this.l)}set isEnabled(t){var e,i=0!=(4194304&this.l);i!==t&&(Xt.t(t,"boolean",jt,"isEnabled"),e=null===this.panel||this.panel.isEnabledObject(),this.l=4194304^this.l,this.i("isEnabled",i,t),null!==(i=this.diagram)&&i.undoManager.isUndoingRedoing||e&&this.nb(this,t))}nb(t,e){var i=t.enabledChanged;if(null!==i&&i(t,e),t instanceof jt){var s=t.F.h,n=s.length;for(let t=0;t<n;t++){var r=s[t];e&&r instanceof jt&&!r.isEnabled||this.nb(r,e)}}}get alignmentFocusName(){return this.fo}set alignmentFocusName(t){var e=this.fo;e!==t&&(Yt,Xt.t(t,"string",jt,"alignmentFocusName"),this.fo=t,this.u(),this.i("alignmentFocusName",e,t))}static definePanelLayout(t,e){se.definePanelLayout(t,e)}static Position=se.Layouts.getValue("Position");static Horizontal=se.Layouts.getValue("Horizontal");static Vertical=se.Layouts.getValue("Vertical");static Spot=se.Layouts.getValue("Spot");static Auto=se.Layouts.getValue("Auto");static Table=se.Layouts.getValue("Table");static Viewbox=se.Layouts.getValue("Viewbox");static TableRow=se.Layouts.getValue("TableRow");static TableColumn=se.Layouts.getValue("TableColumn");static Link=se.Layouts.getValue("Link");static Grid=se.Layouts.getValue("Grid");static Graduated=se.Layouts.getValue("Graduated")}jt.definePanelLayout=jt.definePanelLayout;class ve{dp;gp;mp;pp;Cs;Qe;cs;Fe;constructor(){this.dp=0,this.gp=100,this.mp=10,this.pp=0,this.Cs=null,this.Qe=null,this.cs=null,this.Fe=null}copy(){var t=new ve;return t.dp=this.dp,t.gp=this.gp,t.mp=this.mp,t.pp=this.pp,t.Cs=this.Cs,t.Qe=this.Qe,t.cs=this.cs,t.Fe=this.Fe,t}}class ye{bd;kd;jf;np;constructor(){this.bd=qt.oC,this.kd=U.To,this.jf=qt.xw,this.np=[]}copy(){var t=new ye;return t.bd=this.bd.copy(),t.kd=this.kd.copy(),t.jf=this.jf.copy(),t.np=this.np,t}}class xe{Ze;$e;wp;xp;bp;kp;op;lp;rp;hp;fp;ap;cp;xh;constructor(){this.Ze=[],this.$e=[],this.wp=3,this.xp=3,this.bp=0,this.kp=0,this.op=E.qg,this.lp=1,this.rp=null,this.hp=null,this.fp=1,this.ap=null,this.cp=null,this.xh=null}copy(e){var i,t=new xe,s=this.Ze,n=s.length,r=t.Ze;for(let t=0;t<n;t++)void 0!==s[t]&&((i=s[t].copy()).Pa(e),r[t]=i);var a,o=this.$e,h=o.length,l=t.$e;for(let t=0;t<h;t++)void 0!==o[t]&&((a=o[t].copy()).Pa(e),l[t]=a);return t.wp=this.wp,t.xp=this.xp,t.bp=this.bp,t.kp=this.kp,t.op=this.op.L(),t.lp=this.lp,t.rp=this.rp,t.hp=this.hp,t.fp=this.fp,t.ap=this.ap,t.cp=this.cp,t.xh=this.xh,t}}(r={})[r.Default=1]="Default",r[r.None=2]="None",r[r.ProportionalExtra=3]="ProportionalExtra";var Ae=r;class we{vs;Sp;Vt;La;Ta;fi;lt;Md;lo;$o;Pd;Nd;Da;Ft;Cd;Zs;at;Zi;ke;constructor(t){C.ji(this),this.vs=null,this.Sp=!0,this.Vt=0,this.ke=NaN,this.La=0,this.Ta=1/0,this.fi=J.Default,this.at=0,this.Zi=0,this.lt=0,this.Zs=null,this.Md=1,this.lo=1,this.$o=null,this.Pd=null,this.Nd=NaN,this.Da=null,this.Ft=null,this.Cd=!1,t&&(Object.assign(this,t),void 0!==t.column?(this.isRow=!1,this.index=t.column):void 0!==t.row&&(this.isRow=!0,this.index=t.row))}copy(){var t=new we;return t.Sp=this.Sp,t.Vt=this.Vt,t.ke=this.ke,t.La=this.La,t.Ta=this.Ta,t.fi=this.fi,t.at=this.at,t.Zi=this.Zi,t.lt=this.lt,t.lo=this.lo,t.Md=this.Md,null===this.$o?t.$o=null:t.$o=this.$o.L(),t.Pd=this.Pd,t.Nd=this.Nd,(t.Da=null)!==this.Da&&(t.separatorDashArray=this.separatorDashArray.slice()),t.Ft=this.Ft,t.Cd=this.Cd,t.Zs=this.Zs,t}J1(t){t.isRow?this.height=t.height:this.width=t.width,this.minimum=t.minimum,this.maximum=t.maximum,this.alignment=t.alignment,this.stretch=t.stretch,this.sizing=t.sizing,this.$o=null===t.separatorPadding?null:t.separatorPadding.L(),this.separatorStroke=t.separatorStroke,this.separatorStrokeWidth=t.separatorStrokeWidth,this.Da=null,t.separatorDashArray&&(this.Da=t.separatorDashArray.slice()),this.background=t.background,this.coversSeparators=t.coversSeparators,this.Zs=t.Zs}ci(t){t in Ae?this.sizing=t:Xt.gr(this,t)}toString(){return"RowColumnDefinition "+(this.isRow?"(Row ":"(Column ")+this.index+") #"+C.ps(this)}static Default=1;static None=2;static ProportionalExtra=3;Pa(t){this.vs=t}computeEffectiveSpacingTop(t){let e=0;var i=this.vs;if(this.index!==t){let t=this.separatorStroke;null!==(t=null===t&&null!==i?this.isRow?i.defaultRowSeparatorStroke:i.defaultColumnSeparatorStroke:t)&&(e=this.separatorStrokeWidth,isNaN(e))&&(e=null!==i?this.isRow?i.defaultRowSeparatorStrokeWidth:i.defaultColumnSeparatorStrokeWidth:0)}let s=this.$o;if(null===s){if(null===i)return e;s=i.defaultSeparatorPadding}return e+(this.isRow?s.top:s.left)}computeEffectiveSpacing(){let e=0;var i=this.vs;let s=0;var n=this.isRow;if(null!==i&&i.type===jt.Table){var r=(n?i.Ze:i.$e).length;for(let t=0;t<r;t++){var a=(n?i.Ze:i.$e)[t];if(void 0!==a&&0!==a.at){s=a.index;break}}}if(this.index!==s){let t=this.separatorStroke;null!==(t=null===t&&null!==i?n?i.defaultRowSeparatorStroke:i.defaultColumnSeparatorStroke:t)&&(e=this.separatorStrokeWidth,isNaN(e))&&(e=null!==i?n?i.defaultRowSeparatorStrokeWidth:i.defaultColumnSeparatorStrokeWidth:0)}let t=this.$o;if(null===t){if(null===i)return e;t=i.defaultSeparatorPadding}return e+(this.isRow?t.top+t.bottom:t.left+t.right)}i(t,e,i,s,n){var r=this.vs;if(null!==r&&(r.raiseChangedEvent(2,t,this,e,i,s,n),null!==this.Zs)){e=r.diagram;if(null!==e&&!e.xe){var a=r.findBindingPanel();if(null!==a){var o=a.data;if(null!==o)for(var h=this.Zs.iterator;h.next();)h.value.updateSource(this,o,t,a)}}}}get panel(){return this.vs}get isRow(){return this.Sp}set isRow(t){this.Sp=t}get index(){return this.Vt}set index(t){this.Vt=t}get height(){return this.ke}set height(t){var e=this.ke;e!==t&&(Yt,Xt.t(t,"number",we,"height"),t<0&&Xt.G(t,">= 0",we,"height"),this.ke=t,this.actual=this.at,null!==this.panel&&this.panel.u(),this.i("height",e,t))}get width(){return this.ke}set width(t){var e=this.ke;e!==t&&(Yt,Xt.t(t,"number",we,"width"),t<0&&Xt.G(t,">= 0",we,"width"),this.ke=t,this.actual=this.at,null!==this.panel&&this.panel.u(),this.i("width",e,t))}get minimum(){return this.La}set minimum(t){var e=this.La;e!==t&&(Yt,Xt.t(t,"number",we,"minimum"),(t<0||!isFinite(t))&&Xt.G(t,">= 0",we,"minimum"),this.La=t,this.actual=this.at,null!==this.panel&&this.panel.u(),this.i("minimum",e,t))}get maximum(){return this.Ta}set maximum(t){var e=this.Ta;e!==t&&(Yt,Xt.t(t,"number",we,"maximum"),t<0&&Xt.G(t,">= 0",we,"maximum"),this.Ta=t,this.actual=this.at,null!==this.panel&&this.panel.u(),this.i("maximum",e,t))}get alignment(){return this.fi}set alignment(t){var e=this.fi;e.equals(t)||(Yt,Xt.s(t,J,we,"alignment"),this.fi=t.L(),null!==this.panel&&this.panel.u(),this.i("alignment",e,t))}get stretch(){return this.lo}set stretch(t){var e=this.lo;e!==t&&(this.lo=t,null!==this.panel&&this.panel.u(),this.i("stretch",e,t))}get separatorPadding(){return this.$o}set separatorPadding(t){"number"==typeof t?t=new E(t):null!==t&&(Yt,Xt.s(t,E,we,"separatorPadding"));var e=this.$o;null!==t&&null!==e&&e.equals(t)||(null!==t&&(t=t.L()),this.$o=t,null!==this.panel&&this.panel.u(),this.i("separatorPadding",e,t))}get separatorStroke(){return this.Pd}set separatorStroke(t){var e=this.Pd;e!==t&&(null!==t&&m.ud(t,"RowColumnDefinition.separatorStroke"),t instanceof m&&t.w(),this.Pd=t,null!==this.panel&&this.panel.u(),this.i("separatorStroke",e,t))}get separatorStrokeWidth(){return this.Nd}set separatorStrokeWidth(t){var e=this.Nd;e!==t&&(this.Nd=t,null!==this.panel&&this.panel.u(),this.i("separatorStrokeWidth",e,t))}get separatorDashArray(){return this.Da}set separatorDashArray(i){var t=this.Da;if(t!==i){if(null===i||Array.isArray(i)||Xt.Bi(i,"Array",we,"separatorDashArray:value"),null!==i){var s=i.length;let e=0;for(let t=0;t<s;t++){var n=i[t];"number"==typeof n&&0<=n&&isFinite(n)||Xt.n("separatorDashArray value "+n+" at index "+t+" must be a positive number or zero."),e+=n}if(0===e){if(null===t)return;i=null}}this.Da=i,null!==this.panel&&this.panel.T(),this.i("separatorDashArray",t,i)}}get background(){return this.Ft}set background(t){var e=this.Ft;e!==t&&(null!==t&&m.ud(t,"RowColumnDefinition.background"),t instanceof m&&t.w(),this.Ft=t,null!==this.panel&&this.panel.T(),this.i("background",e,t))}get coversSeparators(){return this.Cd}set coversSeparators(t){var e=this.Cd;e!==t&&(Xt.t(t,"boolean",we,"coversSeparators"),this.Cd=t,null!==this.panel&&this.panel.T(),this.i("coversSeparators",e,t))}get sizing(){return this.Md}set sizing(t){var e=this.Md;e!==t&&(Yt,Xt.it(t,Ae,"Sizing"),this.Md=t,null!==this.panel&&this.panel.u(),this.i("sizing",e,t))}ib(){var t;return 1===this.sizing?(t=this.vs,this.isRow?t.rowSizing:t.columnSizing):this.sizing}get actual(){return this.at}set actual(t){isNaN(this.ke)?this.at=Math.max(Math.min(this.Ta,t),this.La):this.at=Math.max(Math.min(this.Ta,this.ke),this.La)}get measured(){return this.Zi}set measured(t){this.Zi=t}get total(){return this.at+this.computeEffectiveSpacing()}get position(){return this.lt}set position(t){this.lt=t}bind(t,e,i,s){return this.lc(t,e,i,s),this}bindTwoWay(t,e,i,s){t=this.lc(t,e,i,s);return void 0===s&&t.makeTwoWay(),this}theme(t,e,i,s,n){return this.yh(t,e,i,s,n),this}themeData(t,e,i,s,n){return this.yh(t,e,i,s,n).ofData(),this}themeObject(t,e,i,s,n,r){return this.yh(t,e,i,s,n).ofObject(r),this}themeModel(t,e,i,s,n){return this.yh(t,e,i,s,n).ofModel(),this}lc(t,e,i,s){let n=null;return n="string"==typeof t?new ri(t,e,i,s):t,this.Z0(n),n}yh(t,e,i,s,n){let r=null;return r="string"==typeof t?new ai(t,e,i,s,n):t,this.Z0(r),r}Z0(t){var e,i=(t.Te=this).panel;null!==i&&null!==(e=i.findBindingPanel())&&e.dL()&&Xt.n("Cannot add a Binding to a RowColumnDefinition that is already frozen: "+t+" on "+i),null===this.Zs&&(this.Zs=new O),this.Zs.add(t)}}class V extends y{yt;As;Ad;Fa;$i;Qo;jo;Rt;Ld;Td;tt;constructor(t,e){super(),this.yt=null,this.As=null,this.Ad="None",this.Fa="black",this.$i="black",this.Qo=1,this.jo=null,this.Rt=null,this.Ld=NaN,this.Td=NaN,this.tt=null,"string"==typeof t?this.figure=t:t&&Object.assign(this,t),e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),t.yt=this.yt,t.As=this.As,t.Ad=this.Ad,t.Fa=this.Fa,t.$i=this.$i,t.Qo=this.Qo,null!==this.jo&&(t.jo=this.jo.slice()),null!==this.Rt&&(this.Rt.xi?t.Rt=this.Rt:t.Rt=this.Rt.copy()),t.Ld=this.Ld,t.Td=this.Td,null!==this.tt&&(t.tt=this.tt.copy())}Ra(){null===this.Rt?this.Rt=new be:this.Rt.xi&&(this.Rt=this.Rt.copy())}uh(){super.uh(),null!==this.Rt&&(this.Rt.xi=!0)}ci(t){t in S?this.geometryStretch=t:super.ci(t)}toString(){return"Shape("+("None"!==this.figure?this.figure:"None"!==this.toArrow?this.toArrow:this.fromArrow)+")#"+C.ps(this)}kI(r,a){var o=this.pathPattern,t=(o.wt(1/0,1/0),o.measuredBounds),t=(o.vt(0,0,t.width,t.height),this.geometry),h=(r.save(),r.beginPath(),Xt.ct());if(1===t.type)h.push(t.startX),h.push(t.startY),h.push(t.endX),h.push(t.endY),this.Dd(r,a,h,o);else if(4===t.type)for(var l=t.figures.iterator;l.next();){var u=l.value;h.length=0,h.push(u.startX),h.push(u.startY);let e=u.startX,i=u.startY,s=e,n=i;var d=u.segments.h,c=d.length;for(let t=0;t<c;t++){var g=d[t];switch(g.type){case 1:this.Dd(r,a,h,o),h.length=0,h.push(g.endX),h.push(g.endY),e=g.endX,i=g.endY,s=e,n=i;break;case 2:h.push(g.endX),h.push(g.endY),e=g.endX,i=g.endY;break;case 3:I.Hn(e,i,g.point1X,g.point1Y,g.point2X,g.point2Y,g.endX,g.endY,.5,h),e=g.endX,i=g.endY;break;case 4:I.Wg(e,i,g.point1X,g.point1Y,g.endX,g.endY,.5,h),e=g.endX,i=g.endY;break;case 5:var m=g.Fo(u),f=m.length;if(0===f)h.push(g.centerX),h.push(g.centerY),e=g.centerX,i=g.centerY;else for(let t=0;t<f;t++){var p=m[t];I.Hn(e,i,p[2],p[3],p[4],p[5],p[6],p[7],.5,h),e=p[6],i=p[7]}break;case 6:var v=g.Kh(u,e,i),y=v.length;if(0===y)h.push(g.endX),h.push(g.endY),e=g.endX,i=g.endY;else for(let t=0;t<y;t++){var x=v[t];I.Hn(e,i,x[2],x[3],x[4],x[5],x[6],x[7],.5,h),e=x[6],i=x[7]}break;default:Xt.n("Segment not of valid type: "+g.type)}g.isClosed&&(h.push(s),h.push(n),this.Dd(r,a,h,o))}this.Dd(r,a,h,o)}else if(2===t.type)h.push(t.startX),h.push(t.startY),h.push(t.endX),h.push(t.startY),h.push(t.endX),h.push(t.endY),h.push(t.startX),h.push(t.endY),h.push(t.startX),h.push(t.startY),this.Dd(r,a,h,o);else if(3===t.type){var s=new k,e=(s.startX=t.endX,s.startY=(t.startY+t.endY)/2,new b(5)),n=(e.startAngle=0,e.sweepAngle=360,e.centerX=(t.startX+t.endX)/2,e.centerY=(t.startY+t.endY)/2,e.radiusX=Math.abs(t.startX-t.endX)/2,e.radiusY=Math.abs(t.startY-t.endY)/2,s.add(e),e.Fo(s)),A=n.length;if(0===A)h.push(e.centerX),h.push(e.centerY);else{let e=s.startX,i=s.startY;for(let t=0;t<A;t++){var w=n[t];I.Hn(e,i,w[2],w[3],w[4],w[5],w[6],w[7],.5,h),e=w[6],i=w[7]}}this.Dd(r,a,h,o)}Xt.ot(h),r.restore(),r.clearContextCache(!1)}SI(t){let e=t.measuredBounds.width;return t instanceof V&&(e-=t.strokeWidth),e=e<1?1:e}Dd(p,v,y,x){var A=y.length;if(!(A<4)){var t=x.measuredBounds,w=Math.max(1,t.width),b=t.height;let e=y[0],i=y[1],s,n,r=0,a,o=0,h=0,l=0,u=0;var P=Xt.ct();for(let t=2;t<A;t+=2)s=y[t],n=y[t+1],r=s-e,a=n-i,0===r&&(r=.001),o=a/r,h=Math.atan2(a,r),l=Math.sqrt(r*r+a*a),P.push([r,h,o,l]),u+=l,e=s,i=n;e=y[0],i=y[1];var S=this.SI(x);let d=S;var k=w/2;let c=0!=k,g=0,m=P[g],f=(r=m[0],h=m[1],o=m[2],l=m[3],0);for(;.1<=u;){if((d=0===f&&(c?(d=S,d-=k,u-=k,c=!1):d=S,0===d)?1:d)>u)return d=u,void Xt.ot(P);d>l?(f=d-l,d=l):f=0;let t=Math.sqrt(d*d/(1+o*o));if(r<0&&(t=-t),e+=t,i+=o*t,p.translate(e,i),p.rotate(h),p.translate(-w/2,-b/2),0===f&&x.ph(p,v),p.translate(w/2,b/2),p.rotate(-h),p.translate(-e,-i),u-=d,l-=d,0!==f){if(++g===P.length)return void Xt.ot(P);m=P[g],r=m[0],h=m[1],o=m[2],l=m[3],d=f}}Xt.ot(P)}}ph(n,r){var a=n instanceof _t;let o=this.$i;var h=this.Fa;if(null!==o||null!==h){var l=this.yt;if(null!==l){n.commitTransform();var u=this.actualBounds,d=this.naturalBounds,c=(null!==h&&this.bn(n,h,!0,!1,d,u),this.part);let t=this.Qo,e=(null===o||0!==t||null===c||!this.isPanelMain&&c.findMainElement()!==this||(t=c.MI()),null!==(o=0===t?null:o)&&0!==t&&(this.bn(n,o,!1,!1,d,u),n.lineWidth=t,n.lineJoin=this.strokeJoin,n.lineCap=this.strokeCap,n.miterLimit=this.strokeMiterLimit),!1),i=(c&&r.getRenderingHint("drawShadows")&&(e=c.isShadowed),!1===n.hl&&(e=!1),!0),s=(null===o||null!==h&&"transparent"!==h||(i=!1),!1);d=this.strokeDashArray;if(null!==d&&(s=!0,n.enableDash(d,this.strokeDashOffset)),1===l.type)n.beginPath(),n.moveTo(l.startX,l.startY),n.lineTo(l.endX,l.endY),null!==o&&n.strokeContext(),n.endPath();else if(2===l.type){var u=l.startX,c=l.startY,d=l.endX,g=l.endY,m=Math.min(u,d),f=Math.min(c,g),d=Math.abs(d-u),u=Math.abs(g-c);n.beginPath(),n.rect(m,f,d,u),null!==h&&n.fillContext(h,!1,null),null!==o&&(i&&e&&n.shadowsOff(),n.strokeContext(),i)&&e&&n.shadowsOn(),n.endPath()}else if(3===l.type){g=l.startX,c=l.startY,m=l.endX,f=l.endY,d=Math.abs(m-g)/2,u=Math.abs(f-c)/2,g=Math.min(g,m)+d,m=Math.min(c,f)+u;n.beginPath(),n.moveTo(g,m-u),n.bezierCurveTo(g+I.Gn*d,m-u,g+d,m-I.Gn*u,g+d,m),n.bezierCurveTo(g+d,m+I.Gn*u,g+I.Gn*d,m+u,g,m+u),n.bezierCurveTo(g-I.Gn*d,m+u,g-d,m+I.Gn*u,g-d,m),n.bezierCurveTo(g-d,m-I.Gn*u,g-I.Gn*d,m-u,g,m-u),n.closePath(),null!==h&&n.fillContext(h,!1,null),null!==o&&(i&&e&&n.shadowsOff(),n.strokeContext(),i)&&e&&n.shadowsOn(),n.endPath()}else if(4===l.type){var p=l.figures,v=p.length;for(let t=0;t<v;t++){var y=p.h[t],x=(a?this.buildPath(n,y):null===y.ve&&(y.ve=new Path2D,this.buildPath(y.ve,y)),y.isFilled);e?y.isShadowed?(!0===x&&"transparent"!==h&&null!==h&&n.fillContext(h,y.isEvenOdd,y.ve),null!==o&&(x&&i&&n.shadowsOff(),n.stroke(y.ve),x)&&i&&n.shadowsOn()):(n.shadowsOff(),x&&"transparent"!==h&&null!==h&&n.fillContext(h,y.isEvenOdd,y.ve),null!==o&&n.stroke(y.ve),n.shadowsOn()):(x&&null!==h&&n.fillContext(h,y.isEvenOdd,y.ve),null!==o&&n.stroke(y.ve)),n.endPath(t)}}s&&n.disableDash(),null!==this.pathPattern&&this.kI(n,r)}}}buildPath(s,n){s instanceof Path2D||s.beginPath(),s.moveTo(n.startX,n.startY);var e=n.segments.h,i=e.length;let r=null;for(let t=0;t<i;t++){var a=e[t];switch(a.type){case 1:s.moveTo(a.endX,a.endY);break;case 2:s.lineTo(a.endX,a.endY);break;case 3:s.bezierCurveTo(a.point1X,a.point1Y,a.point2X,a.point2Y,a.endX,a.endY);break;case 4:s.quadraticCurveTo(a.point1X,a.point1Y,a.endX,a.endY);break;case 5:if(a.radiusX===a.radiusY){var o=null!==r?r.endX:n.startX,h=null!==r?r.endY:n.startY,l=Math.PI/180;s.arc(a.point1X,a.point1Y,a.radiusX,a.startAngle*l,(a.startAngle+a.sweepAngle)*l,a.sweepAngle<0,o,h)}else{var u=a.Fo(n),d=u.length;if(0===d){s.lineTo(a.centerX,a.centerY);break}for(let t=0;t<d;t++){var c=u[t];0===t&&s.lineTo(c[0],c[1]),s.bezierCurveTo(c[2],c[3],c[4],c[5],c[6],c[7])}}break;case 6:{let t=0,e=0,i;if(null!==r&&5===r.type){l=(i=r.Fo(n)).length;if(0===l){s.lineTo(a.endX,a.endY);break}o=i[l-1]||null;null!==o&&(t=o[6],e=o[7])}else t=null!==r?r.endX:n.startX,e=null!==r?r.endY:n.startY;var g=(i=a.Kh(n,t,e)).length;if(0!==g)for(let t=0;t<g;t++){var m=i[t];s.bezierCurveTo(m[2],m[3],m[4],m[5],m[6],m[7])}else s.lineTo(a.endX,a.endY)}}a.isClosed&&s.closePath(),r=a}}sc(t,e,i){return!(!super.sc(t,e,i)||null===this.$i&&null===this.Fa||null===this.yt||null!==this.pathPattern||(i=this.svg.getElementsByTagName("path"),this.geometry.figures.length!==i.length)||(t.currentPath=this.svg,this.ph(t,e),t.currentPath=null))}fd(t){return null!==this.geometry&&1<this.geometry.figures.length||null!==this.pathPattern||super.fd(t)}d2(t,e){if("g"!==t.nodeName)t.setAttributeNS(null,"filter",e);else{var i=t.getElementsByTagName("path");for(let t=0;t<i.length;t++)i[t].setAttributeNS(null,"filter",e)}}getDocumentPoint(t,e){var i,s,n;return void 0===e&&(e=new U),t instanceof J?((i=t).isNoSpot()&&Xt.n("getDocumentPoint Spot must be a real, specific Spot, not: "+i.toString()),s=this.naturalBounds,n=this.strokeWidth,e.e(i.x*(s.width+n)-n/2+s.x+i.offsetX,i.y*(s.height+n)-n/2+s.y+i.offsetY)):e.set(t),this.Ms.Pt(e),e}getDocumentBounds(t){void 0===t&&(t=new Z);var e=this.naturalBounds,i=this.Ms,e=Z.H(e.x,e.y,e.width,e.height),s=this.strokeWidth,s=(e.inflate(s/2,s/2),U.H(e.x,e.y).D(i));return t.e(s.x,s.y,0,0),s.e(e.right,e.y).D(i),t.unionNoCheck(s.x,s.y,0,0),s.e(e.right,e.bottom).D(i),t.unionNoCheck(s.x,s.y,0,0),s.e(e.x,e.bottom).D(i),t.unionNoCheck(s.x,s.y,0,0),Z.o(e),U.o(s),t}dh(i,t){var s=this.geometry;if(null===s||null===this.fill&&null===this.stroke)return!1;var n=s.bounds;let e=this.strokeWidth/2;1!==s.type||t||(e+=2);var r=Z.a();if(r.c(n),r.inflate(e+2,e+2),!r.containsPoint(i))return Z.o(r),!1;n=e+1e-4;if(1===s.type)return null!==this.stroke&&(a=(s.startX-s.endX)*(i.x-s.endX)+(s.startY-s.endY)*(i.y-s.endY),o=(s.endX-s.startX)*(i.x-s.startX)+(s.endY-s.startY)*(i.y-s.startY),!(a<0||o<0))&&(Z.o(r),I.zi(s.startX,s.startY,s.endX,s.endY,e,i.x,i.y));if(2===s.type){var a=s.startX,o=s.startY,h=s.endX,l=s.endY;if(r.x=Math.min(a,h),r.y=Math.min(o,l),r.width=Math.abs(h-a),r.height=Math.abs(l-o),null===this.fill){if(r.inflate(-n,-n),r.containsPoint(i))return Z.o(r),!1;r.inflate(n,n)}null!==this.stroke&&r.inflate(e,e);h=r.containsPoint(i);return Z.o(r),h}if(3===s.type){var a=s.startX,l=s.startY,o=s.endX,h=s.endY,u=Math.min(a,o),d=Math.min(l,h);let t=Math.abs(o-a)/2,e=Math.abs(h-l)/2;if(u=i.x-(u+t),d=i.y-(d+e),null===this.fill){if(t-=n,e-=n,t<=0||e<=0)return Z.o(r),!1;if(u*u/(t*t)+d*d/(e*e)<=1)return Z.o(r),!1;t+=n,e+=n}return null!==this.stroke&&(t+=n,e+=n),Z.o(r),!(t<=0||e<=0)&&u*u/(t*t)+d*d/(e*e)<=1}if(4===s.type)return Z.o(r),null===this.fill?s.MC(i.x,i.y,e):s.jk(i,e,1<this.strokeWidth,t);Xt.n("Unknown Geometry type: "+s.type)}ld(t,e,i,s){var n=this.desiredSize,r=this.Qo;t=Math.max(t,0),e=Math.max(e,0);let a;if(null!==this.As)a=this.geometry.bounds;else{var o=this.figure;let e=V.K2[o];if(void 0===e){let t=I.qn[o];"function"==typeof(t="string"==typeof t?I.qn[t]:t)?(e=t(null,100,100),V.K2[o]=e):Xt.n("Unsupported Figure: "+o)}a=e.bounds}let h=a.width,l=a.height,u=a.width,d=a.height;switch(this.qs(!0)){case 0:s=i=0;break;case 2:u=Math.max(t-r,0),d=Math.max(e-r,0);break;case 5:u=Math.max(t-r,0),s=0;break;case 4:i=0,d=Math.max(e-r,0)}isFinite(n.width)&&(u=n.width),isFinite(n.height)&&(d=n.height);var c,o=this.maxSize,g=this.minSize,m=(i=Math.max(i-r,g.width),s=Math.max(s-r,g.height),u=Math.min(o.width,u),d=Math.min(o.height,d),u=isFinite(u)?Math.max(i,u):Math.max(h,i),d=isFinite(d)?Math.max(s,d):Math.max(l,s),this.lM());switch(m){case 0:break;case 2:h=u,l=d;break;case 6:{let t=Math.min(u/h,d/l);isFinite(t)||(t=1),h*=t,l*=t;break}default:Xt.n(m+" is not a valid geometryStretch.")}null!==this.As?(0===h&&(h=.001),0===l&&(l=.001),c=(null!==this.As?this.As:this.yt).qD(h,l),Yt,c.w(),this.yt=c):null!==this.yt&&I.q(this.yt.ff,t-r)&&I.q(this.yt.cf,e-r)||(this.yt=V.NI(this,h,l)),a=this.yt.bounds,t===1/0||e===1/0?this.oo(a.x-r/2,a.y-r/2,0===t&&0===h?0:a.width+r,0===e&&0===l?0:a.height+r):this.oo(-r/2,-r/2,u+r,d+r),n.isReal()?(u=n.width,d=n.height,u=Math.min(o.width,u),d=Math.min(o.height,d),u=Math.max(g.width,u),d=Math.max(g.height,d),this.Hi.e(0,0,u,d)):this.Hi.c(a)}lM(){var t=this.geometryStretch;return null!==this.As?1===t?2:t:1===t?V.K2[this.figure].defaultStretch:t}gh(t,e,i,s){this.commonArrange(t,e,i,s)}getNearestIntersectionPoint(t,e,i){return this.ec(t.x,t.y,e.x,e.y,i)}ec(d,c,g,m,f){var p=this.D,t=1/(p.m11*p.m22-p.m12*p.m21),s=p.m22*t,v=-p.m12*t,n=-p.m21*t,e=p.m11*t,i=t*(p.m21*p.dy-p.m22*p.dx),t=t*(p.m12*p.dx-p.m11*p.dy),y=d*s+c*n+i,x=d*v+c*e+t,A=g*s+m*n+i,w=g*v+m*e+t,p=this.Qo/2;let b=this.yt;null===b&&(this.wt(1/0,1/0),b=this.yt);var P=b.bounds;let S=!1;if(1===b.type)if(this.strokeWidth<=1.5)S=I.vn(b.startX,b.startY,b.endX,b.endY,y,x,A,w,f);else{let t=0,e=0;b.startX===b.endX?(t=p,e=0):(s=(b.endY-b.startY)/(b.endX-b.startX),e=p/Math.sqrt(1+s*s),t=e*s);var r=Xt.ct(),n=new U,a=(I.vn(b.startX+t,b.startY+e,b.endX+t,b.endY+e,y,x,A,w,n)&&r.push(n),n=new U,I.vn(b.startX-t,b.startY-e,b.endX-t,b.endY-e,y,x,A,w,n)&&r.push(n),n=new U,I.vn(b.startX+t,b.startY+e,b.startX-t,b.startY-e,y,x,A,w,n)&&r.push(n),n=new U,I.vn(b.endX+t,b.endY+e,b.endX-t,b.endY-e,y,x,A,w,n)&&r.push(n),r.length);if(0===a)return Xt.ot(r),!1;S=!0;let i=1/0;for(let t=0;t<a;t++){var o=r[t],h=(o.x-y)*(o.x-y)+(o.y-x)*(o.y-x);h<i&&(i=h,f.x=o.x,f.y=o.y)}Xt.ot(r)}else if(2===b.type)S=I.Ml(P.x-p,P.y-p,P.x+P.width+p,P.y+P.height+p,y,x,A,w,f);else if(3===b.type){i=Z.H(P.x,P.y,P.width,P.height).inflate(p,p);S=this.CI(i,y,x,A,w,f),Z.o(i)}else if(4===b.type){let n=0,r=0,a=0,o=0;var k=U.a();let t=A-y,e=w-x,h=t*t+e*e,l=y,u=x;if(0<h&&P.contains(l,u)&&(k.x=l,k.y=u,this.containsPoint(k)))for(0!==t&&Math.abs(t)<.5?(e*=.5/t,t=.5):0!==e&&Math.abs(e)<.5&&(t*=.5/e,e=.5),l-=t,u-=e;P.contains(l,u);)l-=t,u-=e;f.x=A,f.y=w;for(let t=0;t<b.figures.count;t++){var M=b.figures.h[t],N=M.isFilled?l:y,C=M.isFilled?u:x,L=M.segments;n=M.startX,r=M.startY;let i=n,s=r;for(let e=0;e<L.count;e++){var D,T=L.h[e],B=T.type;a=T.endX,o=T.endY;let t=!1;switch(B){case 1:i=a,s=o;break;case 2:t=this.rb(n,r,a,o,N,C,A,w,k);break;case 3:t=I.jg(n,r,T.point1X,T.point1Y,T.point2X,T.point2Y,a,o,N,C,A,w,.6,k);break;case 4:t=I.jg(n,r,n+2/3*(T.point1X-n),r+2/3*(T.point1Y-r),a+2/3*(T.point1X-a),o+2/3*(T.point1Y-o),a,o,N,C,A,w,.6,k);break;case 5:case 6:{var G,F=5===T.type?T.Fo(M):T.Kh(M,n,r),R=F.length;if(0===R){t=this.rb(n,r,5===T.type?T.centerX:T.endX,5===T.type?T.centerY:T.endY,N,C,A,w,k);break}let e=null;for(let t=0;t<R;t++)e=F[t],0===t&&this.rb(n,r,e[0],e[1],N,C,A,w,k)&&(G=this.lb(N,C,k,h,f))<h&&(h=G,S=!0),I.jg(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],N,C,A,w,.6,k)&&(G=this.lb(N,C,k,h,f))<h&&(h=G,S=!0);a=e[6],o=e[7];break}default:Xt.n("Unknown Segment type: "+B)}n=a,r=o,t&&(D=this.lb(N,C,k,h,f))<h&&(h=D,S=!0),T.isClosed&&(a=i,o=s,this.rb(n,r,a,o,N,C,A,w,k))&&((D=this.lb(N,C,k,h,f))<h&&(h=D,S=!0))}}let i=g-d,s=m-c;v=Math.sqrt(i*i+s*s);0!==v&&(i/=v,s/=v),f.x-=i*p,f.y-=s*p,U.o(k)}else Xt.n("Unknown Geometry type: "+b.type);return!!S&&(this.D.Pt(f),!0)}lb(t,e,i,s,n){t=i.x-t,e=i.y-e,t=t*t+e*e;return t<s?(n.x=i.x,n.y=i.y,t):s}rb(t,e,i,s,n,r,a,o,h){if(I.q(t,i)&&I.q(e,s)||I.q(n,a)&&I.q(r,o))return!1;let l=!1;var u=(n-a)*(e-s)-(r-o)*(t-i);return 0!=u&&(h.x=((n*o-r*a)*(t-i)-(n-a)*(t*s-e*i))/u,h.y=((n*o-r*a)*(e-s)-(r-o)*(t*s-e*i))/u,(i<t?t-i:i-t)<(s<e?e-s:s-e)?(n=e<s?s:e,(h.y>(a=e<s?e:s)||I.q(h.y,a))&&(h.y<n||I.q(h.y,n))&&(l=!0)):(r=t<i?i:t,(h.x>(o=t<i?t:i)||I.q(h.x,o))&&(h.x<r||I.q(h.x,r))&&(l=!0)),l)}AI(t,e,i){return!1!==this.pickable&&(i.hf(this.D),e?this.LI(t,i):this.containedInRect(t,i))}containedInRect(t,e){if(void 0===e)return t.containsRect(this.actualBounds);let i=this.yt;null===i&&(this.wt(1/0,1/0),i=this.yt);var s=i.bounds,n=this.strokeWidth/2;let r=!1;var a=U.a();return a.e(s.x-n,s.y-n),t.containsPoint(e.Pt(a))&&(a.e(s.x-n,s.bottom+n),t.containsPoint(e.Pt(a)))&&(a.e(s.right+n,s.bottom+n),t.containsPoint(e.Pt(a)))&&(a.e(s.right+n,s.y-n),t.containsPoint(e.Pt(a)))&&(r=!0),U.o(a),r}intersectsRect(t,e){if(this.containedInRect(t,e)||void 0===e&&(e=this.D,t.containsRect(this.actualBounds)))return!0;var i=H.a(),s=(i.set(e),i.Mw(),t.left),n=t.right,r=t.top,t=t.bottom,a=U.a();if(a.e(s,r),i.Pt(a),this.dh(a,!0))return U.o(a),!0;if(a.e(n,r),i.Pt(a),this.dh(a,!0))return U.o(a),!0;if(a.e(s,t),i.Pt(a),this.dh(a,!0))return U.o(a),!0;if(a.e(n,t),i.Pt(a),this.dh(a,!0))return U.o(a),!0;var o=U.a(),h=U.a();i.set(e),i.uC(this.D),i.Mw(),o.x=n,o.y=r,o.D(i),a.x=s,a.y=r,a.D(i);let l=!1;return(this.Ia(a,o,h)||(a.x=n,a.y=t,a.D(i),this.Ia(a,o,h))||(o.x=s,o.y=t,o.D(i),this.Ia(a,o,h))||(a.x=s,a.y=r,a.D(i),this.Ia(a,o,h)))&&(l=!0),U.o(a),H.o(i),U.o(o),U.o(h),l}Ia(i,s,n){if(!this.getNearestIntersectionPoint(i,s,n))return!1;var r=i.x,i=i.y,a=s.x,s=s.y,o=n.x,n=n.y;if(r===a){let t=0,e=0;return e=i<s?(t=i,s):(t=s,i),n>=t&&n<=e}{let t=0,e=0;return e=r<a?(t=r,a):(t=a,r),o>=t&&o<=e}}LI(t,e){if(this.containedInRect(t,e)||void 0===e&&(e=this.D,t.containsRect(this.actualBounds)))return!0;var i=t.left,s=t.right,n=t.top,t=t.bottom,r=U.a(),a=U.a(),o=U.a(),h=H.a();h.set(e),h.uC(this.D),h.Mw(),a.x=s,a.y=n,a.D(h),r.x=i,r.y=n,r.D(h);let l=!1;return(this.Ia(r,a,o)||(r.x=s,r.y=t,r.D(h),this.Ia(r,a,o))||(a.x=i,a.y=t,a.D(h),this.Ia(r,a,o))||(r.x=i,r.y=n,r.D(h),this.Ia(r,a,o)))&&(l=!0),H.o(h),U.o(r),U.o(a),U.o(o),l}sL(n,t,e){if(e&&null!==this.fill&&this.dh(n,!0))return!0;let r=n.distanceSquaredPoint(t);t=r;1.5<this.strokeWidth&&(r=this.strokeWidth/2+Math.sqrt(r),r*=r);let i=this.yt;if(null!==i||(this.wt(1/0,1/0),null!==(i=this.yt))){if(!e){var s=i.bounds,a=s.x,o=s.y,h=s.x+s.width,s=s.y+s.height;if(U.distanceSquared(n.x,n.y,a,o)<=r&&U.distanceSquared(n.x,n.y,h,o)<=r&&U.distanceSquared(n.x,n.y,a,s)<=r&&U.distanceSquared(n.x,n.y,h,s)<=r)return!0}var l,u,o=i.startX,a=i.startY,h=i.endX,s=i.endY;if(1===i.type)return d=U.distanceLineSegmentSquared(n.x,n.y,o,a,h,s),l=(h-o)*(n.x-o)+(s-a)*(n.y-a),u=(o-h)*(n.x-h)+(a-s)*(n.y-s),d<=(0<=l&&0<=u?r:t);if(2===i.type){let t=!1;return t=e?U.distanceLineSegmentSquared(n.x,n.y,o,a,o,s)<=r||U.distanceLineSegmentSquared(n.x,n.y,o,a,h,a)<=r||U.distanceLineSegmentSquared(n.x,n.y,h,a,h,s)<=r||U.distanceLineSegmentSquared(n.x,n.y,o,s,h,s)<=r:t}if(3===i.type)return d=n.x-(o+h)/2,l=n.y-(a+s)/2,u=Math.abs(h-o)/2,t=Math.abs(s-a)/2,0==u||0==t?U.distanceLineSegmentSquared(n.x,n.y,o,a,h,s)<=r:e?(o=I.BD(u,t,d,l))*o<=r:!(U.distanceSquared(d,l,-u,0)>=r||U.distanceSquared(d,l,0,-t)>=r||U.distanceSquared(d,l,0,t)>=r||U.distanceSquared(d,l,u,0)>=r);if(4===i.type){a=i.bounds,h=a.x,s=a.y,o=a.x+a.width,t=a.y+a.height;if(n.x>o&&n.x<h&&n.y>t&&n.y<s&&U.distanceLineSegmentSquared(n.x,n.y,h,s,h,t)>r&&U.distanceLineSegmentSquared(n.x,n.y,h,s,o,s)>r&&U.distanceLineSegmentSquared(n.x,n.y,o,t,h,t)>r&&U.distanceLineSegmentSquared(n.x,n.y,o,t,o,s)>r)return!1;var d=Math.sqrt(r);if(!e){var c=i.figures;for(let t=0;t<c.count;t++){var g=c.h[t];let i=g.startX,s=g.startY;if(n.distanceSquared(i,s)>r)return!1;var m=g.segments.h,f=m.length;for(let t=0;t<f;t++){var p=m[t];switch(p.type){case 1:case 2:if(i=p.endX,s=p.endY,n.distanceSquared(i,s)>r)return!1;break;case 3:var v=Xt.ct(),y=(I.Hn(i,s,p.point1X,p.point1Y,p.point2X,p.point2Y,p.endX,p.endY,.8,v),b(v,n));if(Xt.ot(v),y||(i=p.endX,s=p.endY,n.distanceSquared(i,s)>r))return!1;break;case 4:v=Xt.ct(),y=(I.Wg(i,s,p.point1X,p.point1Y,p.endX,p.endY,.8,v),b(v,n));if(Xt.ot(v),y||(i=p.endX,s=p.endY,n.distanceSquared(i,s)>r))return!1;break;case 5:case 6:{var x=5===p.type?p.Fo(g):p.Kh(g,i,s),A=x.length;if(0===A){if(i=5===p.type?p.centerX:p.endX,s=5===p.type?p.centerY:p.endY,n.distanceSquared(i,s)>r)return!1;break}let e=null;var w=Xt.ct();for(let t=0;t<A;t++)if(e=x[t],w.length=0,I.Hn(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],.8,w),b(w,n))return Xt.ot(w),!1;Xt.ot(w),null!==e&&(i=e[6],s=e[7]);break}default:Xt.n("Unknown Segment type: "+p.type)}}}return!0}if(null===this.fill?i.MC(n.x,n.y,d):i.jk(n,d,!0,!1))return!0}}return!1;function b(e,i){var s=e.length;for(let t=0;t<s;t+=2)if(i.distanceSquared(e[t],e[t+1])>r)return!0;return!1}}CI(e,i,s,n,r,a){if(0===e.width)return I.vn(e.x,e.y,e.x,e.y+e.height,i,s,n,r,a);if(0===e.height)return I.vn(e.x,e.y,e.x+e.width,e.y,i,s,n,r,a);{var o=e.width/2,h=e.height/2,l=e.x+o,e=e.y+h;let t=i!==n?(s-r)/(i-n):9999;if(Math.abs(t)<9999){r=s-e-t*(i-l);if(o*o*(t*t)+h*h-r*r<0)return a.x=NaN,a.y=NaN,!1;var n=Math.sqrt(o*o*(t*t)+h*h-r*r),u=(-(o*o*t)*r+o*h*n)/(h*h+o*o*(t*t))+l,n=(-(o*o*t)*r-o*h*n)/(h*h+o*o*(t*t))+l,d=t*(u-l)+r+e,r=t*(n-l)+r+e;Math.abs((i-u)*(i-u))+Math.abs((s-d)*(s-d))<Math.abs((i-n)*(i-n))+Math.abs((s-r)*(s-r))?(a.x=u,a.y=d):(a.x=n,a.y=r)}else{u=h*h,d=i-l,n=u-u/(o*o)*(d*d);if(n<0)return a.x=NaN,a.y=NaN,!1;r=Math.sqrt(n),h=e+r,l=e-r;Math.abs(h-s)<Math.abs(l-s)?(a.x=i,a.y=h):(a.x=i,a.y=l)}return!0}}pI(){return this.Qo/2*this.strokeMiterLimit*this.getDocumentScale()}get geometry(){return null!==this.yt?this.yt:this.As}set geometry(t){var e,i,s=this.yt,n=this.As;s!==t&&(null!==t?(Yt,Xt.s(t,W,V,"geometry"),this.yt=t.w(),this.As=this.yt):(this.yt=null,this.As=null),null!==(e=this.part)&&e.gc(),this.u(),this.i("geometry",s||n,t),this.ic())&&null!==(i=this.part)&&this.Sa(i,"geometryString")}get geometryString(){return null===this.geometry?"":this.geometry.toString()}set geometryString(t){var t=W.parse(t),e=t.normalize(),t=(this.geometry=t,U.H(-e.x,-e.y));this.position=t,U.o(t)}get isGeometryPositioned(){return 0!=(1048576&this.l)}set isGeometryPositioned(t){var e=0!=(1048576&this.l);e!==t&&(Yt,Xt.t(t,"boolean",V,"isGeometryPositioned"),this.l=1048576^this.l,this.u(),this.i("isGeometryPositioned",e,t))}fe(){this.yt=null}get fill(){return this.Fa}set fill(t){var e=this.Fa;e!==t&&(null!==t&&m.ud(t,"Shape.fill"),t instanceof m&&t.w(),this.Fa=t,this.T(),this.i("fill",e,t))}get stroke(){return this.$i}set stroke(t){var e=this.$i;e!==t&&(null!==t&&m.ud(t,"Shape.stroke"),t instanceof m&&t.w(),this.$i=t,this.T(),this.i("stroke",e,t))}get strokeWidth(){return this.Qo}set strokeWidth(t){var e,i=this.Qo;i!==t&&(Yt,Xt.r(t,V,"strokeWidth"),0<=t?(this.Qo=t,this.u(),null!==(e=this.part)&&e.gc(),this.i("strokeWidth",i,t)):Xt.G(t,"value >= 0",V,"strokeWidth:value"))}K1(){return this.Qo}get strokeCap(){return null!==this.Rt?this.Rt.Mp:"butt"}set strokeCap(t){var e=this.strokeCap;e!==t&&("string"!=typeof t||"butt"!==t&&"round"!==t&&"square"!==t?Xt.G(t,'"butt", "round", or "square"',V,"strokeCap"):(this.Ra(),this.Rt.Mp=t,this.T(),this.i("strokeCap",e,t)))}get strokeJoin(){return null!==this.Rt?this.Rt.Pp:"miter"}set strokeJoin(t){var e=this.strokeJoin;e!==t&&("string"!=typeof t||"miter"!==t&&"bevel"!==t&&"round"!==t?Xt.G(t,'"miter", "bevel", or "round"',V,"strokeJoin"):(this.Ra(),this.Rt.Pp=t,this.T(),this.i("strokeJoin",e,t)))}get strokeMiterLimit(){return null!==this.Rt?this.Rt.Np:10}set strokeMiterLimit(t){var e,i=this.strokeMiterLimit;i!==t&&(Yt,Xt.r(t,V,"strokeMiterLimit"),1<=t?(this.Ra(),this.Rt.Np=t,this.T(),null!==(e=this.part)&&e.gc(),this.i("strokeMiterLimit",i,t)):(Yt,Xt.G(t,"value >= 1",V,"strokeWidth:value")))}get strokeDashArray(){return this.jo}set strokeDashArray(i){var t=this.jo;if(t!==i){if(null===i||Array.isArray(i)||Xt.Bi(i,"Array",V,"strokeDashArray:value"),null!==i){var s=i.length;let e=0;for(let t=0;t<s;t++){var n=i[t];Yt,"number"==typeof n&&0<=n&&isFinite(n)||Xt.n("strokeDashArray:value "+n+" at index "+t+" must be a positive number or zero."),e+=n}if(0===e){if(null===t)return;i=null}}this.jo=i,this.T(),this.i("strokeDashArray",t,i)}}get strokeDashOffset(){return null!==this.Rt?this.Rt.wh:0}set strokeDashOffset(t){var e=this.strokeDashOffset;e!==t&&(Yt,Xt.r(t,V,"strokeDashOffset"),0<=t)&&(this.Ra(),this.Rt.wh=t,this.T(),this.i("strokeDashOffset",e,t))}get figure(){return this.Ad}set figure(e){var i=this.Ad;if(i!==e){Yt,Xt.t(e,"string",V,"figure");let t=I.qn[e];"function"==typeof t?t=e:(t=I.qn[e.toLowerCase()])||Xt.n("Unknown Shape.figure: "+e),i!==t&&(null!==(e=this.part)&&e.gc(),this.Ad=t,this.As=null,this.fe(),this.u(),this.i("figure",i,t))}}get toArrow(){return null!==this.Ut?this.Ut.Cp:"None"}set toArrow(t){var e,i=this.toArrow;!0===t?t="Standard":!1===t&&(t=""),i!==t&&(Yt,Xt.t(t,"string",V,"toArrow"),null===(e=V.RL(t))?Xt.n("Unknown Shape.toArrow: "+t):i!==e&&(null===this.Ut&&(this.Ut=new qe),this.Ut.Cp=e,this.As=null,this.fe(),this.u(),this.IL(e),this.i("toArrow",i,e)))}get fromArrow(){return null!==this.Ut?this.Ut.Ap:"None"}set fromArrow(t){var e,i=this.fromArrow;!0===t?t="Standard":!1===t&&(t=""),i!==t&&(Yt,Xt.t(t,"string",V,"fromArrow"),null===(e=V.RL(t))?Xt.n("Unknown Shape.fromArrow: "+t):i!==e&&(null===this.Ut&&(this.Ut=new qe),this.Ut.Ap=e,this.As=null,this.fe(),this.u(),this.IL(e),this.i("fromArrow",i,e)))}IL(t){var e=this.diagram;null!==e&&e.undoManager.isUndoingRedoing||(this.XR(),e=J.MiddleRight,"None"!==this.toArrow?(this.segmentIndex=-1,this.alignmentFocus=e):"None"!==this.fromArrow&&(this.segmentIndex=0,this.alignmentFocus=new J(1-e.x,e.y)))}get spot1(){return null!==this.Rt?this.Rt.Wn:J.Default}set spot1(t){Xt.s(t,J,V,"spot1");var e=this.spot1;e.equals(t)||(t=t.L(),this.Ra(),this.Rt.Wn=t,this.u(),this.i("spot1",e,t))}get spot2(){return null!==this.Rt?this.Rt.jn:J.Default}set spot2(t){Xt.s(t,J,V,"spot2");var e=this.spot2;e.equals(t)||(t=t.L(),this.Ra(),this.Rt.jn=t,this.u(),this.i("spot2",e,t))}get parameter1(){return this.Ld}set parameter1(t){var e=this.Ld;e!==t&&(this.Ld=t,this.fe(),this.u(),this.i("parameter1",e,t))}get parameter2(){return this.Td}set parameter2(t){var e=this.Td;e!==t&&(this.Td=t,this.fe(),this.u(),this.i("parameter2",e,t))}get naturalBounds(){return this.Hi}oI(){var t=this.desiredSize;t.isReal()||null===this.yt?this.Hi.e(0,0,t.width,t.height):(t=this.yt.bounds,this.Hi.c(t))}get pathPattern(){return null!==this.Rt?this.Rt.Lp:null}set pathPattern(t){var e=this.pathPattern;e!==t&&(Yt,null!==t&&Xt.s(t,y,V,"pathPattern"),this.Ra(),this.Rt.Lp=t,this.T(),this.i("pathPattern",e,t))}get geometryStretch(){return null!==this.Rt?this.Rt.Tp:1}set geometryStretch(t){var e=this.geometryStretch;e!==t&&(Xt.it(t,S,"GeometryStretch"),this.Ra(),this.Rt.Tp=t,this.u(),this.i("geometryStretch",e,t))}get interval(){return null!==this.tt?this.tt.pc:1}set interval(t){var e,i=this.interval;Yt,Xt.r(t,V,"interval"),i!==(t=Math.round(t))&&0!==t&&isFinite(t)&&(null===this.tt&&(this.tt=new Ne),this.tt.pc=t,null!==(e=this.diagram)&&this.panel===e.grid&&e._r(),this.u(),null!==(e=this.panel)&&(e.cs=null),this.i("interval",i,t))}get graduatedStart(){return null!==this.tt?this.tt.yc:0}set graduatedStart(t){var e=this.graduatedStart;Yt,Xt.r(t,V,"graduatedStart"),e!==t&&(t<0?t=0:1<t&&(t=1),null===this.tt&&(this.tt=new Ne),this.tt.yc=t,this.u(),this.i("graduatedStart",e,t))}get graduatedEnd(){return null!==this.tt?this.tt.wc:1}set graduatedEnd(t){var e=this.graduatedEnd;Yt,Xt.r(t,V,"graduatedEnd"),e!==t&&(t<0?t=0:1<t&&(t=1),null===this.tt&&(this.tt=new Ne),this.tt.wc=t,this.u(),this.i("graduatedEnd",e,t))}get graduatedSkip(){return null!==this.tt?this.tt.xc:null}set graduatedSkip(t){var e=this.graduatedSkip;e!==t&&(null!==t&&Xt.t(t,"function",V,"graduatedSkip"),null===this.tt&&(this.tt=new Ne),this.tt.xc=t,this.u(),this.i("graduatedSkip",e,t))}static NI(e,i,s){let n=null;if("None"!==e.toArrow)n=V.co[e.toArrow];else if("None"!==e.fromArrow)n=V.co[e.fromArrow];else{let t=I.qn[e.figure];void 0===(t="string"==typeof t?I.qn[t]:t)&&Xt.n("Unknown Shape.figure: "+e.figure),(n=t(e,i,s)).ff=i,n.cf=s}var t;return null===n&&"function"==typeof(t=I.qn.Rectangle)&&(n=t(e,i,s)),Yt,(n.bounds.width>i+1e-5||n.bounds.height>s+1e-5)&&Xt.n('Geometry made with figure "'+e.figure+'" has bounds '+n.bounds.toString()+" that are too large for the given size ("+i+","+s+"). See documentation for Shape.defineFigureGenerator."),n}static getFigureGenerators(){var t,e=new L;for(const i in I.qn)i!==i.toLowerCase()&&(t=I.qn[i],e.add(i,t));return e.w(),e}static defineFigureGenerator(t,e){Xt.t(t,"string",V,"defineFigureGenerator:name"),"string"==typeof e?(Yt,""!==e&&I.qn[e]||Xt.n("Shape.defineFigureGenerator synonym must not be empty or None or not a defined figure name: "+e)):Xt.t(e,"function",V,"defineFigureGenerator:func");var i=t.toLowerCase(),s=(Yt,""!==t&&t!==i||Xt.n("Shape.defineFigureGenerator name must not be empty or all-lower-case: "+t),I.qn);s[t]=e,s[i]=t}static getArrowheadGeometries(){var t,e,i=new L;for(const s in I.$g)void 0===V.co[s]&&(t=W.parse(I.$g[s],!1),V.co[s]=t,(t=s.toLowerCase())!==s)&&(V.co[t]=s);for(const n in V.co)n!==n.toLowerCase()&&(e=V.co[n])instanceof W&&i.add(n,e);return i.w(),i}static defineArrowheadGeometry(t,e){Xt.t(t,"string",V,"defineArrowheadGeometry:name");let i=null;i="string"==typeof e?(Xt.t(e,"string",V,"defineArrowheadGeometry:pathstr"),W.parse(e,!1)):(Xt.s(e,W,V,"defineArrowheadGeometry:pathstr"),e);var e=t.toLowerCase(),s=(Yt,""!==t&&"none"!==e&&t!==e||Xt.n("Shape.defineArrowheadGeometry name must not be empty or None or all-lower-case: "+t),V.co);s[t]=i,s[e]=t}static co=new h;static K2=new h;static RL(t){let e=V.co[t];if(void 0===e){var i,s=t.toLowerCase();if("none"===s)return"None";if(void 0===(e=V.co[s])){let t=null;for(const n in I.$g)if(n.toLowerCase()===s){t=n;break}if(null!==t)return i=W.parse(I.$g[t],!1),V.co[t]=i,s!==t&&(V.co[s]=t),t}}return"string"==typeof e?e:e instanceof W?t:null}}class be{xi;Mp;Pp;Np;wh;Lp;Tp;Wn;jn;constructor(){this.xi=!1,this.Mp="butt",this.Pp="miter",this.Np=10,this.wh=0,this.Lp=null,this.Tp=1,this.Wn=J.Default,this.jn=J.Default}copy(){var t=new be;return t.Mp=this.Mp,t.Pp=this.Pp,t.Np=this.Np,t.wh=this.wh,t.Lp=this.Lp,t.Tp=this.Tp,t.Wn=this.Wn.L(),t.jn=this.jn.L(),t}}(r={})[r.None=0]="None",r[r.Fit=1]="Fit",r[r.DesiredSize=2]="DesiredSize",r[r.BreakAll=3]="BreakAll";var Pe=r,Se=((r={})[r.Clip=0]="Clip",r[r.Ellipsis=1]="Ellipsis",r),ke=((r={})[r.Trim=0]="Trim",r[r.None=1]="None",r);class z extends y{di;$i;Ln;Oe;bi;C0;Fd;tt;_;Bl;uo;Tn;Ee;Ei;Dn;constructor(t,e){return super(),this.l|=2097152,this.di="",this.$i="black",this.Ln="13px sans-serif",this.Oe=0,this.bi=0,this.C0=0,this.Fd=null,this.tt=null,this._=null,this.Bl=0,this.uo=null,this.Tn=0,this.Ee=null,this.Ei=null,this.Dn=null,"string"==typeof t?this.text=t:t&&Object.assign(this,t),e&&Object.assign(this,e),this}cloneProtected(t){super.cloneProtected(t),t.di=this.di,t.$i=this.$i,t.Ln=this.Ln,t.Oe=this.Oe,t.bi=this.bi,t.C0=this.C0,t.Fd=this.Fd,null!==this.tt&&(t.tt=this.tt.copy()),null!==this._&&(this._.xi?t._=this._:t._=this._.copy()),t.Bl=this.Bl,t.uo=this.uo,t.Tn=this.Tn,t.Ee=this.Ee,t.Ei=this.Ei,t.Dn=this.Dn}Fn(){null===this._?this._=new Me:this._.xi&&(this._=this._.copy())}uh(){super.uh(),null!==this._&&(this._.xi=!0)}uI(t){this.l=6144|t.l,this._t=t.opacity,this.Ft=t.background,this.We=t.desiredSize.L(),this.minSize=t.minSize.L(),this.maxSize=t.maxSize.L(),null!==t.Ni?this.Ni=t.Ni.copy():this.Ni=null,this.v=t.scale,this.qt=t.angle,this.stretch=t.stretch,this.ol=t.margin.L(),this.fi=t.alignment.L(),this._f=t.alignmentFocus.L(),this.segmentFraction=t.segmentFraction,this.segmentOffset=t.segmentOffset.L(),this.segmentOrientation=t.segmentOrientation,null!==t.hi&&(this.hi=t.hi.copy()),this.shadowVisible=t.shadowVisible,this.di=t.di,this.$i=t.$i,this.Ln=t.Ln,null!==this.tt&&(this.tt=t.tt.copy()),null!==t._&&(t._.xi?this._=t._:this._=t._.copy()),this.Bl=t.Bl}fI(t){this.di=t.text||"",this.qt=t.labelAngle||0,this.Oe=t.lineCount||0,this.TI(t.lines),t.naturalBounds&&(this.Hi=t.naturalBounds),t.actualBounds&&(t=t.actualBounds,this.vt(t.x,t.y,t.width,t.height))}ci(t){t in Pe?this.wrap=t:super.ci(t)}toString(){return 22<this.di.length?'TextBlock("'+this.di.substring(0,20)+'"...)':'TextBlock("'+this.di+'")'}static getEllipsis(){return z.Dp}static setEllipsis(t){z.Dp=t,z.hb=new h,z.U2=0}static getBaseline(){return z.ab}static setBaseline(t){z.ab=t}static ab=null;static getUnderline(){return z.fb}static setUnderline(t){z.fb=t}static fb=null;static None=0;static WrapFit=1;static WrapDesiredSize=2;static WrapBreakAll=3;static OverflowClip=0;static OverflowEllipsis=1;static FormatTrim=0;static FormatNone=1;u(){super.u()}get font(){return this.Ln}set font(t){var e=this.Ln;e!==t&&(Yt,Xt.t(t,"string",z,"font"),z.isValidFont(t)||Xt.n('Not a valid font: "'+t+'"'),this.Ln=t,this.uo=null,this.u(),this.i("font",e,t))}static isValidFont(t){return!v.CSS||v.CSS.supports("font",t)}get text(){return this.di}set text(t){var e=this.di;e!==(t=null!=t?t.toString():"")&&(this.di=t,this.u(),this.i("text",e,t),this.fs(!0))}get textAlign(){return null!==this._?this._.Fp:"start"}set textAlign(t){var e=this.textAlign;e!==t&&(Yt,Xt.t(t,"string",z,"textAlign"),"start"===t||"end"===t||"left"===t||"right"===t||"center"===t?(this.Fn(),this._.Fp=t,this.T(),this.i("textAlign",e,t)):(Yt,Xt.G(t,'"start", "end", "left", "right", or "center"',z,"textAlign")))}get flip(){return null!==this._?this._.go:0}set flip(t){var e=this.flip;e!==t&&(Xt.it(t,Qt,"Flip"),this.Fn(),this._.go=t,this.T(),this.i("flip",e,t))}get verticalAlignment(){return null!==this._?this._.cl:J.Top}set verticalAlignment(t){var e=this.verticalAlignment;e.equals(t)||((Yt,Xt.s(t,J,z,"verticalAlignment"),t.isNoSpot())&&Xt.n("TextBlock.verticalAlignment for "+this+" must be a real Spot, not:"+t),t=t.L(),this.Fn(),this._.cl=t,this.rc(),this.i("verticalAlignment",e,t))}get naturalBounds(){if(!this.Hi.isReal()){var i=qt.a();this.G2(this.di,999999,i);let t=i.width,e=(qt.o(i),this.OL(t));i=this.desiredSize;isNaN(i.width)||(t=i.width),isNaN(i.height)||(e=i.height),this.Hi.Do(t,e)}return this.Hi}get isMultiline(){return 0!=(2097152&this.l)}set isMultiline(t){var e=0!=(2097152&this.l);e!==t&&(Yt,Xt.t(t,"boolean",z,"isMultiline"),this.l=2097152^this.l,this.u(),this.i("isMultiline",e,t))}get isUnderline(){return 0!=(4194304&this.l)}set isUnderline(t){var e=0!=(4194304&this.l);e!==t&&(Yt,Xt.t(t,"boolean",z,"isUnderline"),this.l=4194304^this.l,this.fs(!0),this.T(),this.i("isUnderline",e,t))}get isStrikethrough(){return 0!=(8388608&this.l)}set isStrikethrough(t){var e=0!=(8388608&this.l);e!==t&&(Yt,Xt.t(t,"boolean",z,"isStrikethrough"),this.l=8388608^this.l,this.fs(!0),this.T(),this.i("isStrikethrough",e,t))}get wrap(){return null!==this._?this._.Rp:2}set wrap(t){var e=this.wrap;e!==t&&(Yt,Xt.it(t,Pe,"Wrap"),this.Fn(),this._.Rp=t,this.u(),this.i("wrap",e,t))}get overflow(){return null!==this._?this._.Ip:0}set overflow(t){var e=this.overflow;e!==t&&(Yt,Xt.it(t,Se,"Overflow"),this.Fn(),this._.Ip=t,this.u(),this.i("overflow",e,t))}get isOverflowed(){return 0!=(16777216&this.l)}H2(t){t?this.l|=16777216:this.l&=-16777217}get stroke(){return this.$i}set stroke(t){var e=this.$i;e!==t&&(null!==t&&m.ud(t,"TextBlock.stroke"),t instanceof m&&t.w(),this.$i=t,this.T(),this.i("stroke",e,t))}get lineCount(){return this.Oe}get lineHeight(){return this.Op()}get editable(){return 0!=(1048576&this.l)}set editable(t){var e=0!=(1048576&this.l);e!==t&&(Yt,Xt.t(t,"boolean",z,"editable"),this.l=1048576^this.l,this.i("editable",e,t))}get textEditor(){return null!==this._?this._.Ep:null}set textEditor(t){var e=this.textEditor;e!==t&&(Yt,t instanceof pt||Xt.n("TextBlock.textEditor must be an HTMLInfo."),this.Fn(),this._.Ep=t,this.i("textEditor",e,t))}get errorFunction(){return null!==this._?this._.us:null}set errorFunction(t){var e=this.errorFunction;e!==t&&(null!==t&&Xt.t(t,"function",z,"errorFunction"),this.Fn(),this._.us=t,this.i("errorFunction",e,t))}get interval(){return null!==this.tt?this.tt.pc:1}set interval(t){var e,i=this.interval;Yt,Xt.r(t,z,"interval"),i!==(t=Math.round(t))&&0!==t&&isFinite(t)&&(null===this.tt&&(this.tt=new Ne),this.tt.pc=t,this.u(),null!==(e=this.panel)&&(e.cs=null),this.i("interval",i,t))}get graduatedStart(){return null!==this.tt?this.tt.yc:0}set graduatedStart(t){var e=this.graduatedStart;Yt,Xt.r(t,z,"graduatedStart"),e!==t&&(t<0?t=0:1<t&&(t=1),null===this.tt&&(this.tt=new Ne),this.tt.yc=t,this.u(),this.i("graduatedStart",e,t))}get graduatedEnd(){return null!==this.tt?this.tt.wc:1}set graduatedEnd(t){var e=this.graduatedEnd;Yt,Xt.r(t,z,"graduatedEnd"),e!==t&&(t<0?t=0:1<t&&(t=1),null===this.tt&&(this.tt=new Ne),this.tt.wc=t,this.u(),this.i("graduatedEnd",e,t))}get graduatedFunction(){return null!==this.tt?this.tt.Vp:null}set graduatedFunction(t){var e=this.graduatedFunction;e!==t&&(null!==t&&Xt.t(t,"function",z,"graduatedFunction"),null===this.tt&&(this.tt=new Ne),this.tt.Vp=t,this.u(),this.i("graduatedFunction",e,t))}get graduatedSkip(){return null!==this.tt?this.tt.xc:null}set graduatedSkip(t){var e=this.graduatedSkip;e!==t&&(null!==t&&Xt.t(t,"function",z,"graduatedSkip"),null===this.tt&&(this.tt=new Ne),this.tt.xc=t,this.u(),this.i("graduatedSkip",e,t))}ph(r,t){if(null!==this.$i&&0!==this.di.length&&null!==this.Ln){var e=this.naturalBounds,a=this.actualBounds,o=e.width,h=e.height,l=this.Op();let i=r.textAlign=this.textAlign;var u=t.ju,d=("start"===i?i=u?"right":"left":"end"===i&&(i=u?"left":"right"),this.isUnderline),c=this.isStrikethrough;this.bn(r,this.$i,!0,!1,e,a),(d||c)&&this.bn(r,this.$i,!1,!1,e,a);let s=0;var g=o;let n=!1;var u=this.Ms,e=u.dx-(l*u.m21+u.dx),a=u.dy-(l*u.m22+u.dy),u=t.scale,m=((e*e+a*a)*u*u<8&&(n=!0),t.ai!==r&&(n=!1),t.ai instanceof _t&&(n=!1),!1===t.getRenderingHint("textGreeking")&&(n=!1),this.spacingAbove),f=this.spacingBelow;switch(this.flip){case 0:break;case 2:r.translate(o,0),r.scale(-1,1);break;case 1:r.translate(0,h),r.scale(1,-1);break;case 3:r.translate(o,h),r.scale(-1,-1)}r.commitTransform();var p=this.Oe,e=(m+l+f)*p;if(e<h&&(a=this.verticalAlignment,s=a.y*h-a.y*e+a.offsetY),1===p&&null!==this.Dn){let t=this.bi;t>g&&(t=g),s+=m,this.EL(this.Dn,r,0,s,g,l,t,n,i,d,c)}else if(null!==this.Ee&&null!==this.Ei)for(let e=0;e<p;e++){let t=this.Ee[e];t>g&&(t=g),s+=m,this.EL(this.Ei[e],r,0,s,g,l,t,n,i,d,c),s+=l+f}switch(this.flip){case 0:break;case 2:r.scale(-1,1),r.translate(-o,0);break;case 1:r.scale(1,-1),r.translate(0,-h);break;case 3:r.scale(-1,-1),r.translate(-o,-h)}}}EL(t,i,s,n,r,a,o,h,l,u,d){let c=0;if(h)"left"===l?c=0:"right"===l?c=r-o:"center"===l&&(c=(r-o)/2),i.fillRect(s+c,n+.25*a,o,1);else{"left"===l?c=0:"right"===l?c=r:"center"===l&&(c=r/2);h=null!==z.ab?z.ab(this,a):.75*a;i.fillText(t,s+c,n+h);let e=a/20|0;if(0===e&&(e=1),"right"===l?c-=o:"center"===l&&(c-=o/2),u&&(r=null!==z.fb?z.fb(this,a):.8*a,this.VL(s+c,n+r,s+c+o,n+r,e,i),i instanceof _t)&&i.lastCreatedElement.classList.add("gojs-td"),d){let t=n+a-a/2.2|0;e%2!=0&&(t+=.5),this.VL(s+c,t,s+c+o,t,e,i),i instanceof _t&&i.lastCreatedElement.classList.add("gojs-td")}}}VL(t,e,i,s,n,r){r.beginPath(),r.lineWidth=n,r.moveTo(t,e),r.lineTo(i,s),r.stroke(),r.endPath()}sc(e,t,i){if(!super.sc(e,t,i))return!1;if(this.bn(e,this.$i,!0,!1,this.naturalBounds,this.actualBounds),i){if(0===this.svg.getElementsByTagName("text").length)return!0;var s=this.svg.getElementsByClassName("gojs-td");for(let t=0;t<s.length;t++)e.setFillOrStrokeInPlace(s[t],!1)}else this.DI(this.svg,this.text,e);return!0}DI(t,e,i){t.innerHTML=e,i.setFillOrStrokeInPlace(t,!0)}fd(t){return!!(1<this.lineCount||this.isUnderline||this.isStrikethrough)||super.fd(t)}d2(t,e){if("g"!==t.nodeName)t.setAttributeNS(null,"filter",e);else{var i=t.getElementsByTagName("text");for(let t=0;t<i.length;t++)i[t].setAttributeNS(null,"filter",e)}}FI(){this.Tn=0,this.bi=0,this.uo=null,this.Ee=null,this.Ei=null,this.Dn=null}ld(t,e,i,s){var n=this.Oe,r=(this.Bl=t,this.H2(!1),this.Ln);null!==z.al&&z.BL!==r&&(z.al.font=r,z.BL=r),this.FI();let a=0,o=0;a=isNaN(this.desiredSize.width)?(a=this.RI(),Math.min(a,t/this.scale)):this.desiredSize.width,null!==this.panel&&(a=Math.min(a,this.panel.maxSize.width)),o=this.OL(a),o=isNaN(this.desiredSize.height)?Math.min(o,e/this.scale):this.desiredSize.height,this.II(t,o),1!==this.wrap&&!isNaN(this.desiredSize.width)||(a=isNaN(t)?this.bi:Math.min(t,this.bi)),a=Math.max(i,a),o=Math.max(s,o),this.Hi.Do(a,o),this.oo(0,0,a,o),null!==this.svg&&n!==this.Oe&&this.fs(!0)}gh(t,e,i,s){this.commonArrange(t,e,i,s)}Rn(t,e){null===this.Dn?(this.Dn=t,this.bi=e):(null!==this.Ei&&null!==this.Ee||(this.Ei=[],this.Ee=[],this.Ei.push(this.Dn),this.Ee.push(this.bi)),this.Ei.push(t),this.Ee.push(e),this.Ei.length>this.maxLines&&(this.l|=16777216))}G2(t,r,a){var o=0===this.formatting;o&&(t=t.trim());let h=0,l=0,u=0;var s=this.Ln,d=this.spacingAbove+this.spacingBelow,d=Math.max(0,this.Op()+d),s=1===this.overflow?this.zL(s):0;if(this.Oe>=this.maxLines)null!==a&&a.e(0,d);else{let n=t;if(0===this.wrap){if(this.Tn=1,l=this.getStringWidth(t),0===s||l<=r)return this.bi=Math.max(this.bi,l),this.Rn(t,this.bi),void(null!==a&&a.e(l,d));let e=this.Rd(n),i=(n=n.substring(e.length),this.Rd(n));for(l=this.getStringWidth(e+i),u=0;0<i.length&&l<=r;){e+=i,n=n.substring(i.length),i=this.Rd(n),u=l;let t=e+i;o&&(t=t.trim()),l=this.getStringWidth(t)}for(o&&(i=i.trim()),e+=i,r=Math.max(1,r-s);this.getStringWidth(e)>r&&1<e.length;)e=e.substring(0,e.length-1);this.H2(!0),e+=z.Dp,u=this.getStringWidth(e),this.bi=u,this.Rn(e,u),void(null!==a&&a.e(u,d))}else{let s=0;for(0===n.length&&(s=1,this.Rn(n,0));0<n.length;){let i=this.Rd(n);for(n=n.substring(i.length);this.getStringWidth(i)>r;){let t=1;for(l=this.getStringWidth(i.substring(0,t)),u=0;l<=r;)t++,u=l,l=this.getStringWidth(i.substring(0,t));let e=0;h=1===t?(e=l,Math.max(h,l)):(e=u,Math.max(h,u)),--t<1&&(t=1);var c=i.substring(0,t);if(this.Rn(c,e),s++,i=i.substring(t),this.Oe+s>this.maxLines)break}let e=this.Rd(n);for(l=this.getStringWidth(i+e),u=0;0<e.length&&l<=r;){i+=e,n=n.substring(e.length),e=this.Rd(n),u=l;let t=i+e;o&&(t=t.trim()),l=this.getStringWidth(t)}if(""!==(i=o?i.trim():i)){"­"===i[i.length-1]&&(i=i.substring(0,i.length-1)+"‐");let t=0;if(h=0===e.length?(t=l,Math.max(h,l)):(u=this.getStringWidth(i),t=u,Math.max(h,u)),this.Rn(i,t),s++,this.Oe+s>this.maxLines)break}}this.Tn=Math.min(this.maxLines,s),this.bi=Math.max(this.bi,h),null!==a&&a.e(this.bi,d*this.Tn)}}}II(e,i){if(0!==this.bi&&null!==this.Ee&&null!==this.Ei&&1===this.overflow){var s=this.Ln,s=1===this.overflow?this.zL(s):0,n=this.spacingAbove+this.spacingBelow,n=Math.max(0,this.Op()+n),i=Math.min(this.maxLines-1,Math.max(Math.floor(i/n+.01)-1,0));if(!(i+1>=this.Ei.length)){this.H2(!0);let t=this.Ei[i];for(var r=Math.max(1,e-s);this.getStringWidth(t)>r&&1<t.length;)t=t.substring(0,t.length-1);t+=z.Dp;n=this.getStringWidth(t);this.Ei[i]=t,this.Ei=this.Ei.slice(0,i+1),this.Ee[i]=n,this.Ee=this.Ee.slice(0,i+1),this.Tn=this.Ei.length,this.bi=Math.max(this.bi,n),this.Oe=this.Tn,1===this.Oe&&(this.Dn=this.Ei[0])}}}Rd(t){if(3===this.wrap)return t.substring(0,1);let e=t.length,i=0;for(var s=z.OI;i<e&&!s.test(t.charAt(i));)i++;for(1===this.formatting&&(e=Math.min(e,i+1));i<e&&s.test(t.charAt(i));)i++;return i>=t.length?t:t.substring(0,i)}getStringWidth(t){return null===z.al?8*t.length:z.al.measureText(t).width}Op(){if(null!==this.uo)return this.uo;var t=this.Ln;let e=0;return null===z.al?e=16:void 0!==z.v2[t]&&z.XL<5e3?e=z.v2[t]:(e=1.3*z.al.measureText("M").width,z.v2[t]=e,z.XL++),this.uo=e}zL(t){if(null===z.al)return 6;let e=0;return void 0!==z.hb[t]&&z.U2<5e3?e=z.hb[t]:(e=z.al.measureText(z.Dp).width,z.hb[t]=e,z.U2++),e}cb(t,e){return t.indexOf(`
`,e)}OL(t){let e=this.di.replace(/\r\n/g,`
`).replace(/\r/g,`
`);var i,s,n=this.spacingAbove+this.spacingBelow,r=Math.max(0,this.Op()+n);if(0===e.length)return this.bi=0,this.Oe=1,r;this.isMultiline||0<=(n=this.cb(e,0))&&(e=e.substring(0,n));let a=0,o=this.Oe=0,h=-1,l=!1;for(;!l;)-1===(h=this.cb(e,o))&&(h=e.length,l=!0),o<=h&&(i=e.substring(o,h),0!==this.wrap?(this.Tn=0,s=qt.a(),this.G2(i,t,s),a+=s.height,qt.o(s),this.Oe+=this.Tn):(this.G2(i,t,null),a+=r,this.Oe++),this.Oe===this.maxLines)&&(l=!0),o=h+1;return this.C0=a}RI(){let r=this.di.replace(/\r\n/g,`
`).replace(/\r/g,`
`);if(0===r.length)return 8;var t;if(this.isMultiline){let i=0,s=0,n=!1;for(;!n;){let t=this.cb(r,s),e=(-1===t&&(t=r.length,n=!0),r.substring(s,t));0===this.formatting&&(e=e.trim()),i=Math.max(i,this.getStringWidth(e)),s=t+1}return i}return 0<=(t=this.cb(r,0))&&(r=r.substring(0,t)),this.getStringWidth(r)}get textValidation(){return null!==this._?this._.Vl:null}set textValidation(t){var e=this.textValidation;e!==t&&(null!==t&&Xt.t(t,"function",z,"textValidation"),this.Fn(),this._.Vl=t,this.i("textValidation",e,t))}get textEdited(){return null!==this._?this._.Bp:null}set textEdited(t){var e=this.textEdited;e!==t&&(null!==t&&Xt.t(t,"function",z,"textEdited"),this.Fn(),this._.Bp=t,this.i("textEdited",e,t))}get spacingAbove(){return null!==this._?this._.zp:0}set spacingAbove(t){var e=this.spacingAbove;e!==t&&(Yt,Xt.t(t,"number",z,"spacingAbove"),this.Fn(),this._.zp=t,this.u(),this.i("spacingAbove",e,t))}get spacingBelow(){return null!==this._?this._.Xp:0}set spacingBelow(t){var e=this.spacingBelow;e!==t&&(Yt,Xt.t(t,"number",z,"spacingBelow"),this.Fn(),this._.Xp=t,this.u(),this.i("spacingBelow",e,t))}get formatting(){return null!==this._?this._.Yp:0}set formatting(t){var e=this.formatting;e!==t&&(Xt.it(t,ke,"formatting"),this.Fn(),this._.Yp=t,this.u(),this.i("formatting",e,t))}get maxLines(){return null!==this._?this._.Kp:1/0}set maxLines(t){var e=this.maxLines;e!==t&&(Yt,Xt.t(t,"number",z,"maxLines"),(t=Math.floor(t))<=0&&Xt.G(t,"> 0",z,"maxLines"),this.Fn(),this._.Kp=t,this.u(),this.i("maxLines",e,t))}getMetrics(){return[this.bi,this.Bl,this.uo,this.Tn,this.Ee,this.Ei,this.Dn]}TI(t){void 0!==t&&(this.bi=t[0],this.Bl=t[1],this.uo=t[2],this.Tn=t[3],this.Ee=t[4],this.Ei=t[5],this.Dn=t[6])}get metrics(){return{arrSize:null!==this.Ee?this.Ee:[this.bi],arrText:null!==this.Ei?this.Ei:[this.Dn],maxLineWidth:this.bi,fontHeight:this.uo}}get choices(){return this.Fd}set choices(t){var e=this.Fd;e!==t&&(Yt,null===t||Array.isArray(t)||Xt.Bi(t,"Array",z,"choices:value"),this.Fd=t,this.i("choices",e,t))}static OI=new RegExp("[ ​­]");static v2=new h;static XL=0;static hb=new h;static U2=0;static Dp="...";static BL="";static al=K.isUsingDOM()?new $t(null).gi:null}class Me{xi;us;go;Yp;Kp;Ip;zp;Xp;Fp;Bp;Ep;Vl;cl;Rp;constructor(){this.xi=!1,this.us=null,this.go=0,this.Yp=0,this.Kp=1/0,this.Ip=0,this.zp=0,this.Xp=0,this.Fp="start",this.Bp=null,this.Ep=null,this.Vl=null,this.cl=J.Top,this.Rp=2}copy(){var t=new Me;return t.us=this.us,t.go=this.go,t.Yp=this.Yp,t.Kp=this.Kp,t.Ip=this.Ip,t.zp=this.zp,t.Xp=this.Xp,t.Fp=this.Fp,t.Bp=this.Bp,t.Ep=this.Ep,t.Vl=this.Vl,t.cl=this.cl,t.Rp=this.Rp,t}}class Ne{pc;yc;wc;Vp;xc;constructor(){this.pc=1,this.yc=0,this.wc=1,this.Vp=null,this.xc=null}copy(){var t=new Ne;return t.pc=this.pc,t.yc=this.yc,t.wc=this.wc,t.Vp=this.Vp,t.xc=this.xc,t}}(r={})[r.None=0]="None",r[r.Fill=2]="Fill",r[r.Uniform=6]="Uniform",r[r.UniformToFill=7]="UniformToFill";var Ce=r;class Le extends y{ul;St;dl;bc;us;gl;kc;go;Sc;Mc;q1;constructor(t,e){super(),this.l|=2097152,this.ul=null,this.St="",this.dl=Z.RD,this.bc=2,this.us=null,this.gl=null,this.kc=J.Center,this.go=0,this.Sc=null,this.Mc=null,this.q1=null,"string"==typeof t?this.source=t:t&&Object.assign(this,t),e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),t.St=this.St,t.element=this.ul,t.dl=this.dl.L(),t.bc=this.bc,t.go=this.go,t.us=this.us,t.gl=this.gl,t.kc=this.kc.L(),t.Mc=this.Mc}ci(t){t in Ce?this.imageStretch=t:super.ci(t)}toString(){return"Picture("+this.source+")#"+C.ps(this)}get Pc(){return 0!=(1048576&this.l)}set Pc(t){this.Pc!==t&&(this.l=1048576^this.l)}get Oa(){return 0!=(2097152&this.l)}set Oa(t){this.Oa!==t&&(this.l=2097152^this.l)}get Sn(){return 0!=(4194304&this.l)}set Sn(t){this.Sn!==t&&(this.l=4194304^this.l)}static clearCache(t){void 0===t&&(t=""),Xt.t(t,"string",Le,"clearCache:url"),""!==t?Le.Up[t]&&(delete Le.Up[t],Le.ub--):(Le.Up=new h,Le.ub=0)}static BA(e,i){i.YL||(i.db=t=>{Le.EI(i,t),e.desiredSize.isReal()||(e.ae(!1),e.u())},i.gb=t=>Le.VI(i,t),i.addEventListener("load",i.db),i.addEventListener("error",i.gb),i.YL=!0)}static MR(t){t.db&&t.removeEventListener("load",t.db),t.gb&&t.removeEventListener("error",t.gb),delete t.db,delete t.gb,delete t.YL}get element(){return this.ul}set element(t){var e,i,s=this.ul;this.fs(!0),s!==t&&(this.Pc=t instanceof HTMLCanvasElement,e=t instanceof HTMLImageElement,null===t||e||t instanceof HTMLVideoElement||this.Pc||Xt.n("Picture.element must be an instance of Image, Canvas, or Video, not: "+t),null!==(i=this.diagram)&&i.EP(this),null!==(this.ul=t)&&e&&void 0===t.as&&(t.as=new C),null!==i&&e&&i.OP(this),this.i("element",s,t),this.T())}kR(){var t=this.ul;null!==t&&(!this.Pc&&!0!==t.complete||(t.w0&&(t.Gp instanceof Event&&null!==this.us?this.us(this,t.Gp):!0===t.Sn&&!t.Gp&&null!==this.gl&&t.q2&&this.gl(this,t.q2)),t.Sn=!0,this.desiredSize.isReal())||(this.ae(!1),this.u()),!0===t.Sn)&&null!==this.diagram&&this.diagram.Wu.add(this)}BI(){if(null===this.ul)this.Sc=!1;else{var t=new $t(null).gi;try{t.drawImage(this.ul,0,0)}catch(t){Yt,this.Oa&&Xt.ft(t.toString()),this.Oa=!1}try{t.getImageData(0,0,1,1).data[3]&&(this.Sc=!1),this.Sc=!1}catch{this.Sc=!0}}}get source(){return this.St}set source(i){var s,t=this.St;if(t!==i){this.fs(!0),Xt.t(i,"string",Le,"source"),this.St=i;let e=Le.Up;if(K.isUsingDOM()){let t=null;void 0!==e[i]?t=e[i]:""!==i&&(30<Le.ub&&(Le.clearCache(),e=Le.Up),(t=Xt.hn("img")).w0=!0,Le.BA(this,t),null!==(s=this.Mc)&&(t.crossOrigin=s(this)),t.src=i,e[i]=t,Le.ub++),null!==(this.element=t)&&void 0===t.__goCache&&(t.__goCache=new De),this.u(),this.T()}this.i("source",t,i)}}static EI(e,i){e.Sn=!0,e.Gp=!1;var s,t=e.as.copy();if(null!=t){for(var n=t.iterator;n.next();){var r=n.value,a=(r.T(),e.getAttribute("src")||""),o=r.eh.getValue(a);if(null!==o){var h=o.length;for(let t=0;t<h;t++)s=o[t],r.Wu.add(s),s.fs(!0),r.requestUpdate(),e.w0&&(void 0===e.q2&&(e.q2=i),null!==s.gl)&&s.gl(s,i)}}e.as.clear()}}static VI(t,e){t.Gp=e;var i,s=t.as.copy();if(null!=s){for(var n=s.iterator;n.next();){var r=n.value,a=t.getAttribute("src")||"",o=r.eh.getValue(a);if(null!==o){var h=o.length,l=Xt.ct();for(let t=0;t<h;t++)l.push(o[t]);if(t.w0)for(let t=0;t<h;t++)null!==(i=l[t]).us&&i.us(i,e);Xt.ot(l)}}t.as.clear()}}reloadSource(){var t;""!==this.source&&(Le.clearCache(this.source),t=this.source,this.source="",this.source=t)}redraw(){this.T(),this.fs(!0)}get sourceCrossOrigin(){return this.Mc}set sourceCrossOrigin(t){var e;this.Mc!==t&&(null!==t&&Xt.t(t,"function",Le,"sourceCrossOrigin"),this.Mc=t,null!==this.element)&&(e=this.element.getAttribute("src"),null===t&&"string"==typeof e?this.element.crossOrigin=null:null!==t&&(this.element.crossOrigin=t(this)),this.element.src=e)}get sourceRect(){return this.dl}set sourceRect(t){var e=this.dl;e.equals(t)||(Xt.s(t,Z,Le,"sourceRect"),t=t.L(),this.dl=t,this.T(),this.i("sourceRect",e,t))}get imageStretch(){return this.bc}set imageStretch(t){var e=this.bc;e!==t&&(Xt.it(t,Ce,"ImageStretch"),this.bc=t,this.T(),this.i("imageStretch",e,t))}get flip(){return this.go}set flip(t){var e=this.go;e!==t&&(Xt.it(t,Qt,"Flip"),this.go=t,this.T(),this.i("flip",e,t))}get imageAlignment(){return this.kc}set imageAlignment(t){Xt.s(t,J,Le,"imageAlignment");var e=this.kc;e.equals(t)||(t=t.L(),this.kc=t,this.T(),this.i("imageAlignment",e,t))}get errorFunction(){return this.us}set errorFunction(t){var e=this.us;e!==t&&(null!==t&&Xt.t(t,"function",Le,"errorFunction"),this.us=t,this.i("errorFunction",e,t))}get successFunction(){return this.gl}set successFunction(t){var e=this.gl;e!==t&&(null!==t&&Xt.t(t,"function",Le,"successFunction"),this.gl=t,this.i("successFunction",e,t))}ph(t,h){var l=this.ul;if(null!==l){var u=l.getAttribute("src");if(!(l instanceof HTMLImageElement&&(null===u||""===u)||l.Gp instanceof Event&&t instanceof te)){var u=t instanceof _t,d=this.naturalBounds;let n=0,r=0;var c=this.Pc;let a=c?+l.width:l.naturalWidth,o=c?+l.height:l.naturalHeight;if(void 0===a&&l.videoWidth&&(a=l.videoWidth),void 0===o&&l.videoHeight&&(o=l.videoHeight),0!==a&&0!==o){var c=a,g=o;this.sourceRect.isReal()&&(n=this.dl.x,r=this.dl.y,a=this.dl.width,o=this.dl.height);let e=a,i=o;var m=this.bc,f=this.kc;switch(m){case 0:this.sourceRect.isReal()||(e>=d.width&&(n=n+f.offsetX+(e*f.x-d.width*f.x)),i>=d.height&&(r=r+f.offsetY+(i*f.y-d.height*f.y)),a=Math.min(d.width,e),o=Math.min(d.height,i));break;case 2:e=d.width,i=d.height;break;case 6:case 7:let t=0;6===m?(t=Math.min(d.height/i,d.width/e),e*=t,i*=t):7===m&&(t=Math.max(d.height/i,d.width/e),e*=t,i*=t,e>=d.width&&(n=(n+f.offsetX+(e*f.x-d.width*f.x)/e)*a),i>=d.height&&(r=(r+f.offsetY+(i*f.y-d.height*f.y)/i)*o),a*=1/(e/d.width),o*=1/(i/d.height),e=d.width,i=d.height)}var p=a*o,v=this.getDocumentScale()*h.scale,v=e*v*(i*v),y=p/v,p=l.__goCache;let s=null;var x=Le.zI;if(!u){if(l.Sn&&void 0!==p&&4<v&&x*x<y){null===p.Yt&&(p.KL(4,c,g,l),p.KL(16,c,g,l));var A=p.Yt,w=A.length;for(let t=0;t<w&&A[t].Id*A[t].Id<y;t++)s=A[t]}if(!h.qu&&(null===this.Sc&&this.BI(),this.Sc))return}u=e<d.width?f.offsetX+(d.width*f.x-e*f.x):0,v=i<d.height?f.offsetY+(d.height*f.y-i*f.y):0;switch(this.flip){case 0:break;case 2:t.translate(Math.min(d.width,e),0),t.scale(-1,1);break;case 1:t.translate(0,Math.min(d.height,i)),t.scale(1,-1);break;case 3:t.translate(Math.min(d.width,e),Math.min(d.height,i)),t.scale(-1,-1)}if(t.commitTransform(),h.getRenderingHint("pictureRatioOptimization")&&!h.sa&&void 0!==p&&null!==s&&1!==s.Id){t.save();x=s.Id;try{t.drawImage(s.St,n/x,r/x,Math.min(s.St.width,a/x),Math.min(s.St.height,o/x),u,v,Math.min(d.width,e),Math.min(d.height,i)),t instanceof _t&&(this.q1=[n/x,r/x,Math.min(s.St.width,a/x),Math.min(s.St.height,o/x),u,v,Math.min(d.width,e),Math.min(d.height,i)])}catch(t){Yt,this.Oa&&Xt.ft(t.toString()),this.Oa=!1}t.restore()}else try{t.drawImage(l,n,r,a,o,u,v,Math.min(d.width,e),Math.min(d.height,i)),t instanceof _t&&(this.q1=[n,r,a,o,u,v,Math.min(d.width,e),Math.min(d.height,i)])}catch(t){Yt,this.Oa&&Xt.ft(t.toString()),this.Oa=!1}switch(this.flip){case 0:break;case 2:t.scale(-1,1),t.translate(-Math.min(d.width,e),0);break;case 1:t.scale(1,-1),t.translate(0,-Math.min(d.height,i));break;case 3:t.scale(-1,-1),t.translate(-Math.min(d.width,e),-Math.min(d.height,i))}}}}}get naturalBounds(){return this.Hi}ld(t,e,i,s){var n=this.desiredSize,r=this.qs(!0),a=this.ul,o=this.Pc;let h=0,l=0;(o||!this.Sn&&a&&a.complete)&&(this.Sn=!0),null===a?(isFinite(n.width)||(t=i),isFinite(n.height)||(e=s)):(h=o?+a.width:a.naturalWidth,l=o?+a.height:a.naturalHeight),isFinite(n.width)||2===r||5===r?(isFinite(t)||(this.sourceRect.isReal()?t=this.sourceRect.width:null!==a&&(t=h)),i=0):null!==a&&!1!==this.Sn&&(t=this.sourceRect.isReal()?this.sourceRect.width:h),isFinite(n.height)||2===r||4===r?(isFinite(e)||(this.sourceRect.isReal()?e=this.sourceRect.height:null!==a&&(e=l)),s=0):null!==a&&!1!==this.Sn&&(e=this.sourceRect.isReal()?this.sourceRect.height:l),isFinite(n.width)&&(t=n.width),isFinite(n.height)&&(e=n.height);o=this.maxSize,r=this.minSize;i=Math.max(i||0,r.width),s=Math.max(s||0,r.height),t=Math.min(o.width,t),e=Math.min(o.height,e),t=Math.max(i,t),e=Math.max(s,e),null===a||a.complete||(isFinite(t)||(t=0),isFinite(e))||(e=0),this.Hi.Do(t,e),this.oo(0,0,t,e)}gh(t,e,i,s){this.commonArrange(t,e,i,s)}static Up=new h;static ub=0;static zI=4}class De{Yt;constructor(){this.Yt=null}KL(i,s,n,r){null===this.Yt&&(this.Yt=[]);var a=new $t(null),o=a.gi,h=1/i;if(a.width=s/i,a.height=n/i,0!==a.width&&0!==a.height){s=new Te(a.Bt,i);let t=r,e=1;0<this.Yt.length&&(n=this.Yt[this.Yt.length-1],t=n.St,e=n.Id),o.setTransform(h*e,0,0,h*e,0,0),o.commitTransform(),o.drawImage(t,0,0),this.Yt.push(s)}}}class Te{St;Id;constructor(t,e){this.St=t,this.Id=e}}class Be{Ai;em;constructor(){this.em=new W,this.Ai=null}ti(t){null!==t?(t.ut(),(this.em=t).figures.clear()):this.em=new W,this.Ai=null}yu(t,e,i,s,n,r){void 0!==s&&!0===s?((s=new b(1)).endX=t,s.endY=e,this.Ai.segments.add(s)):(this.Ai=new k,this.Ai.startX=t,this.Ai.startY=e,this.Ai.isFilled=i,this.Ai.isEvenOdd=r||!1,this.em.figures.add(this.Ai)),void 0!==n&&(this.Ai.isShadowed=n)}UD(){var t=this.Ai.segments.length;0<t&&this.Ai.segments.elt(t-1).close()}GD(){0<this.Ai.segments.length&&(this.Ai.isFilled=!0)}HD(t){this.Ai.isShadowed=t}gE(t){this.Ai.isEvenOdd=t}XD(t,e,i){void 0===i&&(i=!1);var s=new b(1);s.endX=t,s.endY=e,i&&s.close(),this.Ai.segments.add(s)}xr(t,e,i){void 0===i&&(i=!1);var s=new b(2);s.endX=t,s.endY=e,i&&s.close(),this.Ai.segments.add(s)}br(t,e,i,s,n,r,a){void 0===a&&(a=!1);var o=new b(3);o.point1X=t,o.point1Y=e,o.point2X=i,o.point2Y=s,o.endX=n,o.endY=r,a&&o.close(),this.Ai.segments.add(o)}Dw(t,e,i,s,n){void 0===n&&(n=!1);var r=new b(4);r.point1X=t,r.point1Y=e,r.endX=i,r.endY=s,n&&r.close(),this.Ai.segments.add(r)}YD(t,e,i,s,n,r,a){void 0===r&&(r=0),void 0===a&&(a=!1);var o=new b(5);o.startAngle=t,o.sweepAngle=e,o.centerX=i,o.centerY=s,o.radiusX=n,o.radiusY=0!==r?r:n,a&&o.close(),this.Ai.segments.add(o)}KD(t,e,i,s,n,r,a,o){void 0===o&&(o=!1);r=new b(6,r,a,t,e,i,s,n);o&&r.close(),this.Ai.segments.add(r)}static W2=null;static xC(t){var e=Be.W2;return(null!==e?(Be.W2=null,e):e=new Be).ti(t),e}static bC(t){Be.W2=t}}{function Ge(t,e){var i=t.toLowerCase(),s=I.qn;s[t]=e,s[i]=t}Ge("Rectangle",(t,e,i)=>{var s="r"+e+","+i;let n=I.yr[s];return void 0===n&&((n=new W(2)).endX=e,n.endY=i,I.wr<I.Qg)&&(I.yr[s]=n,I.wr++),n}),Ge("Square",(t,e,i)=>{var s="s"+e+","+i;let n=I.yr[s];return void 0===n&&((n=new W(2)).endX=e,n.endY=i,n.defaultStretch=6,I.wr<I.Qg)&&(I.yr[s]=n,I.wr++),n});const qi=(t,e,i,s,n)=>{var r="rr"+e+","+i+","+(s=isNaN(s)||s<0?5:s)+","+(n=isNaN(n)?15:n),a=I.yr[r];if(void 0===a){let t=s;t=1==(1&n)?(t=Math.min(t,2==(2&n)?e/3:e),Math.min(t,8==(8&n)?i/3:i)):0;var o,h,l=new k(t,0,!0),a=(new W).add(l),u=J.TopLeft.copy(),d=J.BottomRight.copy();2==(2&n)?(o=s,o=Math.min(o,1==(1&n)?e/3:e),h=(o=Math.min(o,4==(4&n)?i/3:i))*I.Gn,l.add(new b(2,e-o,0)).add(new b(3,e,o,e-h,0,e,h)),u.offsetY=h,d.offsetX=-h):l.add(new b(2,e,0)),4==(4&n)?(o=s,o=Math.min(o,8==(8&n)?e/3:e),h=(o=Math.min(o,2==(2&n)?i/3:i))*I.Gn,l.add(new b(2,e,i-o)).add(new b(3,e-o,i,e,i-h,e-h,i)),d.offsetX=-h,d.offsetY=-h):l.add(new b(2,e,i)),8==(8&n)?(o=s,o=Math.min(o,4==(4&n)?e/3:e),h=(o=Math.min(o,1==(1&n)?i/3:i))*I.Gn,l.add(new b(2,o,i)).add(new b(3,0,i-o,h,i,0,i-h)),u.offsetX=h,d.offsetY=-h):l.add(new b(2,0,i)),1==(1&n)?(s=t*I.Gn,l.add(new b(2,0,t)).add(new b(3,t,0,0,s,s,0).close()),u.offsetX=s,u.offsetY=s):l.add(new b(2,0,0).close()),a.spot1=u,a.spot2=d,I.wr<I.Qg&&(I.yr[r]=a,I.wr++)}return a},ji=(Ge("RoundedRectangle",(t,e,i)=>{var s=t?t.parameter1:NaN,t=t?t.parameter2:NaN;return qi(0,e,i,s,t)}),Ge("Border","RoundedRectangle"),Ge("RoundedTopRectangle",(t,e,i)=>{t=t?t.parameter1:NaN;return qi(0,e,i,t,3)}),Ge("RoundedBottomRectangle",(t,e,i)=>{t=t?t.parameter1:NaN;return qi(0,e,i,t,12)}),Ge("RoundedLeftRectangle",(t,e,i)=>{t=t?t.parameter1:NaN;return qi(0,e,i,t,9)}),Ge("RoundedRightRectangle",(t,e,i)=>{t=t?t.parameter1:NaN;return qi(0,e,i,t,6)}),Ge("Ellipse",(t,e,i)=>{var s="e"+e+","+i;let n=I.yr[s];return void 0===n&&((n=new W(3)).endX=e,n.endY=i,n.spot1=J.Kk,n.spot2=J.Uk,I.wr<I.Qg)&&(I.yr[s]=n,I.wr++),n}),Ge("Circle",(t,e,i)=>{var s="c"+e+","+i;let n=I.yr[s];return void 0===n&&((n=new W(3)).endX=e,n.endY=i,n.spot1=J.Kk,n.spot2=J.Uk,n.defaultStretch=6,I.wr<I.Qg)&&(I.yr[s]=n,I.wr++),n}),Ge("TriangleRight",(t,e,i)=>(new W).add(new k(0,0).add(new b(2,e,.5*i)).add(new b(2,0,i).close())).setSpots(0,.25,.5,.75)),Ge("TriangleDown",(t,e,i)=>(new W).add(new k(0,0).add(new b(2,e,0)).add(new b(2,.5*e,i).close())).setSpots(.25,0,.75,.5)),Ge("TriangleLeft",(t,e,i)=>(new W).add(new k(e,i).add(new b(2,0,.5*i)).add(new b(2,e,0).close())).setSpots(.5,.25,1,.75)),Ge("TriangleUp",(t,e,i)=>(new W).add(new k(e,i).add(new b(2,0,i)).add(new b(2,.5*e,0).close())).setSpots(.25,.5,.75,1)),Ge("Triangle","TriangleUp"),Ge("Diamond",(t,e,i)=>(new W).add(new k(.5*e,0).add(new b(2,0,.5*i)).add(new b(2,.5*e,i)).add(new b(2,e,.5*i).close())).setSpots(.25,.25,.75,.75)),Ge("LineH",(t,e,i)=>{var s=new W(1);return s.startX=0,s.startY=i/2,s.endX=e,s.endY=i/2,s}),Ge("LineV",(t,e,i)=>{var s=new W(1);return s.startX=e/2,s.startY=0,s.endX=e/2,s.endY=i,s}),Ge("None","Rectangle"),Ge("BarH","Rectangle"),Ge("BarV","Rectangle"),Ge("MinusLine","LineH"),Ge("PlusLine",(t,e,i)=>(new W).add(new k(0,i/2,!1).add(new b(2,e,i/2)).add(new b(1,e/2,0)).add(new b(2,e/2,i)))),Ge("XLine",(t,e,i)=>(new W).add(new k(0,i,!1).add(new b(2,e,0)).add(new b(1,0,0)).add(new b(2,e,i)))),Ge("LineRight",(t,e,i)=>(new W).add(new k(.25*e,0,!1).add(new b(2,.75*e,.5*i)).add(new b(2,.25*e,i)))),Ge("LineDown",(t,e,i)=>(new W).add(new k(0,.25*i,!1).add(new b(2,.5*e,.75*i)).add(new b(2,e,.25*i)))),Ge("LineLeft",(t,e,i)=>(new W).add(new k(.75*e,0,!1).add(new b(2,.25*e,.5*i)).add(new b(2,.75*e,i)))),Ge("LineUp",(t,e,i)=>(new W).add(new k(0,.75*i,!1).add(new b(2,.5*e,.25*i)).add(new b(2,e,.75*i)))),Ge("Capsule",(t,e,i)=>{var s,n=new W;return e<i?(s=new k(0,e/2,!0),n.add(s),s.add(new b(5,180,180,e/2,e/2,e/2,e/2)),s.add(new b(2,e,i-e/2)),s.add(new b(5,0,180,e/2,i-e/2,e/2,e/2)),s.add(new b(2,0,e/2)),n.spot1=new J(.156,0,0,.156*e),n.spot2=new J(.844,1,0,.156*-e)):i<e?(s=new k(i/2,0,!0),n.add(s),s.add(new b(2,e-i/2,0)),s.add(new b(5,270,180,e-i/2,i/2,i/2,i/2)),s.add(new b(2,i/2,i)),s.add(new b(5,90,180,i/2,i/2,i/2,i/2)),n.spot1=new J(0,.156,.156*i,0),n.spot2=new J(1,.844,.156*-i,0)):(n.type=3,n.endX=e,n.endY=i,n.spot1=J.Kk,n.spot2=J.Uk),n}),(t,e)=>new k(t,e,!1,!1)),Qi=(t,e,i)=>t.add(new b(2,e,i)),Ui=(t,e,i)=>t.add(new b(1,e,i));Ge("Borders",(t,e,i)=>{let s=t?t.parameter1:NaN;isNaN(s)?s=10:s&=15;t=new W;let n;return 10===s?(n=ji(e,0),Qi(n,e,i),Ui(n,0,i),Qi(n,0,0)):5===s?(n=ji(0,0),Qi(n,e,0),Ui(n,e,i),Qi(n,0,i)):1===s?(n=ji(0,0),Qi(n,e,0),Ui(n,e,i)):2===s?(n=ji(e,0),Qi(n,e,i)):4===s?(n=ji(e,i),Qi(n,0,i)):8===s?(n=ji(0,i),Qi(n,0,0),Ui(n,e,i)):3===s?(n=ji(0,0),Qi(n,e,0),Qi(n,e,i)):6===s?(n=ji(e,0),Qi(n,e,i),Qi(n,0,i)):12===s?(n=ji(e,i),Qi(n,0,i),Qi(n,0,0)):9===s?(n=ji(0,i),Qi(n,0,0),Qi(n,e,0)):7===s?(n=ji(0,0),Qi(n,e,0),Qi(n,e,i),Qi(n,0,i)):14===s?(n=ji(e,0),Qi(n,e,i),Qi(n,0,i),Qi(n,0,0)):13===s?(n=ji(e,i),Qi(n,0,i),Qi(n,0,0),Qi(n,e,0)):11===s?(n=ji(0,i),Qi(n,0,0),Qi(n,e,0),Qi(n,e,i)):15===s?(n=ji(0,0),Qi(n,e,0),Qi(n,e,i),Qi(n,0,i),n.add(new b(2,0,0).close())):(n=ji(0,0),Ui(n,e,i)),t.add(n),t})}I.$g={"":"",Standard:"F1 m 0,0 l 8,4 -8,4 2,-4 z",Backward:"F1 m 8,0 l -2,4 2,4 -8,-4 z",Triangle:"F1 m 0,0 l 8,4.62 -8,4.62 z",BackwardTriangle:"F1 m 8,4 l 0,4 -8,-4 8,-4 0,4 z",Boomerang:"F1 m 0,0 l 8,4 -8,4 4,-4 -4,-4 z",BackwardBoomerang:"F1 m 8,0 l -8,4 8,4 -4,-4 4,-4 z",SidewaysV:"m 0,0 l 8,4 -8,4 0,-1 6,-3 -6,-3 0,-1 z",BackwardV:"m 8,0 l -8,4 8,4 0,-1 -6,-3 6,-3 0,-1 z",OpenTriangle:"m 0,0 l 8,4 -8,4",BackwardOpenTriangle:"m 8,0 l -8,4 8,4",OpenTriangleLine:"m 0,0 l 8,4 -8,4 m 8.5,0 l 0,-8",BackwardOpenTriangleLine:"m 8,0 l  -8,4 8,4 m -8.5,0 l 0,-8",OpenTriangleTop:"m 0,0 l 8,4 m 0,4",BackwardOpenTriangleTop:"m 8,0 l -8,4 m 0,4",OpenTriangleBottom:"m 0,8 l 8,-4",BackwardOpenTriangleBottom:"m 0,4 l 8,4",HalfTriangleTop:"F1 m 0,0 l 0,4 8,0 z m 0,8",BackwardHalfTriangleTop:"F1 m 8,0 l 0,4 -8,0 z m 0,8",HalfTriangleBottom:"F1 m 0,4 l 0,4 8,-4 z",BackwardHalfTriangleBottom:"F1 m 8,4 l 0,4 -8,-4 z",ForwardSemiCircle:"m 4,0 b 270 180 0 4 4",BackwardSemiCircle:"m 4,8 b 90 180 0 -4 4",Feather:"m 0,0 l 3,4 -3,4",BackwardFeather:"m 3,0 l -3,4 3,4",DoubleFeathers:"m 0,0 l 3,4 -3,4 m 3,-8 l 3,4 -3,4",BackwardDoubleFeathers:"m 3,0 l -3,4 3,4 m 3,-8 l -3,4 3,4",TripleFeathers:"m 0,0 l 3,4 -3,4 m 3,-8 l 3,4 -3,4 m 3,-8 l 3,4 -3,4",BackwardTripleFeathers:"m 3,0 l -3,4 3,4 m 3,-8 l -3,4 3,4 m 3,-8 l -3,4 3,4",ForwardSlash:"m 0,8 l 5,-8",BackSlash:"m 0,0 l 5,8",DoubleForwardSlash:"m 0,8 l 4,-8 m -2,8 l 4,-8",DoubleBackSlash:"m 0,0 l 4,8 m -2,-8 l 4,8",TripleForwardSlash:"m 0,8 l 4,-8 m -2,8 l 4,-8 m -2,8 l 4,-8",TripleBackSlash:"m 0,0 l 4,8 m -2,-8 l 4,8 m -2,-8 l 4,8",Fork:"m 0,4 l 8,0 m -8,0 l 8,-4 m -8,4 l 8,4",BackwardFork:"m 8,4 l -8,0 m 8,0 l -8,-4 m 8,4 l -8,4",LineFork:"m 0,0 l 0,8 m 0,-4 l 8,0 m -8,0 l 8,-4 m -8,4 l 8,4",BackwardLineFork:"m 8,4 l -8,0 m 8,0 l -8,-4 m 8,4 l -8,4 m 8,-8 l 0,8",CircleFork:"F1 m 6,4 b 0 360 -3 0 3 z m 0,0 l 6,0 m -6,0 l 6,-4 m -6,4 l 6,4",BackwardCircleFork:"F1 m 0,4 l 6,0 m -6,-4 l 6,4 m -6,4 l 6,-4 m 6,0 b 0 360 -3 0 3",CircleLineFork:"F1 m 6,4 b 0 360 -3 0 3 z m 1,-4 l 0,8 m 0,-4 l 6,0 m -6,0 l 6,-4 m -6,4 l 6,4",BackwardCircleLineFork:"F1 m 0,4 l 6,0 m -6,-4 l 6,4 m -6,4 l 6,-4 m 0,-4 l 0,8 m 7,-4 b 0 360 -3 0 3",Circle:"F1 m 8,4 b 0 360 -4 0 4 z",Block:"F1 m 0,0 l 0,8 8,0 0,-8 z",StretchedDiamond:"F1 m 0,3 l 5,-3 5,3 -5,3 -5,-3 z",Diamond:"F1 m 0,4 l 4,-4 4,4 -4,4 -4,-4 z",Chevron:"F1 m 0,0 l 5,0 3,4 -3,4 -5,0 3,-4 -3,-4 z",StretchedChevron:"F1 m 0,0 l 8,0 3,4 -3,4 -8,0 3,-4 -3,-4 z",NormalArrow:"F1 m 0,2 l 4,0 0,-2 4,4 -4,4 0,-2 -4,0 z",X:"m 0,0 l 8,8 m 0,-8 l -8,8",TailedNormalArrow:"F1 m 0,0 l 2,0 1,2 3,0 0,-2 2,4 -2,4 0,-2 -3,0 -1,2 -2,0 1,-4 -1,-4 z",DoubleTriangle:"F1 m 0,0 l 4,4 -4,4 0,-8 z  m 4,0 l 4,4 -4,4 0,-8 z",BigEndArrow:"F1 m 0,0 l 5,2 0,-2 3,4 -3,4 0,-2 -5,2 0,-8 z",ConcaveTailArrow:"F1 m 0,2 h 4 v -2 l 4,4 -4,4 v -2 h -4 l 2,-2 -2,-2 z",RoundedTriangle:"F1 m 0,1 a 1,1 0 0 1 1,-1 l 7,3 a 0.5,1 0 0 1 0,2 l -7,3 a 1,1 0 0 1 -1,-1 l 0,-6 z",SimpleArrow:"F1 m 1,2 l -1,-2 2,0 1,2 -1,2 -2,0 1,-2 5,0 0,-2 2,2 -2,2 0,-2 z",AccelerationArrow:"F1 m 0,0 l 0,8 0.2,0 0,-8 -0.2,0 z m 2,0 l 0,8 1,0 0,-8 -1,0 z m 3,0 l 2,0 2,4 -2,4 -2,0 0,-8 z",BoxArrow:"F1 m 0,0 l 4,0 0,2 2,0 0,-2 2,4 -2,4 0,-2 -2,0 0,2 -4,0 0,-8 z",TriangleLine:"F1 m 8,4 l -8,-4 0,8 8,-4 z m 0.5,4 l 0,-8",CircleEndedArrow:"F1 m 10,4 l -2,-3 0,2 -2,0 0,2 2,0 0,2 2,-3 z m -4,0 b 0 360 -3 0 3 z",DynamicWidthArrow:"F1 m 0,3 l 2,0 2,-1 2,-2 2,4 -2,4 -2,-2 -2,-1 -2,0 0,-2 z",EquilibriumArrow:"m 0,3 l 8,0 -3,-3 m 3,5 l -8,0 3,3",FastForward:"F1 m 0,0 l 3.5,4 0,-4 3.5,4 0,-4 1,0 0,8 -1,0 0,-4 -3.5,4 0,-4 -3.5,4 0,-8 z",Kite:"F1 m 0,4 l 2,-4 6,4 -6,4 -2,-4 z",HalfArrowTop:"F1 m 0,0 l 4,4 4,0 -8,-4 z m 0,8",HalfArrowBottom:"F1 m 0,8 l 4,-4 4,0 -8,4 z",OpposingDirectionDoubleArrow:"F1 m 0,4 l 2,-4 0,2 4,0 0,-2 2,4 -2,4 0,-2 -4,0 0,2 -2,-4 z",PartialDoubleTriangle:"F1 m 0,0 4,3 0,-3 4,4 -4,4 0,-3 -4,3 0,-8 z",LineCircle:"F1 m 0,0 l 0,8 m 7 -4 b 0 360 -3 0 3 z",DoubleLineCircle:"F1 m 0,0 l 0,8 m 2,-8 l 0,8 m 7 -4 b 0 360 -3 0 3 z",TripleLineCircle:"F1 m 0,0 l 0,8 m 2,-8 l 0,8 m 2,-8 l 0,8 m 7 -4 b 0 360 -3 0 3 z",CircleLine:"F1 m 6 4 b 0 360 -3 0 3 z m 1,-4 l 0,8",DiamondCircle:"F1 m 8,4 l -4,4 -4,-4 4,-4 4,4 m 8,0 b 0 360 -4 0 4 z",PlusCircle:"F1 m 8,4 b 0 360 -4 0 4 l -8 0 z m -4 -4 l 0 8",OpenRightTriangleTop:"m 8,0 l 0,4 -8,0 m 0,4",OpenRightTriangleBottom:"m 8,8 l 0,-4 -8,0",Line:"m 0,0 l 0,8",DoubleLine:"m 0,0 l 0,8 m 2,0 l 0,-8",TripleLine:"m 0,0 l 0,8 m 2,0 l 0,-8 m 2,0 l 0,8",PentagonArrow:"F1 m 8,4 l -4,-4 -4,0 0,8 4,0 4,-4 z"};(r={})[r.None=0]="None",r[r.Added=1]="Added",r[r.Removed=2]="Removed",r[r.Shown=4]="Shown",r[r.Hidden=8]="Hidden",r[r.NodeSized=16]="NodeSized",r[r.GroupLayout=32]="GroupLayout",r[r.NodeReplaced=64]="NodeReplaced",r[r.Standard=127]="Standard",r[r.All=16777215]="All";class Y extends jt{N;_o;E;ml;pl;tr;di;ir;kh;$s;er;Od;vM;UL;Hp;vp;constructor(t,e){void 0===t||t instanceof se||"number"==typeof t||"string"==typeof t?super(t):(super(),t&&(e=t)),this.N=2408959,this._o="",this.E=null,this.ml="",this.pl=null,this.tr=null,this.di="",this.ir=null,this.kh=null,this.$s=new U(NaN,NaN).w(),this.er=null,this.Od=NaN,this.vM=-1,this.UL=new Z,this.Hp=null,this.vp=NaN,e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),t.N=-4097&this.N|49152,t._o=this._o,null!==this.E&&(this.E.xi?t.E=this.E:t.E=this.E.copy()),t.ml=this.ml,t.tr=null,t.di=this.di,t.$s.c(this.$s),t.Od=this.Od}qo(t){super.qo(t),t.mh(),t.pl=null,t.er=null,t.Hp=null}toString(){let t=Xt.an(this.constructor)+"#"+C.ps(this);return null!==this.data&&(t+="("+Xt.toString(this.data)+")"),t}static LayoutNone=0;static LayoutAdded=1;static LayoutRemoved=2;static LayoutShown=4;static LayoutHidden=8;static LayoutNodeSized=16;static LayoutGroupLayout=32;static LayoutNodeReplaced=64;static LayoutStandard=127;static LayoutAll=16777215;Qi(){null===this.E?this.E=new Fe:this.E.xi&&(this.E=this.E.copy())}uh(){super.uh(),null!==this.E&&(this.E.xi=!0)}tc(t,e,i,s,n,r,a){const o=this.diagram;null!==o&&(3===t&&"elements"===e?n instanceof jt?n.il(t=>{o.partManager.LP(t,o)}):n instanceof Le&&o.OP(n):4===t&&"elements"===e&&(n instanceof jt?n.il(t=>o.partManager.TP(t,o)):n instanceof Le&&o.EP(n)),o.raiseChangedEvent(t,e,i,s,n,r,a))}updateTargetBindings(t){if(super.updateTargetBindings(t),null!==this.data){var e=this.F.h,i=e.length;for(let t=0;t<i;t++){var s=e[t];s instanceof jt&&s.il(t=>{null!==t.data&&t.updateTargetBindings()})}for(var n=this.adornments;n.next();)n.value.updateTargetBindings(t)}}Uo(){if(super.Uo(),this.S2()){var e=this.F.h,i=e.length;for(let t=0;t<i;t++){var s=e[t];s instanceof jt&&s.il(t=>t.Uo())}}for(var t=this.adornments;t.next();)t.value.Uo()}updateRelationshipsFromData(){null!==this.data&&this.diagram?.partManager.updateRelationshipsFromData(this)}get key(){var t=this.diagram;if(null!==t)return t.model.getKeyForNodeData(this.data)}get adornments(){return null===this.tr?o.instance:this.tr.iteratorValues}findAdornment(t){Yt,Xt.t(t,"string",Y,"findAdornment:category");var e=this.tr;return null===e?null:e.getValue(t)}addAdornment(i,s){if(null!==s){Yt,Xt.t(i,"string",Y,"addAdornment:category"),Xt.s(s,X,Y,"addAdornment:ad");let t=null,e=this.tr;var n;(t=null!==e?e.getValue(i):t)!==s&&(null!==t&&null!==(n=t.diagram)&&n.remove(t),null===e&&(e=new L,this.tr=e),s._o!==i&&(s.category=i),e.add(i,s),null!==(n=this.diagram))&&(n.add(s),null!==(i=s.adornedObject))&&null!==(n=i.findBindingPanel())&&(s.data=n.data)}}removeAdornment(t){Yt,Xt.t(t,"string",Y,"removeAdornment:category");var e,i,s=this.tr;null!==s&&(null!==(e=s.getValue(t))&&null!==(i=e.diagram)&&(i.remove(e),e.data=null),s.remove(t),0===s.count)&&(this.tr=null)}clearAdornments(){var t=this.tr;if(null!==t){for(var e=Xt.ct(),i=t.iterator;i.next();){var s=i.key;e.push(s)}var n=e.length;for(let t=0;t<n;t++)this.removeAdornment(e[t]);Xt.ot(e)}}updateAdornments(){var e=this.diagram;if(null!==e){this.XI(e),this.YI(e);let t=this.adornments;for(;t.next();){var i=t.value;i.u(),i.hasPlaceholder()&&i.placeholder.u()}for(t=this.adornments;t.next();)t.value.updateTargetBindings()}}invalidateAdornments(){var t=this.diagram;null!==t&&(t.oh(),!0!==this.GL())&&this.HL(!0)}qM(){!1!==this.GL()&&(this.updateAdornments(),this.HL(!1))}XI(i){var t="Selection";if(this.isSelected&&this.selectionAdorned){var s=this.selectionObject;if(null!==s&&this.actualBounds.isReal()&&this.isVisible()&&s.isVisibleObject()&&s.actualBounds.isReal()){let e=this.findAdornment(t);if(null===e){let t=this.selectionAdornmentTemplate;if(!((t=null===t?this.Il()?i.linkSelectionAdornmentTemplate:this instanceof j?i.groupSelectionAdornmentTemplate:i.nodeSelectionAdornmentTemplate:t)instanceof X))return;t.ui(),null!==(e=t.copy())&&(this.Il()&&this.selectionObject===this.path&&(e.type=jt.Link),e.adornedObject=s)}if(null!==e)return e.type===jt.Link&&e.u(),void this.addAdornment(t,e)}}this.removeAdornment(t)}YI(t){const e=this;t.toolManager.mouseDownTools.each(t=>{t.isEnabled&&t.updateAdornments(e)}),t.toolManager.updateAdornments(e)}GM(t){null===(this.ir=t)&&this.VR()}get layer(){return this.ir}get diagram(){var t=this.ir;return null==t?null:t.diagram}get layerName(){return this.ml}set layerName(e){var i,s,n=this.ml;if(n!==e){Xt.t(e,"string",Y,"layerName");let t=this.diagram;null!==t&&(null===t.findLayer(e)||t.partManager.addsToTemporaryLayer)||(this.ml=e,null!==t&&t.invalidateDocumentBounds(),this.i("layerName",n,e),null===(n=this.layer))||n.name===e||null===(t=n.diagram)||null===(e=t.findLayer(e))||e===n||(0<=(i=n.re(-1,this,!0))&&t.raiseChangedEvent(4,"parts",n,this,null,i,!0),i=e.Qh(99999999,this,!0),n.visible!==e.visible&&this.Ki(e.visible),0<=i&&t.raiseChangedEvent(3,"parts",e,null,this,!0,i),null===(i=this.layerChanged))||(s=t.W,t.W=!0,i(this,n,e),t.W=s)}}get layerChanged(){return null!==this.E?this.E.qp:null}set layerChanged(t){var e=this.layerChanged;e!==t&&(null!==t&&Xt.t(t,"function",Y,"layerChanged"),this.Qi(),this.E.qp=t,this.i("layerChanged",e,t))}get zOrder(){return this.Od}set zOrder(t){var e,i=this.Od;i!==t&&(Xt.t(t,"number",Y,"zOrder"),this.Od=t,null!==(e=this.layer)&&e.Nx(-1,this),this.i("zOrder",i,t),null!==(e=this.diagram))&&e.T()}KI(){var t=this.layer;null!==t&&t.Nx(-1,this)}mb(){var t;!1===this.rh()&&(this.j2(!0),this.hd(),null!==(t=this.diagram))&&(t.d0(this),t.requestUpdate())}vL(){var t,e,i;this.N|=2097152,!1!==this.rh()&&(t=this.position,(e=this.location).isReal()&&t.isReal()||this.qL(t,e),e=this.Ri,i=Z.a().c(e),e.ut(),e.x=t.x,e.y=t.y,e.w(),this.ad(i,e),Z.o(i),this.j2(!1))}oo(t,e,i,s){var n=this.ce,r=(n.e(t,e,i,s),null===this.Ni&&(this.Ni=new H),this.Ni);r.ti(),this.P0(r,t,e,i,s),(this.Ni=r).Gk()||r.Nw(n)}P0(t,i,s,n,r){if(1!==this.v&&t.v(this.v),0!==this.qt){let e=J.Center;this.locationSpot.isSpot()&&(e=this.locationSpot);var a=U.a();if(this.locationObject!==this){var o=this.locationObject,h=o.naturalBounds;a.setSpot(h.x,h.y,h.width,h.height,e),null!==o.Ni&&o.Ni.Pt(a),a.offset(-o.measuredBounds.x,-o.measuredBounds.y);let t=o.panel;for(;null!==t&&t!==this;)null!==t.Ni&&t.Ni.Pt(a),a.offset(-t.measuredBounds.x,-t.measuredBounds.y),t=t.panel}else a.setSpot(i,s,n,r,e);t.ys(this.qt,a.x,a.y),U.o(a)}}get locationObject(){var t;return null===this.er&&(this instanceof X&&this.type!==jt.Link&&this.hasPlaceholder()?this.er=this.placeholder:""!==(t=this.locationObjectName)?(t=this.findObject(t),this.er=null!==t?t:this):this.er=this),this.er.visible?this.er:this}get minLocation(){return null!==this.E?this.E.Wp:U.iC}set minLocation(t){var e=this.minLocation;e.equals(t)||(Yt,Xt.s(t,U,Y,"minLocation"),t=t.L(),this.Qi(),this.E.Wp=t,this.i("minLocation",e,t))}get maxLocation(){return null!==this.E?this.E.jp:U.eC}set maxLocation(t){var e=this.maxLocation;e.equals(t)||(Yt,Xt.s(t,U,Y,"maxLocation"),t=t.L(),this.Qi(),this.E.jp=t,this.i("maxLocation",e,t))}get locationObjectName(){return null!==this.E?this.E.Jp:""}set locationObjectName(t){var e=this.locationObjectName;e!==t&&(Yt,Xt.t(t,"string",Y,"locationObjectName"),this.Qi(),this.E.Jp=t,this.er=null,this.u(),this.i("locationObjectName",e,t))}get locationSpot(){return null!==this.E?this.E.Zp:J.TopLeft}set locationSpot(t){var e=this.locationSpot;e.equals(t)||(Yt,Xt.s(t,J,Y,"locationSpot"),t.isSpot()||Xt.n("Part.locationSpot must be a specific Spot value, not: "+t),t=t.L(),this.Qi(),this.E.Zp=t,this.u(),this.i("locationSpot",e,t))}move(t,e){!0===e?this.location=t:this.position=t}moveTo(t,e,i){t=U.H(t,e);this.move(t,i),U.o(t)}isVisible(){if(!this.visible)return!1;var t=this.layer;if(null!==t){if(!t.visible)return!1;t=t.diagram;if(null!==t&&t.animationManager.ux(this))return!0}t=this.containingGroup;return!!(null===t||t.isSubGraphExpanded&&t.isVisible())}Ki(t){var e=this.diagram;t?(this.invalidateLayout(4),this.invalidateAdornments(),null!==e&&e.d0(this)):(this.invalidateLayout(8),this.clearAdornments()),this.mh(),null!==e&&(e.invalidateDocumentBounds(),e.T())}findObject(t){if(this.name===t)return this;let e=this.Hp;var i;return null===e&&(this.Hp=e=new L),null!==e.getValue(t)?e.getValue(t):null!==(i=super.findObject(t))?(e.set(t,i),i):(e.set(t,null),null)}V0(){this.Hp=null}getRelativePoint(e,t,i){void 0===i&&(i=new U);var t=t.isNoSpot()?J.Center:t,s=e.naturalBounds;if(i.e(s.width*t.x+t.offsetX,s.height*t.y+t.offsetY),null!==e&&e!==this){e.D.Pt(i);let t=e.panel;for(;null!==t&&t!==this;)t.D.Pt(i),t=t.panel;null!==this.Ni&&this.Ni.Pt(i),i.offset(-this.ce.x,-this.ce.y)}return i}getDocumentBounds(t){return(t=void 0===t?new Z:t).c(this.actualBounds)}ensureBounds(){this.wt(1/0,1/0),this.vt()}xL(e){var t=this.locationSpot,i=this.locationObject,s=i.naturalBounds,n=i instanceof V?i.strokeWidth:0;if(e.setSpot(0,0,s.width+n,s.height+n,t),i!==this){e.offset(-n/2,-n/2),i.D.Pt(e);let t=i.panel;for(;null!==t&&t!==this;)t.D.Pt(e),t=t.panel}return null!==this.Ni&&this.Ni.Pt(e),e.offset(-this.ce.x,-this.ce.y),e}$h(n,r){var r=void 0===r?this.UL:r,t=this.UI(),e=2*t;if(this.isShadowed){let t=n.x,e=n.y,i=n.width,s=n.height;var a=this.shadowBlur,o=this.shadowOffset;i+=a,s+=a,t-=a/2,e-=a/2,0<o.x?i+=o.x:(t+=o.x,i-=o.x),0<o.y?s+=o.y:(e+=o.y,s-=o.y),r.e(t-1,e-1,i+2,s+2)}else r.e(n.x-1-t,n.y-1-t,n.width+2+e,n.height+2+e);return r}MI(){return this.type===jt.Link&&this instanceof X&&"Selection"===this.category&&this.adornedObject instanceof V&&this.adornedPart.findMainElement()===this.adornedObject?this.adornedObject.strokeWidth:0}UI(){return isNaN(this.vp)&&(this.vp=this.CL()),this.vp}gc(){this.vp=NaN}vt(){var t,e,i,s;!1===this.hs()?this.vL():(this.ro(!1),t=this.Ri,(e=Z.a()).c(t),i=this.Rl(),this.gh(0,0,this.ce.width,this.ce.height),s=this.position,this.qL(s,this.location),t.ut(),t.x=s.x,t.y=s.y,t.w(),this.ad(e,t),e.equals(t)?this.Gs(i):this.De()&&(!I.p(e.width,t.width)||!I.p(e.height,t.height))&&0<=this.vM&&this.invalidateLayout(16),Z.o(e),this.j2(!1))}ad(e,i){var s,n=this.diagram;if(null!==n){let t=!1;!1===n.ea&&e.isReal()&&((s=Z.a()).c(n.documentBounds),s.subtractMargin(n.padding),e.x>s.x&&e.y>s.y&&e.right<s.right&&e.bottom<s.bottom&&i.x>s.x&&i.y>s.y&&i.right<s.right&&i.bottom<s.bottom&&(t=!0),Z.o(s)),!0!==this.GI()&&e.equals(i)||this.AA(t,n),n.T(),!e.isReal()&&!i.isReal()||e.equalsApproxClose(i)||(this instanceof D&&!n.undoManager.isUndoingRedoing&&this.invalidateConnectedLinks(),this.mh())}}get location(){return this.$s}set location(t){Yt,Xt.s(t,U,Y,"location");var e=t.x,i=t.y,s=this.$s;(s.x===e||isNaN(s.x)&&isNaN(e))&&(s.y===i||isNaN(s.y)&&isNaN(i))||(t=t.copy(),!this.HI(t,s))||this.i("location",s,t.copy())}HI(t,e){var i,s,n;return!this.Il()&&(this.$s=t,this.N|=2097152,!1===this.hs()&&(this.mb(),!(i=this.lt).isReal()||null!==(s=this.diagram)&&!s.animationManager.isTicking&&s.undoManager.isUndoingRedoing||(n=i.copy(),i.e(i.x+(t.x-e.x),i.y+(t.y-e.y)),this.WL(s,i,n.x,n.y),this.i("position",n,i.copy()))),!0)}w2(t,e,i){var s;return!(this.Il()||!t.isReal()||(null!==(s=this.diagram)&&this.WL(s,t,e,i),this.lt=t,this.N&=-2097153,!this.$s.isReal()||null!==s&&!s.animationManager.isTicking&&s.undoManager.isUndoingRedoing||(s=this.$s,this.$s=new U(s.x+(t.x-e),s.y+(t.y-i)),this.i("location",s,this.$s.copy())),!1===this.rh()&&!1===this.hs()&&(this.mb(),this.vL()),0))}WL(t,e,i,s){null===t||this instanceof X||(t=t.animationManager).Mi&&t.$C(this,new U(i,s),e,!1)}Nf(t,e,i){var s=this.$s,n=this.lt;if(i){if(s.x===t&&s.y===e)return;this.rh()||this.hs()?n.e(NaN,NaN):n.e(n.x+t-s.x,n.y+e-s.y),s.e(t,e)}else{if(n.x===t&&n.y===e)return;s.e(s.x+t-n.x,s.y+e-n.y),n.e(t,e)}this.mb()}b2(){this.N&=-2097153,this.mb()}qL(t,e){var i=this.xL(U.a()),s=this.diagram,n=e.isReal(),r=t.isReal();n&&r?2097152&this.N?this.jL(t,e,s,i):this.JL(t,e,s,i):n?this.jL(t,e,s,i):r&&this.JL(t,e,s,i),this.N|=2097152,U.o(i),this.hd()}jL(t,e,i,s){var n=t.x,r=t.y;t.e(e.x-s.x,e.y-s.y),null!==i&&((s=(e=i.animationManager).defaultAnimation.isAnimating)||!e.Mi||this instanceof X||e.$C(this,new U(n,r),t,!1),s||t.x===n&&t.y===r||this.i("position",new U(n,r),t.copy()))}JL(t,e,i,s){var n=e.copy();e.e(t.x+s.x,t.y+s.y),e.equals(n)||null===i||this.i("location",n,e.copy())}AA(t,e){this.c2(!1),this instanceof D&&e.KP(this),this.layer.isTemporary||t||e.invalidateDocumentBounds();var t=this.Ri,i=e.viewportBounds;i.isReal()?this.Rl()?(t.intersectsRectPlus(i,10)||this.Gs(!1),this.updateAdornments()):this.isVisible()&&t.intersectsRect(i)?(this.Gs(!0),this.updateAdornments()):this.invalidateAdornments():e.Kf=!0}tl(){return!0}De(){return!0}Il(){return!1}Ws(){return!0}hasPlaceholder(){return!1}get category(){return this._o}set category(e){var i=this._o;if(i!==e){null!==this.svg&&(this.svg.remove(),this.fs(!0)),Xt.t(e,"string",Y,"category");var s,n,r=this.diagram,a=this.data;let t=null;null===r||null===a||this instanceof X||(s=r.model.undoManager).isEnabled&&!s.isUndoingRedoing&&(t=this.clone()).F.addAll(this.F),this._o=e,this.i("category",i,e),null===r||null===a||this instanceof X?this instanceof X&&null!==(s=this.adornedPart)&&(null!==(n=s.tr)&&n.remove(i),s.addAdornment(this.category,this)):(n=r.model).undoManager.isUndoingRedoing||(this.Il()?(r.partManager.setLinkCategoryForData(a,e),null!==(s=r.partManager.findLinkTemplateForCategory(e))&&(s.ui(),null!==(s=s.copy()))&&this.J2(s,i,e)):(null!==n&&n.setCategoryForNodeData(a,e),null!==(s=r.partManager.findTemplateForNodeData(a,e))&&(s.ui(),null===(n=s.copy())||n instanceof q||(r=this.location.copy(),this.J2(n,i,e),this.location.isReal())||(this.location=r))),null!==t&&((a=this.clone()).F.addAll(this.F),this.i("self",t,a)))}}get self(){return this}set self(t){this.J2(t,this.category,t.category)}static ZL=!1;J2(t,e,i){t.constructor===this.constructor||Y.ZL||(Y.ZL=!0,Xt.ft('Should not change the class of the Part when changing category from "'+e+'" to "'+i+'"'),Xt.ft("  Old class: "+Xt.an(this.constructor)+", new class: "+Xt.an(t.constructor)+", part: "+this.toString())),this.clearAdornments();var e=this.data,s=this.layerName,n=this.isSelected,r=this.isHighlighted;let a=!0,o=!0,h=!1;this instanceof D&&(a=this.isTreeLeaf,o=this.isTreeExpanded,h=this.wasTreeExpanded),t.qo(this),t.cloneProtected(this),this._o=i,null!==this.svg&&(this.svg.remove(),this.svg=null,this.fs(!0)),this.u(),this.T();t=this.diagram;let l=!0;null!==t&&(l=t.skipsUndoManager,t.skipsUndoManager=!0),this.si=e,this.N=n?4096|this.N:-4097&this.N,this.N=r?524288|this.N:-524289&this.N,this instanceof D&&(this.z=a?4|this.z:-5&this.z,this.z=o?1|this.z:-2&this.z,this.z=h?2|this.z:-3&this.z),null!==e&&this.updateTargetBindings();i=this.layerName;i!==s&&(this.ml=s,this.layerName=i),null!==t&&(t.skipsUndoManager=l),this.De()&&this.invalidateLayout(64)}canCopy(){var t;return!(!this.copyable||null!==(t=this.layer)&&(!t.allowCopy||null!==(t=t.diagram)&&!t.allowCopy))}canDelete(){var t;return!(!this.deletable||null!==(t=this.layer)&&(!t.allowDelete||null!==(t=t.diagram)&&!t.allowDelete))}canEdit(){var t;return!(!this.textEditable||null!==(t=this.layer)&&(!t.allowTextEdit||null!==(t=t.diagram)&&!t.allowTextEdit))}canGroup(){var t;return!(!this.groupable||null!==(t=this.layer)&&(!t.allowGroup||null!==(t=t.diagram)&&!t.allowGroup))}canMove(){var t;return!(!this.movable||null!==(t=this.layer)&&(!t.allowMove||null!==(t=t.diagram)&&!t.allowMove))}canReshape(){var t;return!(!this.reshapable||null!==(t=this.layer)&&(!t.allowReshape||null!==(t=t.diagram)&&!t.allowReshape))}canResize(){var t;return!(!this.resizable||null!==(t=this.layer)&&(!t.allowResize||null!==(t=t.diagram)&&!t.allowResize))}canRotate(){var t;return!(!this.rotatable||null!==(t=this.layer)&&(!t.allowRotate||null!==(t=t.diagram)&&!t.allowRotate))}canSelect(){var t;return!(!this.selectable||null!==(t=this.layer)&&(!t.allowSelect||null!==(t=t.diagram)&&!t.allowSelect))}get copyable(){return 0!=(1&this.N)}set copyable(t){var e=0!=(1&this.N);e!==t&&(Yt,Xt.t(t,"boolean",Y,"copyable"),this.N=1^this.N,this.i("copyable",e,t))}get deletable(){return 0!=(2&this.N)}set deletable(t){var e=0!=(2&this.N);e!==t&&(Yt,Xt.t(t,"boolean",Y,"deletable"),this.N=2^this.N,this.i("deletable",e,t))}get textEditable(){return 0!=(4&this.N)}set textEditable(t){var e=0!=(4&this.N);e!==t&&(Yt,Xt.t(t,"boolean",Y,"textEditable"),this.N=4^this.N,this.i("textEditable",e,t),this.invalidateAdornments())}get groupable(){return 0!=(8&this.N)}set groupable(t){var e=0!=(8&this.N);e!==t&&(Yt,Xt.t(t,"boolean",Y,"groupable"),this.N=8^this.N,this.i("groupable",e,t))}get movable(){return 0!=(16&this.N)}set movable(t){var e=0!=(16&this.N);e!==t&&(Yt,Xt.t(t,"boolean",Y,"movable"),this.N=16^this.N,this.i("movable",e,t))}get selectionAdorned(){return 0!=(32&this.N)}set selectionAdorned(t){var e=0!=(32&this.N);e!==t&&(Yt,Xt.t(t,"boolean",Y,"selectionAdorned"),this.N=32^this.N,this.i("selectionAdorned",e,t),this.invalidateAdornments())}get isInDocumentBounds(){return 0!=(64&this.N)}set isInDocumentBounds(t){var e,i=0!=(64&this.N);i!==t&&(Yt,Xt.t(t,"boolean",Y,"isInDocumentBounds"),this.N=64^this.N,null!==(e=this.diagram)&&e.invalidateDocumentBounds(),this.i("isInDocumentBounds",i,t))}get isLayoutPositioned(){return 0!=(128&this.N)}set isLayoutPositioned(t){var e=0!=(128&this.N);e!==t&&(Yt,Xt.t(t,"boolean",Y,"isLayoutPositioned"),this.N=128^this.N,this.i("isLayoutPositioned",e,t),this.invalidateLayout(t?4:8))}get selectable(){return 0!=(256&this.N)}set selectable(t){var e=0!=(256&this.N);e!==t&&(Yt,Xt.t(t,"boolean",Y,"selectable"),this.N=256^this.N,this.i("selectable",e,t),this.invalidateAdornments())}get reshapable(){return 0!=(512&this.N)}set reshapable(t){var e=0!=(512&this.N);e!==t&&(Yt,Xt.t(t,"boolean",Y,"reshapable"),this.N=512^this.N,this.i("reshapable",e,t),this.invalidateAdornments())}get resizable(){return 0!=(1024&this.N)}set resizable(t){var e=0!=(1024&this.N);e!==t&&(Yt,Xt.t(t,"boolean",Y,"resizable"),this.N=1024^this.N,this.i("resizable",e,t),this.invalidateAdornments())}get rotatable(){return 0!=(2048&this.N)}set rotatable(t){var e=0!=(2048&this.N);e!==t&&(Yt,Xt.t(t,"boolean",Y,"rotatable"),this.N=2048^this.N,this.i("rotatable",e,t),this.invalidateAdornments())}get isSelected(){return 0!=(4096&this.N)}set isSelected(e){var i=0!=(4096&this.N);if(i!==e){Yt,Xt.t(e,"boolean",Y,"isSelected");var s=this.diagram;if(e){if(!this.canSelect())return;if(null!==s){var n=s.maxSelectionCount;if(s.selection.count>=n)return}}this.N=4096^this.N;let t=!1;null!==s&&(t=s.skipsUndoManager,s.skipsUndoManager=!0,(n=s.selection).ut(),e?n.add(this):n.remove(this),n.w()),this.i("isSelected",i,e),this.invalidateAdornments();n=this.selectionChanged;null!==n&&n(this),null!==s&&(s.requestUpdate(),s.skipsUndoManager=t)}}get isHighlighted(){return 0!=(524288&this.N)}set isHighlighted(t){var e,i=0!=(524288&this.N);i!==t&&(Yt,Xt.t(t,"boolean",Y,"isHighlighted"),this.N=524288^this.N,null!==(e=this.diagram)&&((e=e.highlighteds).ut(),t?e.add(this):e.remove(this),e.w()),this.i("isHighlighted",i,t),this.T(),null!==(e=this.highlightedChanged))&&e(this)}get isShadowed(){return 0!=(8192&this.N)}set isShadowed(t){var e=0!=(8192&this.N);e!==t&&(Yt,Xt.t(t,"boolean",Y,"isShadowed"),this.N=8192^this.N,this.fs(!0),this.i("isShadowed",e,t),this.T())}GL(){return 0!=(16384&this.N)}HL(t){t?this.N|=16384:this.N&=-16385}rh(){return 0!=(32768&this.N)}j2(t){t?this.N|=32768:this.N&=-32769}GI(){return 0!=(65536&this.N)}c2(t){t?this.N|=65536:this.N&=-65537}Rl(){return 0!=(131072&this.N)}Gs(t){t?this.N|=131072:this.N&=-131073}$L(){return 0!=(1048576&this.N)}pb(t){t?this.N|=1048576:this.N&=-1048577}get isAnimated(){return 0!=(262144&this.N)}set isAnimated(t){var e=0!=(262144&this.N);e!==t&&(Yt,Xt.t(t,"boolean",Y,"isAnimated"),this.N=262144^this.N,this.i("isAnimated",e,t))}get highlightedChanged(){return null!==this.E?this.E.$p:null}set highlightedChanged(t){var e=this.highlightedChanged;e!==t&&(null!==t&&Xt.t(t,"function",Y,"highlightedChanged"),this.Qi(),this.E.$p=t,this.i("highlightedChanged",e,t))}get selectionObjectName(){return null!==this.E?this.E.Qp:""}set selectionObjectName(t){var e=this.selectionObjectName;e!==t&&(Yt,Xt.t(t,"string",Y,"selectionObjectName"),this.Qi(),this.E.Qp=t,this.pl=null,this.i("selectionObjectName",e,t))}get selectionAdornmentTemplate(){return null!==this.E?this.E._p:null}set selectionAdornmentTemplate(t){var e=this.selectionAdornmentTemplate;e!==t&&(Yt,Xt.s(t,X,Y,"selectionAdornmentTemplate"),this.Qi(),this.E._p=t,this.i("selectionAdornmentTemplate",e,t))}get selectionObject(){var t;return null===this.pl&&(null!==(t=this.selectionObjectName)&&""!==t?(t=this.findObject(t),this.pl=null!==t?t:this):this instanceof q?(t=this.path,this.pl=null!==t?t:this):this.pl=this),this.pl}get selectionChanged(){return null!==this.E?this.E.ty:null}set selectionChanged(t){var e=this.selectionChanged;e!==t&&(null!==t&&Xt.t(t,"function",Y,"selectionChanged"),this.Qi(),this.E.ty=t,this.i("selectionChanged",e,t))}get resizeAdornmentTemplate(){return null!==this.E?this.E.iy:null}set resizeAdornmentTemplate(t){var e=this.resizeAdornmentTemplate;e!==t&&(Yt,Xt.s(t,X,Y,"resizeAdornmentTemplate"),this.Qi(),this.E.iy=t,this.i("resizeAdornmentTemplate",e,t))}get resizeObjectName(){return null!==this.E?this.E.ey:""}set resizeObjectName(t){var e=this.resizeObjectName;e!==t&&(Yt,Xt.t(t,"string",Y,"resizeObjectName"),this.Qi(),this.E.ey=t,this.i("resizeObjectName",e,t))}get resizeObject(){var t=this.resizeObjectName;if(""!==t){t=this.findObject(t);if(null!==t)return t}return this}get resizeCellSize(){return null!==this.E?this.E.sy:qt.xw}set resizeCellSize(t){var e=this.resizeCellSize;e.equals(t)||(Yt,Xt.s(t,qt,Y,"resizeCellSize"),t=t.L(),this.Qi(),this.E.sy=t,this.i("resizeCellSize",e,t))}get rotateAdornmentTemplate(){return null!==this.E?this.E.ny:null}set rotateAdornmentTemplate(t){var e=this.rotateAdornmentTemplate;e!==t&&(Yt,Xt.s(t,X,Y,"rotateAdornmentTemplate"),this.Qi(),this.E.ny=t,this.i("rotateAdornmentTemplate",e,t))}get rotateObjectName(){return null!==this.E?this.E.oy:""}set rotateObjectName(t){var e=this.rotateObjectName;e!==t&&(Yt,Xt.t(t,"string",Y,"rotateObjectName"),this.Qi(),this.E.oy=t,this.i("rotateObjectName",e,t))}get rotateObject(){var t=this.rotateObjectName;if(""!==t){t=this.findObject(t);if(null!==t)return t}return this}get rotationSpot(){return null!==this.E?this.E.ry:J.Default}set rotationSpot(t){var e=this.rotationSpot;e.equals(t)||((Yt,Xt.s(t,J,Y,"rotationSpot"),t===J.Default)||t.isSpot()||Xt.n("Part.rotationSpot must be a specific Spot value or Spot.Default, not: "+t),t=t.L(),this.Qi(),this.E.ry=t,this.i("rotationSpot",e,t))}get text(){return this.di}set text(t){var e=this.di;e!==t&&(Yt,Xt.t(t,"string",Y,"text"),this.di=t,this.i("text",e,t))}get containingGroup(){return this.kh}set containingGroup(e){if(this.De()){var i=this.kh;if(i!==e){Yt,null!==e&&Xt.s(e,j,Y,"containingGroup"),null===e||this!==e&&!e.isMemberOf(this)||(this===e&&Xt.n("Cannot make a Group a member of itself: "+this.toString()),Xt.n("Cannot make a Group indirectly contain itself: "+this.toString()+" already contains "+e.toString())),this.invalidateLayout(2);var s=this.diagram,n=(null!==i?i.Z2(this):this instanceof j&&null!==s&&s.Zr.remove(this),null!==(this.kh=e)?e.$2(this):this instanceof j&&null!==s&&s.Zr.add(this),this.invalidateLayout(1),null!==s&&s.W&&(n=this.data,t=s.model,null!==n)&&t.ma()&&(l=null!==e?e.data:null,t.setGroupForData(n,t.getKeyForNodeData(l))),this.containingGroupChanged);if(null!==n){let t=!0;null!==s&&(t=s.W,s.W=!0),n(this,i,e),null!==s&&(s.W=t)}if(this instanceof j)for(var t=new C,r=(Y.ah(t,this,!0,0,!0),t.iterator);r.next();){var a=r.value;if(a instanceof D)for(var o=a.linksConnected;o.next();)o.value.Ed()}if(this instanceof D){for(var h=this.linksConnected;h.next();)h.value.Ed();var l=this.labeledLink;null!==l&&l.Ed()}this.i("containingGroup",i,e),null!==e&&e.KI()}}else Xt.n("cannot set the Part.containingGroup of a Link or Adornment")}mh(){var t=this.containingGroup;null!==t&&(t.hasPlaceholder()&&t.placeholder.u(),t.u(),t.invalidateConnectedLinks())}T(){var t=this.diagram;null!==t&&!this.hs()&&!this.rh()&&this.isVisible()&&this.Ri.isReal()&&t.T(this.$h(this.Ri))}u(){var t;this.Ko()||(super.u(),null!==(t=this.diagram)&&(t.d0(this),this instanceof D&&null!==this.labeledLink&&this.labeledLink.rc(),t.requestUpdate(!0)))}rc(t){var e;this.hs()||(null!==(e=this.diagram)&&(e.d0(this),this instanceof D&&this.invalidateConnectedLinks(),e.requestUpdate()),this.ro(!0))}vm(t){t||null!==(t=this.kh)&&t.$2(this)}qm(t){t||null!==(t=this.kh)&&t.Z2(this)}Wf(){var t,e=this.data;null!==e&&null!==(t=this.diagram)&&null!==(t=t.model)&&t.removeNodeData(e)}get containingGroupChanged(){return null!==this.E?this.E.ly:null}set containingGroupChanged(t){var e=this.containingGroupChanged;e!==t&&(null!==t&&Xt.t(t,"function",Y,"containingGroupChanged"),this.Qi(),this.E.ly=t,this.i("containingGroupChanged",e,t))}findSubGraphLevel(){return this.Q2(this)}Q2(t){var e=t.containingGroup;if(null!==e)return 1+this.Q2(e);if(t instanceof D){e=t.labeledLink;if(null!==e)return this.Q2(e)}return 0}findTopLevelPart(){return this._2(this)}_2(t){var e=t.containingGroup;if(null!==e)return this._2(e);if(t instanceof D){e=t.labeledLink;if(null!==e)return this._2(e)}return t}get isTopLevel(){return!(null!==this.containingGroup||this instanceof D&&null!==this.labeledLink)}isMemberOf(t){return t instanceof j&&this.tN(this,t)}tN(t,e){if(t!==e&&null!==e){var i=t.containingGroup;if(null!==i&&(i===e||this.tN(i,e)))return!0;if(t instanceof D){i=t.labeledLink;if(null!==i)return this.tN(i,e)}}return!1}findCommonContainingGroup(t){if(null===t)return null;if(Yt,Xt.s(t,Y,Y,"findCommonContainingGroup:other"),this===t)return this.containingGroup;let e=this;for(;null!==e;){var i;e instanceof j&&e.pb(!0),e=(e=e instanceof D&&null!==(i=e.labeledLink)?i:e).containingGroup}let s=null;for(e=t;null!==e;){if(e.$L()){s=e;break}var n;e=(e=e instanceof D&&null!==(n=e.labeledLink)?n:e).containingGroup}for(e=this;null!==e;){var r;e instanceof j&&e.pb(!1),e=(e=e instanceof D&&null!==(r=e.labeledLink)?r:e).containingGroup}return s}get layoutConditions(){return null!==this.E?this.E.hy:127}set layoutConditions(t){var e=this.layoutConditions;e!==t&&(Yt,Xt.t(t,"number",Y,"layoutConditions"),this.Qi(),this.E.hy=t,this.i("layoutConditions",e,t))}canLayout(){var t;return!(!this.isLayoutPositioned||!this.isVisible()||null!==(t=this.layer)&&t.isTemporary||this instanceof D&&this.isLinkLabel)}vI(t){return!!(this.isLayoutPositioned&&t&this.layoutConditions)&&!(null!==(t=this.layer)&&t.isTemporary||this instanceof D&&this.isLinkLabel||null!==(t=this.diagram)&&t.undoManager.isUndoingRedoing)}invalidateLayout(t){var e,i;this.vI(t=void 0===t?16777215:t)&&(null!==(i=this.kh)?null!==(e=i.layout)?e.invalidateLayout():i.invalidateLayout(t):null!==(e=this.diagram)&&null!==(i=e.layout)&&i.invalidateLayout())}LA(){var t;return!(!this.isVisible()||null!==(t=this.layer)&&t.isTemporary)}static ah(t,e,i,s,n,r){if(void 0===r&&(r=null),!t.contains(e)&&(null===r||r(e))&&!(e instanceof X))if(t.add(e),e instanceof D){if(i&&e instanceof j)for(var a=e.memberParts;a.next();){var o=a.value;Y.ah(t,o,i,s,n,r)}if(!1!==n)for(var h=e.linksConnected;h.next();){var l,u,d=h.value;!t.contains(d)&&(l=d.fromNode,u=d.toNode,l=null===l||t.contains(l),u=null===u||t.contains(u),n?l&&u:l||u)&&Y.ah(t,d,i,s,n,r)}if(1<s)for(var c=e.findTreeChildrenNodes();c.next();){var g=c.value;Y.ah(t,g,i,s-1,n,r)}}else if(e instanceof q)for(var m=e.labelNodes;m.next();){var f=m.value;Y.ah(t,f,i,s,n,r)}}get dragComputation(){return null!==this.E?this.E.ay:null}set dragComputation(t){var e=this.dragComputation;e!==t&&(null!==t&&Xt.t(t,"function",Y,"dragComputation"),this.Qi(),this.E.ay=t,this.i("dragComputation",e,t))}get shadowOffset(){return null!==this.E?this.E.fy:U.sC}set shadowOffset(t){var e=this.shadowOffset;e.equals(t)||(Yt,Xt.s(t,U,Y,"shadowOffset"),t=t.L(),this.Qi(),this.E.fy=t,this.T(),this.i("shadowOffset",e,t))}get shadowColor(){return null!==this.E?this.E.cy:"gray"}set shadowColor(t){var e=this.shadowColor;e!==t&&(Yt,Xt.t(t,"string",Y,"shadowColor"),this.Qi(),this.E.cy=t,this.T(),this.i("shadowColor",e,t))}get shadowBlur(){return null!==this.E?this.E.Cn:4}set shadowBlur(t){var e=this.shadowBlur;e!==t&&(Yt,Xt.t(t,"number",Y,"shadowBlur"),this.Qi(),this.E.Cn=t,this.T(),this.i("shadowBlur",e,t))}}class Fe{xi;qp;ly;_p;Qp;ty;$p;iy;ey;sy;ny;oy;ry;Jp;Zp;Wp;jp;ay;hy;fy;cy;Cn;constructor(){this.xi=!1,this.qp=null,this.ly=null,this._p=null,this.Qp="",this.ty=null,this.$p=null,this.iy=null,this.ey="",this.sy=qt.xw,this.ny=null,this.oy="",this.ry=J.Default,this.Jp="",this.Zp=J.TopLeft,this.Wp=U.iC,this.jp=U.eC,this.ay=null,this.hy=127,this.fy=U.sC,this.cy="gray",this.Cn=4}copy(){var t=new Fe;return t.qp=this.qp,t.ly=this.ly,t._p=this._p,t.Qp=this.Qp,t.ty=this.ty,t.$p=this.$p,t.iy=this.iy,t.ey=this.ey,t.sy=this.sy.L(),t.ny=this.ny,t.oy=this.oy,t.ry=this.ry.L(),t.Jp=this.Jp,t.Zp=this.Zp.L(),t.Wp=this.Wp.L(),t.jp=this.jp.L(),t.ay=this.ay,t.hy=this.hy,t.fy=this.fy.L(),t.cy=this.cy,t.Cn=this.Cn,t}}class X extends Y{xs;Et;sM;nM;uc;constructor(t,e){void 0===t||t instanceof se||"number"==typeof t||"string"==typeof t?super(t):(super(),t&&(e=t)),this.N&=-257,this.ml="Adornment",this.xs=null,this.sM=0,this.nM=!1,this.Et=null,this.uc=null,e&&Object.assign(this,e)}toString(){var t=this.adornedPart;return"Adornment("+this.category+")"+(null!==t?t.toString():"")}updateRelationshipsFromData(){}pd(t){var e=this.adornedObject,i=e?.part;if(i instanceof q&&e instanceof V){var s,e=i.path,n=(e.geometry,i.pd(t),s=e.geometry,this.F.h),r=n.length;for(let t=0;t<r;t++){var a=n[t];a.isPanelMain&&a instanceof V&&(a.yt=s)}}}hasPlaceholder(){return null!==this.Et&&this.Et.isVisibleObject()}get placeholder(){return this.Et}get adornedObject(){return this.xs}set adornedObject(t){Yt,null!==t&&Xt.s(t,y,Y,"adornedObject:value");var e=this.adornedPart;let i=null;null!==t&&(i=t.part),null===e||null!==t&&e===i||e.removeAdornment(this.category),this.xs=t,null!==i&&i.addAdornment(this.category,this)}get adornedPart(){var t=this.xs;return null!==t?t.part:null}tl(){var t=this.xs;return null===t||null===(t=t.part)||!t.hs()}De(){return!1}get containingGroup(){return null}tc(t,e,i,s,n,r,a){var o;3===t&&"elements"===e?n instanceof je?null===this.Et?this.Et=n:(Yt,this.Et!==n&&Xt.n("Cannot insert a second Placeholder into the visual tree of an Adornment.")):n instanceof jt&&(o=n.findInVisualTree(t=>t instanceof je))instanceof je&&(null===this.Et?this.Et=o:(Yt,this.Et!==o&&Xt.n("Cannot insert a second Placeholder into the visual tree of an Adornment."))):4===t&&"elements"===e&&null!==this.Et&&(s===this.Et||s instanceof jt&&this.Et.isContainedBy(s))&&(this.Et=null),super.tc(t,e,i,s,n,r,a)}updateAdornments(){}Wf(){}}(Re={})[Re.None=0]="None",Re[Re.Evenly=1]="Evenly",Re[Re.Packed=2]="Packed";var Re;class D extends Y{z;bt;Nc;yl;Sh;ue;ni;constructor(t,e){void 0===t||t instanceof se||"number"==typeof t||"string"==typeof t?super(t):(super(),t&&(e=t)),this.z=13,this.bt=null,this.ni=new O,this.Nc=null,this.yl=null,this.ue=null,this.Sh=!1,e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),t.z=this.z,null!==this.bt&&(this.bt.xi?t.bt=this.bt:t.bt=this.bt.copy())}qo(t){super.qo(t),t.invalidateConnectedLinks(),t.yl=this.yl,t.ue=null}static SpreadingNone=0;static SpreadingEvenly=1;static SpreadingPacked=2;wl(){null===this.bt?this.bt=new Oe:this.bt.xi&&(this.bt=this.bt.copy())}uh(){super.uh(),null!==this.bt&&(this.bt.xi=!0)}QL(t){null!==t&&(null===this.yl&&(this.yl=new C),this.yl.add(t))}_L(t){null!==t&&null!==this.yl&&this.yl.remove(t)}tT(t,e,i){if(null!==t&&null!==this.yl)for(var s=this.yl.iterator;s.next();){var n=s.value;if(n.uy===this&&n.yb===t&&n.iN===e&&n.eN===i||n.uy===t&&n.yb===this&&n.iN===i&&n.eN===e)return n}return null}invalidateLinkBundle(t,e,i){t=this.tT(t,e=null==e?"":e,i=null==i?"":i);null!==t&&t.Vd()}tc(t,e,i,s,n,r,a){(3===t&&"elements"===e||4===t&&"elements"===e)&&(this.ue=null),super.tc(t,e,i,s,n,r,a)}invalidateConnectedLinks(t){for(var e=this.linksConnected;e.next();){var i=e.value;void 0!==t&&t.contains(i)||(this.Se(i.fromPort),this.Se(i.toPort),i.invalidateRoute())}}nL(t){for(var e=this.linksConnected;e.next();){var i=e.value;i.fromPort!==t&&i.toPort!==t||(this.Se(i.fromPort),this.Se(i.toPort),i.invalidateRoute())}}Se(t){var e;null===t||(null!==(e=t.nd)&&e.Vd(),null===(t=(e=t.part).containingGroup))||e.isVisible()||t.Se(t.port)}tl(){return!0}get portSpreading(){return null!==this.bt?this.bt.gy:1}set portSpreading(t){var e=this.portSpreading;e!==t&&(Yt,0!==t&&1!==t&&2!==t&&Xt.n("Node.portSpreading can only be set to PortSpreading.None, PortSpreading.Evenly, or PortSpreading.Packed, not: "+t),this.wl(),this.bt.gy=t,this.i("portSpreading",e,t),null!==(e=this.diagram)&&e.undoManager.isUndoingRedoing||this.invalidateConnectedLinks())}get avoidable(){return 0!=(8&this.z)}set avoidable(t){var e,i=0!=(8&this.z);i!==t&&(Yt,Xt.t(t,"boolean",D,"avoidable"),this.z=8^this.z,null!==(e=this.diagram)&&e.KP(this),this.i("avoidable",i,t))}get avoidableMargin(){return null!==this.bt?this.bt.my:E.aC}set avoidableMargin(t){"number"==typeof t?t=new E(t):Xt.s(t,E,D,"avoidableMargin");var e,i=this.avoidableMargin;i.equals(t)||(t=t.L(),this.wl(),this.bt.my=t,null!==(e=this.diagram)&&e.KP(this),this.i("avoidableMargin",i,t))}canAvoid(){return this.avoidable&&!this.isLinkLabel}getAvoidableRect(t){return t.set(this.actualBounds),t.addMargin(this.avoidableMargin),t}findVisibleNode(){let t=this;for(;null!==t&&!t.isVisible();)t=t.containingGroup;return t}isVisible(){if(!super.isVisible())return!1;let i=!0,t=1;var e=this.diagram;if(null!==e){if(e.animationManager.ux(this))return!0;i=e.isTreePathToChildren,t=e.treeCollapsePolicy}if(1===t){e=this.findTreeParentNode();if(null!==e&&!e.isTreeExpanded)return!1}else if(2===t){var s=i?this.findLinksInto():this.findLinksOutOf();let t=!1,e=!1;for(;s.next();){var n=s.value;if(n.isTreeLink){t=!0;n=i?n.fromNode:n.toNode;if(n&&n.isTreeExpanded){e=!0;break}}}if(t&&!e)return!1}else if(3===t){var r=i?this.findLinksInto():this.findLinksOutOf();let t=!1,e=!1;for(;r.next();){var a=r.value;if(a.isTreeLink){t=!0;a=i?a.fromNode:a.toNode;if(a&&!a.isTreeExpanded){e=!0;break}}}if(t&&e)return!1}e=this.labeledLink;return null===e||e.isVisible()}Ki(t){super.Ki(t);for(var e=this.linksConnected;e.next();){var i,s=e.value;!t||null===this.containingGroup||null===(i=s.getOtherNode(this))||i.isMemberOf(this.containingGroup)||s.invalidateRoute(),s.Ki(t)}}get linksConnected(){return this.ni.iterator}findExternalTreeLinksConnected(){var t=new C,e=new C;return this.iT(this,t,e),e.iterator}iT(i,s,n){if(null!==i&&!s.has(i)){s.add(i);let e=!0;var t=this.diagram;null!==t&&(e=t.isTreePathToChildren),i.linksConnected.each(t=>{t.isTreeLink?(e?t.fromNode===i:t.toNode===i)&&this.iT(e?t.toNode:t.fromNode,s,n):n.add(t)})}}findLinksConnected(e){if(null===(e=void 0===e?null:e))return this.ni.iterator;Yt,Xt.t(e,"string",D,"findLinksConnected:pid");const t=new u(this.ni),i=this;return t.predicate=t=>t.fromNode===i&&t.fromPortId===e||t.toNode===i&&t.toPortId===e,t}findLinksOutOf(e){void 0===e&&(e=null),Yt,null!==e&&Xt.t(e,"string",D,"findLinksOutOf:pid");const t=new u(this.ni),i=this;return t.predicate=t=>t.fromNode===i&&(null===e||t.fromPortId===e),t}findLinksInto(e){void 0===e&&(e=null),Yt,null!==e&&Xt.t(e,"string",D,"findLinksInto:pid");const t=new u(this.ni),i=this;return t.predicate=t=>t.toNode===i&&(null===e||t.toPortId===e),t}findNodesConnected(t){void 0===t&&(t=null),Yt,null!==t&&Xt.t(t,"string",D,"findNodesConnected:pid");let e=null,i=null;for(var s=this.ni.iterator;s.next();){var n,r=s.value;r.fromNode===this?null!==t&&r.fromPortId!==t||(n=r.toNode,null!==e?e.add(n):null!==i&&i!==n?((e=new C).add(i),e.add(n)):i=n):r.toNode!==this||null!==t&&r.toPortId!==t||(n=r.fromNode,null!==e?e.add(n):null!==i&&i!==n?((e=new C).add(i),e.add(n)):i=n)}return null!==e?e.iterator:null!==i?new l(i):o.instance}findNodesOutOf(t){void 0===t&&(t=null),Yt,null!==t&&Xt.t(t,"string",D,"findNodesOutOf:pid");let e=null,i=null;for(var s=this.ni.iterator;s.next();){var n=s.value;n.fromNode!==this||null!==t&&n.fromPortId!==t||(n=n.toNode,null!==e?e.add(n):null!==i&&i!==n?((e=new C).add(i),e.add(n)):i=n)}return null!==e?e.iterator:null!==i?new l(i):o.instance}findNodesInto(t){void 0===t&&(t=null),Yt,null!==t&&Xt.t(t,"string",D,"findNodesInto:pid");let e=null,i=null;for(var s=this.ni.iterator;s.next();){var n=s.value;n.toNode!==this||null!==t&&n.toPortId!==t||(n=n.fromNode,null!==e?e.add(n):null!==i&&i!==n?((e=new C).add(i),e.add(n)):i=n)}return null!==e?e.iterator:null!==i?new l(i):o.instance}findLinksBetween(e,i,s){void 0===i&&(i=null),void 0===s&&(s=null),(Yt,Xt.s(e,D,D,"findLinksBetween:othernode"),null!==i&&Xt.t(i,"string",D,"findLinksBetween:pid"),null!==s)&&Xt.t(s,"string",D,"findLinksBetween:otherpid");const t=new u(this.ni),n=this;return t.predicate=t=>!((t.fromNode!==n||t.toNode!==e||null!==i&&t.fromPortId!==i||null!==s&&t.toPortId!==s)&&(t.fromNode!==e||t.toNode!==n||null!==s&&t.fromPortId!==s||null!==i&&t.toPortId!==i)),t}findLinksTo(e,i,s){void 0===i&&(i=null),void 0===s&&(s=null),(Yt,Xt.s(e,D,D,"findLinksTo:othernode"),null!==i&&Xt.t(i,"string",D,"findLinksTo:pid"),null!==s)&&Xt.t(s,"string",D,"findLinksTo:otherpid");const t=new u(this.ni),n=this;return t.predicate=t=>!(t.fromNode!==n||t.toNode!==e||null!==i&&t.fromPortId!==i||null!==s&&t.toPortId!==s),t}get linkConnected(){return null!==this.bt?this.bt.py:null}set linkConnected(t){var e=this.linkConnected;e!==t&&(null!==t&&Xt.t(t,"function",D,"linkConnected"),this.wl(),this.bt.py=t,this.i("linkConnected",e,t))}get linkDisconnected(){return null!==this.bt?this.bt.yy:null}set linkDisconnected(t){var e=this.linkDisconnected;e!==t&&(null!==t&&Xt.t(t,"function",D,"linkDisconnected"),this.wl(),this.bt.yy=t,this.i("linkDisconnected",e,t))}get linkValidation(){return null!==this.bt?this.bt.Fl:null}set linkValidation(t){var e=this.linkValidation;e!==t&&(null!==t&&Xt.t(t,"function",D,"linkValidation"),this.wl(),this.bt.Fl=t,this.i("linkValidation",e,t))}wb(e,i){this.Se(i);var s=this.ni.contains(e);if(s||this.ni.add(e),!s||e.fromNode===e.toNode){var n=this.linkConnected;if(null!==n){let t=!0;var r=this.diagram;null!==r&&(t=r.W,r.W=!0),n(this,e,i),null!==r&&(r.W=t)}}if(!s&&e.isTreeLink){n=e.fromNode,i=e.toNode;if(null!==n&&null!==i&&n!==i){let t=!0;r=this.diagram,s=(t=null!==r?r.isTreePathToChildren:t)?i:n,e=t?n:i;s.Sh||(s.Sh=e),!e.isTreeLeaf||null!==r&&r.undoManager.isUndoingRedoing||(t?n===e&&(e.isTreeLeaf=!1):i===e&&(e.isTreeLeaf=!1))}}}xb(e,i){this.Se(i);var t=this.ni.remove(e);let s=null;if(t||e.toNode===e.fromNode){var n=this.linkDisconnected;if(s=this.diagram,null!==n){let t=!0;null!==s&&(t=s.W,s.W=!0),n(this,e,i),null!==s&&(s.W=t)}}if(t&&e.isTreeLink){let t=!0;n=(t=null!==s?s.isTreePathToChildren:t)?e.toNode:e.fromNode,i=t?e.fromNode:e.toNode;null!==n&&(n.Sh=!1),null===i||i.isTreeLeaf||(0===i.ni.count?(i.Sh=null)!==s&&s.undoManager.isUndoingRedoing||(i.isTreeLeaf=!0):i.x0())}}x0(){if(this.Sh=!1,0!==this.ni.count){let t=!0;var e=this.diagram;if(null===e||!e.undoManager.isUndoingRedoing){null!==e&&(t=e.isTreePathToChildren);for(var i=this.ni.iterator;i.next();){var s=i.value;if(s.isTreeLink)if(t){if(s.fromNode===this)return void(this.isTreeLeaf=!1)}else if(s.toNode===this)return void(this.isTreeLeaf=!1)}this.isTreeLeaf=!0}}}updateRelationshipsFromData(){var t=this.diagram;null!==t&&t.partManager.updateRelationshipsFromData(this)}vm(t){super.vm(t),t||(this.x0(),null!==(t=this.Nc)&&t.eT(this))}qm(t){super.qm(t),t||null!==(t=this.Nc)&&t.sT(this)}Wf(){if(0<this.ni.count){var t=this.diagram;if(null!==t)for(var e=null===t.commandHandler||t.commandHandler.deletesConnectedLinks,i=this.ni.copy().iterator;i.next();){var s=i.value;e?t.remove(s):(s.fromNode===this&&(s.fromNode=null),s.toNode===this&&(s.toNode=null))}}this.labeledLink=null,super.Wf()}get isLinkLabel(){return null!==this.Nc}get labeledLink(){return this.Nc}set labeledLink(t){var e,i,s,n,r,a=this.Nc;a!==t&&(Yt,null!==t&&Xt.s(t,q,D,"labeledLink"),e=this.diagram,i=this.data,null!==a&&(a.sT(this),null===e||null===i||e.undoManager.isUndoingRedoing||(n=a.data,s=e.model,null!==n&&s.Ea()&&void 0!==(r=s.getKeyForNodeData(i))&&s.removeLabelKeyForLinkData(n,r)),this.containingGroup=null),null!==(this.Nc=t)&&(t.eT(this),null===e||null===i||e.undoManager.isUndoingRedoing||(s=t.data,n=e.model,null!==s&&n.Ea()&&void 0!==(r=n.getKeyForNodeData(i))&&n.addLabelKeyForLinkData(s,r)),this.containingGroup=t.containingGroup),this.rc(),this.i("labeledLink",a,t))}findVisiblePort(t){let e=t;for(;!(null===e||e.actualBounds.isReal()&&e.isVisibleObject());)e=e.panel;return null===e?this.port:e}findPort(t){if(Yt,Xt.t(t,"string",D,"findPort:pid"),null===this.ue){if(""===t&&!1===this.Nn)return this;this.nT()}let e=this.ue.getValue(t);return null!==e||""!==t&&null!==(e=this.ue.getValue(""))?e:this}get port(){return this.findPort("")}get ports(){return null===this.ue&&this.nT(),this.ue.iteratorValues}nT(){null===this.ue?this.ue=new L:this.ue.clear(),this.walkVisualTreeFrom(this,(t,e)=>t.uL(e)),0===this.ue.count&&this.ue.add("",this)}uL(t){var e=t.portId;null!==e&&null!==this.ue&&this.ue.add(e,t)}k2(t,e){t=t.portId;if(null!==t){null!==this.ue&&this.ue.remove(t);var i=this.diagram;if(null!==i&&e){let e=null;for(var s=this.findLinksConnected(t);s.next();){var n=s.value;(e=null===e?Xt.ct():e).push(n)}if(null!==e){for(let t=0;t<e.length;t++){var r=e[t];i.remove(r)}Xt.ot(e)}}}}isInTreeOf(t){if(null===t||t===this)return!1;let e=!0;var i=this.diagram;let s=this;var n=t;let r;if(e=null!==i?i.isTreePathToChildren:e)for(;s!==n;){r=null;for(var a=s.ni.iterator;a.next();){var o=a.value;if(o.isTreeLink&&(r=o.fromNode)!==s&&r!==this)break}if(r===this||null===r||r===s)return!1;s=r}else for(;s!==n;){r=null;for(var h=s.ni.iterator;h.next();){var l=h.value;if(l.isTreeLink&&(r=l.toNode)!==s&&r!==this)break}if(r===this||null===r||r===s)return!1;s=r}return!0}findTreeRoot(){let t=!0;var e=this.diagram;let i=this,s;if(t=null!==e?e.isTreePathToChildren:t)for(;;){s=null;for(var n=i.ni.iterator;n.next();){var r=n.value;if(r.isTreeLink&&(s=r.fromNode)!==i&&s!==this)break}if(s===this)return this;if(null===s||s===i)return i;i=s}else for(;;){s=null;for(var a=i.ni.iterator;a.next();){var o=a.value;if(o.isTreeLink&&(s=o.toNode)!==i&&s!==this)break}if(s===this)return this;if(null===s||s===i)return i;i=s}}findCommonTreeParent(t){if(null===t)return null;if(Yt,Xt.s(t,D,D,"findCommonTreeParent:other"),this===t)return this;let e=this;for(;null!==e;)e.pb(!0),e=e.findTreeParentNode();let i=null;for(e=t;null!==e;){if(e.$L()){i=e;break}e=e.findTreeParentNode()}for(e=this;null!==e;)e.pb(!1),e=e.findTreeParentNode();return i}findTreeParentLink(){let t=!0;var e=this.diagram,i=(null!==e&&(t=e.isTreePathToChildren),this.ni.iterator);if(t)for(;i.next();){var s=i.value;if(s.isTreeLink&&s.fromNode!==this)return s}else for(;i.next();){var n=i.value;if(n.isTreeLink&&n.toNode!==this)return n}return null}findTreeParentNode(){var t=this.Sh;if(null!==t){if(t instanceof D)return t;for(var t=this.diagram,e=null===t||t.isTreePathToChildren,i=this.ni.iterator;i.next();){var s=i.value;if(s.isTreeLink){s=e?s.fromNode:s.toNode;if(s!==this)return this.Sh=s}}this.Sh=null}return null}findTreeParentChain(){var t=new C;return function t(e,i){i.add(e);var s=e.findTreeParentLink();null!==s&&(i.add(s),null!==(s=e.findTreeParentNode()))&&t(s,i)}(this,t),t}findTreeLevel(){return this.qI(this)}qI(t){let e=0,i=t.findTreeParentNode();for(;null!==i&&i!==t;)i=i.findTreeParentNode(),e++;return e}findTreeChildrenLinks(){let t=!0;var e=this.diagram;null!==e&&(t=e.isTreePathToChildren);const i=new u(this.ni),s=this;return t?i.predicate=t=>!(!t.isTreeLink||t.fromNode!==s):i.predicate=t=>!(!t.isTreeLink||t.toNode!==s),i}findTreeChildrenNodes(){let t=!0;var e=this.diagram;null!==e&&(t=e.isTreePathToChildren);let i=null,s=null;var n=this.ni.iterator;if(t)for(;n.next();){var r=n.value;r.isTreeLink&&r.fromNode===this&&(r=r.toNode,null!==i?i.add(r):null!==s&&s!==r?((i=new O).add(s),i.add(r)):s=r)}else for(;n.next();){var a=n.value;a.isTreeLink&&a.toNode===this&&(a=a.fromNode,null!==i?i.add(a):null!==s&&s!==a?((i=new O).add(s),i.add(a)):s=a)}return null!==i?i.iterator:null!==s?new l(s):o.instance}findTreeParts(t){void 0===t&&(t=1/0),Xt.t(t,"number",D,"findTreeParts:level");var e=new C;return Y.ah(e,this,!1,t,!0),e}collapseTree(t){void 0===t&&(t=1),Xt.r(t,D,"collapseTree:level"),t<1&&(t=1);var e,i=this.diagram;null===i||i.isCollapsingExpanding||(i.isCollapsingExpanding=!0,(e=new C).add(this),this.oT(e,i.isTreePathToChildren,t,i,this,1===i.treeCollapsePolicy),i.isCollapsingExpanding=!1)}oT(t,e,i,s,n,r){if(1<i)for(var a=e?this.findLinksOutOf():this.findLinksInto();a.next();){var o=a.value;o.isTreeLink&&(null===(o=o.getOtherNode(this))||o===this||t.contains(o)||(t.add(o),o.oT(t,e,i-1,s,n,r)))}else this.rT(t,e,s,n,r)}rT(t,e,i,s,n){for(var r=s===this||this.isTreeExpanded,a=e?this.findLinksOutOf():this.findLinksInto();a.next();){var o=a.value;if(o.isTreeLink){o=o.getOtherNode(this);if(null!==o&&o!==this){var h=t.contains(o);if(h||t.add(o),r){const l=e?o.findNodesInto():o.findNodesOutOf(),u=this;l.all(t=>t===u||!t.isTreeExpanded)&&i.Rf(o,s),o.mh(),o.Ki(!1)}o.isTreeExpanded&&(o.wasTreeExpanded=o.isTreeExpanded,h||o.rT(t,e,i,s,n))}}}this.isTreeExpanded=!1}expandTree(t){void 0===t&&(t=2),Xt.r(t,D,"expandTree:level"),t<2&&(t=2);var e,i=this.diagram;null===i||i.isCollapsingExpanding||(i.isCollapsingExpanding=!0,(e=new C).add(this),this.lT(e,i.isTreePathToChildren,t,i,this,1===i.treeCollapsePolicy),i.isCollapsingExpanding=!1)}lT(t,e,i,s,n,r){for(var a=n!==this&&this.isTreeExpanded,o=e?this.findLinksOutOf():this.findLinksInto();o.next();){var h=o.value;if(h.isTreeLink){a||h.Re||h.invalidateRoute();h=h.getOtherNode(this);if(null!==h&&h!==this&&!t.contains(h)){if(t.add(h),!a){h.Ki(!0),h.mh();const l=e?h.findNodesInto():h.findNodesOutOf(),u=this;l.all(t=>t===u||!t.isTreeExpanded)&&s.Ff(h,n)}(2<i||h.wasTreeExpanded)&&(h.wasTreeExpanded=!1,h.lT(t,e,i-1,s,n,r))}}}this.isTreeExpanded=!0}get isTreeExpanded(){return 0!=(1&this.z)}set isTreeExpanded(t){var e=0!=(1&this.z);if(e!==t){Yt,Xt.t(t,"boolean",D,"isTreeExpanded"),this.z=1^this.z;var i=this.diagram,e=(this.i("isTreeExpanded",e,t),this.treeExpandedChanged);if(null!==e){let t=!0;null!==i&&(t=i.W,i.W=!0),e(this),null!==i&&(i.W=t)}null!==i&&i.undoManager.isUndoingRedoing?this.Ki(t):t?this.expandTree():this.collapseTree()}}get wasTreeExpanded(){return 0!=(2&this.z)}set wasTreeExpanded(t){var e=0!=(2&this.z);e!==t&&(Yt,Xt.t(t,"boolean",D,"wasTreeExpanded"),this.z=2^this.z,this.i("wasTreeExpanded",e,t))}get treeExpandedChanged(){return null!==this.bt?this.bt.wy:null}set treeExpandedChanged(t){var e=this.treeExpandedChanged;e!==t&&(null!==t&&Xt.t(t,"function",D,"treeExpandedChanged"),this.wl(),this.bt.wy=t,this.i("treeExpandedChanged",e,t))}get isTreeLeaf(){return 0!=(4&this.z)}set isTreeLeaf(t){var e=0!=(4&this.z);e!==t&&(Yt,Xt.t(t,"boolean",D,"isTreeLeaf"),this.z=4^this.z,this.i("isTreeLeaf",e,t))}get isTreeRoot(){return null===this.findTreeParentLink()}}class Oe{xi;py;yy;Fl;wy;my;gy;xy;by;hh;ky;constructor(){this.xi=!1,this.py=null,this.yy=null,this.Fl=null,this.wy=null,this.my=E.aC,this.gy=1,this.xy=null,this.by=null,this.hh=null,this.ky=null}copy(){var t=new Oe;return t.py=this.py,t.yy=this.yy,t.Fl=this.Fl,t.wy=this.wy,t.my=this.my.L(),t.gy=this.gy,t.xy=this.xy,t.by=this.by,t.hh=this.hh,t.ky=this.ky,t}}(s={})[s.None=0]="None",s[s.End=17]="End",s[s.Scale=18]="Scale",s[s.Stretch=19]="Stretch";var Ee=s,He=((s={})[s.Normal=1]="Normal",s[s.Orthogonal=2]="Orthogonal",s[s.AvoidsNodes=6]="AvoidsNodes",s[s.AvoidsNodesStraight=7]="AvoidsNodesStraight",s),Ie=((s={})[s.None=0]="None",s[s.Bezier=9]="Bezier",s[s.JumpGap=10]="JumpGap",s[s.JumpOver=11]="JumpOver",s);class q extends Y{Dt;mo;po;Bd;yo;wo;zd;Cc;Xd;Yd;Kd;Va;Ud;Qs;Ci;Ve;Dr;Ac;sr;sN;nN;bb;oN;rN;Sy;kb;yt;nr;static Ba=null;static za=null;uc;lN;hN;constructor(t){super(jt.Link),this.Dt=8,this.mo=null,this.po="",this.Bd=null,this.yo=null,this.wo="",this.zd=null,this.Cc=0,this.Xd=0,this.Yd=0,this.Kd=NaN,this.Va=1,this.Ud=.5,this.Qs=null,this.Ci=(new O).w(),this.Ve=null,this.Dr=null,this.Ac=new Z,this.yt=new W,this.sr=null,this.nr=null,this.sN=null,this.nN=null,this.lN=0,this.hN=0,this.bb=new U,this.oN=null,this.rN=null,this.Sy=null,this.kb=NaN,this.$=null,this.uc=[],t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Dt=-113&this.Dt,t.po=this.po,t.Bd=this.Bd,t.wo=this.wo,t.zd=this.zd,t.Cc=this.Cc,t.Xd=this.Xd,t.Yd=this.Yd,t.Kd=this.Kd,t.Va=this.Va,t.Ud=this.Ud,null!==this.$&&(t.$=this.$.copy())}qo(t){super.qo(t),this.po=t.po,this.wo=t.wo,t.Ve=null,t.invalidateRoute(),t.nr=this.nr;var e=t.fromPort,e=(null!==e&&t.fromNode.Se(e),t.toPort);null!==e&&t.toNode.Se(e)}ci(t){t in He||t in Ie||t in Ee?q.aN(t)?this.routing=t:9===t||10===t||11===t?this.curve=t:17===t||18===t||19===t?this.adjusting=t:1!==t&&0!==t&&Xt.n("Unknown Link enum value for a Link property: "+t):super.ci(t)}static Normal=1;static Orthogonal=2;static AvoidsNodes=6;static AvoidsNodesStraight=7;static None=0;static Bezier=9;static JumpGap=10;static JumpOver=11;static End=17;static Scale=18;static Stretch=19;static OrientAlong=21;static OrientPlus90=22;static OrientMinus90=23;static OrientOpposite=24;static OrientUpright=25;static OrientPlus90Upright=26;static OrientMinus90Upright=27;static OrientUpright45=28;static WI=8;static jI=16;static JI=14;static Xa=8;je(){null===this.$&&(this.$=new Xe)}nI(t,r,a){var o=t.segmentIndex,e=t.segmentFraction;let i=t.alignmentFocus;var s,n,h,l,u,d,c,g=t.segmentOrientation,m=t.segmentOffset;let f=0,p=0,v=0,y=0;if(isNaN(o)){var x=this.yt,A=Xt.ct(),w=(x.getPointAndAngleAlongPath(e,A),U.H(A[0],A[1]));w.add(this.getPoint(0)),1===x.type?w.offset(-x.startX,-x.startY):(x=x.figures.first(),w.offset(-x.startX,-x.startY)),y=A[2],0!==g&&(v=this.computeAngle(t,g,y),t.angle=v),f=w.x,p=w.y,U.o(w),Xt.ot(A)}else if(o<-r||r<=o){var x=U.a();this.wL(x),y=this.midAngle,0!==g&&(v=this.computeAngle(t,g,y),t.angle=v),f=x.x,p=x.y,U.o(x)}else{let i,s,n=0;if(s=0<=o?(i=a.h[o],o<r-1?a.h[o+1]:i):(n=r+o,i=a.h[n],0<n?a.h[n-1]:i),i.equalsApprox(s)){let t,e;e=0<=o?(t=0<o?a.h[o-1]:i,o<r-2?a.h[o+2]:s):(t=n<r-1?a.h[n+1]:i,1<n?a.h[n-2]:s);var w=t.distanceSquaredPoint(i),A=s.distanceSquaredPoint(e);y=A+10<w?0<=o?t.directionPoint(i):i.directionPoint(t):w+10<A?0<=o?s.directionPoint(e):e.directionPoint(s):0<=o?t.directionPoint(e):e.directionPoint(t)}else y=0<=o?i.directionPoint(s):s.directionPoint(i);0!==g&&(v=this.computeAngle(t,g,y),t.angle=v),f=i.x+(s.x-i.x)*e,p=i.y+(s.y-i.y)*e}i.isNone()?t.location=new U(f,p):(i.isNoSpot()&&(i=J.Center),(x=H.a()).ti(),x.v(t.scale,t.scale),x.ys(t.angle,0,0),r=t.naturalBounds,a=Z.H(0,0,r.width,r.height),(w=U.a()).setRectSpot(a,i),x.Pt(w),A=-w.x,s=-w.y,u=r.width,r=r.height,(n=U.a()).c(m),h=isNaN(m.x),l=isNaN(m.y),h||l?(u=u/2+3,r=r/2+3,d=45<=y&&y<=135,c=225<=y&&y<=315,0===g&&(d||c)?(n.x=l?u:m.y,n.y=h?r:m.x,d?0<=o||isNaN(o)&&e<.5||h&&(n.y=-r):c&&((0<=o||isNaN(o)&&e<.5)&&h&&(n.y=-r),l)&&(n.x=-u)):(h&&(0<=o||isNaN(o)&&e<.5?n.x=u:n.x=-u),l&&(n.y=-r),n.rotate(y))):n.rotate(y),f+=n.x,p+=n.y,x.Nw(a),A+=a.x,s+=a.y,g=U.H(f+A,p+s),t.move(g),U.o(g),U.o(n),U.o(w),Z.o(a),H.o(x))}tl(){let t=this.fromNode;if(null!==t){var e=t.findVisibleNode();if((t=null!==e?e:t).hs()||t.rh())return!1}let i=this.toNode;if(null!==i){e=i.findVisibleNode();if((i=null!==e?e:i).hs()||i.rh())return!1}return!0}w2(t,e,i){return!1}b2(){}De(){return!1}computeAngle(t,e,i){return q.computeAngle(e,i)}static computeAngle(t,e){let i=0;switch(t){default:case 0:i=0;break;case 21:i=e;break;case 22:i=e+90;break;case 23:i=e-90;break;case 24:i=e+180;break;case 25:90<(i=I.Zg(e))&&i<270&&(i-=180);break;case 26:90<(i=I.Zg(e+90))&&i<270&&(i-=180);break;case 27:90<(i=I.Zg(e-90))&&i<270&&(i-=180);break;case 28:if(45<(i=I.Zg(e))&&i<135||225<i&&i<315)return 0;90<i&&i<270&&(i-=180)}return I.Zg(i)}get fromNode(){return this.mo}set fromNode(t){var e=this.mo;if(e!==t){Yt,null!==t&&Xt.s(t,D,q,"fromNode");var i=this.fromPort,s=(null!==e&&(this.yo!==e&&e.xb(this,i),this.My(),this.invalidateLayout(2)),null!==(this.mo=t)&&this.Ki(t.isVisible()),this.sr=null,this.invalidateRoute(),this.diagram),n=(null!==s&&s.W&&s.partManager.setFromNodeForLink(this,t,e),this.fromPort),r=this.fromPortChanged;if(null!==r){let t=!0;null!==s&&(t=s.W,s.W=!0),r(this,i,n),null!==s&&(s.W=t)}null!==t&&(this.yo!==t&&t.wb(this,n),this.Py(),this.invalidateLayout(1)),this.i("fromNode",e,t),this.Ed()}}get fromPortId(){return this.po}set fromPortId(t){var e=this.po;if(e!==t){Yt,Xt.t(t,"string",q,"fromPortId");var i,s=this.fromPort,n=(null!==s&&this.fromNode.Se(s),this.My(),this.po=t,this.fromPort),r=(null!==n&&this.fromNode.Se(n),this.diagram);if(null!==r&&(i=this.data,a=r.model,null!==i)&&a.Ea()&&a.setFromPortIdForLinkData(i,t),s!==n){this.sr=null,this.invalidateRoute();var a=this.fromPortChanged;if(null!==a){let t=!0;null!==r&&(t=r.W,r.W=!0),a(this,s,n),null!==r&&(r.W=t)}}this.Py(),this.i("fromPortId",e,t)}}get fromPort(){var t,e=this.mo;return null===e?null:(t=this.po,e.findPort(t))}get fromPortChanged(){return this.Bd}set fromPortChanged(t){var e=this.Bd;e!==t&&(null!==t&&Xt.t(t,"function",q,"fromPortChanged"),this.Bd=t,this.i("fromPortChanged",e,t))}get toNode(){return this.yo}set toNode(t){var e=this.yo;if(e!==t){Yt,null!==t&&Xt.s(t,D,q,"toNode");var i=this.toPort,s=(null!==e&&(this.mo!==e&&e.xb(this,i),this.My(),this.invalidateLayout(2)),null!==(this.yo=t)&&this.Ki(t.isVisible()),this.sr=null,this.invalidateRoute(),this.diagram),n=(null!==s&&s.W&&s.partManager.setToNodeForLink(this,t,e),this.toPort),r=this.toPortChanged;if(null!==r){let t=!0;null!==s&&(t=s.W,s.W=!0),r(this,i,n),null!==s&&(s.W=t)}null!==t&&(this.mo!==t&&t.wb(this,n),this.Py(),this.invalidateLayout(1)),this.i("toNode",e,t),this.Ed()}}get toPortId(){return this.wo}set toPortId(t){var e=this.wo;if(e!==t){Yt,Xt.t(t,"string",q,"toPortId");var i,s=this.toPort,n=(null!==s&&this.toNode.Se(s),this.My(),this.wo=t,this.toPort),r=(null!==n&&this.toNode.Se(n),this.diagram);if(null!==r&&(i=this.data,a=r.model,null!==i)&&a.Ea()&&a.setToPortIdForLinkData(i,t),s!==n){this.sr=null,this.invalidateRoute();var a=this.toPortChanged;if(null!==a){let t=!0;null!==r&&(t=r.W,r.W=!0),a(this,s,n),null!==r&&(r.W=t)}}this.Py(),this.i("toPortId",e,t)}}get toPort(){var t,e=this.yo;return null===e?null:(t=this.wo,e.findPort(t))}get toPortChanged(){return this.zd}set toPortChanged(t){var e=this.zd;e!==t&&(null!==t&&Xt.t(t,"function",q,"toPortChanged"),this.zd=t,this.i("toPortChanged",e,t))}get fromSpot(){return null!==this.$?this.$.pa:J.Default}set fromSpot(t){var e=this.fromSpot;e.equals(t)||(Yt,Xt.s(t,J,q,"fromSpot"),t=t.L(),this.je(),this.$.pa=t,this.i("fromSpot",e,t),(e.isSide()||t.isSide())&&null!==(e=this.fromNode)&&e.Se(this.fromPort),this.invalidateRoute())}get fromEndSegmentLength(){return null!==this.$?this.$.wa:NaN}set fromEndSegmentLength(t){var e=this.fromEndSegmentLength;e!==t&&(Yt,Xt.t(t,"number",q,"fromEndSegmentLength"),t<0&&Xt.G(t,">= 0",q,"fromEndSegmentLength"),this.je(),this.$.wa=t,this.i("fromEndSegmentLength",e,t),this.invalidateRoute())}get fromShortLength(){return null!==this.$?this.$.ba:NaN}set fromShortLength(t){var e=this.fromShortLength;e!==t&&(Yt,Xt.t(t,"number",q,"fromShortLength"),this.je(),this.$.ba=t,this.fe(),this.i("fromShortLength",e,t))}get toSpot(){return null!==this.$?this.$.ya:J.Default}set toSpot(t){var e=this.toSpot;e.equals(t)||(Yt,Xt.s(t,J,q,"toSpot"),t=t.L(),this.je(),this.$.ya=t,this.i("toSpot",e,t),(e.isSide()||t.isSide())&&null!==(e=this.toNode)&&e.Se(this.toPort),this.invalidateRoute())}get toEndSegmentLength(){return null!==this.$?this.$.xa:NaN}set toEndSegmentLength(t){var e=this.toEndSegmentLength;e!==t&&(Yt,Xt.t(t,"number",q,"toEndSegmentLength"),t<0&&Xt.G(t,">= 0",q,"toEndSegmentLength"),this.je(),this.$.xa=t,this.i("toEndSegmentLength",e,t),this.invalidateRoute())}get toShortLength(){return null!==this.$?this.$.ka:NaN}set toShortLength(t){var e=this.toShortLength;e!==t&&(Yt,Xt.t(t,"number",q,"toShortLength"),this.je(),this.$.ka=t,this.fe(),this.i("toShortLength",e,t))}Ed(){var t=this.fromNode,e=this.toNode;let i=null;if(i=null!==t?null!==e?t.findCommonContainingGroup(e):t.containingGroup:null!==e?e.containingGroup:null,this.ZI(i),this.isLabeledLink)for(var s=this.labelNodes;s.next();)s.value.containingGroup=i}ZI(e){var i=this.kh;if(i!==e){null!==i&&i.Z2(this),null!==(this.kh=e)&&e.$2(this);var s=this.containingGroupChanged;if(null!==s){let t=!0;var n=this.diagram;null!==n&&(t=n.W,n.W=!0),s(this,i,e),null!==n&&(n.W=t)}!this.Re||this.oN!==i&&this.rN!==i||this.invalidateRoute()}}mh(){var t=this.containingGroup;null!==t&&this.fromNode!==t&&this.toNode!==t&&t.computesBoundsIncludingLinks&&super.mh()}getOtherNode(t){Yt,Xt.s(t,D,q,"getOtherNode:node");var e=this.fromNode;return t===e?this.toNode:e}getOtherPort(t){Yt,Xt.s(t,y,q,"getOtherPort:port");var e=this.fromPort;return t===e?this.toPort:e}get isLabeledLink(){return null!==this.Qs&&0<this.Qs.count}get labelNodes(){return null===this.Qs?o.instance:this.Qs.iterator}eT(t){null===this.Qs&&(this.Qs=new C),this.Qs.add(t),this.u()}sT(t){null!==this.Qs&&(this.Qs.remove(t),this.u())}vm(e){if(super.vm(e),this.Ya()&&this.invalidateOtherJumpOvers(this.actualBounds),!e){e=this.mo;let t=null;null!==e&&(t=this.fromPort,e.wb(this,t));var i,s=this.yo;null!==s&&(i=this.toPort,s!==e||i!==t)&&s.wb(this,i),this.Py()}}qm(e){if(super.qm(e),this.Ya()&&this.invalidateOtherJumpOvers(this.actualBounds),!e){e=this.mo;let t=null;null!==e&&(t=this.fromPort,e.xb(this,t));var i,s=this.yo;null!==s&&(i=this.toPort,s!==e||i!==t)&&s.xb(this,i),this.My()}}Wf(){if(this.Re=!0,null!==this.Qs){var t=this.diagram;if(null!==t)for(var e=this.Qs.copy().iterator;e.next();){var i=e.value;t.remove(i)}}var s;null!==this.data&&null!==(s=this.diagram)&&s.partManager.fN(this)}updateRelationshipsFromData(){var t;null!==this.data&&null!==(t=this.diagram)&&t.partManager.updateRelationshipsFromData(this)}move(t,e){var i=e?this.location:this.position;let s=i.x,n=(isNaN(s)&&(s=0),i.y);isNaN(n)&&(n=0);for(var r=t.x-s,a=t.y-n,o=(!0===e?super.move(t,!1):(e=U.H(i.x+r,i.y+a),super.move(e,!1),U.o(e)),this.Mr(r,a),this.labelNodes);o.next();){var h=o.value,l=h.position;h.moveTo(l.x+r,l.y+a)}}get relinkableFrom(){return 0!=(1&this.Dt)}set relinkableFrom(t){var e=0!=(1&this.Dt);e!==t&&(Yt,Xt.t(t,"boolean",q,"relinkableFrom"),this.Dt=1^this.Dt,this.i("relinkableFrom",e,t),this.invalidateAdornments())}get relinkableTo(){return 0!=(2&this.Dt)}set relinkableTo(t){var e=0!=(2&this.Dt);e!==t&&(Yt,Xt.t(t,"boolean",q,"relinkableTo"),this.Dt=2^this.Dt,this.i("relinkableTo",e,t),this.invalidateAdornments())}canRelinkFrom(){var t;return!(!this.relinkableFrom||null!==(t=this.layer)&&(!t.allowRelink||null!==(t=t.diagram)&&!t.allowRelink))}canRelinkTo(){var t;return!(!this.relinkableTo||null!==(t=this.layer)&&(!t.allowRelink||null!==(t=t.diagram)&&!t.allowRelink))}get resegmentable(){return 0!=(4&this.Dt)}set resegmentable(t){var e=0!=(4&this.Dt);e!==t&&(Yt,Xt.t(t,"boolean",q,"resegmentable"),this.Dt=4^this.Dt,this.i("resegmentable",e,t),this.invalidateAdornments())}get isTreeLink(){return 0!=(8&this.Dt)}set isTreeLink(t){var e=0!=(8&this.Dt);e!==t&&(Yt,Xt.t(t,"boolean",q,"isTreeLink"),this.Dt=8^this.Dt,this.i("isTreeLink",e,t),null!==this.fromNode&&this.fromNode.x0(),null!==this.toNode)&&this.toNode.x0()}get path(){var t=this.findMainElement();return t instanceof V?t:null}get routeBounds(){return this.updateRoute(),this.$I(this.Ac)}$I(i){let s=1/0,n=1/0;var r=this.pointsCount;if(0===r)i.e(NaN,NaN,0,0);else{if(1===r){var t=this.getPoint(0);s=Math.min(t.x,s),n=Math.min(t.y,n),i.e(t.x,t.y,0,0)}else if(2===r){var t=this.getPoint(0),a=this.getPoint(1);s=Math.min(t.x,a.x),n=Math.min(t.y,a.y),i.e(t.x,t.y,0,0),i.unionPoint(a)}else if(9===this.computeCurve()&&3<=r&&!this.isOrthogonal){let e=this.getPoint(0);if(s=e.x,n=e.y,i.e(s,n,0,0),3===r){t=this.getPoint(1),a=(s=Math.min(t.x,s),n=Math.min(t.y,n),this.getPoint(2));s=Math.min(a.x,s),n=Math.min(a.y,n),I.gu(e.x,e.y,t.x,t.y,t.x,t.y,a.x,a.y,.5,i)}else for(let t=3;t<r;t+=3){var o=this.getPoint(t-2),h=(t+3>=r&&(t=r-1),this.getPoint(t-1)),l=this.getPoint(t);I.gu(e.x,e.y,o.x,o.y,h.x,h.y,l.x,l.y,.5,i),s=Math.min(l.x,s),n=Math.min(l.y,n),e=l}}else{t=this.getPoint(0),a=this.getPoint(1);s=Math.min(t.x,a.x),n=Math.min(t.y,a.y),i.e(t.x,t.y,0,0),i.unionPoint(a);for(let t=2;t<r;t++){var e=this.getPoint(t);s=Math.min(e.x,s),n=Math.min(e.y,n),i.unionPoint(e)}}this.bb.e(s-i.x,n-i.y)}return i}get midPoint(){return this.updateRoute(),this.computeMidPoint(new U)}wL(t){return this.updateRoute(),this.computeMidPoint(t)}computeMidPoint(s){var n=this.pointsCount;if(0===n)s.c(U.Ek);else if(1===n)s.c(this.getPoint(0));else if(2===n)l=this.getPoint(0),d=this.getPoint(1),s.e((l.x+d.x)/2,(l.y+d.y)/2);else if(this.isOrthogonal&&(15<=this.computeCorner()||9===this.computeCurve()))this.yt.getPointAlongPath(.5,s),s.add(this.getPoint(0)),l=this.yt.figures.first(),s.offset(-l.startX,-l.startY);else if(9===this.computeCurve())3===n?(d=this.getPoint(0),l=this.getPoint(1),u=this.getPoint(2),I.mC(d.x,d.y,l.x,l.y,l.x,l.y,u.x,u.y,s)):(l=3*((d=(n-1)/3|0)/2|0),d%2==1?(u=this.getPoint(l),d=this.getPoint(1+l),o=this.getPoint(2+l),h=this.getPoint(3+l),I.mC(u.x,u.y,d.x,d.y,o.x,o.y,h.x,h.y,s)):s.c(this.getPoint(l)));else{var r=this.flattenedLengths,a=this.flattenedTotalLength;let t=0,e=0,i=0;for(;t<a/2&&e<n&&(i=r[e],!(t+i>a/2));)t+=i,e++;var o,h,l,u=this.getPoint(e),d=this.getPoint(e+1);Math.abs(u.x-d.x)<1?u.y>d.y?s.e(u.x,u.y-(a/2-t)):s.e(u.x,u.y+(a/2-t)):Math.abs(u.y-d.y)<1?u.x>d.x?s.e(u.x-(a/2-t),u.y):s.e(u.x+(a/2-t),u.y):(h=(o=(a/2-t)/i)*(d.x-u.x),l=o*(d.y-u.y),s.e(u.x+h,u.y+l))}return s}get midAngle(){return this.updateRoute(),this.computeMidAngle()}computeMidAngle(){var e=this.pointsCount;if(e<2)return NaN;if(2===e)return i=this.getPoint(0),o=this.getPoint(1),i.directionPoint(o);if(this.isOrthogonal&&(15<=this.computeCorner()||9===this.computeCurve()))return this.yt.getAngleAlongPath(.5);if(9===this.computeCurve()&&4<=e){var i=(e-1)/3|0;let t=3*(i/2|0);if(i%2==1)return t=Math.floor(t),o=this.getPoint(t),i=this.getPoint(t+1),h=this.getPoint(t+2),l=this.getPoint(t+3),I.ED(o.x,o.y,i.x,i.y,h.x,h.y,l.x,l.y);if(0<t&&t+1<e)return o=this.getPoint(t-1),i=this.getPoint(t+1),o.directionPoint(i)}var t=this.flattenedLengths,s=this.flattenedTotalLength;let n=0,r=0,a=0;for(;n<s/2&&r<e&&(a=t[r],!(n+a>s/2));)n+=a,r++;var o,h=this.getPoint(r),l=this.getPoint(r+1);if(Math.abs(h.x-l.x)<1&&Math.abs(h.y-l.y)<1){if(0<r&&r+2<e)return o=this.getPoint(r-1),i=this.getPoint(r+2),o.directionPoint(i)}else{if(Math.abs(h.x-l.x)<1)return h.y>l.y?270:90;if(Math.abs(h.y-l.y)<1)return h.x>l.x?180:0}return h.directionPoint(l)}QI(){var t;null===this.Sy&&(this.Re||this.Sb(),t=this.Sy=[],this._I(t))}get flattenedLengths(){return this.QI(),this.Sy}get flattenedTotalLength(){let e=this.kb;if(isNaN(e)){var i=this.flattenedLengths,s=i.length;for(let t=e=0;t<s;t++)e+=i[t];this.kb=e}return e}_I(i){var t=this.pointsCount;for(let e=0;e<t-1;e++){let t=0;var s=this.getPoint(e),n=this.getPoint(e+1);I.q(s.x,n.x)?(t=n.y-s.y)<0&&(t=-t):I.q(s.y,n.y)?(t=n.x-s.x)<0&&(t=-t):t=Math.sqrt(s.distanceSquaredPoint(n)),i.push(t)}}get points(){return this.Ci}set points(t){var e=this.Ci;if(e!==t){let i=null;if(Array.isArray(t)){var s=t;let e=s.length%2==0;if(e)for(let t=0;t<s.length;t++)if("number"!=typeof s[t]||isNaN(s[t])){e=!1;break}if(e){i=new O;for(let t=0;t<s.length/2;t++){var n=new U(s[2*t],s[2*t+1]).w();i.add(n)}}else{let e=!0;for(let t=0;t<s.length;t++){var r=s[t];if(!Xt.Mt(r)||"number"!=typeof r.x||isNaN(r.x)||"number"!=typeof r.y||isNaN(r.y)){e=!1;break}}if(e){i=new O;for(let t=0;t<s.length;t++){var a=s[t];i.add(new U(a.x,a.y).w())}}else Yt,Xt.n("Link.points array must contain only an even number of numbers or objects with x and y properties, not: "+t)}}else if(t instanceof O)for(var o=(i=t.copy()).iterator;o.next();)o.value.w();else Xt.n("Link.points value is not an instance of List or Array: "+t);i.w(),this.Ci=i,this.fe(),this.Sb();t=this.diagram;null!==t&&(t.Uh||t.undoManager.isUndoingRedoing||t.Mx.add(this),t.animationManager.Mi)&&t.animationManager.VM(this,i),this.i("points",e,i)}}get pointsCount(){return this.Ci.count}getPoint(t){return this.Ci.h[t]}setPoint(t,e){Yt,Xt.s(e,U,q,"setPoint"),e.isReal()||Xt.n("Link.setPoint called with a Point that does not have real numbers: "+e.toString()),Yt,null===this.Ve&&Xt.n("Call Link.startRoute before modifying the points of the route."),this.Ci.setElt(t,e)}setPointAt(t,e,i){Yt,Xt.r(e,q,"setPointAt:x"),Xt.r(i,q,"setPointAt:y"),Yt,null===this.Ve&&Xt.n("Call Link.startRoute before modifying the points of the route."),this.Ci.setElt(t,new U(e,i))}insertPoint(t,e){Yt,Xt.s(e,U,q,"insertPoint"),e.isReal()||Xt.n("Link.insertPoint called with a Point that does not have real numbers: "+e.toString()),Yt,null===this.Ve&&Xt.n("Call Link.startRoute before modifying the points of the route."),this.Ci.insertAt(t,e)}insertPointAt(t,e,i){Yt,Xt.r(e,q,"insertPointAt:x"),Xt.r(i,q,"insertPointAt:y"),Yt,null===this.Ve&&Xt.n("Call Link.startRoute before modifying the points of the route."),this.Ci.insertAt(t,new U(e,i))}addPoint(t){Yt,Xt.s(t,U,q,"addPoint"),t.isReal()||Xt.n("Link.addPoint called with a Point that does not have real numbers: "+t.toString()),Yt,null===this.Ve&&Xt.n("Call Link.startRoute before modifying the points of the route."),this.Ci.add(t)}addPointAt(t,e){Yt,Xt.r(t,q,"insertPointAt:x"),Xt.r(e,q,"insertPointAt:y"),Yt,null===this.Ve&&Xt.n("Call Link.startRoute before modifying the points of the route."),this.Ci.add(new U(t,e))}removePoint(t){Yt,null===this.Ve&&Xt.n("Call Link.startRoute before modifying the points of the route."),this.Ci.removeAt(t)}clearPoints(){Yt,null===this.Ve&&Xt.n("Call Link.startRoute before modifying the points of the route."),this.Ci.clear()}Mr(t,e){if(0!==t||0!==e)if(0===this.pointsCount)this.defaultFromPoint&&this.defaultFromPoint.offset(t,e),this.defaultToPoint&&this.defaultToPoint.offset(t,e);else{for(var i=this.Re,s=new O,n=this.Ci.iterator;n.next();){var r=n.value;s.add(new U(r.x+t,r.y+e).w())}s.w();var a=this.Ci,o=(this.Ci=s,this.diagram);isNaN(t)||isNaN(e)||null!==o&&o.animationManager.Mi?this.u():(this.$s.e(this.$s.x+t,this.$s.y+e),this.lt.e(this.lt.x+t,this.lt.y+e),this.rc()),i?this.Sb():(this.defaultFromPoint&&(this.defaultFromPoint=this.getPoint(0)),this.defaultToPoint&&(this.defaultToPoint=this.getPoint(this.pointsCount-1))),null!==o&&o.animationManager.Mi&&o.animationManager.VM(this,s),this.i("points",a,s)}}startRoute(){null===this.Ve&&(this.Ve=this.Ci,this.Ci=this.Ci.copy())}commitRoute(){if(null!==this.Ve){var t=this.Ve,r=this.Ci;let e=1/0,i=1/0;var a=t.h,o=a.length;for(let t=0;t<o;t++){var h=a[t];e=Math.min(h.x,e),i=Math.min(h.y,i)}let s=1/0,n=1/0;var l=r.h,u=l.length;for(let t=0;t<u;t++){var d=l[t];s=Math.min(d.x,s),n=Math.min(d.y,n),d.w()}if(r.w(),u===o)for(let t=0;t<u;t++){var c=a[t],g=l[t];if(c.x-e!=g.x-s||c.y-i!=g.y-n){this.fe();break}}else this.fe();this.Ve=null;var m=this.diagram;null!==m&&m.animationManager.Mi&&m.animationManager.VM(this,r),this.Sb(),this.i("points",t,r)}}rollbackRoute(){null!==this.Ve&&(this.Ci=this.Ve,this.Ve=null)}xF(){null!==this.Dr&&(this.points=this.Dr,this.Dr=null)}Sb(){0===this.Ci.count?this.Re=!1:(this.Re=!0,this.Sy=null,this.kb=NaN,this.defaultFromPoint=this.getPoint(0),this.defaultToPoint=this.getPoint(this.pointsCount-1),this.Mb(!1))}invalidateRoute(){if(!this.wn){var t=this.path;if(null!==t){var e=this.diagram;if(e){if(e.Mx.contains(this)||e.undoManager.isUndoingRedoing)return;e=e.animationManager;if(e.isTicking&&!e.isAnimating)return;null===this.Dr||e.isTicking||(this.Dr=null)}this.Re=!1,this.u(),t.u()}}}get Re(){return 0!=(16&this.Dt)}set Re(t){0!=(16&this.Dt)!==t&&(this.Dt=16^this.Dt)}get wn(){return 0!=(32&this.Dt)}set wn(t){0!=(32&this.Dt)!==t&&(this.Dt=32^this.Dt)}get Ny(){return 0!=(64&this.Dt)}set Ny(t){0!=(64&this.Dt)!==t&&(this.Dt=64^this.Dt)}get cN(){return 0!=(512&this.Dt)}set cN(t){0!=(512&this.Dt)!==t&&(this.Dt=512^this.Dt)}get defaultFromPoint(){return this.sN}set defaultFromPoint(t){this.sN=t.copy()}get defaultToPoint(){return this.nN}set defaultToPoint(t){this.nN=t.copy()}updateRoute(){if(!this.Re&&!this.Ny){let t=!0;try{this.Ny=!0,this.startRoute(),t=this.computePoints()}catch{this.Ny=!1,this.rollbackRoute()}finally{this.Ny=!1,t?this.commitRoute():this.rollbackRoute()}}}computePoints(){var t=this.diagram;if(null===t)return!1;let h=this.fromNode,l=null;if(null===h?(q.Ba||(q.Ba=new D,q.Ba.desiredSize=qt.lf,q.Ba.ensureBounds()),this.defaultFromPoint&&(q.Ba.location=this.defaultFromPoint,q.Ba.ensureBounds(),h=q.Ba,l=q.Ba)):l=this.fromPort,null===l||h.isVisible()||(null!==(c=h.findVisibleNode())&&c!==h?(h=c,l=c.port):h=c),null===(this.oN=h)||!h.location.isReal()||null===(l=h.findVisiblePort(l)))return!1;let u=this.toNode,d=null;if(null===u?(q.za||(q.za=new D,q.za.desiredSize=qt.lf,q.za.ensureBounds()),this.defaultToPoint&&(q.za.location=this.defaultToPoint,q.za.ensureBounds(),u=q.za,d=q.za)):d=this.toPort,null===d||u.isVisible()||(null!==(c=u.findVisibleNode())&&c!==u?(u=c,d=c.port):u=c),null===(this.rN=u)||!u.location.isReal()||null===(d=u.findVisiblePort(d)))return!1;var c=this.pointsCount,g=this.computeSpot(!0,l),m=this.computeSpot(!1,d),f=this.Gd(g),p=this.Gd(m),v=l===d&&null!==l,y=this.isOrthogonal;let e=9===this.curve;v&&!y?(e=!0,this.sr=!0):this.sr=!1;var x=0===this.computeAdjusting()||v;if(!y&&!v&&f&&p){let t=!1;!x&&3<=c&&(A=this.getLinkPoint(h,l,g,!0,!1,u,d),w=this.getLinkPoint(u,d,m,!1,!1,h,l),t=this.adjustPoints(0,A,c-1,w))&&(A=this.getLinkPoint(h,l,g,!0,!1,u,d),w=this.getLinkPoint(u,d,m,!1,!1,h,l),this.adjustPoints(0,A,c-1,w)),t||(this.clearPoints(),e?this.tO(h,l,g,u,d,m):this.iO(h,l,g,u,d,m))}else{var A=this.isAvoiding,w=(x&&(y&&A||v)&&this.clearPoints(),v?this.computeCurviness():0),A=this.getLinkPoint(h,l,g,!0,y,u,d);let e=0,i=0,s=0;if(y||!f||v){let t=this.computeEndSegmentLength(h,l,g,!0);s=this.getLinkDirection(h,l,A,g,!0,y,u,d),v&&(f||g.equals(m)||!y&&g.x+m.x===1&&g.y+m.y===1)&&(s-=y?90:30,w<0)&&(s-=180),s<0?s+=360:360<=s&&(s-=360),v&&(t+=Math.abs(w)*(y?1:2)),0===s?e=t:90===s?i=t:180===s?e=-t:i=270===s?-t:(e=t*Math.cos(s*Math.PI/180),t*Math.sin(s*Math.PI/180)),g.isNoSpot()&&v&&(P=l.getDocumentPoint(J.Center,U.a()),b=U.H(P.x+1e3*e,P.y+1e3*i),this.getLinkPointFromPoint(h,l,P,b,!0,A),U.o(P),U.o(b))}var b,P=this.getLinkPoint(u,d,m,!1,y,h,l);let n=0,r=0,a=0;if(y||!p||v){let t=this.computeEndSegmentLength(u,d,m,!1);a=this.getLinkDirection(u,d,P,m,!1,y,h,l),v&&(p||g.equals(m)||!y&&g.x+m.x===1&&g.y+m.y===1)&&(a+=y?0:30,w<0)&&(a+=180),a<0?a+=360:360<=a&&(a-=360),v&&(t+=Math.abs(w)*(y?1:2)),0===a?n=t:90===a?r=t:180===a?n=-t:r=270===a?-t:(n=t*Math.cos(a*Math.PI/180),t*Math.sin(a*Math.PI/180)),m.isNoSpot()&&v&&(b=d.getDocumentPoint(J.Center,U.a()),g=U.H(b.x+1e3*n,b.y+1e3*r),this.getLinkPointFromPoint(u,d,b,g,!1,P),U.o(b),U.o(g))}let t=A,o=(!y&&f&&!v||(t=new U(A.x+e,A.y+i)),P);!y&&p&&!v||(o=new U(P.x+n,P.y+r)),!x&&!y&&f&&3<c&&this.adjustPoints(0,A,c-2,o)?this.setPoint(c-1,P):!x&&!y&&p&&3<c&&this.adjustPoints(1,t,c-1,P)?this.setPoint(0,A):!x&&(y?6<=c:4<c)&&this.adjustPoints(1,t,c-2,o)?(this.setPoint(0,A),this.setPoint(c-1,P)):(this.clearPoints(),this.addPoint(A),!y&&f&&!v||this.addPoint(t),y&&this.addOrthoPoints(t,s,o,a,h,u),!y&&p&&!v||this.addPoint(o),this.addPoint(P))}return t.addInvalidRoute(this),!0}uN(t,e){return Math.abs(e.x-t.x)>Math.abs(e.y-t.y)?(e.x>=t.x?e.x=t.x+9e9:e.x=t.x-9e9,e.y=t.y):(e.y>=t.y?e.y=t.y+9e9:e.y=t.y-9e9,e.x=t.x),e}getLinkPointFromPoint(a,o,h,l,t,u){if(void 0===u&&(u=new U),null===a||null===o)u.c(h);else{var d,c,g,m,f;a.isVisible()||null!==(f=a.findVisibleNode())&&f!==a&&(o=(a=f).port);let t=0,e=0,i=0,s=0,n=null,r=o.panel;s=null===(r=null===r||r.Mn()?r:r.panel)?(t=l.x,e=l.y,i=h.x,h.y):(f=1/((n=r.Ms).m11*n.m22-n.m12*n.m21),a=n.m22*f,d=-n.m12*f,c=-n.m21*f,g=n.m11*f,m=f*(n.m21*n.dy-n.m22*n.dx),f=f*(n.m12*n.dx-n.m11*n.dy),t=l.x*a+l.y*c+m,e=l.x*d+l.y*g+f,i=h.x*a+h.y*c+m,h.x*d+h.y*g+f),o.ec(t,e,i,s,u),null!==n&&u.D(n)}return u}eO(t,e){t=t.nd;return null!==t?t.hT(e):null}Pb(t){let e=t.nd;return null===e&&((e=new ze).or=t,e.be=t.part,t.nd=e),e.hT(this)}getLinkPoint(e,i,s,n,r,a,o,h){if(void 0===h&&(h=new U),s.isSpot()&&!this.Gd(s))i.getDocumentPoint(s,h);else{if(s.isSide()){var l,u=this.Pb(i);if(null!==u)return l=u.Hd,h.c(l),r&&7===this.routing&&null!==(l=this.Pb(o))&&u.Lc<l.Lc&&(u=U.a(),l=U.a(),d=new Z(i.getDocumentPoint(J.TopLeft,u),i.getDocumentPoint(J.BottomRight,l)),c=this.computeSpot(!n,o),a=this.getLinkPoint(a,o,c,!n,r,e,i,l),(s.includesSide(J.LeftSide)||s.includesSide(J.RightSide))&&a.y>=d.y&&a.y<=d.y+d.height?h.y=a.y:(s.includesSide(J.TopSide)||s.includesSide(J.BottomSide))&&a.x>=d.x&&a.x<=d.x+d.width&&(h.x=a.x),U.o(u),U.o(l)),h}var d,c=i.getDocumentPoint(this.Nb(s,n),U.a());let t=null;this.pointsCount>(r?6:2)?(t=n?this.getPoint(1):this.getPoint(this.pointsCount-2),r&&(t=this.uN(c,t.copy()))):(d=this.computeSpot(!n,o),a=U.a(),t=o.getDocumentPoint(this.Nb(d,!n),a),r&&(t=this.uN(c,t)),U.o(a)),this.getLinkPointFromPoint(e,i,c,t,n,h),U.o(c)}return h}getLinkDirection(t,e,i,s,n,r,a,o){let h=this.sO(t,e,i,s,n,r,a,o);return a&&s.isNoSpot()&&a.isMemberOf(t)&&360<=(h+=180)&&(h-=360),this.Gd(s)||0!==(i=e.getDocumentAngle())&&(45<=i&&i<135?h+=90:135<=i&&i<225?h+=180:225<=i&&i<315&&(h+=270),360<=h)&&(h-=360),h}sO(t,e,i,s,n,r,a,o){if(s.isSpot())return s.x>s.y?s.x>1-s.y?0:s.x<1-s.y?270:315:s.x<s.y?s.x>1-s.y?90:s.x<1-s.y?180:135:s.x<.5?225:.5<s.x?45:0;if(s.isSide()){s=this.Pb(e);if(null!==s)switch(s.Me){case 1:return 270;case 2:return 180;default:case 4:return 0;case 8:return 90}}s=e.getDocumentPoint(J.Center,U.a());let h=null,l=(this.pointsCount>(r?6:2)?(h=n?this.getPoint(1):this.getPoint(this.pointsCount-2),h=r?this.uN(s,h.copy()):i):(e=U.a(),h=o.getDocumentPoint(J.Center,e),U.o(e)),0);return l=Math.abs(h.x-s.x)>Math.abs(h.y-s.y)?h.x>=s.x?0:180:h.y>=s.y?90:270,U.o(s),l}computeEndSegmentLength(t,e,i,s){if(null!==e&&i.isSide()){i=this.Pb(e);if(null!==i)return i.Cb}let n=NaN;return n=s?this.fromEndSegmentLength:this.toEndSegmentLength,null!==e&&isNaN(n)&&(n=s?e.fromEndSegmentLength:e.toEndSegmentLength),n=isNaN(n)?10:n}computeSpot(t,e){return void 0===e&&(e=null),t?this.nO(e||this.fromPort):this.oO(e||this.toPort)}nO(t){if(null===t)return J.Center;let e=this.fromSpot;return(e=e.isDefault()?t.fromSpot:e)===J.Default?J.None:e}oO(t){if(null===t)return J.Center;let e=this.toSpot;return(e=e.isDefault()?t.toSpot:e)===J.Default?J.None:e}Gd(t){return t===J.None||.5===t.x&&.5===t.y}Nb(t,e){return.5===t.x&&.5===t.y?t:J.Center}computeOtherPoint(t,e){var i;return 0!==this.computeAdjusting()&&4<this.pointsCount?this.computeMidPoint(new U):null!==(i=this.eO(e,this))?i.Hd:e.getDocumentPoint(J.Center)}computeShortLength(e){if(e){let t=this.fromShortLength;return isNaN(t)&&null!==(e=this.fromPort)&&(t=e.fromShortLength),isNaN(t)?0:t}{let t=this.toShortLength;return isNaN(t)&&null!==(e=this.toPort)&&(t=e.toShortLength),isNaN(t)?0:t}}Um(s,n,r,a,o,t){if(!1!==this.pickable){void 0===n&&(n=null),void 0===r&&(r=null);let i=t;if(void 0===t&&(i=H.a()).ti(),i.hf(this.D),this.containedInRect(s,i))return this.V2(n,r,o),void 0===t&&H.o(i),!0;if(this.intersectsRect(s,i)){let e=!1;if(!this.dc){var h=this.F.h;for(let t=h.length;t--;){var l=h[t];if(l.visible||l===this.locationObject){var u=l.actualBounds,d=this.naturalBounds;if(!(u.x>d.width||u.y>d.height||u.x+u.width<0||u.y+u.height<0)){d=l,u=H.a();if(u.set(i),d instanceof jt?e=d.Um(s,n,r,a,o,u):this.path===d?d instanceof V&&(e=d.AI(s,a,u)):e=d.eL(s,a,u),e){let t=d;(t=null!==n?n(d):t)&&(null===r||r(t))&&o.add(t)}H.o(u)}}}}return void 0===t&&H.o(i),e||null!==this.background}void 0===t&&H.o(i)}return!1}get isOrthogonal(){return 2==(2&this.Va)}static aN(t){return 2==(2&t)}get isAvoiding(){return 4==(4&this.Va)}computeCurve(){var t,e;return null===this.sr&&(t=null!==(t=this.fromPort)&&t===this.toPort,e=this.isOrthogonal,this.sr=t&&!e),this.sr?9:this.curve}computeCorner(){if(9===this.curve)return 0;let t=this.corner;return t=isNaN(t)||t<0?10:t}findMidLabel(){var e=this.path,i=this.F.h,s=i.length;for(let t=0;t<s;t++){var n=i[t];if(n!==e&&!n.isPanelMain&&(n.segmentIndex===-1/0||isNaN(n.segmentIndex)))return n}for(var t=this.labelNodes;t.next();){var r=t.value;if(r.segmentIndex===-1/0||isNaN(r.segmentIndex))return r}return null}computeSpacing(){if(!this.isVisible())return 0;let t=q.JI;t=Math.max(t,this.computeThickness());var e,i,s,n,r=this.fromPort,a=this.toPort;return null!==r&&null!==a&&null!==(n=this.findMidLabel())&&(i=n.naturalBounds,s=n.margin,e=isNaN(i.width)?30:i.width*n.scale+s.left+s.right,i=isNaN(i.height)?14:i.height*n.scale+s.top+s.bottom,s=n.segmentOrientation,t=21===s||25===s||24===s?Math.max(t,i):23===s||27===s||22===s||26===s?Math.max(t,e):(n=r.getDocumentPoint(J.Center).directionPoint(a.getDocumentPoint(J.Center))/180*Math.PI,Math.max(t,Math.abs(Math.sin(n)*e)+Math.abs(Math.cos(n)*i)+1)),9===this.curve)&&(t*=1.333),t}arrangeBundledLinks(e,t){if(t)for(let t=0;t<e.length;t++){var i=e[t];0===i.computeAdjusting()&&i.invalidateRoute()}}computeCurviness(){let s=this.curviness;if(isNaN(s)){s=q.jI;var t=this.nr;if(null!==t){var n=Xt.ct();let e=0;var r=t._s;for(let t=0;t<r.length;t++){var a=r[t].computeSpacing();n.push(a),e+=a}let i=-e/2;for(let t=0;t<r.length;t++){if(r[t]===this){s=i+n[t]/2;break}i+=n[t]}t.uy===this.fromNode&&(s=-s),Xt.ot(n)}}return s}computeThickness(){var t;return this.isVisible()?null!==(t=this.path)?Math.max(t.strokeWidth,1):1:0}hasCurviness(){return!isNaN(this.curviness)||null!==this.nr}iO(t,e,i,s,n,r){var a=this.getLinkPoint(t,e,i,!0,!1,s,n),o=this.getLinkPoint(s,n,r,!1,!1,t,e);if(this.hasCurviness()){var h=o.x-a.x,l=o.y-a.y,u=this.computeCurviness(),d=u,c=a.x+h/2,g=a.y+l/2;let e=c,i=g;if(I.p(l,0))0<h?i-=d:i+=d;else{h=-h/l;let t=Math.sqrt(d*d/(h*h+1));u<0&&(t=-t),e=(l<0?-1:1)*t+c,i=h*(e-c)+g}this.addPoint(a),this.addPointAt(e,i),this.addPoint(o)}else{this.addPoint(a),this.addPoint(o);d=Z.a(),u=(e.getDocumentBounds(d),d.containsPoint(o)),l=(n.getDocumentBounds(d),d.containsPoint(a));(u||l)&&(h=e.getDocumentPoint(this.Nb(i,!0),new U),this.setPoint(0,this.getLinkPointFromPoint(t,e,h,o,!0,h)),c=n.getDocumentPoint(this.Nb(r,!1),new U),this.setPoint(1,this.getLinkPointFromPoint(s,n,c,a,!1,c))),Z.o(d)}}tO(t,e,i,s,n,r){var a=this.getLinkPoint(t,e,i,!0,!1,s,n),o=this.getLinkPoint(s,n,r,!1,!1,t,e),h=o.x-a.x,l=o.y-a.y,u=this.computeCurviness();let d=0,c=0,g=a.x+h/3,m=a.y+l/3,f=g,p=m,v=(I.p(l,0)?0<h?p-=u:p+=u:(d=-h/l,c=Math.sqrt(u*u/(d*d+1)),u<0&&(c=-c),f=(l<0?-1:1)*c+g,p=d*(f-g)+m),g=a.x+2*h/3),y=m=a.y+2*l/3;I.p(l,0)?0<h?y-=u:y+=u:(v=(l<0?-1:1)*c+g,y=d*(v-g)+m),this.clearPoints(),this.addPoint(a),this.addPointAt(f,p),this.addPointAt(v,y),this.addPoint(o),this.setPoint(0,this.getLinkPoint(t,e,i,!0,!1,s,n)),this.setPoint(3,this.getLinkPoint(s,n,r,!1,!1,t,e))}adjustPoints(t,e,i,s){let n=this.computeAdjusting();if(this.isOrthogonal){if(18===n)return!1;19===n&&(n=17)}switch(n){case 18:return this.rO(t,e,i,s);case 19:return this.lO(t,e,i,s);case 17:return this.hO(t,e,i,s);default:return!1}}rO(n,r,a,o){var h=this.getPoint(n),l=this.getPoint(a);if(!h.equalsApprox(r)||!l.equalsApprox(o)){var u=h.x,d=h.y;let i=l.x-u,s=l.y-d;h=Math.sqrt(i*i+s*s);if(!I.q(h,0)){let t=0;I.q(i,0)?t=s<0?-Math.PI/2:Math.PI/2:(t=Math.atan(s/Math.abs(i)),i<0&&(t=Math.PI-t));var c=r.x,g=r.y,l=o.x-c,m=o.y-g,f=Math.sqrt(l*l+m*m);let e=0;I.q(l,0)?e=m<0?-Math.PI/2:Math.PI/2:(e=Math.atan(m/Math.abs(l)),l<0&&(e=Math.PI-e));var p=f/h,v=e-t;this.setPoint(n,r);for(let e=n+1;e<a;e++){var y=this.getPoint(e),y=(i=y.x-u,s=y.y-d,Math.sqrt(i*i+s*s));if(!I.q(y,0)){let t=0;I.q(i,0)?t=s<0?-Math.PI/2:Math.PI/2:(t=Math.atan(s/Math.abs(i)),i<0&&(t=Math.PI-t));var x=t+v,y=y*p,A=c+y*Math.cos(x),y=g+y*Math.sin(x);this.setPointAt(e,A,y)}}this.setPoint(a,o)}}return!0}lO(t,e,r,i){var a=this.getPoint(t),o=this.getPoint(r);if(!a.equalsApprox(e)||!o.equalsApprox(i)){var h=a.x,l=a.y,u=o.x,d=o.y,c=(u-h)*(u-h)+(d-l)*(d-l),g=e.x,m=e.y,f=i.x,p=i.y;let s=0,n=1;f-g!=0?(s=(p-m)/(f-g),n=Math.sqrt(1+1/(s*s))):s=9e9,this.setPoint(t,e);for(let i=t+1;i<r;i++){var v=this.getPoint(i),y=v.x,v=v.y;let t=.5;var x=h+(t=0!=c?((h-y)*(h-u)+(l-v)*(l-d))/c:t)*(u-h),A=l+t*(d-l);let e=Math.sqrt((y-x)*(y-x)+(v-A)*(v-A));v<s*(y-x)+A&&(e=-e),0<s&&(e=-e);v=g+t*(f-g),y=m+t*(p-m);0!==s?(A=y-((x=v+e/n)-v)/s,this.setPointAt(i,x,A)):this.setPointAt(i,v,y+e)}this.setPoint(r,i)}return!0}hO(o,h,l,u){if(this.isOrthogonal){let t=this.getPoint(o),e=this.getPoint(o+1),i=this.getPoint(o+2),s=e.x,n=e.y;var d=s,c=n;I.p(t.y,e.y)?I.p(e.x,i.x)?n=h.y:I.p(e.y,i.y)&&(s=h.x):I.p(t.x,e.x)&&(I.p(e.y,i.y)?s=h.x:I.p(e.x,i.x)&&(n=h.y)),this.setPointAt(o+1,s,n),t=this.getPoint(l),e=this.getPoint(l-1),i=this.getPoint(l-2);let r=e.x,a=e.y;var g=r,m=a;if(I.p(t.y,e.y)?I.p(e.x,i.x)?a=u.y:I.p(e.y,i.y)&&(r=u.x):I.p(t.x,e.x)&&(I.p(e.y,i.y)?r=u.x:I.p(e.x,i.x)&&(a=u.y)),this.setPointAt(l-1,r,a),this.FA())return this.setPointAt(o+1,d,c),this.setPointAt(l-1,g,m),!1}return this.setPoint(o,h),this.setPoint(l,u),!0}addOrthoPoints(t,e,i,s,n,r){e<0?e+=360:360<=e&&(e-=360),s<0?s+=360:360<=s&&(s-=360);var a=s,o=(e=315<=e||e<45?0:45<=e&&e<135?90:135<=e&&e<225?180:270,s=315<=s||s<45?0:45<=s&&s<135?90:135<=s&&s<225?180:270,t),h=i,n=n.actualBounds.copy(),r=r.actualBounds.copy();n.isReal()&&r.isReal()&&(n.inflate(q.Xa,q.Xa),r.inflate(q.Xa,q.Xa),n.unionPoint(t),r.unionPoint(i),t=U.a(),i=U.a(),0===e?h.x>o.x||270===s&&h.y<o.y&&r.right>o.x||90===s&&h.y>o.y&&r.right>o.x?(t.e(h.x,o.y),i.e(h.x,(o.y+h.y)/2),180===s?(t.x=this.computeMidOrthoPosition(o.x,o.y,h.x,h.y,!1),i.x=t.x,i.y=h.y):270===s&&h.y<o.y||90===s&&h.y>o.y?(o.x<r.left?t.x=this.computeMidOrthoPosition(o.x,o.y,r.left,h.y,!1):o.x<r.right&&(270===s&&o.y<r.top||90===s&&o.y>r.bottom)?t.x=this.computeMidOrthoPosition(o.x,o.y,h.x,h.y,!1):t.x=r.right,i.x=t.x,i.y=h.y):0===s&&o.x<r.left&&o.y>r.top&&o.y<r.bottom&&(t.x=o.x,o.y<h.y?t.y=Math.min(h.y,r.top):t.y=Math.max(h.y,r.bottom),i.y=t.y)):(t.e(o.x,h.y),i.e((o.x+h.x)/2,h.y),(180===s||90===s&&h.y<n.top||270===s&&h.y>n.bottom)&&(180===s&&(r.containsPoint(o)||n.containsPoint(h))?t.y=this.computeMidOrthoPosition(o.x,o.y,h.x,h.y,!0):h.y<o.y&&(180===s||90===s)?t.y=this.computeMidOrthoPosition(o.x,n.top,h.x,Math.max(h.y,r.bottom),!0):h.y>o.y&&(180===s||270===s)&&(t.y=this.computeMidOrthoPosition(o.x,n.bottom,h.x,Math.min(h.y,r.top),!0)),i.x=h.x,i.y=t.y),t.y>n.top&&t.y<n.bottom&&(h.x>=n.left&&h.x<=o.x||o.x<=r.right&&o.x>=h.x?90!==s&&270!==s||(t.e(Math.max((o.x+h.x)/2,o.x),o.y),i.e(t.x,h.y)):(270===s||(0===s||180===s)&&h.y<o.y?t.y=Math.min(h.y,0===s?n.top:Math.min(n.top,r.top)):t.y=Math.max(h.y,0===s?n.bottom:Math.max(n.bottom,r.bottom)),i.x=h.x,i.y=t.y))):180===e?h.x<o.x||270===s&&h.y<o.y&&r.left<o.x||90===s&&h.y>o.y&&r.left<o.x?(t.e(h.x,o.y),i.e(h.x,(o.y+h.y)/2),0===s?(t.x=this.computeMidOrthoPosition(o.x,o.y,h.x,h.y,!1),i.x=t.x,i.y=h.y):270===s&&h.y<o.y||90===s&&h.y>o.y?(o.x>r.right?t.x=this.computeMidOrthoPosition(o.x,o.y,r.right,h.y,!1):o.x>r.left&&(270===s&&o.y<r.top||90===s&&o.y>r.bottom)?t.x=this.computeMidOrthoPosition(o.x,o.y,h.x,h.y,!1):t.x=r.left,i.x=t.x,i.y=h.y):180===s&&o.x>r.right&&o.y>r.top&&o.y<r.bottom&&(t.x=o.x,o.y<h.y?t.y=Math.min(h.y,r.top):t.y=Math.max(h.y,r.bottom),i.y=t.y)):(t.e(o.x,h.y),i.e((o.x+h.x)/2,h.y),(0===s||90===s&&h.y<n.top||270===s&&h.y>n.bottom)&&(0===s&&(r.containsPoint(o)||n.containsPoint(h))?t.y=this.computeMidOrthoPosition(o.x,o.y,h.x,h.y,!0):h.y<o.y&&(0===s||90===s)?t.y=this.computeMidOrthoPosition(o.x,n.top,h.x,Math.max(h.y,r.bottom),!0):h.y>o.y&&(0===s||270===s)&&(t.y=this.computeMidOrthoPosition(o.x,n.bottom,h.x,Math.min(h.y,r.top),!0)),i.x=h.x,i.y=t.y),t.y>n.top&&t.y<n.bottom&&(h.x<=n.right&&h.x>=o.x||o.x>=r.left&&o.x<=h.x?90!==s&&270!==s||(t.e(Math.min((o.x+h.x)/2,o.x),o.y),i.e(t.x,h.y)):(270===s||(0===s||180===s)&&h.y<o.y?t.y=Math.min(h.y,180===s?n.top:Math.min(n.top,r.top)):t.y=Math.max(h.y,180===s?n.bottom:Math.max(n.bottom,r.bottom)),i.x=h.x,i.y=t.y))):90===e?h.y>o.y||180===s&&h.x<o.x&&r.bottom>o.y||0===s&&h.x>o.x&&r.bottom>o.y?(t.e(o.x,h.y),i.e((o.x+h.x)/2,h.y),270===s?(t.y=this.computeMidOrthoPosition(o.x,o.y,h.x,h.y,!0),i.x=h.x,i.y=t.y):180===s&&h.x<o.x||0===s&&h.x>o.x?(o.y<r.top?t.y=this.computeMidOrthoPosition(o.x,o.y,h.x,r.top,!0):o.y<r.bottom&&(180===s&&o.x<r.left||0===s&&o.x>r.right)?t.y=this.computeMidOrthoPosition(o.x,o.y,h.x,h.y,!0):t.y=r.bottom,i.x=h.x,i.y=t.y):90===s&&o.y<r.top&&o.x>r.left&&o.x<r.right&&(o.x<h.x?t.x=Math.min(h.x,r.left):t.x=Math.max(h.x,r.right),t.y=o.y,i.x=t.x)):(t.e(h.x,o.y),i.e(h.x,(o.y+h.y)/2),(270===s||0===s&&h.x<n.left||180===s&&h.x>n.right)&&(270===s&&(r.containsPoint(o)||n.containsPoint(h))?t.x=this.computeMidOrthoPosition(o.x,o.y,h.x,h.y,!1):h.x<o.x&&(270===s||0===s)?t.x=this.computeMidOrthoPosition(n.left,o.y,Math.max(h.x,r.right),h.y,!1):h.x>o.x&&(270===s||180===s)&&(t.x=this.computeMidOrthoPosition(n.right,o.y,Math.min(h.x,r.left),h.y,!1)),i.x=t.x,i.y=h.y),t.x>n.left&&t.x<n.right&&(h.y>=n.top&&h.y<=o.y||o.y<=r.bottom&&o.y>=h.y?0!==s&&180!==s||(t.e(o.x,Math.max((o.y+h.y)/2,o.y)),i.e(h.x,t.y)):(180===s||(90===s||270===s)&&h.x<o.x?t.x=Math.min(h.x,90===s?n.left:Math.min(n.left,r.left)):t.x=Math.max(h.x,90===s?n.right:Math.max(n.right,r.right)),i.x=t.x,i.y=h.y))):h.y<o.y||180===s&&h.x<o.x&&r.top<o.y||0===s&&h.x>o.x&&r.top<o.y?(t.e(o.x,h.y),i.e((o.x+h.x)/2,h.y),90===s?(t.y=this.computeMidOrthoPosition(o.x,o.y,h.x,h.y,!0),i.x=h.x,i.y=t.y):180===s&&h.x<o.x||0===s&&h.x>=o.x?(o.y>r.bottom?t.y=this.computeMidOrthoPosition(o.x,o.y,h.x,r.bottom,!0):o.y>r.top&&(180===s&&o.x<r.left||0===s&&o.x>r.right)?t.y=this.computeMidOrthoPosition(o.x,o.y,h.x,h.y,!0):t.y=r.top,i.x=h.x,i.y=t.y):270===s&&o.y>r.bottom&&o.x>r.left&&o.x<r.right&&(o.x<h.x?t.x=Math.min(h.x,r.left):t.x=Math.max(h.x,r.right),t.y=o.y,i.x=t.x)):(t.e(h.x,o.y),i.e(h.x,(o.y+h.y)/2),(90===s||0===s&&h.x<n.left||180===s&&h.x>n.right)&&(90===s&&(r.containsPoint(o)||n.containsPoint(h))?t.x=this.computeMidOrthoPosition(o.x,o.y,h.x,h.y,!1):h.x<o.x&&(90===s||0===s)?t.x=this.computeMidOrthoPosition(n.left,o.y,Math.max(h.x,r.right),h.y,!1):h.x>o.x&&(90===s||180===s)&&(t.x=this.computeMidOrthoPosition(n.right,o.y,Math.min(h.x,r.left),h.y,!1)),i.x=t.x,i.y=h.y),t.x>n.left&&t.x<n.right&&(h.y<=n.bottom&&h.y>=o.y||o.y>=r.top&&o.y<=h.y?0!==s&&180!==s||(t.e(o.x,Math.min((o.y+h.y)/2,o.y)),i.e(h.x,t.y)):(180===s||(90===s||270===s)&&h.x<o.x?t.x=Math.min(h.x,270===s?n.left:Math.min(n.left,r.left)):t.x=Math.max(h.x,270===s?n.right:Math.max(n.right,r.right)),i.x=t.x,i.y=h.y))),this.cN=s!==a,this.lN=e,this.hN=s,this.addPoint(t.copy()),this.addPoint(i.copy()),U.o(t),U.o(i))}computeMidOrthoPosition(t,e,i,s,n){let r=0;return!this.hasCurviness()||this.computeSpot(!0,this.fromPort).isSide()||this.computeSpot(!1,this.toPort).isSide()||(r=this.computeCurviness()),n?(e+s)/2+r:(t+i)/2+r}FA(){if(null!==this.diagram&&this.isAvoiding){var e=this.points.h,i=e.length;if(!(i<4)){var s=this.diagram.getPositions(!0,this.containingGroup,null);for(let t=1;t<i-2;t++){var n=e[t],r=e[t+1];if(!s.isUnoccupied(Math.min(n.x,r.x),Math.min(n.y,r.y),Math.abs(n.x-r.x),Math.abs(n.y-r.y)))return!0}}}return!1}vd(s,t,e,n,i,r){var a=s.cellWidth,o=s.cellHeight;let h=s._i(t,e),l=t,u=e,d=l,c=u;for(0===n?d+=a:90===n?c+=o:180===n?d-=a:c-=o,n!==r&&h>Ve.xo&&s._i(d,c)!==h-1&&(s._i(l-a,u)===h-1?(n=180,d=l-a,c=u):s._i(l+a,u)===h-1?(n=0,d=l+a,c=u):s._i(l,u-o)===h-1?(n=270,d=l,c=u-o):s._i(l,u+o)===h-1&&(n=90,d=l,c=u+o));h>Ve.xo&&s._i(d,c)===h-1;)l=d,u=c,0===n?d+=a:90===n?c+=o:180===n?d-=a:c-=o,--h;if(i?h>Ve.xo&&(180===n||0===n?l=Math.floor(l/a)*a+a/2:90!==n&&270!==n||(u=Math.floor(u/o)*o+o/2)):(l=Math.floor(l/a)*a+a/2,u=Math.floor(u/o)*o+o/2),h>Ve.xo){let i=n,t=l,e=u;if(0===n?(i=90,e+=o):90===n?(i=180,t-=a):180===n?(i=270,e-=o):270===n&&(i=0,t+=a),s._i(t,e)===h-1)this.vd(s,t,e,i,!1,i);else{let t=l,e=u;0===n?(i=270,e-=o):90===n?(i=0,t+=a):180===n?(i=90,e+=o):270===n&&(i=180,t-=a),s._i(t,e)===h-1&&this.vd(s,t,e,i,!1,i)}}this.addPointAt(l,u)}findClosestSegment(t){Yt,Xt.s(t,U,q,"findClosestSegment:p");var e=t.x,i=t.y;let s=this.getPoint(0),n=this.getPoint(1),r=U.distanceLineSegmentSquared(e,i,s.x,s.y,n.x,n.y),a=0;for(let t=1;t<this.pointsCount-1;t++){s=this.getPoint(t+1);var o=U.distanceLineSegmentSquared(e,i,n.x,n.y,s.x,s.y);n=s,o<r&&(a=t,r=o)}return a}fe(){this.Mh=!1,this.u()}get Mh(){return 0!=(128&this.Dt)}set Mh(t){0!=(128&this.Dt)!==t&&(this.Dt=128^this.Dt)}get geometry(){if(!this.Mh){if(this.updateRoute(),this.pointsCount<2)return this.Mh=!0,this.yt;this.yt=this.makeGeometry()}return this.yt}pd(t){if(!t){if(!1===this.Re)return;t=this.findMainElement();if(this.Mh&&(null===t||null!==t.geometry))return}this.pointsCount<2?this.Mh=!0:this.yt=this.makeGeometry();var e=this.path;if(null!==e){e.yt=this.yt;var i=this.F.h,s=i.length;for(let t=0;t<s;t++){var n=i[t];n!==e&&n.isPanelMain&&n instanceof V&&(n.yt=this.yt)}}}aO(t){return this.Ya()&&t.sh.contains(this)&&(0!==this.Ac.width||0!==this.Ac.height)&&(t.animationManager.isAnimating||t.currentTool!==t.toolManager)}makeGeometry(){var e=this.yt,s=this.pointsCount;let n=!1;var i=this.diagram;null!==i&&this.aO(i)&&(n=!0);let r=0,a=0,o=this.getPoint(0).copy();var h=o.copy(),l=this.Ci.h,i=this.computeCurve();if(9===i&&3<=s&&!I.q(this.smoothness,0))if(3===s){var u=this.getPoint(1);r=Math.min(o.x,u.x),a=Math.min(o.y,u.y),u=this.getPoint(2),r=Math.min(r,u.x),a=Math.min(a,u.y)}else{if(this.isOrthogonal)for(let t=0;t<s;t++){var d=l[t];h.x=Math.min(d.x,h.x),h.y=Math.min(d.y,h.y)}else for(let t=3;t<s;t+=3){t+3>=s&&(t=s-1);var c=this.getPoint(t);h.x=Math.min(c.x,h.x),h.y=Math.min(c.y,h.y)}r=h.x,a=h.y}else{for(let t=0;t<s;t++){var g=l[t];h.x=Math.min(g.x,h.x),h.y=Math.min(g.y,h.y)}r=h.x,a=h.y}if(r-=this.bb.x,a-=this.bb.y,o.x-=r,o.y-=a,2!==s||this.Ya()){e.type=4;var m=Be.xC(e);if(0!==this.computeShortLength(!0)&&(o=this.Tc(o,!0,h)),m.yu(o.x,o.y,!1,!1),9===i&&3<=s&&!I.q(this.smoothness,0))if(3===s){u=this.getPoint(1),i=u.x-r,u=u.y-a;let t=this.getPoint(2).copy();t.x-=r,t.y-=a,0!==this.computeShortLength(!1)&&(t=this.Tc(t,!1,h)),m.br(i,u,i,u,t.x,t.y)}else if(this.isOrthogonal){var f=U.H(r,a),p=U.a(),v=(p.c(this.getPoint(1)),U.H(r,a)),y=U.H(r,a);let e=this.getPoint(0),i;var x=this.smoothness/3;for(let t=1;t<this.pointsCount-1;t++){i=this.getPoint(t);var A=e,w=i,b=this.getPoint(this.dN(i,t,!1));I.q(A.x,w.x)&&I.q(w.x,b.x)||I.q(A.y,w.y)&&I.q(w.y,b.y)||(this.fO(A,w,b,x,v,y),(1===t||2===t&&I.q(e.x,this.getPoint(0).x)&&I.q(e.y,this.getPoint(0).y))&&(p.x=.5*(e.x+i.x),p.y=.5*(e.y+i.y)),m.br(p.x-r,p.y-a,v.x-r,v.y-a,i.x-r,i.y-a),f.set(v),p.set(y),e=i)}let t=e.x,s=e.y,n=this.getPoint(this.pointsCount-1);t=.5*(t+(n=0!==this.computeShortLength(!1)?this.Tc(n.copy(),!1,U.To):n).x),s=.5*(s+n.y),m.br(y.x-r,y.y-a,t-r,s-a,n.x-r,n.y-a),U.o(f),U.o(p),U.o(v),U.o(y)}else for(let e=3;e<s;e+=3){var P=this.getPoint(e-2),S=(e+3>=s&&(e=s-1),this.getPoint(e-1));let t=this.getPoint(e);e===s-1&&0!==this.computeShortLength(!1)&&(t=this.Tc(t.copy(),!1,U.To)),m.br(P.x-r,P.y-a,S.x-r,S.y-a,t.x-r,t.y-a)}else{var k=U.a(),M=(k.c(this.getPoint(0)),U.a()),N=(M.c(k),this.computeCorner());let e=1,i=0;for(;e<s;){e=this.dN(k,e,1<e);let t=this.getPoint(e);if(e>=s-1){if(k.equals(t)){if(0===i)for(e=1;e<s;)M.c(k),t=this.getPoint(e++),this.Rn(m,-r,-a,k,t,n),k.c(t)}else 0!==this.computeShortLength(!1)&&(t=this.Tc(t.copy(),!1,U.To)),this.Rn(m,-r,-a,k,t,n);break}i=this.dN(t,e+1,e<s-3);var C=this.getPoint(i);this.cO(m,-r,-a,k,t,C,k,M,N,n),M.c(t),e=i}U.o(k)}return Be.bC(m),this.Mh=!0,e}{let t=this.getPoint(1).copy();return t.x-=r,t.y-=a,0!==this.computeShortLength(!0)&&(o=this.Tc(o,!0,h)),0!==this.computeShortLength(!1)&&(t=this.Tc(t,!1,h)),e.type=1,e.startX=o.x,e.startY=o.y,e.endX=t.x,e.endY=t.y,this.Mh=!0,e}}Ab(t,e,i,s){let n=i-t;if(isNaN(n)||n===1/0||n===-1/0)return NaN;n<0&&(n=-n);let r=s-e;return isNaN(r)||r===1/0||r===-1/0?NaN:(r<0&&(r=-r),I.q(n,0)?r:I.q(r,0)?n:Math.sqrt(n*n+r*r))}fO(t,e,i,s,n,r){isNaN(s)&&(s=this.smoothness/3);var a=t.x,t=t.y,o=e.x,e=e.y,h=i.x,i=i.y,l=s*this.Ab(a,t,o,e),s=s*this.Ab(o,e,h,i);I.q(t,e)&&I.q(o,h)&&(a<o?e<i?(n.x=o-l,n.y=e-l,r.x=o+s,r.y=e+s):(n.x=o-l,n.y=e+l,r.x=o+s,r.y=e-s):e<i?(n.x=o+l,n.y=e-l,r.x=o-s,r.y=e+s):(n.x=o+l,n.y=e+l,r.x=o-s,r.y=e-s)),I.q(a,o)&&I.q(e,i)&&(t<e?(o<h?(n.x=o-l,n.y=e-l,r.x=o+s):(n.x=o+l,n.y=e-l,r.x=o-s),r.y=e+s):(o<h?(n.x=o-l,n.y=e+l,r.x=o+s):(n.x=o+l,n.y=e+l,r.x=o-s),r.y=e-s)),(I.q(a,o)&&I.q(o,h)||I.q(t,e)&&I.q(e,i))&&(l=.5*(t+i),n.x=s=.5*(a+h),n.y=l,r.x=s,r.y=l)}Tc(e,i,s){var n=this.pointsCount;if(!(n<2))if(i){var i=this.getPoint(1),r=i.x-s.x,i=i.y-s.y,a=this.Ab(e.x,e.y,r,i);if(0===a)return e;var o=2===n?.5*a:a;let t=this.computeShortLength(!0);o=(t=t>o?o:t)*(r-e.x)/a,r=t*(i-e.y)/a;e.x+=o,e.y+=r}else{i=this.getPoint(n-2),a=i.x-s.x,o=i.y-s.y,r=this.Ab(e.x,e.y,a,o);if(0===r)return e;i=2===n?.5*r:r;let t=this.computeShortLength(!1);s=(t=t>i?i:t)*(e.x-a)/r,n=t*(e.y-o)/r;e.x-=s,e.y-=n}return e}dN(t,e,i){var s=this.pointsCount;let n=t;for(;I.q(t.x,n.x)&&I.q(t.y,n.y);){if(s<=e)return s-1;n=this.getPoint(e++)}if(!I.q(t.x,n.x)&&!I.q(t.y,n.y))return e-1;let r=n;for(;I.q(t.x,n.x)&&I.q(n.x,r.x)&&(!i||(t.y>=n.y?n.y>=r.y:n.y<=r.y))||I.q(t.y,n.y)&&I.q(n.y,r.y)&&(!i||(t.x>=n.x?n.x>=r.x:n.x<=r.x));){if(s<=e)return s-1;r=this.getPoint(e++)}return e-2}cO(i,s,n,r,a,o,h,t,l,u){if(I.p(r.y,a.y)&&I.p(a.x,o.x)){var d=Math.min(l,Math.abs(a.x-t.x)/2),c=Math.min(d,Math.abs(o.y-a.y)/2),d=c;if(I.p(d,0))this.Rn(i,s,n,r,a,u),h.c(a);else{let t=a.x;var g=a.y,m=t;let e=g;e=(t=a.x>r.x?a.x-d:a.x+d,o.y>a.y?a.y+c:a.y-c);d=U.H(t,g);this.Rn(i,s,n,r,d,u),U.o(d),i.Dw(a.x+s,a.y+n,m+s,e+n),h.e(m,e)}}else if(I.p(r.x,a.x)&&I.p(a.y,o.y)){c=Math.min(l,Math.abs(a.y-t.y)/2),g=Math.min(c,Math.abs(o.x-a.x)/2),c=g;if(I.p(g,0))this.Rn(i,s,n,r,a,u),h.c(a);else{d=a.x;let t=a.y,e=d;m=t,l=(e=(t=a.y>r.y?a.y-c:a.y+c,o.x>a.x?a.x+g:a.x-g),U.H(d,t));this.Rn(i,s,n,r,l,u),U.o(l),i.Dw(a.x+s,a.y+n,e+s,m+n),h.e(e,m)}}else this.Rn(i,s,n,r,a,u),h.c(a)}computeJumpLength(){return 10}Rn(r,a,o,h,l,t){if(!t&&this.Ya()){var u=this.computeJumpLength(),d=u/2,c=[];let i=0,s=(this.isVisible()&&(i=this.uO(h,l,c)),h.x),n=h.y;if(0<i)if(I.p(h.y,l.y))if(h.x<l.x){let e=0;for(;e<i;){var g=Math.max(h.x,Math.min(c[e++]-d,l.x-u));r.xr(g+a,l.y+o),s=g+a,n=l.y+o;let t=Math.min(g+u,l.x);for(;e<i;){var m=c[e];if(!(m<t+u))break;e++,t=Math.min(m+d,l.x)}var g=l.y-u+o,f=t+a,p=l.y+o;10===this.curve?r.yu(f,p,!1,!1):r.br(s,g,f,g,f,p),s=f,n=p}}else{let e=i-1;for(;0<=e;){var v=Math.min(h.x,Math.max(c[e--]+d,l.x+u));r.xr(v+a,l.y+o),s=v+a,n=l.y+o;let t=Math.max(v-u,l.x);for(;0<=e;){var y=c[e];if(!(y>t-u))break;e--,t=Math.max(y-d,l.x)}var v=l.y-u+o,x=t+a,A=l.y+o;10===this.curve?r.yu(x,A,!1,!1):r.br(s,v,x,v,x,A),s=x,n=A}}else if(I.p(h.x,l.x))if(h.y<l.y){let e=0;for(;e<i;){var w=Math.max(h.y,Math.min(c[e++]-d,l.y-u));r.xr(l.x+a,w+o),s=l.x+a,n=w+o;let t=Math.min(w+u,l.y);for(;e<i;){var b=c[e];if(!(b<t+u))break;e++,t=Math.min(b+d,l.y)}var w=l.x-u+a,P=l.x+a,S=t+o;10===this.curve?r.yu(P,S,!1,!1):r.br(w,n,w,S,P,S),s=P,n=S}}else{let e=i-1;for(;0<=e;){var k=Math.min(h.y,Math.max(c[e--]+d,l.y+u));r.xr(l.x+a,k+o),s=l.x+a,n=k+o;let t=Math.max(k-u,l.y);for(;0<=e;){var M=c[e];if(!(M>t-u))break;e--,t=Math.max(M-d,l.y)}var k=l.x-u+a,N=l.x+a,C=t+o;10===this.curve?r.yu(N,C,!1,!1):r.br(k,n,k,C,N,C),s=N,n=C}}}r.xr(l.x+a,l.y+o)}uO(e,i,s){var t=this.diagram;if(null===t||e.equals(i))return 0;for(var n=t.layers;n.next();){var r=n.value;if(null!==r&&r.visible){var a=r.HM(),o=a.length;for(let t=0;t<o;t++){var h,l=a[t];if(l instanceof q){if(l===this)return 0<s.length&&s.sort((t,e)=>t-e),s.length;l.isVisible()&&l.Ya()&&(h=l.routeBounds).isReal()&&this.routeBounds.intersectsRect(h)&&!this.usesSamePort(l)&&null!==(h=l.path)&&h.isVisibleObject()&&this.dO(e,i,s,l)}}}}return 0<s.length&&s.sort((t,e)=>t-e),s.length}dO(e,i,s,n){var r=I.p(e.y,i.y),a=n.pointsCount;let o=n.getPoint(0);var h=U.a();for(let t=1;t<a;t++){var l=n.getPoint(t);if(t<a-1){var u=n.getPoint(t+1);if(o.y===l.y&&l.y===u.y){if(l.x>o.x&&u.x>=l.x||l.x<o.x&&u.x<=l.x)continue}else if(o.x===l.x&&l.x===u.x&&(l.y>o.y&&u.y>=l.y||l.y<o.y&&u.y<=l.y))continue}this.gO(e,i,o,l,h)&&(r?s.push(h.x):s.push(h.y)),o=l}U.o(h)}gO(t,e,i,s,n){var r=t.x,t=t.y,a=e.x,e=e.y,o=i.x,i=i.y,h=s.x,s=s.y;if(I.p(r,a)){if(!I.p(t,e)&&I.p(i,s)&&Math.min(t,e)<i&&Math.max(t,e)>i&&Math.min(o,h)<r&&Math.max(o,h)>r&&!I.p(o,h))return n.x=r,n.y=i,!0}else if(I.p(t,e)&&I.p(o,h)&&Math.min(r,a)<o&&Math.max(r,a)>o&&Math.min(i,s)<t&&Math.max(i,s)>t&&!I.p(i,s))return n.x=o,n.y=t,!0;return n.x=0,n.y=0,!1}get firstPickIndex(){return!(this.pointsCount<=2)&&(this.isOrthogonal||!this.Gd(this.computeSpot(!0)))?1:0}get lastPickIndex(){var t=this.pointsCount;return 0===t?0:!(t<=2)&&(this.isOrthogonal||!this.Gd(this.computeSpot(!1)))?t-2:t-1}Ya(){var t=this.curve;return 11===t||10===t}Mb(t){!t&&!this.Ya()||null===(t=this.diagram)||t.animationManager.isTicking||t.sh.contains(this)||0===this.Ac.width&&0===this.Ac.height||t.sh.add(this,this.Ac.copy())}invalidateOtherJumpOvers(i){var e=this.layer;if(null!==e&&e.visible&&!e.isTemporary){var s=e.diagram;if(null!==s&&!s.animationManager.isTicking){let t=!1;for(var n=s.layers;n.next();){var r=n.value;if(r.visible)if(r===e){let e=!(t=!0);var a=r.HM(),o=a.length;for(let t=0;t<o;t++){var h=a[t];h instanceof q&&(h===this?e=!0:e&&this.aT(h,i))}}else if(t){var l=r.HM(),u=l.length;for(let t=0;t<u;t++){var d=l[t];d instanceof q&&this.aT(d,i)}}}}}}aT(t,e){var i;null!==t&&t.Mh&&t.Re&&t.Ya()&&(i=t.routeBounds).isReal()&&(this.routeBounds.intersectsRect(i)||e.intersectsRect(i))&&!this.usesSamePort(t)&&t.fe()}usesSamePort(t){var e=this.pointsCount,i=t.pointsCount;if(0<e&&0<i){var s=this.getPoint(0),n=t.getPoint(0);if(s.equalsApprox(n))return!0;e=this.getPoint(e-1),i=t.getPoint(i-1);if(e.equalsApprox(i)||s.equalsApprox(i)||e.equalsApprox(n))return!0}else if(this.fromNode===t.fromNode||this.toNode===t.toNode||this.fromNode===t.toNode||this.toNode===t.fromNode)return!0;return!1}isVisible(){if(!super.isVisible())return!1;var e=this.containingGroup;let i=!0;var s=this.diagram,s=(null!==s&&(i=s.isTreePathToChildren),this.fromNode);if(null!==s){if(this.isTreeLink&&i&&!s.isTreeExpanded)return!1;if(s===e)return!0;let t=s;for(;null!==t;){if(t.labeledLink===this)return!0;t=t.containingGroup}s=s.findVisibleNode();if(null===s||s===e)return!1}s=this.toNode;if(null!==s){if(this.isTreeLink&&!i&&!s.isTreeExpanded)return!1;if(s===e)return!0;let t=s;for(;null!==t;){if(t.labeledLink===this)return!0;t=t.containingGroup}s=s.findVisibleNode();if(null===s||s===e)return!1}return!0}Ki(t){if(super.Ki(t),t&&this.Mb(!1),null!==this.nr&&this.nr.Vd(),null!==this.Qs)for(var e=this.Qs.iterator;e.next();)e.value.Ki(t)}get adjusting(){return this.Cc}set adjusting(t){var e=this.Cc;e!==t&&(Yt,0!==t&&17!==t&&18!==t&&19!==t&&Xt.n("Link.adjusting can only be set to None, End, Scale, or Stretch, not: "+t),this.Cc=t,this.i("adjusting",e,t))}computeAdjusting(){return this.isAvoiding&&null!==this.diagram&&this.diagram.animationManager.defaultAnimation.isAnimating?17:this.Cc}get corner(){return this.Xd}set corner(t){var e=this.Xd;e!==t&&(Yt,Xt.t(t,"number",q,"corner"),this.Xd=t,this.fe(),this.i("corner",e,t))}get curve(){return this.Yd}set curve(t){var e=this.Yd;e!==t&&(Yt,0!==t&&9!==t&&10!==t&&11!==t&&Xt.n("Link.curve can only be set to None, Bezier, JumpGap, or JumpOver, not: "+t),this.Yd=t,this.invalidateRoute(),this.fe(),this.Mb(10===e||11===e||10===t||11===t),this.i("curve",e,t))}get curviness(){return this.Kd}set curviness(t){var e=this.Kd;e!==t&&(Yt,Xt.t(t,"number",q,"curviness"),this.Kd=t,this.invalidateRoute(),this.fe(),this.i("curviness",e,t))}get routing(){return this.Va}set routing(t){var e=this.Va;e!==t&&(Yt,1!==t&&2!==t&&6!==t&&7!==t&&Xt.n("Link.routing can only be set to Normal, Orthogonal, AvoidsNodes, not: "+t),this.Va=t,this.sr=null,this.invalidateRoute(),this.Mb(q.aN(e)||q.aN(t)),this.i("routing",e,t))}get smoothness(){return this.Ud}set smoothness(t){var e=this.Ud;e!==t&&(Yt,Xt.t(t,"number",q,"smoothness"),this.Ud=t,this.fe(),this.i("smoothness",e,t))}Py(){var s=this.mo;if(null!==s){var n=this.yo;if(null!==n&&isNaN(this.curviness)){var r=this.po,a=this.wo;let i=null,e=null;var o=s.ni.h,h=o.length;for(let t=0;t<h;t++){var l=o[t];(l.mo===s&&l.po===r&&l.yo===n&&l.wo===a||l.mo===n&&l.po===a&&l.yo===s&&l.wo===r)&&(null===e?e=l:(null===i&&(i=[]).push(e),i.push(l)))}if(null!==i){let e=s.tT(n,r,a);null===e&&(e=new Ke(s,r,n,a),s.QL(e),n.QL(e)),e._s=i;for(let t=0;t<i.length;t++)i[t].nr=e;e.Vd()}}}}My(){var t,e=this.nr;null!==e&&isNaN(this.curviness)&&(this.nr=null,0<=(t=e._s.indexOf(this)))&&(Xt.rf(e._s,t),e.Vd())}Il(){return!0}get key(){var t=this.diagram;if(null!==t&&t.model.Ea())return t.model.getKeyForLinkData(this.data)}}class Ke{Go;Ks;uy;iN;yb;eN;_s;constructor(t,e,i,s){C.ji(this),this.Go=!1,this.Ks=!1,this.uy=t,this.iN=e,this.yb=i,this.eN=s,this._s=[]}Vd(){var t;this.Go||0<(t=this._s).length&&null!==(t=t[0].diagram)&&(t.uP.add(this),this.Ks=t.undoManager.isUndoingRedoing),this.Go=!0}NP(){var t,e,i;this.Go&&(this.Go=!1,0<(t=this._s).length&&(i=null===(i=(e=t[0]).diagram)||i.Uh&&!this.Ks,this.Ks=!1,e.arrangeBundledLinks(t,i),1===t.length)&&(e.nr=null,t.length=0),0===t.length)&&(this.uy._L(this),this.yb._L(this))}}class Ve{de;ge;Ka;Ua;ki;Si;Yt;Ph;Nh;da;BP;Go;Cy;Jf;zP;XP;constructor(t){C.ji(this),this.da=null,this.BP=null,this.Go=!0,this.Cy=!1,this.de=1,this.ge=1,this.Ka=-1,this.Ua=-1,this.ki=t.width,this.Si=t.height,this.Yt=null,this.Ph=0,this.Nh=0,this.Jf=11,this.zP=2*this.Jf,this.XP=2*this.Jf}static tn=0;static xo=1;static qd=999999;static gN=Ve.qd+1;static mN=Ve.qd+2;R1(t){if(!(t.width<=0||t.height<=0)){var e=t.x,i=t.y,s=t.x+t.width,t=t.y+t.height,n=(this.de=Math.floor((e-this.ki)/this.ki)*this.ki,this.ge=Math.floor((i-this.Si)/this.Si)*this.Si,this.Ka=Math.ceil((s+2*this.ki)/this.ki)*this.ki,this.Ua=Math.ceil((t+2*this.Si)/this.Si)*this.Si,1+(0|Math.ceil((this.Ka-this.de)/this.ki))),r=1+(0|Math.ceil((this.Ua-this.ge)/this.Si));if(null===this.Yt||this.Ph<n-1||this.Nh<r-1){var a=[];for(let t=0;t<=n;t++)a[t]=new Uint32Array(r);this.Yt=a,this.Ph=n-1,this.Nh=r-1}this.mO(Ve.gN)}}get bounds(){return new Z(this.de,this.ge,this.Ka-this.de,this.Ua-this.ge)}get cellWidth(){return this.ki}set cellWidth(t){0<t&&t!==this.ki&&(this.ki=t,this.R1(this.bounds))}get cellHeight(){return this.Si}set cellHeight(t){0<t&&t!==this.Si&&(this.Si=t,this.R1(this.bounds))}Wd(t,e){return this.de<=t&&t<=this.Ka&&this.ge<=e&&e<=this.Ua}_i(t,e){return this.Wd(t,e)?(t=(t-=this.de)/this.ki,e=(e-=this.ge)/this.Si,this.Yt[0|t][0|e]):Ve.gN}PR(t,e,i,s){if(this.Wd(t,e)){var n=(t-this.de)/this.ki|0,r=(e-this.ge)/this.Si|0,t=(t+i-this.de)/this.ki|0,i=(e+s-this.ge)/this.Si|0,a=Math.min(t,this.Ph),o=Math.min(i,this.Nh);for(let t=n;t<=a;t++){var h=this.Yt[t];if(h.fill)h.fill(Ve.tn,r,o+1);else for(let t=r;t<=o;t++)h[t]=Ve.tn}}}mO(e){if(null!==this.Yt)for(let t=0;t<=this.Ph;t++){var i=this.Yt[t];if(i.fill)i.fill(e);else for(let t=0;t<=this.Nh;t++)i[t]=e}}GA(){if(null!==this.Yt)for(let t=0;t<=this.Ph;t++){var e=this.Yt[t];for(let t=0;t<=this.Nh;t++)e[t]>=Ve.xo&&(e[t]=Ve.gN)}}pO(t,e){return this._i(t,e)===Ve.tn}isUnoccupied(n,r,a,o){if(!(n>this.Ka||n+a<this.de||r>this.Ua||r+o<this.ge)){let e=(n-this.de)/this.ki|0,i=(r-this.ge)/this.Si|0,t=Math.max(0,a)/this.ki+1|0,s=Math.max(0,o)/this.Si+1|0;if(e<0&&(t+=e,e=0),i<0&&(s+=i,i=0),!(t<0||s<0)){var h=0|Math.min(e+t-1,this.Ph),l=0|Math.min(i+s-1,this.Nh);for(let t=e;t<=h;t++){var u=this.Yt[t];for(let t=i;t<=l;t++)if(u[t]===Ve.tn)return!1}}}return!0}maxUnoccupiedH(t,e,i,s){if(t>this.Ka||e<this.de||i>this.Ua||i<this.ge)return 0;var n=(t-this.de)/this.ki|0,r=(e-this.de)/this.ki|0,a=(i-this.ge)/this.Si|0,o=s/this.Si+1|0;let h;for(h=0;h<o/2;h++){let e=!1;for(let t=n;t<=r;t++)if(this.Yt[t][a+h]===Ve.tn||this.Yt[t][a-h]===Ve.tn){e=!0;break}if(e)return Math.max(0,(2*h-1)*this.Si)}return s}maxUnoccupiedV(t,e,i,s){if(t>this.Ua||e<this.ge||i>this.Ka||i<this.de)return 0;var n=(t-this.ge)/this.Si|0,r=(e-this.ge)/this.Si|0,a=(i-this.de)/this.ki|0,o=s/this.ki+1|0;let h;for(h=0;h<o/2;h++){let e=!1;for(let t=n;t<=r;t++)if(this.Yt[a+h][t]===Ve.tn||this.Yt[a-h][t]===Ve.tn){e=!0;break}if(e)return Math.max(0,(2*h-1)*this.ki)}return s}yO(t,e,i,s,n,r,a,o){let h=this.Yt[t|=0][e|=0];if(h>=Ve.xo&&h<Ve.qd)for(s?e+=i:t+=i,h+=1;n<=t&&t<=r&&a<=e&&e<=o;){var l=this.Yt[t][e];if(h>=l)break;this.Yt[t][e]=h,h+=1,s?e+=i:t+=i}return s?e:t}bo(e,i,s,n,r,a,o,h){if(!(e<r||a<e||i<o||h<i)){var l=this.yO(e,i,s,n,r,a,o,h);if(n)if(0<s)for(let t=i+s;t<l;t+=s)this.bo(e,t,1,!n,r,a,o,h),this.bo(e,t,-1,!n,r,a,o,h);else for(let t=i+s;t>l;t+=s)this.bo(e,t,1,!n,r,a,o,h),this.bo(e,t,-1,!n,r,a,o,h);else if(0<s)for(let t=e+s;t<l;t+=s)this.bo(t,i,1,!n,r,a,o,h),this.bo(t,i,-1,!n,r,a,o,h);else for(let t=e+s;t>l;t+=s)this.bo(t,i,1,!n,r,a,o,h),this.bo(t,i,-1,!n,r,a,o,h)}}Lb(t,e,i,s,n,r,a,o,h,l){let u=0|t,d=0|e,c=Ve.tn,g=Ve.xo;for(this.Yt[u][d]=g;c===Ve.tn&&u>a&&u<o&&d>h&&d<l;)g+=1,this.Yt[u][d]=g,r?d+=n:u+=n,c=this.Yt[u][d];return r?d:u}Tb(t,e,i,s,n,r,a,o,h,l){let u=0|i,d=0|s,c=Ve.tn;var g=Ve.qd;for(this.Yt[u][d]=g;c===Ve.tn&&u>a&&u<o&&d>h&&d<l;)this.Yt[u][d]=g,r?d+=n:u+=n,c=this.Yt[u][d]}fT(t,e,n,i,s,r){if(null!==this.Yt){this.Cy=!1;var a=t.x,t=t.y;if(this.Wd(a,t)){var a=(a-=this.de)/this.ki,t=(t-=this.ge)/this.Si,o=n.x,n=n.y;if(this.Wd(o,n))if(o=(o-=this.de)/this.ki,n=(n-=this.ge)/this.Si,Math.abs(a-o)<=1&&Math.abs(t-n)<=1)this.Cy=!0;else{var h=s.x,l=s.y,u=s.x+s.width,s=s.y+s.height,h=(h=(h-=this.de)/this.ki,l=(l-=this.ge)/this.Si,u=(u-=this.de)/this.ki,s=(s-=this.ge)/this.Si,Math.max(0,Math.min(this.Ph,0|h))),u=Math.min(this.Ph,Math.max(0,0|u)),l=Math.max(0,Math.min(this.Nh,0|l)),s=Math.min(this.Nh,Math.max(0,0|s)),d=this.Yt,a=0|a,t=0|t,o=0|o,n=0|n,c=0===e||90===e?1:-1,e=90===e||270===e,g=(d[a][t]===Ve.tn?(this.Lb(a,t,o,n,c,e,h,u,l,s),this.Lb(a,t,o,n,1,!e,h,u,l,s),this.Lb(a,t,o,n,-1,!e,h,u,l,s)):this.Lb(a,t,o,n,c,e,a,t,a,t),d[o][n]===Ve.tn?(this.Tb(a,t,o,n,0===i||90===i?1:-1,90===i||270===i,h,u,l,s),this.Tb(a,t,o,n,1,!(90===i||270===i),h,u,l,s),this.Tb(a,t,o,n,-1,!(90===i||270===i),h,u,l,s)):this.Tb(a,t,o,n,c,e,o,n,o,n),Xt.ct());if(r&&this.cT(o,n,i,a,t,g)){g[0]===o&&g[1]===n||(g.unshift(n),g.unshift(o)),g[g.length-2]===a&&g[g.length-1]===t||(g.push(a),g.push(t));let e=Ve.xo,i=g[g.length-2],s=g[g.length-1];d[i][s]=e++;for(let t=g.length-4;0<=t;t-=2){i=g[t+2],s=g[t+3];for(var m=g[t],f=g[t+1];m>i?i++:m<i?i--:f>s?s++:f<s&&s--,d[i][s]=e++,i!==m||s!==f;);}}else this.bo(a,t,1,!1,h,u,l,s),this.bo(a,t,-1,!1,h,u,l,s),this.bo(a,t,1,!0,h,u,l,s),this.bo(a,t,-1,!0,h,u,l,s);Xt.ot(g)}}}}cT(s,n,r,a,o,h){var l=this.Yt;let u=s,d=n;for(;;){if(u===a&&d===o)return!0;let t=u,e=d;if(0===r){if(!(t<a))break;t++}else if(90===r){if(!(e<o))break;e++}else if(180===r){if(!(t>a))break;t--}else{if(!(e>o))break;e--}var i=l[t][e];if(0===i||i===Ve.mN)break;u=t,d=e}for(;;){let t=r,e=u,i=d;0===r||90!==r&&180===r?i<o?(t=90,i++):i>o&&(t=270,i--):e<a?(t=0,e++):e>a&&(t=180,e--);var c=l[e][i];if(t!==r&&0!==c&&c!==Ve.mN){if(h.push(u),h.push(d),this.cT(u,d,t,a,o,h))return!0;h.pop(),h.pop()}if(l[u][d]=Ve.mN,0===r){if(u===s)return!1;u--}else if(90===r){if(d===n)return!1;d--}else if(180===r){if(u===s)return!1;u++}else{if(d===n)return!1;d++}}}}class ze{be;or;ds;jd;constructor(){C.ji(this),this.be=null,this.or=null,this.ds=[],this.jd=!1}toString(){var e=this.ds;let i=this.be.toString()+" "+e.length.toString()+":";for(let t=0;t<e.length;t++){var s=e[t];null!==s&&(i+=`
  `+s.toString())}return i}wO(t,e,i,s){e=e.offsetY;switch(e){case 8:return 90;case 2:return 180;case 1:return 270;case 4:return 0}let n=i;switch(e){case 9:return 180<n?270:90;case 6:return 90<n&&n<=270?180:0}var r=180*Math.atan2(t.height,t.width)/Math.PI;switch(e){case 3:return n>r&&n<=180+r?180:270;case 5:return n>180-r&&n<=360-r?270:0;case 12:return n>r&&n<=180+r?90:0;case 10:return n>180-r&&n<=360-r?180:90;case 7:return 90<n&&n<=180+r?180:n>180+r&&n<=360-r?270:0;case 13:return 180<n&&n<=360-r?270:n>r&&n<=180?90:0;case 14:return n>r&&n<=180-r?90:n>180-r&&n<=270?180:0;case 11:return n>180-r&&n<=180+r?180:n>180+r?270:90}return s&&15!==e&&(n-=15)<0&&(n+=360),n>r&&n<180-r?90:n>=180-r&&n<=180+r?180:n>180+r&&n<360-r?270:0}Vd(){this.ds.length=0}hT(e){let i=this.ds;0===i.length&&(this.xO(),i=this.ds);for(let t=0;t<i.length;t++){var s=i[t];if(null!==s&&s._e===e)return s}return null}xO(){if(!this.jd){var n=this.jd;this.jd=!0;let t,e=null;var a=this.be,o=a instanceof j?a:null;if(null===o||o.isSubGraphExpanded)t=a.isTreeExpanded?a.findLinksConnected(this.or.portId):a.findExternalTreeLinksConnected();else{if(!o.actualBounds.isReal())return this.jd=n,this.ds;e=o,t=e.findExternalLinksConnected()}let r=this.ds.length=0;for(var a=this.or.getDocumentPoint(J.TopLeft,U.a()),o=this.or.getDocumentPoint(J.BottomRight,U.a()),h=Z.H(a.x,a.y,0,0),l=(h.unionPoint(o),U.o(a),U.o(o),U.H(h.x+h.width/2,h.y+h.height/2)),u=this.or.getDocumentAngle(),d=t.iterator;d.next();){var c=d.value;if(c.isVisible()&&c.fromPort!==c.toPort){var g=c.fromPort===this.or||null!==c.fromNode&&c.fromNode.isMemberOf(e),m=c.computeSpot(g,this.or);if(m.isSide()){let n;if(null!==(n=g?c.toPort:c.fromPort)){let s=n.part;if(null!==s){g=s.findVisibleNode(),g=(null!==g&&g!==s&&(s=g,n=s.port),c.computeOtherPoint(s,n));let t=l.directionPoint(g);(t-=u)<0?t+=360:360<=t&&(t-=360);m=this.wO(h,m,t,c.isOrthogonal);let e=0,i=(0===m?(e=4,180<t&&(t-=360)):90===m?(e=8,270<t&&(t-=360)):180===m?e=2:(e=1,t<90&&(t+=360)),this.ds[r]);void 0===i?(i=new Ye(c,t,e),this.ds[r]=i):(i._e=c,i.qt=t,i.Me=e),i.Db.set(g),r++}}}}}U.o(l),this.bO();var f=this.ds.length;let i=-1,s=0;for(r=0;r<f;r++){var p=this.ds[r];void 0!==p&&(p.Me!==i&&(i=p.Me,s=0),p.Jd=s,s++)}for(i=-1,s=0,r=f-1;0<=r;r--){var v=this.ds[r];void 0!==v&&(v.Me!==i&&(i=v.Me,s=v.Jd+1),v.Lc=s)}this.kO(this.ds),this.SO(this.ds),this.jd=n,Z.o(h)}return this.ds}MO(t,e){return t===e?0:null===t?-1:null===e?1:t.Me<e.Me?-1:t.Me>e.Me?1:t.qt<e.qt?-1:t.qt>e.qt?1:0}bO(){this.ds.sort(ze.prototype.MO)}kO(e){var t=this.or,i=this.be.portSpreading,s=U.a(),n=U.a(),r=U.a(),a=U.a();t.getDocumentPoint(J.TopLeft,s),t.getDocumentPoint(J.TopRight,n),t.getDocumentPoint(J.BottomRight,r),t.getDocumentPoint(J.BottomLeft,a);let o=0,h=0,l=0,u=0;if(2===i)for(let t=0;t<e.length;t++){var d=e[t];if(null!==d){var c=d._e.computeThickness();switch(d.Me){case 8:l+=c;break;case 2:u+=c;break;case 1:o+=c;break;default:h+=c}}}let g=0,m=0,f=1,p,v,y=0,x=0;for(let t=0;t<e.length;t++){var A=e[t];if(null!==A){if(g!==A.Me){switch(g=A.Me){case 8:p=r,v=a;break;case 2:p=a,v=s;break;case 1:p=s,v=n;break;default:p=n,v=r}switch(y=v.x-p.x,x=v.y-p.y,g){case 8:l>Math.abs(y)?(f=Math.abs(y)/l,l=Math.abs(y)):f=1;break;case 2:u>Math.abs(x)?(f=Math.abs(x)/u,u=Math.abs(x)):f=1;break;case 1:o>Math.abs(y)?(f=Math.abs(y)/o,o=Math.abs(y)):f=1;break;default:h>Math.abs(x)?(f=Math.abs(x)/h,h=Math.abs(x)):f=1}m=0}var w=A.Hd;if(2===i){var b=A._e.computeThickness();switch(b*=f,w.set(p),g){case 8:w.x=p.x+y/2+l/2-m-b/2;break;case 2:w.y=p.y+x/2+u/2-m-b/2;break;case 1:w.x=p.x+y/2-o/2+m+b/2;break;default:w.y=p.y+x/2-h/2+m+b/2}m+=b}else{let t=.5;1===i&&(t=(A.Jd+1)/(A.Lc+1)),w.x=p.x+y*t,w.y=p.y+x*t}}}U.o(s),U.o(n),U.o(r),U.o(a)}SO(e){for(let t=0;t<e.length;t++){var i=e[t];null!==i&&(i.Cb=this.PO(i))}}PO(t){var e,i,s,n=t._e,r=n.fromPort===this.or,r=n.computeEndSegmentLength(this.be,this.or,J.None,r);let a=t.Jd;return a<0||(e=t.Lc)<=1||!n.isOrthogonal?r:(n=t.Db,i=t.Hd,2!==t.Me&&8!==t.Me||(a=e-1-a),s=q.WI,((t=2===t.Me||4===t.Me)?n.y<i.y:n.x<i.x)?r+a*s:(t?n.y===i.y:n.x===i.x)?r:r+(e-1-a)*s)}}class Ye{_e;qt;Me;Db;Jd;Lc;Hd;Cb;constructor(t,e,i){this._e=t,this.qt=e,this.Me=i,this.Db=new U,this.Jd=0,this.Lc=0,this.Hd=new U,this.Cb=0}toString(){return this._e.toString()+" "+this.qt.toString()+" "+this.Me.toString()+":"+this.Jd.toString()+"/"+this.Lc.toString()+" "+this.Hd.toString()+" "+this.Cb.toString()+" "+this.Db.toString()}}class Xe{pa;ya;wa;xa;ba;ka;U0;Y0;G0;K0;constructor(){this.pa=J.Default,this.ya=J.Default,this.wa=NaN,this.xa=NaN,this.ba=NaN,this.ka=NaN,this.U0=null,this.Y0=null,this.G0=1/0,this.K0=1/0}copy(){var t=new Xe;return t.pa=this.pa.L(),t.ya=this.ya.L(),t.wa=this.wa,t.xa=this.xa,t.ba=this.ba,t.ka=this.ka,t.U0=this.U0,t.Y0=this.Y0,t.G0=this.G0,t.K0=this.K0,t}}class qe{I0;O0;E0;R0;Cp;Ap;constructor(){this.I0=-1/0,this.O0=0,this.E0=U.To,this.R0=0,this.Cp="None",this.Ap="None"}copy(){var t=new qe;return t.I0=this.I0,t.O0=this.O0,t.E0=this.E0.L(),t.R0=this.R0,t.Cp=this.Cp,t.Ap=this.Ap,t}}class j extends D{Zd;Et;ua;b0;hi;le;constructor(t,e){void 0===t||t instanceof se||"number"==typeof t||"string"==typeof t?super(t):(super(),t&&(e=t)),this.z=4608|this.z,this.Zd=new C,this.Et=null,this.le=new Qe,(this.le.group=this).ua=new C,this.b0=null,this.hi=null,e&&Object.assign(this,e)}cloneProtected(t){super.cloneProtected(t),this.z=-32769&this.z;var e=t.findInVisualTree(t=>t instanceof je);e instanceof je?t.Et=e:t.Et=null,null!==this.le?(t.le=this.le.copy(),t.le.group=t):(null!==t.le&&(t.le.group=null),t.le=null),null!==this.hi&&(t.hi=this.hi.copy())}qo(t){super.qo(t);for(var e=t.findSubGraphParts(),i=t.memberParts;i.next();){var s=i.value;if(s.u(),s.invalidateLayout(8),s.clearAdornments(),s instanceof D)s.invalidateConnectedLinks(e);else if(s instanceof q)for(var n=s.labelNodes;n.next();)n.value.invalidateConnectedLinks(e)}}tc(t,e,i,s,n,r,a){var o;3===t&&"elements"===e?n instanceof je?null===this.Et?this.Et=n:this.Et!==n&&Xt.n("Cannot insert a second Placeholder into the visual tree of a Group."):n instanceof jt&&(o=n.findInVisualTree(t=>t instanceof je))instanceof je&&(null===this.Et?this.Et=o:this.Et!==o&&Xt.n("Cannot insert a second Placeholder into the visual tree of a Group.")):4===t&&"elements"===e&&null!==this.Et&&(s===this.Et||s instanceof jt&&this.Et.isContainedBy(s))&&(this.Et=null),super.tc(t,e,i,s,n,r,a)}ad(t,e){if(super.ad(t,e),this.isClipping&&this.type!==jt.Spot&&this.isSubGraphExpanded){let t=this.resizeObject;t instanceof jt&&(t=t.findMainElement()),null===this.hi&&(this.hi=new Z),t.getDocumentBounds(this.hi),t instanceof V&&this.hi.inflate(-t.strokeWidth,-t.strokeWidth)}}gh(t,e,i,s){this.hasPlaceholder()&&(this.er=this.placeholder),super.gh(t,e,i,s)}ensureBounds(){const e=this;e.isSubGraphExpanded&&this.memberParts.each(t=>{!e.computesBoundsIncludingLinks&&t instanceof q||t.ensureBounds()}),super.ensureBounds()}tl(){if(!super.tl())return!1;for(var t=this.memberParts;t.next();){var e=t.value;if(e instanceof D){if(e.isVisible()&&e.hs())return!1}else if(e instanceof q&&e.isVisible()&&e.hs()&&e.fromNode!==this&&e.toNode!==this)return!1}return!0}hasPlaceholder(){return null!==this.Et&&this.Et.isVisibleObject()&&this.isSubGraphExpanded}get placeholder(){return this.Et}get computesBoundsAfterDrag(){return 0!=(2048&this.z)}set computesBoundsAfterDrag(t){var e=0!=(2048&this.z);e!==t&&(Xt.t(t,"boolean",j,"computesBoundsAfterDrag"),this.z=2048^this.z,this.i("computesBoundsAfterDrag",e,t))}get computesBoundsIncludingLinks(){return 0!=(4096&this.z)}set computesBoundsIncludingLinks(t){Xt.t(t,"boolean",j,"computesBoundsIncludingLinks");var e=0!=(4096&this.z);e!==t&&(this.z=4096^this.z,this.i("computesBoundsIncludingLinks",e,t))}get computesBoundsIncludingLocation(){return 0!=(8192&this.z)}set computesBoundsIncludingLocation(t){Xt.t(t,"boolean",j,"computesBoundsIncludingLocation");var e=0!=(8192&this.z);e!==t&&(this.z=8192^this.z,this.i("computesBoundsIncludingLocation",e,t))}get handlesDragDropForMembers(){return 0!=(16384&this.z)}set handlesDragDropForMembers(t){Xt.t(t,"boolean",j,"handlesDragDropForMembers");var e=0!=(16384&this.z);e!==t&&(this.z=16384^this.z,this.i("handlesDragDropForMembers",e,t))}get avoidableMembers(){return 0!=(131072&this.z)}set avoidableMembers(t){Xt.t(t,"boolean",j,"avoidableMembers");var e=0!=(131072&this.z);e!==t&&(this.z=131072^this.z,this.i("avoidableMembers",e,t))}get memberParts(){return this.Zd.iterator}$2(e){if(this.Zd.add(e)){e instanceof j&&this.ua.add(e);var i=this.memberAdded;if(null!==i){let t=!0;var s=this.diagram;null!==s&&(t=s.W,s.W=!0),i(this,e),null!==s&&(s.W=t)}this.isVisible()&&this.isSubGraphExpanded||e.Ki(!1)}if(!(e instanceof q)||this.computesBoundsIncludingLinks){let t=this.Et;(t=null===t?this:t).u()}}Z2(e){if(this.Zd.remove(e)){e instanceof j&&this.ua.remove(e);var i=this.memberRemoved;if(null!==i){let t=!0;var s=this.diagram;null!==s&&(t=s.W,s.W=!0),i(this,e),null!==s&&(s.W=t)}this.isVisible()&&this.isSubGraphExpanded||e.Ki(!0)}if(!(e instanceof q)||this.computesBoundsIncludingLinks){let t=this.Et;(t=null===t?this:t).u()}}Wf(){if(0<this.Zd.count){var t=this.diagram;if(null!==t)for(var e=this.Zd.copy().iterator;e.next();){var i=e.value;t.remove(i)}}super.Wf()}get layout(){return this.le}set layout(t){var e,i=this.le;i!==t&&(null!==t&&(Xt.s(t,Qe,j,"layout"),null!==t.diagram)&&t.diagram.layout===t&&Xt.n("A layout cannot be both the Diagram.layout and a Group.layout: "+t),null!==i&&(i.diagram=null,i.group=null),this.le=t,e=this.diagram,null!==t&&(t.diagram=e,t.group=this),null!==e&&(e.Jr=!0),this.i("layout",i,t),null!==e)&&e.requestUpdate()}get memberAdded(){return null!==this.bt?this.bt.xy:null}set memberAdded(t){var e=this.memberAdded;e!==t&&(null!==t&&Xt.t(t,"function",j,"memberAdded"),this.wl(),this.bt.xy=t,this.i("memberAdded",e,t))}get memberRemoved(){return null!==this.bt?this.bt.by:null}set memberRemoved(t){var e=this.memberRemoved;e!==t&&(null!==t&&Xt.t(t,"function",j,"memberRemoved"),this.wl(),this.bt.by=t,this.i("memberRemoved",e,t))}get memberValidation(){return null!==this.bt?this.bt.hh:null}set memberValidation(t){var e=this.memberValidation;e!==t&&(null!==t&&Xt.t(t,"function",j,"memberValidation"),this.wl(),this.bt.hh=t,this.i("memberValidation",e,t))}canAddMembers(t){var e=this.diagram;if(null===e)return!1;for(var i=e.commandHandler,s=i.h2(t).iterator;s.next();){var n=s.value;if(!i.isValidMember(this,n))return!1}return!0}addMembers(t,e){var i=this.diagram;if(null===i)return!1;var s=i.commandHandler;let n=!0;for(var r=s.h2(t).iterator;r.next();){var a=r.value;!e||s.isValidMember(this,a)?a.containingGroup=this:n=!1}return n}get ungroupable(){return 0!=(256&this.z)}set ungroupable(t){var e=0!=(256&this.z);e!==t&&(Xt.t(t,"boolean",j,"ungroupable"),this.z=256^this.z,this.i("ungroupable",e,t))}canUngroup(){var t;return!!this.ungroupable&&!(null===(t=this.layer)||!t.allowUngroup||null!==(t=t.diagram)&&!t.allowUngroup)}invalidateConnectedLinks(t){var e=this.NO();if(super.invalidateConnectedLinks(t),!e){this.PA(!0);for(var i=this.findExternalLinksConnected();i.next();){var s,n=i.value;void 0!==t&&t.contains(n)||(null!==(s=n.fromNode)&&s!==this&&s.isMemberOf(this)&&!s.isVisible()?(s.Se(n.fromPort),s.Se(n.toPort),n.invalidateRoute()):null!==(s=n.toNode)&&s!==this&&s.isMemberOf(this)&&!s.isVisible()&&(s.Se(n.fromPort),s.Se(n.toPort),n.invalidateRoute()))}}}findExternalLinksConnected(){var t=null!==this.diagram&&this.diagram.wP;if(t&&null!==this.b0)return this.b0.iterator;for(var e=this.findSubGraphParts(),i=(e.add(this),new C),s=e.iterator;s.next();){var n=s.value;if(n instanceof D)for(var r=n.linksConnected;r.next();){var a=r.value;e.contains(a)||i.add(a)}}return t&&(this.b0=i),i.iterator}findExternalNodesConnected(){for(var t=this.findSubGraphParts(),e=(t.add(this),new C),i=t.iterator;i.next();){var s=i.value;if(s instanceof D)for(var n=s.linksConnected;n.next();){var r=n.value,a=r.fromNode,a=(null===a||t.contains(a)&&a!==this||e.add(a),r.toNode);null===a||t.contains(a)&&a!==this||e.add(a)}}return e.iterator}mE(){var t=new C;return function t(e,i){null!==e&&(i.add(e),t(e.containingGroup,i))}(this,t),t}findSubGraphParts(){var t=new C;return Y.ah(t,this,!0,0,!0),t.remove(this),t}Ki(t){super.Ki(t);for(var e=this.memberParts;e.next();)e.value.Ki(t)}collapseSubGraph(){var t,e=this.diagram;null===e||e.isCollapsingExpanding||(e.isCollapsingExpanding=!0,t=this.findSubGraphParts(),this.uT(t,e,this),e.isCollapsingExpanding=!1)}uT(t,e,i){for(var s=this.memberParts;s.next();){var n=s.value;if(n.Ki(!1),n instanceof j&&n.isSubGraphExpanded&&(n.wasSubGraphExpanded=n.isSubGraphExpanded,n.uT(t,e,i)),n instanceof D)n.invalidateConnectedLinks(t),e.Rf(n,i);else if(n instanceof q)for(var r=n.labelNodes;r.next();)r.value.invalidateConnectedLinks(t)}this.isSubGraphExpanded=!1}expandSubGraph(){var t,e=this.diagram;null===e||e.isCollapsingExpanding||(e.isCollapsingExpanding=!0,t=this.findSubGraphParts(),this.dT(t,e,this),e.isCollapsingExpanding=!1)}dT(t,e,i){for(var s=this.memberParts;s.next();){var n=s.value;if(n.Ki(!0),n instanceof j&&n.wasSubGraphExpanded&&(n.wasSubGraphExpanded=!1,n.dT(t,e,i)),n instanceof D)n.invalidateConnectedLinks(t);else if(n instanceof q)for(var r=n.labelNodes;r.next();)r.value.invalidateConnectedLinks(t)}this.isSubGraphExpanded=!0}get isSubGraphExpanded(){return 0!=(512&this.z)}set isSubGraphExpanded(t){var e=0!=(512&this.z);if(e!==t){Xt.t(t,"boolean",j,"isSubGraphExpanded"),this.z=512^this.z;var i=this.diagram,e=(this.i("isSubGraphExpanded",e,t),this.subGraphExpandedChanged);if(null!==e){let t=!0;null!==i&&(t=i.W,i.W=!0),e(this),null!==i&&(i.W=t)}null!==i&&i.undoManager.isUndoingRedoing?(null!==this.Et&&this.Et.u(),this.memberParts.each(t=>t.updateAdornments())):t?this.expandSubGraph():this.collapseSubGraph()}}get wasSubGraphExpanded(){return 0!=(1024&this.z)}set wasSubGraphExpanded(t){var e=0!=(1024&this.z);e!==t&&(Xt.t(t,"boolean",j,"wasSubGraphExpanded"),this.z=1024^this.z,this.i("wasSubGraphExpanded",e,t))}get subGraphExpandedChanged(){return null!==this.bt?this.bt.ky:null}set subGraphExpandedChanged(t){var e=this.subGraphExpandedChanged;e!==t&&(null!==t&&Xt.t(t,"function",j,"subGraphExpandedChanged"),this.wl(),this.bt.ky=t,this.i("subGraphExpandedChanged",e,t))}move(t,e){var i=(e=void 0===e?!1:e)?this.location:this.position,s=i.x,i=i.y,n=t.x,r=t.y;if(!(s===n||isNaN(s)&&isNaN(n))||!(i===r||isNaN(i)&&isNaN(r))){for(var a=n-(isNaN(s)?0:s),o=r-(isNaN(i)?0:i),h=U.a(),l=(super.move(t,e),new C),u=this.findSubGraphParts().iterator;u.next();){var d=u.value;d instanceof q&&(d.wn&&l.add(d),d.Re||d.fromNode!==this&&d.toNode!==this)&&(d.wn=!0)}for(u.reset();u.next();){var c,g,m=u.value;m.Il()||m instanceof D&&m.isLinkLabel||(c=m.position,g=m.location,c.isReal()?(h.x=c.x+a,h.y=c.y+o,m.position=h):g.isReal()&&(h.x=g.x+a,h.y=g.y+o,m.location=h))}for(u.reset();u.next();){var f,p=u.value;p instanceof q&&(p.wn=l.contains(p),p.Re||p.fromNode!==this&&p.toNode!==this)&&(f=p.position,h.x=f.x+a,h.y=f.y+o,h.isReal()?p.move(h):p.invalidateRoute())}U.o(h)}}NO(){return 0!=(65536&this.z)}PA(t){0!=(65536&this.z)!==t&&(this.z=65536^this.z)}get sl(){return 0!=(32768&this.z)}set sl(t){0!=(32768&this.z)!==t&&(this.z=32768^this.z)}}class je extends y{ei;$d;constructor(t){super(),this.ei=E.qg,this.$d=new Z(NaN,NaN,NaN,NaN),t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.ei=this.ei.L(),t.$d=this.$d.copy()}dh(t){var e;return null!==this.background&&(e=this.naturalBounds,Z.contains(0,0,e.width,e.height,t.x,t.y))}ld(t,e,i,s){var n=this.part;if(null!==n&&(n instanceof j||n instanceof X)||Xt.n("Placeholder is not inside a Group or Adornment."),n instanceof j){var r=this.computeBorder(this.$d),a=this.minSize,o=isFinite(a.width)?Math.max(a.width,r.width):r.width,a=isFinite(a.height)?Math.max(a.height,r.height):r.height,h=this.Hi,l=(h.Do(o||0,a||0),this.oo(0,0,h.width,h.height),n.memberParts);let t=!1;for(;l.next();)if(l.value.isVisible()){t=!0;break}o=n.diagram;!t||null===o||o.animationManager.OM(n)||isNaN(r.x)||isNaN(r.y)||((a=U.a()).setRectSpot(r,n.locationSpot),n.location=a,U.o(a))}else{var h=n,o=this.Hi,r=this.ei,a=r.left+r.right,n=r.top+r.bottom,u=h.adornedObject,d=u.getDocumentAngle();h.angle=d;let t=0;u instanceof V&&(t=u.strokeWidth);var d=u.getDocumentScale(),c=u.naturalBounds,g=(c.width+t)*d,c=(c.height+t)*d;h.type!==jt.Link&&(d="Selection"===h.category?J.TopLeft:h.locationSpot,d=u.getDocumentPoint(d,U.a()),h.location=d,U.o(d)),isNaN(g)||isNaN(c)?(h=u.getDocumentPoint(J.TopLeft,U.a()),(d=Z.H(h.x,h.y,0,0)).unionPoint(u.getDocumentPoint(J.BottomRight,h)),d.unionPoint(u.getDocumentPoint(J.TopRight,h)),d.unionPoint(u.getDocumentPoint(J.BottomLeft,h)),o.Do(d.width+a||0,d.height+n||0),this.oo(-r.left,-r.top,o.width,o.height),U.o(h),Z.o(d)):(o.Do(g+a||0,c+n||0),this.oo(-r.left,-r.top,o.width,o.height))}}gh(t,e,i,s){this.actualBounds.e(t,e,i,s)}computeBorder(t){var e=this.part,i=e.diagram,s=null===i||!i.animationManager.isAnimating;if(null!==i&&e instanceof j&&!e.layer.isTemporary&&e.computesBoundsAfterDrag&&this.$d.isReal()){var n=i.toolManager.findTool("Dragging");if(n===i.currentTool){i=n.computeBorder(e,this.$d,t);if(null!==i)return i}}var n=Z.a(),i=this.computeMemberBounds(n),r=this.ei;return e instanceof j&&!e.isSubGraphExpanded?t.e(i.x-r.left,i.y-r.top,0,0):t.e(i.x-r.left,i.y-r.top,Math.max(i.width+r.left+r.right,0),Math.max(i.height+r.top+r.bottom,0)),Z.o(n),s&&e instanceof j&&e.computesBoundsIncludingLocation&&e.location.isReal()&&t.unionPoint(e.location),t}computeMemberBounds(n){if(this.part instanceof j){var r=this.part;let t=1/0,e=1/0,i=-1/0,s=-1/0;for(var a,o=r.memberParts;o.next();){var h=o.value;!h.isVisible()||h instanceof q&&(!r.computesBoundsIncludingLinks||h.Ko()||h.fromNode===r||h.toNode===r)||((h=h.actualBounds).left<t&&(t=h.left),h.top<e&&(e=h.top),h.right>i&&(i=h.right),h.bottom>s&&(s=h.bottom))}isFinite(t)&&isFinite(e)?n.e(t,e,i-t,s-e):(a=r.location,n.e(a.x,a.y,0,0))}else n.e(0,0,0,0);return n}get padding(){return this.ei}set padding(t){"number"==typeof t?t=new E(t):Xt.s(t,E,je,"padding");var e=this.ei;e.equals(t)||(t=t.L(),this.ei=t,this.i("padding",e,t),this.u())}}class Qe{b;da;Qd;Lr;_d;tg;zo;xl;ig;eg;ko;constructor(t){C.ji(this),this.b=null,this.da=null,this.Qd=!0,this.Lr=!0,this._d=!1,this.tg=new U(0,0).w(),this.zo=!0,this.xl=null,this.ig=null,this.eg=!1,this.ko=null,t&&Object.assign(this,t)}cloneProtected(t){t.Qd=this.Qd,t.Lr=this.Lr,t._d=this._d,t.tg.c(this.tg),t.zo=this.zo,t.xl=this.xl,t.ig=this.ig,t.eg=!0}copy(){var t=new this.constructor;return this.cloneProtected(t),t}ci(t){Xt.gr(this,t)}toString(){let t=Xt.an(this.constructor);return t+="(",null!==this.group&&(t+=" in "+this.group),null!==this.diagram&&(t+=" for "+this.diagram),t+=")"}get diagram(){return this.b}set diagram(t){null!==t&&Xt.s(t,K,Qe,"diagram"),this.b=t}get group(){return this.da}set group(t){this.da!==t&&(null!==t&&Xt.s(t,j,Qe,"group"),null!==(this.da=t))&&(this.b=t.diagram)}get isOngoing(){return this.Qd}set isOngoing(t){this.Qd!==t&&(Xt.t(t,"boolean",Qe,"isOngoing"),this.Qd=t)}get isInitial(){return this.Lr}set isInitial(t){Xt.t(t,"boolean",Qe,"isInitial"),(this.Lr=t)||(this.eg=!0)}get isViewportSized(){return this._d}set isViewportSized(t){this._d!==t&&(Xt.t(t,"boolean",Qe,"isViewportSized"),this._d=t)&&this.invalidateLayout()}get isRouting(){return this.zo}set isRouting(t){this.zo!==t&&(Xt.t(t,"boolean",Qe,"isRouting"),this.zo=t)}get isRealtime(){return this.xl}set isRealtime(t){this.xl!==t&&(null!==t&&Xt.t(t,"boolean",Qe,"isRealtime"),this.xl=t)}get isValidLayout(){return this.eg}set isValidLayout(t){this.eg===t||(Xt.t(t,"boolean",Qe,"isValidLayout"),this.eg=t)||null!==(t=this.diagram)&&(t.Jr=!0)}invalidateLayout(){var t,e;this.isValidLayout&&null!==(t=this.diagram)&&!t.undoManager.isUndoingRedoing&&!(e=t.animationManager).isTicking&&(e.defaultAnimation.isAnimating&&e.stopAnimation(),this.isOngoing&&t.Uh||this.isInitial&&!t.Uh)&&(this.isValidLayout=!1,t.requestUpdate())}get network(){return this.ko}set network(t){this.ko!==t&&(null!==t&&Xt.s(t,Ue,Qe,"network"),null!==(this.ko=t))&&(t.layout=this)}createNetwork(){return new Ue(this)}makeNetwork(t){var e=this.createNetwork();return t instanceof K?(e.addParts(t.nodes,!0),e.addParts(t.links,!0)):t instanceof j?e.addParts(t.memberParts):e.addParts(t.iterator),e}updateParts(){this.isValidLayout=!0;let t=this.diagram;if(null===t&&null!==this.network)for(var e=this.network.vertexes.iterator;e.next();){var i=e.value.node;if(null!==i&&null!==(t=i.diagram))break}try{null!==t&&t.startTransaction("Layout"),this.commitLayout()}finally{null!==t&&t.commitTransaction("Layout")}}commitLayout(){if(null!==this.network){for(var t=this.network.vertexes.iterator;t.next();)t.value.commit();if(this.isRouting)for(var e=this.network.edges.iterator;e.next();)e.value.commit()}}doLayout(t){Yt,null===t&&Xt.n("Layout.doLayout(collection) argument must not be null but a Diagram, a Group, or an Iterable of Parts");var e=new C;t instanceof K?(this.Ch(e,t.nodes,!0,this.sl,!0,!1,!0),this.Ch(e,t.parts,!0,this.sl,!0,!1,!0)):t instanceof j?this.Ch(e,t.memberParts,!1,this.sl,!0,!1,!0):e.addAll(t.iterator),0<e.count&&(null!==(t=this.diagram)&&t.startTransaction("Layout"),this.doMinimalNoNetworkLayout(e),null!==t)&&t.commitTransaction("Layout"),this.isValidLayout=!0}doMinimalNoNetworkLayout(t){var e=t.count,i=Math.ceil(Math.sqrt(e)),s=(this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin),this.arrangementOrigin.x);let n=s,r=this.arrangementOrigin.y,a=0,o=0;for(var h=t.iterator;h.next();){var l=h.value,u=(l.ensureBounds(),l.measuredBounds),d=u.width,u=u.height;l.moveTo(n,r),l instanceof j&&(l.sl=!1),n+=Math.max(d,50)+20,o=Math.max(o,Math.max(u,50)),a>=i-1?(a=0,n=s,r+=o+20,o=0):a++}}doMinimalNetworkLayout(){var t=this.network.vertexes.count,e=Math.ceil(Math.sqrt(t)),i=(this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin),this.arrangementOrigin.x);let s=i,n=this.arrangementOrigin.y,r=0,a=0;for(var o=this.network.vertexes.iterator;o.next();){var h,l,u=o.value.node;null===u||u instanceof q||(u.ensureBounds(),!this.sl(u))||(h=(l=u.measuredBounds).width,l=l.height,u.moveTo(s,n),u instanceof j&&(u.sl=!1),s+=Math.max(h,50)+20,a=Math.max(a,Math.max(l,50)),r>=e-1?(r=0,s=i,n+=a+20,a=0):r++)}}sl(t){return!!(!t.location.isReal()&&!t.position.isReal()||t instanceof j&&t.sl)}Ch(t,e,i,s,n,r,a){for(var o=e.iterator;o.next();){var h=o.value;i&&!h.isTopLevel||null!==s&&!s(h)||!h.canLayout()||(n&&h instanceof D?h.isLinkLabel||(h instanceof j&&null===h.layout?this.Ch(t,h.memberParts,!1,s,n,r,a):(h.ensureBounds(),t.add(h))):r&&h instanceof q?t.add(h):!a||!h.De()||h instanceof D||(h.ensureBounds(),t.add(h)))}}getLayoutBounds(t,e){var i=this.boundsComputation;return null!==i?i(t,this,e=e||new Z):!e&&t.margin.equalTo(0,0,0,0)?t.actualBounds:((e=e||new Z).set(t.actualBounds),e.addMargin(t.margin),e)}get boundsComputation(){return this.ig}set boundsComputation(t){this.ig!==t&&(null!==t&&Xt.t(t,"function",Qe,"boundsComputation"),this.ig=t,this.invalidateLayout())}collectParts(t){var e=new C;return t instanceof K?(this.Ch(e,t.nodes,!0,null,!0,!0,!0),this.Ch(e,t.links,!0,null,!0,!0,!0),this.Ch(e,t.parts,!0,null,!0,!0,!0)):t instanceof j?this.Ch(e,t.memberParts,!1,null,!0,!0,!0):this.Ch(e,t.iterator,!1,null,!0,!0,!0),e}get arrangementOrigin(){return this.tg}set arrangementOrigin(t){Xt.s(t,U,Qe,"arrangementOrigin"),this.tg.equals(t)||(this.tg.c(t),this.invalidateLayout())}initialOrigin(t){var e,i,s=this.group;return null!==s?s.hasPlaceholder()?(e=(i=s.placeholder).getDocumentPoint(J.TopLeft),(isNaN(e.x)||isNaN(e.y))&&e.set(t),i=i.padding,e.x+=i.left,e.y+=i.top,e):(i=s.position.copy(),(isNaN(i.x)||isNaN(i.y))&&i.set(t),i):t}}class Ue{le;So;In;Ay;Ly;constructor(t){C.ji(this),Yt,t||Xt.n("LayoutNetwork constructor requires non-null Layout argument"),this.le=t,this.So=new C,this.In=new C,this.Ay=new L,this.Ly=new L}clear(){if(this.So)for(var t=this.So.iterator;t.next();)t.value.clear();if(this.In)for(var e=this.In.iterator;e.next();)e.value.clear();this.So=new C,this.In=new C,this.Ay=new L,this.Ly=new L}toString(t){void 0===t&&(t=0);let e="LayoutNetwork"+(null!==this.layout?"("+this.layout.toString()+")":"");if(!(t<=0)&&(e+=" vertexes: "+this.So.count+" edges: "+this.In.count,1<t)){for(var i=this.So.iterator;i.next();){var s=i.value;e+=`
    `+s.toString(t-1)}for(var n=this.In.iterator;n.next();){var r=n.value;e+=`
    `+r.toString(t-1)}}return e}get layout(){return this.le}set layout(t){null!==t&&(this.le=t)}get vertexes(){return this.So}get edges(){return this.In}createVertex(){return new We(this)}createEdge(){return new Ze(this)}addParts(t,e,i){if(null!==t){void 0===e&&(e=!1),Xt.t(e,"boolean",Ue,"addParts:toplevelonly"),null===(i=void 0===i?null:i)&&(i=t=>{var e;return t instanceof D?!t.isLinkLabel:t instanceof q&&null!==(e=t.fromNode)&&!e.isLinkLabel&&!(null===(e=t.toNode)||e.isLinkLabel)});for(var s=t.iterator;s.next();){var n,r=s.value;r instanceof D&&(!e||r.isTopLevel)&&r.canLayout()&&i(r)&&(r instanceof j&&null===r.layout?this.addParts(r.memberParts,!1):null===this.findVertex(r)&&((n=this.createVertex()).node=r,this.addVertex(n)))}for(s.reset();s.next();){var a,o,h=s.value;h instanceof q&&(!e||h.isTopLevel)&&h.canLayout()&&i(h)&&null===this.findEdge(h)&&(a=h.fromNode,o=h.toNode,null!==a)&&null!==o&&a!==o&&(a=this.findGroupVertex(a),o=this.findGroupVertex(o),this.linkVertexes(a,o,h))}}}findGroupVertex(i){if(null!==i){i=i.findVisibleNode();if(null!==i){let t=this.findVertex(i);if(null!==t)return t;let e=i.containingGroup;for(;null!==e;){if(null!==(t=this.findVertex(e)))return t;e=e.containingGroup}}}return null}addVertex(t){var e;null!==t&&(Yt,Xt.s(t,We,Ue,"addVertex:vertex"),this.So.add(t),null!==(e=t.node)&&this.Ay.add(e,t),t.network=this)}addNode(t){if(null===t)return null;Yt,Xt.s(t,D,Ue,"addNode:node");let e=this.findVertex(t);return null===e&&((e=this.createVertex()).node=t,this.addVertex(e)),e}deleteVertex(i){if(null!==i&&(Yt,Xt.s(i,We,Ue,"deleteVertex:vertex"),this.gT(i))){let e=i.rr;for(let t=e.count-1;0<=t;t--){var s=e.elt(t);this.deleteEdge(s)}for(let t=(e=i.lr).count-1;0<=t;t--){var n=e.elt(t);this.deleteEdge(n)}}}gT(t){var e;return null!==t&&((e=this.So.remove(t))&&null!==(t=t.node)&&this.Ay.remove(t),e)}deleteNode(t){null!==t&&(Yt,Xt.s(t,D,Ue,"deleteNode:node"),null!==(t=this.findVertex(t)))&&this.deleteVertex(t)}findVertex(t){return null===t?null:(Yt,Xt.s(t,D,Ue,"findVertex:node"),this.Ay.getValue(t))}addEdge(t){var e;null!==t&&(Yt,Xt.s(t,Ze,Ue,"addEdge:edge"),this.pN(t),null!==(e=t.toVertex)&&e.addSourceEdge(t),null!==(e=t.fromVertex))&&e.addDestinationEdge(t)}pN(t){var e;null!==t&&(this.In.add(t),null!==(e=t.link)&&null===this.findEdge(e)&&this.Ly.add(e,t),t.network=this)}addLink(t){if(null===t)return null;Yt,Xt.s(t,q,Ue,"addLink:link");var e=t.fromNode,i=t.toNode;let s=this.findEdge(t);return null===s?((s=this.createEdge()).link=t,null!==e&&(s.fromVertex=this.addNode(e)),null!==i&&(s.toVertex=this.addNode(i)),this.addEdge(s)):(s.fromVertex=null!==e?this.addNode(e):null,s.toVertex=null!==i?this.addNode(i):null),s}deleteEdge(t){var e;null!==t&&(Yt,Xt.s(t,Ze,Ue,"deleteEdge:edge"),null!==(e=t.toVertex)&&e.deleteSourceEdge(t),null!==(e=t.fromVertex)&&e.deleteDestinationEdge(t),this.yN(t))}yN(t){var e;return null!==t&&((e=this.In.remove(t))&&null!==(t=t.link)&&this.Ly.remove(t),e)}deleteLink(t){null!==t&&(Yt,Xt.s(t,q,Ue,"deleteLink:link"),null!==(t=this.findEdge(t)))&&this.deleteEdge(t)}findEdge(t){return null===t?null:(Yt,Xt.s(t,q,Ue,"findEdge:link"),this.Ly.getValue(t))}linkVertexes(t,e,i){var s;return null!==t&&null!==e&&((Yt,Xt.s(t,We,Ue,"linkVertexes:fromVertex"),Xt.s(e,We,Ue,"linkVertexes:toVertex"),null!==i)&&Xt.s(i,q,Ue,"linkVertexes:link"),t.network===this)&&e.network===this?((s=this.createEdge()).link=i,s.fromVertex=t,s.toVertex=e,this.addEdge(s),s):null}reverseEdge(t){var e,i;null!==t&&(Yt,Xt.s(t,Ze,Ue,"reverseEdge:edge"),e=t.fromVertex,i=t.toVertex,null!==e)&&null!==i&&(e.deleteDestinationEdge(t),i.deleteSourceEdge(t),t.reverseEdge(),e.addSourceEdge(t),i.addDestinationEdge(t))}deleteSelfEdges(){for(var e=Xt.ct(),t=this.In.iterator;t.next();){var i=t.value;i.fromVertex===i.toVertex&&e.push(i)}var s=e.length;for(let t=0;t<s;t++)this.deleteEdge(e[t]);Xt.ot(e)}deleteArtificialVertexes(){for(var e=Xt.ct(),t=this.So.iterator;t.next();){var i=t.value;null===i.node&&null===i.data&&e.push(i)}let s=e.length;for(let t=0;t<s;t++)this.deleteVertex(e[t]);for(var n=Xt.ct(),r=this.In.iterator;r.next();){var a=r.value;null===a.link&&null===a.data&&n.push(a)}s=n.length;for(let t=0;t<s;t++)this.deleteEdge(n[t]);Xt.ot(e),Xt.ot(n)}deleteUselessEdges(){for(var e=Xt.ct(),t=this.In.iterator;t.next();){var i=t.value;null!==i.fromVertex&&null!==i.toVertex||e.push(i)}var s=e.length;for(let t=0;t<s;t++)this.deleteEdge(e[t]);Xt.ot(e)}isSingleton(t){return!(0<t.rr.count||0<t.lr.count)}splitIntoSubNetworks(t){(t=void 0===t?!0:t)&&(this.deleteArtificialVertexes(),this.deleteUselessEdges(),this.deleteSelfEdges());var e=new O;let i=!0;for(;i;){i=!1;for(var s=this.So.iterator;s.next();){var n=s.value;if(!this.isSingleton(n)){var r=this.layout.createNetwork();e.add(r),this.CO(r,n),i=!0;break}}}return e.sort((t,e)=>null===t||null===e||t===e?0:e.vertexes.count-t.vertexes.count),e}CO(e,t){if(null!==t){var i=new O;for(i.add(t);0<i.count;){var s=i.first();if(i.removeAt(0),s.network!==e){this.gT(s),e.addVertex(s);let t=s.sourceEdges;for(;t.next();){var n=t.value;n.network!==e&&(this.yN(n),e.pN(n),i.add(n.fromVertex))}for(t=s.destinationEdges;t.next();){var r=t.value;r.network!==e&&(this.yN(r),e.pN(r),i.add(r.toVertex))}}}}}findAllParts(){for(var t=new C,e=this.So.iterator;e.next();){var i=e.value;t.add(i.node)}for(var s=this.In.iterator;s.next();){var n=s.value;t.add(n.link)}return t}}class We{ko;si;be;Be;ts;rr;lr;constructor(t){C.ji(this),Yt,t||Xt.n("LayoutVertex constructor requires non-null LayoutNetwork argument"),this.ko=t,this.Be=new Z(0,0,10,10).w(),this.ts=new U(5,5).w(),this.si=null,this.be=null,this.rr=new O,this.lr=new O}clear(){this.si=null,this.be=null,this.rr=new O,this.lr=new O}toString(t){void 0===t&&(t=0);let n="LayoutVertex#"+C.ps(this);if(0<t&&(n+=null!==this.node?"("+this.node.toString()+")":"",1<t)){let t="",e=!0,i=this.rr.iterator;for(;i.next();){var r=i.value;e?e=!1:t+=",",t+=r.toString(0)}let s="";for(e=!0,i=this.lr.iterator;i.next();){var a=i.value;e?e=!1:s+=",",s+=a.toString(0)}n+=" sources: "+t+" destinations: "+s}return n}get Mo(){return this.rr._N}get hr(){return this.lr._N}get data(){return this.si}set data(t){var e,i,s;null!==(this.si=t)&&t.bounds&&(e=(t=t.bounds).x,i=t.y,s=t.width,t=t.height,this.ts.e(s/2,t/2),this.Be.e(e,i,s,t))}get node(){return this.be}set node(i){if(this.be!==i){Yt,null!==i&&Xt.s(i,D,We,"node"),(this.be=i).ensureBounds();var s=this.network.layout,n=Z.a(),s=s.getLayoutBounds(i,n);let t=s.x,e=s.y;var r=s.width,s=s.height;if(isNaN(t)&&(t=0),isNaN(e)&&(e=0),this.Be.e(t,e,r,s),Z.o(n),!(i instanceof j)){n=i.locationObject.getDocumentPoint(J.Center);if(n.isReal())return void this.ts.e(n.x-t,n.y-e)}this.ts.e(r/2,s/2)}}get bounds(){return this.Be}set bounds(t){this.Be.equals(t)||(Yt,Xt.s(t,Z,We,"bounds"),this.Be.c(t))}get focus(){return this.ts}set focus(t){this.ts.equals(t)||(Yt,Xt.s(t,U,We,"focus"),this.ts.c(t))}get centerX(){return this.Be.x+this.ts.x}set centerX(t){var e=this.Be;e.x+this.ts.x!==t&&(Yt,Xt.r(t,We,"centerX"),e.ut(),e.x=t-this.ts.x,e.w())}get centerY(){return this.Be.y+this.ts.y}set centerY(t){var e=this.Be;e.y+this.ts.y!==t&&(Yt,Xt.r(t,We,"centerY"),e.ut(),e.y=t-this.ts.y,e.w())}get focusX(){return this.ts.x}set focusX(t){var e=this.ts;e.x!==t&&(e.ut(),e.x=t,e.w())}get focusY(){return this.ts.y}set focusY(t){var e=this.ts;e.y!==t&&(e.ut(),e.y=t,e.w())}get x(){return this.Be.x}set x(t){var e=this.Be;e.x!==t&&(e.ut(),e.x=t,e.w())}get y(){return this.Be.y}set y(t){var e=this.Be;e.y!==t&&(e.ut(),e.y=t,e.w())}get width(){return this.Be.width}set width(t){var e=this.Be;e.width!==t&&(e.ut(),e.width=t,e.w())}get height(){return this.Be.height}set height(t){var e=this.Be;e.height!==t&&(e.ut(),e.height=t,e.w())}commit(){var t=this.si;if(null!==t)i=this.bounds,e=t.bounds,Xt.Mt(e)?(e.x=i.x,e.y=i.y,e.width=i.width,e.height=i.height):t.bounds=i.copy();else{var e=this.node;if(null!==e){t=this.bounds;if(!(e instanceof j)){var i=Z.a(),s=(e.ensureBounds(),this.network.layout.getLayoutBounds(e,i)),n=e.locationObject.getDocumentPoint(J.Center);if(s.isReal()&&n.isReal())return e.moveTo(t.x+this.focusX-(n.x-s.x),t.y+this.focusY-(n.y-s.y)),void Z.o(i);Z.o(i)}e.moveTo(t.x,t.y)}}}addSourceEdge(t){null!==t&&(Yt,Xt.s(t,Ze,We,"addSourceEdge:edge"),this.rr.contains(t)||this.rr.add(t))}deleteSourceEdge(t){null!==t&&(Yt,Xt.s(t,Ze,We,"deleteSourceEdge:edge"),this.rr.remove(t))}addDestinationEdge(t){null!==t&&(Yt,Xt.s(t,Ze,We,"addDestinationEdge:edge"),this.lr.contains(t)||this.lr.add(t))}deleteDestinationEdge(t){null!==t&&(Yt,Xt.s(t,Ze,We,"deleteDestinationEdge:edge"),this.lr.remove(t))}get network(){return this.ko}set network(t){Yt,Xt.s(t,Ue,We,"network"),this.ko=t}get sourceVertexes(){for(var t=new C,e=this.sourceEdges;e.next();){var i=e.value;t.add(i.fromVertex)}return t.iterator}get destinationVertexes(){for(var t=new C,e=this.destinationEdges;e.next();){var i=e.value;t.add(i.toVertex)}return t.iterator}get vertexes(){var t=new C;let e=this.sourceEdges;for(;e.next();){var i=e.value;t.add(i.fromVertex)}for(e=this.destinationEdges;e.next();){var s=e.value;t.add(s.toVertex)}return t.iterator}get sourceEdges(){return this.rr.iterator}get destinationEdges(){return this.lr.iterator}get edges(){var t=new O;let e=this.sourceEdges;for(;e.next();){var i=e.value;t.add(i)}for(e=this.destinationEdges;e.next();){var s=e.value;t.add(s)}return t.iterator}get edgesCount(){return this.rr.count+this.lr.count}static standardComparer(t,e){Yt,Xt.s(t,We,We,"standardComparer:m"),Yt,Xt.s(e,We,We,"standardComparer:n");var i,t=t.be,e=e.be;return t?e?(t=t.text)<(i=e.text)?-1:i<t?1:0:1:null!==e?-1:0}static smartComparer(e,i){if(Yt,Xt.s(e,We,We,"smartComparer:m"),Yt,Xt.s(i,We,We,"smartComparer:n"),null===e)return null!==i?-1:0;if(null===i)return 1;e=e.be,i=i.be;if(null===e)return null!==i?-1:0;if(null===i)return 1;{var e=e.text.toLocaleLowerCase(),i=i.text.toLocaleLowerCase(),s=e.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/),n=i.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/);let t=0;for(;t<s.length;t++){if(""!==n[t]&&void 0!==n[t]){var r=parseFloat(s[t]),a=parseFloat(n[t]);if(isNaN(r)){if(isNaN(a)){if(0!==s[t].localeCompare(n[t]))return s[t].localeCompare(n[t]);continue}return 1}if(isNaN(a))return-1;if(r-a!=0)return r-a;continue}if(""===s[t])continue;return 1}return""!==n[t]&&void 0!==n[t]?-1:0}}}class Ze{ko;si;_e;is;es;constructor(t){C.ji(this),Yt,t||Xt.n("LayoutEdge constructor requires non-null LayoutNetwork argument"),this.ko=t,this.si=null,this._e=null,this.is=null,this.es=null}clear(){this.si=null,this._e=null,this.is=null,this.es=null}toString(t){void 0===t&&(t=0);let e="LayoutEdge#"+C.ps(this);return 0<t&&(e+=null!==this._e?"("+this._e.toString()+")":"",1<t)&&(e+=" "+(this.is?this.is.toString():"null")+" --\x3e "+(this.es?this.es.toString():"null")),e}reverseEdge(){var t=this.is;this.is=this.es,this.es=t}commit(){}getOtherVertex(t){return Yt,Xt.s(t,We,Ze,"getOtherVertex:v"),this.es===t?this.is:this.is===t?this.es:null}get network(){return this.ko}set network(t){Yt,Xt.s(t,Ue,Ze,"network"),this.ko=t}get data(){return this.si}set data(t){this.si!==t&&(Yt,null!==t&&Xt.t(t,"object",Ze,"data"),this.si=t)}get link(){return this._e}set link(t){this._e!==t&&(Yt,null!==t&&Xt.s(t,q,Ze,"link"),this._e=t)}get fromVertex(){return this.is}set fromVertex(t){this.is!==t&&(Yt,null!==t&&Xt.s(t,We,Ze,"fromVertex"),this.is=t)}get toVertex(){return this.es}set toVertex(t){this.es!==t&&(Yt,null!==t&&Xt.s(t,We,Ze,"toVertex"),this.es=t)}}(s={})[s.Position=0]="Position",s[s.Location=1]="Location";var Je=s,_e=((s={})[s.LeftToRight=10]="LeftToRight",s[s.RightToLeft=11]="RightToLeft",s),$e=((s={})[s.Forwards=20]="Forwards",s[s.Reverse=21]="Reverse",s[s.Ascending=22]="Ascending",s[s.Descending=23]="Descending",s);class ti extends Qe{sg;ng;Oo;On;fi;vi;Pe;Ne;constructor(t){super(),this.isViewportSized=!0,this.sg=NaN,this.ng=NaN,this.Oo=new qt(NaN,NaN).w(),this.On=new qt(10,10).w(),this.fi=1,this.vi=10,this.Pe=22,this.Ne=ti.standardComparer,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.sg=this.sg,t.ng=this.ng,t.Oo.c(this.Oo),t.On.c(this.On),t.fi=this.fi,t.vi=this.vi,t.Pe=this.Pe,t.Ne=this.Ne}ci(t){t in $e?this.sorting=t:t in _e?this.arrangement=t:t in Je?this.alignment=t:super.ci(t)}doLayout(o){Yt,null===o&&Xt.n("Layout.doLayout(collection) argument must not be null but a Diagram, a Group, or an Iterable of Parts"),this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);for(var t=this.collectParts(o),o=this.diagram,e=t.copy().iterator;e.next();){var i=e.value;if(!i.Il()||null===i.fromNode&&null===i.toNode){if(i.ensureBounds(),i instanceof j)for(var s=i.memberParts;s.next();){var n=s.value;t.remove(n)}}else t.remove(i)}var h,l,u=t.toArray();if(0!==u.length){switch(this.sorting){case 20:break;case 21:u.reverse();break;case 22:u.sort(this.comparer);break;case 23:u.sort(this.comparer),u.reverse()}let t=this.wrappingColumn,e=(isNaN(t)&&(t=0),this.wrappingWidth);e=isNaN(e)&&null!==o?(h=o.viewportBounds,l=o.padding,Math.max(h.width-l.left-l.right,0)):Math.max(this.wrappingWidth,0),t<=0&&e<=0&&(t=1);let i=this.spacing.width,s=(isFinite(i)||(i=0),this.spacing.height);isFinite(s)||(s=0),null!==o&&o.startTransaction("Layout");var d=[];switch(this.alignment){case 0:this.AO(u,e,t,i,s,d);break;case 1:this.LO(u,e,t,i,s,d)}let n=0,r=0,a=0;for(let t=0;t<d.length;t++){var c=d[t];n=Math.min(n,c.x),r=Math.min(r,c.y),a=Math.max(a,c.x+c.width)}11===this.arrangement?this.commitLayers(d,new U(n+i/2-(a+n),r-s/2)):this.commitLayers(d,new U(n-i/2,r-s/2)),null!==o&&o.commitTransaction("Layout"),this.isValidLayout=!0}}AO(s,n,r,a,o,h){var l=Z.a();let u=Math.max(this.cellSize.width,1);if(!isFinite(u))for(let t=u=0;t<s.length;t++){var e=s[t],e=this.getLayoutBounds(e,l);u=Math.max(u,e.width)}u+=a,u=Math.max(u,1);let d=Math.max(this.cellSize.height,1);if(!isFinite(d))for(let t=d=0;t<s.length;t++){var i=s[t],i=this.getLayoutBounds(i,l);d=Math.max(d,i.height)}d+=o,d=Math.max(d,1);var c=this.arrangement,g=this.arrangementOrigin.x;let m=g,f=this.arrangementOrigin.y,p=0,v=0;for(let i=0;i<s.length;i++){var y=s[i],x=this.getLayoutBounds(y,l),A=Math.ceil((x.width+a)/u),w=Math.ceil((x.height+o)/d),A=A*u,w=w*d;let t=0,e=(t=11===c?Math.abs(m-x.width):m+x.width,(0<r&&p>r-1||0<n&&0<p&&t-g>n)&&(h.push(new Z(0,f,n+a,v)),p=0,m=g,f+=v,v=0),v=Math.max(v,w),0);e=11===c?-x.width:0,11===(y.moveTo(m+e,f),c)?m-=A:m+=A,p++}h.push(new Z(0,f,n+a,v)),Z.o(l)}LO(i,s,n,r,a,o){var h=Z.a();let l=Math.max(this.cellSize.width,1),e=0,u=0,d=0;var c=U.a();for(let t=0;t<i.length;t++){var g=i[t],m=this.getLayoutBounds(g,h),g=g.getRelativePoint(g.locationObject,g.locationSpot,c);e=Math.max(e,g.x),u=Math.max(u,m.width-g.x),d=Math.max(d,g.y)}var f=this.arrangement,p=(11===f?e+=r:u+=r,l=isFinite(l)?Math.max(l+r,1):Math.max(e+u,1),this.arrangementOrigin.x);let v=p,y=this.arrangementOrigin.y,x=0,A=(s>=e&&(s-=e),0),w=0;var b=Math.max(this.cellSize.height,1);let P=d=0,S=!0;var k=U.a();for(let e=0;e<i.length;e++){var M=i[e],N=this.getLayoutBounds(M,h),C=M.getRelativePoint(M.locationObject,M.locationSpot,c);if(0<x)switch(f){case 11:{let t=(v-p-(N.width-C.x))/l;t=I.q(Math.round(t),t)?Math.round(t):Math.floor(t),v=t*l+p;break}default:{let t=(v-p+C.x)/l;t=I.q(Math.round(t),t)?Math.round(t):Math.ceil(t),v=t*l+p;break}}else A=11===f?v+C.x+N.width:v-C.x;let t=0;if(t=11===f?-(v+C.x)+A:v+N.width-C.x-A,0<n&&x>n-1||0<s&&0<x&&t>s){o.push(new Z(0,S?y-d:y,s+r,P+d+a));for(let t=0;t<x&&e!==x;t++){var L=i[e-x+t],D=L.getRelativePoint(L.locationObject,L.locationSpot,k);L.moveTo(L.position.x,L.position.y+d-D.y)}P+=a,S?y+=P:y+=P+d,d=0,P=0,x=0,v=p,S=!1}11===(v===p&&(w=11===f?Math.max(w,N.width-C.x):Math.min(w,-C.x)),d=Math.max(d,C.y),P=Math.max(P,N.height-C.y),isFinite(b)&&(P=Math.max(P,Math.max(N.height,b)-C.y)),S?M.moveTo(v-C.x,y-C.y):M.moveTo(v-C.x,y),f)?v-=C.x+r:v+=N.width-C.x+r,x++}if(o.push(new Z(0,y,s+r,(S?P:P+d)+a)),i.length!==x)for(let t=0;t<x;t++){var T=i[i.length-x+t],B=T.getRelativePoint(T.locationObject,T.locationSpot,c);T.moveTo(T.position.x,T.position.y+d-B.y)}if(U.o(c),U.o(k),11===f)for(let t=0;t<o.length;t++){var G=o[t];G.width+=w,G.x-=w}else for(let t=0;t<o.length;t++){var F=o[t];F.x>w&&(F.width+=F.x-w,F.x=w)}Z.o(h)}commitLayers(t,e){}get wrappingWidth(){return this.sg}set wrappingWidth(t){this.sg!==t&&(Xt.t(t,"number",ti,"wrappingWidth"),0<t||isNaN(t))&&(this.sg=t,this.isViewportSized=isNaN(t),this.invalidateLayout())}get wrappingColumn(){return this.ng}set wrappingColumn(t){this.ng!==t&&(Xt.t(t,"number",ti,"wrappingColumn"),0<t||isNaN(t))&&(this.ng=t,this.invalidateLayout())}get cellSize(){return this.Oo}set cellSize(t){Xt.s(t,qt,ti,"cellSize"),this.Oo.equals(t)||(this.Oo.c(t),this.invalidateLayout())}get spacing(){return this.On}set spacing(t){Xt.s(t,qt,ti,"spacing"),this.On.equals(t)||(this.On.c(t),this.invalidateLayout())}get alignment(){return this.fi}set alignment(t){this.fi!==t&&(Xt.it(t,Je,"GridAlignment"),1===t||0===t)&&(this.fi=t,this.invalidateLayout())}get arrangement(){return this.vi}set arrangement(t){this.vi!==t&&(Xt.it(t,_e,"GridArrangement"),10===t||11===t)&&(this.vi=t,this.invalidateLayout())}get sorting(){return this.Pe}set sorting(t){this.Pe!==t&&(Xt.it(t,$e,"GridSorting"),20===t||21===t||22===t||23===t)&&(this.Pe=t,this.invalidateLayout())}get comparer(){return this.Ne}set comparer(t){this.Ne!==t&&(Xt.t(t,"function",ti,"comparer"),this.Ne=t,this.invalidateLayout())}static standardComparer(t,e){Yt,Xt.s(t,Y,ti,"standardComparer:a"),Yt,Xt.s(e,Y,ti,"standardComparer:b");t=t.text,e=e.text;return t<e?-1:e<t?1:0}static smartComparer(e,i){if(Yt,Xt.s(e,Y,ti,"standardComparer:a"),Yt,Xt.s(i,Y,ti,"standardComparer:b"),null===e)return null!==i?-1:0;if(null===i)return 1;{var e=e.text.toLocaleLowerCase(),i=i.text.toLocaleLowerCase(),s=e.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/),n=i.split(/([+-]?[.]?\d+(?:\.\d*)?(?:e[+-]?\d+)?)/);let t=0;for(;t<s.length;t++){if(""!==n[t]&&void 0!==n[t]){var r=parseFloat(s[t]),a=parseFloat(n[t]);if(isNaN(r)){if(isNaN(a)){if(0!==s[t].localeCompare(n[t]))return s[t].localeCompare(n[t]);continue}return 1}if(isNaN(a))return-1;if(r-a!=0)return r-a;continue}if(""===s[t])continue;return 1}return""!==n[t]&&void 0!==n[t]?-1:0}}static Position=0;static Location=1;static LeftToRight=10;static RightToLeft=11;static Forward=20;static Reverse=21;static Ascending=22;static Descending=23}class ei{og;_s;It;Ga;b;Ty;Po;bl;wN;constructor(){this.og=new C,this._s=new C,this.It=new C,this.Po=new L,this.bl=new L,this.Ga=new L,this.b=null,this.Ty=!1,this.wN=!0}clear(){this.og.clear(),this._s.clear(),this.It.clear(),this.Po.clear(),this.bl.clear(),this.Ga.clear()}Vo(t){Yt,null!==t&&Xt.s(t,K,ei,"setDiagram"),this.b=t}Qh(t){t instanceof D?(this.og.add(t),t instanceof j&&((null===(e=t.containingGroup)?this.b.Zr:e.ua).add(t),null!==(e=t.layout))&&(e.diagram=this.b)):t instanceof q?this._s.add(t):t instanceof X||this.It.add(t);var e=t.data;null===e||t instanceof X||(t instanceof q?this.mT(e,t):this.Po.add(e,t))}re(t){t.clearAdornments(),t instanceof D?(this.og.remove(t),t instanceof j&&((null===(e=t.containingGroup)?this.b.Zr:e.ua).remove(t),null!==(e=t.layout))&&(e.diagram=null)):t instanceof q?this._s.remove(t):t instanceof X||this.It.remove(t);var e=t.data;null===e||t instanceof X||(t instanceof q?this.pT(e,t):this.Po.remove(e))}mT(t,e){this.bl.add(t,e)}pT(t,e){this.bl.remove(t)}rebuildParts(){var t=this.b;if(null!==t){for(var e=t.nodeTemplateMap.iterator;e.next();){var i=e.value,s=e.key;(!i.De()||i instanceof j)&&Xt.n(`Invalid node template in Diagram.nodeTemplateMap: template for "${s}" must be a Node or a simple Part, not a Group or Link: `+i)}for(var n=t.groupTemplateMap.iterator;n.next();){var r=n.value,a=n.key;r instanceof j||Xt.n(`Invalid group template in Diagram.groupTemplateMap: template for "${a}" must be a Group, not a normal Node or Link: `+r)}for(var o=t.linkTemplateMap.iterator;o.next();){var h=o.value,l=o.key;h instanceof q||Xt.n(`Invalid link template in Diagram.linkTemplateMap: template for "${l}" must be a Link, not a normal Node or simple Part: `+h)}for(var u=Xt.ct(),d=t.selection.iterator;d.next();){var c=d.value.data;c&&u.push(c)}for(var g=Xt.ct(),m=t.highlighteds.iterator;m.next();){var f=m.value.data;f&&g.push(f)}var p=Xt.ct();if(this.preservesRebuildLocations){for(var v=this.nodes.iterator;v.next();){var y=v.value;null!==y.data&&(p.push(y.data),p.push(y.location))}for(var x=this.links.iterator;x.next();){var A=x.value;null!==A.data&&(p.push(A.data),p.push(A.location))}for(var w=this.parts.iterator;w.next();){var b=w.value;null!==b.data&&(p.push(b.data),p.push(b.location))}}this.yT(),this.RP();for(let t=0;t<u.length;t++){var P=this.findPartForData(u[t]);null!==P&&(P.isSelected=!0)}for(let t=0;t<g.length;t++){var S=this.findPartForData(g[t]);null!==S&&(S.isHighlighted=!0)}if(this.preservesRebuildLocations)for(let t=0;t<p.length;t+=2){var k=this.findPartForData(p[t]);null!==k&&(k.location=p[t+1])}Xt.ot(u),Xt.ot(g),Xt.ot(p)}}RP(){var t=this.diagram.model;this.Dy(t.nodeDataArray)}Dy(t,e){const i=this.diagram.model;t.forEach(t=>{i.containsNodeData(t)&&this.wT(t,!1)}),t.forEach(t=>{i.containsNodeData(t)&&this.Fb(t)}),!1!==e&&this.diagram.F1(!1)}wT(t,e){if(null==t||this.diagram.undoManager.isUndoingRedoing||this.Po.contains(t))return null;void 0===e&&(e=!0);var i=this.TO(t);return null!==i&&e&&this.Fb(t),i}TO(t){if(null!=t&&!this.b.undoManager.isUndoingRedoing&&!this.Po.contains(t)){var e=this.DO(t),i=this.findTemplateForNodeData(t,e);if(null!==i){i.ui();var s,i=i.copy();if(null!==i)return s=this.diagram.xe,this.diagram.xe=!0,i._o=e,i.si=t,this.Ty&&(i.ml="Tool"),this.diagram.add(i),i.si=null,i.data=t,this.diagram.xe=s,i}}return null}insertLink(t,e,i,s){return null}Fb(t){}DO(t){return this.b.model.getCategoryForNodeData(t)}static xT=!1;static bT=!1;findTemplateForNodeData(t,e){var i=this.b,s=i.model;let n=null;return s.ma()&&s.isGroupForData(t)?null===(n=i.groupTemplateMap.getValue(e))&&null===(n=i.groupTemplateMap.getValue(""))&&(ei.bT||(ei.bT=!0,Xt.ft('No Group template found for category "'+e+'"'),Xt.ft("  Using default group template")),n=i.OF):null===(n=i.nodeTemplateMap.getValue(e))&&null===(n=i.nodeTemplateMap.getValue(""))&&(ei.xT||(ei.xT=!0,Xt.ft('No Node template found for category "'+e+'"'),Xt.ft("  Using default node template")),n=i.RF),n}getLinkCategoryForData(t){return""}setLinkCategoryForData(t,e){}setFromNodeForLink(t,e,i){}setToNodeForLink(t,e,i){}static kT=!1;findLinkTemplateForCategory(t){var e=this.b;let i=e.linkTemplateMap.getValue(t);return null===i&&null===(i=e.linkTemplateMap.getValue(""))&&(ei.kT||(ei.kT=!0,Xt.ft('No Link template found for category "'+t+'"'),Xt.ft("  Using default link template")),i=e.IF),i}yI(t,e,i){t instanceof q?(null!==e&&this.pT(e,t),null!==i&&this.mT(i,t)):t instanceof Y&&(null!==e&&this.Po.remove(e),null!==i)&&this.Po.add(i,t)}yT(){var t=this.diagram.model;this.xN(t.nodeDataArray)}xN(t){t.forEach(t=>{this.Rb(t)})}Rb(t){t=this.findPartForData(t);null!==t&&(this.diagram.DP(t,!1),this.bN(t))}bN(t){}fN(t){}findPartForKey(t){return null!=t&&null!==(t=this.b.model.findNodeDataForKey(t))?this.Po.getValue(t):null}findNodeForKey(t){return null!=t&&null!==(t=this.b.model.findNodeDataForKey(t))&&(t=this.Po.getValue(t))instanceof D?t:null}findLinkForKey(t){return null}findPartForData(t){if(null===t)return null;let e=this.Po.getValue(t);return e=null===e?this.bl.getValue(t):e}findNodeForData(t){return null!==t&&(t=this.Po.getValue(t))instanceof D?t:null}findLinkForData(t,e){return null===t?null:this.bl.getValue(t)}findNodesByExample(){for(var e=new C,t=this.og.iterator;t.next();){var i=t.value,s=i.data;if(null!==s)for(let t=0;t<arguments.length;t++){var n=arguments[t];if(Xt.Mt(n)&&this.kN(s,n)){e.add(i);break}}}return e.iterator}findLinksByExample(){for(var e=new C,t=this._s.iterator;t.next();){var i=t.value,s=i.data;if(null!==s)for(let t=0;t<arguments.length;t++){var n=arguments[t];if(Xt.Mt(n)&&this.kN(s,n)){e.add(i);break}}}return e.iterator}kN(t,e){for(const h in e){var i=t[h],s=e[h];if(Array.isArray(s)){if(!Array.isArray(i))return!1;var n=i,r=s;if(n.length<r.length)return!1;for(let t=0;t<n.length;t++){var a=n[t],o=r[t];if(void 0!==o&&!this.ST(a,o))return!1}}else if(!this.ST(i,s))return!1}return!0}ST(t,e){if("function"==typeof e){if(!e(t))return!1}else if(e instanceof RegExp){if(!t||!e.test(t.toString()))return!1}else if(Xt.Mt(t)&&Xt.Mt(e)){if(!this.kN(t,e))return!1}else if(t!==e)return!1;return!0}doModelDataChanged(t){if(t.model===this.diagram.model&&this.diagram.W){this.diagram.W=!1;try{var e=t.change;""===t.modelChange&&2===e&&this.Fy(t.object,t.propertyName)}finally{this.diagram.W=!0}}}doModelChanged(t){if(this.b){var e=this.b;if(t.model===e.model){var i=t.change;if(e.bR(t),e.W){e.W=!1;try{var s,n,r,a,o,h,l,u,d,c=t.modelChange;""!==c?2===i?("nodeCategory"===c?(s=t.object,n=this.findPartForData(s),r=t.newValue,null!==n&&"string"==typeof r&&(n.category=r)):"nodeDataArray"===c&&(a=t.oldValue,this.xN(a),o=t.newValue,this.Dy(o)),e.isModified=!0):3===i?(h=t.newValue,"nodeDataArray"===c&&Xt.Mt(h)&&this.wT(h),e.isModified=!0):4===i?(l=t.oldValue,"nodeDataArray"===c&&Xt.Mt(l)&&this.Rb(l),e.isModified=!0):1===i&&("SourceChanged"===c?null!==t.object?this.Fy(t.object,t.propertyName):(this.updateAllRelationshipsFromData(),this.updateAllTargetBindings()):"ModelDisplaced"===c&&this.rebuildParts()):2===i?(u=t.propertyName,(d=t.object)===e.model?"nodeKeyProperty"!==u&&"nodeCategoryProperty"!==u||e.undoManager.isUndoingRedoing||this.rebuildParts():this.Fy(d,u),e.isModified=!0):3!==i&&4!==i||(this.FO(t),e.isModified=!0)}finally{e.W=!0}}}}}updateAllTargetBindings(t){void 0===t&&(t="");let e=this.parts.iterator;for(;e.next();)e.value.updateTargetBindings(t);for(e=this.nodes.iterator;e.next();)e.value.updateTargetBindings(t);for(e=this.links.iterator;e.next();)e.value.updateTargetBindings(t)}updateAllThemeBindings(){let t=this.parts.iterator;for(;t.next();)t.value.Uo();for(t=this.nodes.iterator;t.next();)t.value.Uo();for(t=this.links.iterator;t.next();)t.value.Uo()}updateAllRelationshipsFromData(){const e=this.b.model,i=new C,s=e.nodeDataArray;for(let t=0;t<s.length;t++){var n=s[t];i.add(n)}const r=[];this.nodes.each(t=>{null===t.data||i.contains(t.data)||r.push(t.data)}),this.parts.each(t=>{null===t.data||i.contains(t.data)||r.push(t.data)}),r.forEach(t=>e.MT(t,!1));for(let t=0;t<s.length;t++){var a=s[t];null===this.findPartForData(a)&&e.PT(a,!1)}this.NT();let t=this.parts.iterator;for(;t.next();)t.value.updateRelationshipsFromData();for(t=this.nodes.iterator;t.next();)t.value.updateRelationshipsFromData();for(t=this.links.iterator;t.next();)t.value.updateRelationshipsFromData()}NT(){}updateRelationshipsFromData(t){}Fy(t,e){if("string"==typeof e){var i=this.findPartForData(t);if(null!==i)i.updateTargetBindings(e);else{var s=this.RO(t);if(null!==s){for(let t=0;t<s.length;t++)s[t].updateTargetBindings(e);Xt.ot(s)}}t===this.diagram.model.modelData&&this.updateAllTargetBindings(e)}}RO(e){let i=null;for(var t=this.Ga.iterator;t.next();){var s=t.value;for(let t=0;t<s.length;t++){var n=s[t].findItemPanelForData(e);null!==n&&(i=null===i?Xt.ct():i).push(n)}if(null!==i)break}return i}FO(t){var e=t.object,i=3===t.change,s=i?t.newParam:t.oldParam,n=i?t.newValue:t.oldValue,r=this.Ga.getValue(e);if(Array.isArray(r))for(let t=0;t<r.length;t++){var a=r[t];i?a.ob(n,s,!0):a.xI(s)}}LP(e,i){null!==i&&e.il(t=>i.CA(t));var t=e.bh;if(Array.isArray(t)){var s=this.Ga.getValue(t);if(null===s){var n=[];n.push(e),this.Ga.add(t,n)}else{for(let t=0;t<s.length;t++)if(s[t]===e)return;s.push(e)}}}TP(e,i){e.il(t=>i.SR(t));var s=e.bh;if(Array.isArray(s)){var n=this.Ga.getValue(s);if(null!==n)for(let t=0;t<n.length;t++)if(n[t]===e)return n.splice(t,1),void(0===n.length&&this.Ga.remove(s))}}copyParts(e,i,s){void 0===s&&(s=!1);var n=new L;if(Array.isArray(e))for(let t=0;t<e.length;t++)this.Ib(e[t],i,n,s);else for(var t=e.iterator;t.next();)this.Ib(t.value,i,n,s);if(null!==i){for(var r=i.model,a=i.y0().dragsLink,o=new C,h=new L,l=n.iterator;l.next();){var u=l.value;if(u instanceof q)a||null!==u.fromNode&&null!==u.toNode||o.add(u);else if(u instanceof D&&null!==u.data)if(r.Qu()){var d=u,c=l.key,g=c.findTreeParentNode();null!==g&&(null!==(g=n.getValue(g))?(r.setParentKeyForNodeData(d.data,r.getKeyForNodeData(g.data)),g=i.findLinkForData(d.data),null!==(c=c.findTreeParentLink())&&null!==g&&h.add(c,g)):r.setParentKeyForNodeData(d.data,void 0))}else if(r._u())for(var m=u,f=l.key,p=r.isRelatedKeysPathTo?f.findNodesOutOf():f.findNodesInto();p.next();){var v,y=p.value,x=n.getValue(y);null!==x?(r.addRelatedKeyForNodeData(m.data,x.key),x=i.partManager.findLinkForData(m.data,x.key),null!==(v=this.findLinkForData(f.data,y.key))&&null!==x&&h.add(v,x)):r.removeRelatedKeyForNodeData(m.data,y.key)}}if(0<o.count&&i.removeParts(o,!1),0<h.count)for(var A=h.iterator;A.next();){var w=A.key,b=A.value;n.add(w,b)}}if(null!==i&&null!==this.b){var P=i.model,S=P.afterCopyFunction;if(null!==S){const N=new L;n.each(t=>{null!==t.key.data&&N.add(t.key.data,t.value.data)});var k=this.b.model;S(N,P,k)}}for(var M=n.iterator;M.next();)M.value.updateTargetBindings();return n}Ib(t,e,i,s){if(null===t||s&&!t.canCopy())return null;if(i.contains(t))return i.getValue(t);var n=this.SN(t,e);if(!(n instanceof Y))return null;if(n.isSelected=!1,n.isHighlighted=!1,i.add(t,n),t instanceof D){for(var r=t.linksConnected;r.next();){var a,o=r.value;o.fromNode===t&&null!==(a=i.getValue(o))&&(a.fromNode=n),o.toNode===t&&null!==(a=i.getValue(o))&&(a.toNode=n)}if(t instanceof j&&n instanceof j)for(var h=t.memberParts;h.next();){var l=h.value,l=this.Ib(l,e,i,s);l instanceof q||null!==l&&(l.containingGroup=n)}}else if(t instanceof q&&n instanceof q)for(var u=t.fromNode,u=(null!==u&&null!==(u=i.getValue(u))&&(n.fromNode=u),t.toNode),d=(null!==u&&null!==(u=i.getValue(u))&&(n.toNode=u),t.labelNodes);d.next();){var c=d.value,c=this.Ib(c,e,i,s);null!==c&&c instanceof D&&(c.labeledLink=n)}return n}SN(t,e){let i=null;var s=t.data;if(null!==s&&null!==e){var n=e.model;t instanceof q||(r=n.copyNodeData(s),Xt.Mt(r)&&(n.addNodeData(r),i=e.findPartForData(r)))}else if(t.ui(),null!==(i=t.copy())){n=this.b;if(null!==e)e.add(i);else if(null!==s&&null!==n&&null!==n.commandHandler&&n.commandHandler.copiesClipboardData){var r=n.model;let t=null;i instanceof q||(t=r.copyNodeData(s)),Xt.Mt(t)&&(i.data=t)}}return i}get nodes(){return this.og}get links(){return this._s}get parts(){return this.It}get diagram(){return this.b}get addsToTemporaryLayer(){return this.Ty}set addsToTemporaryLayer(t){this.Ty=t}get preservesRebuildLocations(){return this.wN}set preservesRebuildLocations(t){this.wN=t}}class ii extends ei{RP(){var t=this.diagram.model;this.Dy(t.nodeDataArray),this.CT(t.linkDataArray)}Dy(t){super.Dy(t,!1);for(var e=this.links.iterator;e.next();)e.value.Ed();this.diagram.F1(!1)}CT(t){t.forEach(t=>{this.AT(t)}),this.diagram.F1(!1)}AT(t){if(null!=t&&!this.diagram.undoManager.isUndoingRedoing&&!this.bl.contains(t)){var e,i=this.getLinkCategoryForData(t),s=this.findLinkTemplateForCategory(i);if(null!==s){s.ui();const n=s.copy();if(null!==n)return s=this.diagram.xe,this.diagram.xe=!0,n._o=i,n.si=t,""!==(e=(i=this.diagram.model).Ob(t,!0))&&(n.fromPortId=e),void 0!==(e=i.ze(t,!0))&&(e=this.findNodeForKey(e))instanceof D&&(n.fromNode=e),""!==(e=i.Ob(t,!1))&&(n.toPortId=e),void 0!==(e=i.ze(t,!1))&&(e=this.findNodeForKey(e))instanceof D&&(n.toNode=e),e=i.getLabelKeysForLinkData(t),Array.isArray(e)&&e.forEach(t=>{t=this.findNodeForKey(t);null!==t&&(t.labeledLink=n)}),this.Ty&&(n.ml="Tool"),this.diagram.add(n),n.si=null,n.data=t,this.diagram.xe=s,n}}return null}yT(){var t=this.diagram.model;this.LT(t.linkDataArray),this.xN(t.nodeDataArray)}LT(t){t.forEach(t=>{this.Rb(t)})}getLinkCategoryForData(t){return this.diagram.model.getCategoryForLinkData(t)}setLinkCategoryForData(t,e){return this.diagram.model.setCategoryForLinkData(t,e)}setFromNodeForLink(t,e){var i=this.diagram.model,e=null!==e?e.data:null;i.setFromKeyForLinkData(t.data,i.getKeyForNodeData(e))}setToNodeForLink(t,e){var i=this.diagram.model,e=null!==e?e.data:null;i.setToKeyForLinkData(t.data,i.getKeyForNodeData(e))}fN(t){this.diagram.model.removeLinkData(t.data)}findPartForKey(t){var e=super.findPartForKey(t);if(null===e){t=this.diagram.model.findLinkDataForKey(t);if(null!==t)return this.bl.getValue(t)}return e}findLinkForKey(t){return null!=t&&null!==(t=this.diagram.model.findLinkDataForKey(t))?this.bl.getValue(t):null}doModelChanged(t){if(super.doModelChanged(t),this.diagram){var e=this.diagram;if(t.model===e.model){var i=t.change;if(e.W){e.W=!1;try{var s,n,r,a,o,h,l,u,d,c,g,m,f=t.modelChange;if(""!==f)if(2===i){if("linkFromKey"===f){var p,v,y=t.object,x=this.findLinkForData(y);null!==x&&(p=t.newValue,v=this.findNodeForKey(p),x.fromNode=v)}else if("linkToKey"===f){var A,w,b=t.object,P=this.findLinkForData(b);null!==P&&(A=t.newValue,w=this.findNodeForKey(A),P.toNode=w)}else if("linkFromPortId"===f){var S,k=t.object,M=this.findLinkForData(k);null!==M&&"string"==typeof(S=t.newValue)&&(M.fromPortId=S)}else if("linkToPortId"===f){var N,O=t.object,C=this.findLinkForData(O);null!==C&&"string"==typeof(N=t.newValue)&&(C.toPortId=N)}else if("nodeGroupKey"===f){var L,D,E=t.object,T=this.findPartForData(E);null!==T&&(void 0!==(L=t.newValue)&&(D=this.findNodeForKey(L))instanceof j?T.containingGroup=D:T.containingGroup=null)}else if("linkLabelKeys"===f){const B=t.object,G=this.findLinkForData(B);if(null!==G){const F=t.oldValue,R=t.newValue;Array.isArray(F)&&F.forEach(t=>{0<=R.indexOf(t)||null!==(t=this.findNodeForKey(t))&&(t.labeledLink=null)}),Array.isArray(R)&&R.forEach(t=>{t=this.findNodeForKey(t);null!==t&&(t.labeledLink=G)})}}else"linkCategory"===f?(n=t.object,r=this.findLinkForData(n),a=t.newValue,null!==r&&"string"==typeof a&&(r.category=a)):"linkDataArray"===f&&(o=t.oldValue,this.LT(o),h=t.newValue,this.CT(h));e.isModified=!0}else 3===i?(l=t.newValue,"linkDataArray"===f&&"object"==typeof l&&null!==l?this.AT(l):"linkLabelKeys"===f&&t.model.isKeyType(l)&&(u=t.object,d=this.findLinkForData(u),c=this.findNodeForKey(l),null!==d)&&null!==c&&(c.labeledLink=d),e.isModified=!0):4===i&&(g=t.oldValue,"linkDataArray"===f&&"object"==typeof g&&null!==g?this.Rb(g):"linkLabelKeys"===f&&t.model.isKeyType(g)&&null!==(m=this.findNodeForKey(g))&&(m.labeledLink=null),e.isModified=!0);else 2===i&&(s=t.propertyName,t.object!==e.model||"linkFromKeyProperty"!==s&&"linkToKeyProperty"!==s&&"linkFromPortIdProperty"!==s&&"linkToPortIdProperty"!==s&&"linkLabelKeysProperty"!==s&&"nodeIsGroupProperty"!==s&&"nodeGroupKeyProperty"!==s&&"linkCategoryProperty"!==s||e.undoManager.isUndoingRedoing||this.rebuildParts(),e.isModified=!0)}finally{e.W=!0}}}}}NT(){const e=this.diagram.model,i=new C,t=e.linkDataArray,s=(t.forEach(t=>{i.add(t)}),[]);this.links.each(t=>{null===t.data||i.contains(t.data)||s.push(t.data)}),s.forEach(t=>{e.TT(t,!1)}),t.forEach(t=>{null===this.findLinkForData(t)&&e.DT(t,!1)})}updateRelationshipsFromData(t){var e=t.data;if(null!==e){const r=t.diagram;if(null!==r){const a=r.model;if(t instanceof q){var i=a.ze(e,!0),s=r.findNodeForKey(i),i=(t.fromNode=s,i=a.ze(e,!1),s=r.findNodeForKey(i),t.toNode=s,a.getLabelKeysForLinkData(e));if(0<i.length||0<t.labelNodes.count){if(1===i.length&&1===t.labelNodes.count){var s=i[0],n=t.labelNodes.first();if(a.getKeyForNodeData(n.data)===s)return}const o=(new C).addAll(i),h=new C;t.labelNodes.each(t=>{null!==t.data&&void 0!==(t=a.getKeyForNodeData(t.data))&&h.add(t)});var n=h.copy(),s=(n.removeAll(o),o.copy());if(s.removeAll(h),0<n.count||0<s.count){const l=t;n.each(t=>{t=r.findNodeForKey(t);null!==t&&t.labeledLink===l&&(t.labeledLink=null)}),s.each(t=>{t=r.findNodeForKey(t);null!==t&&t.labeledLink!==l&&(t.labeledLink=l)})}}}else t instanceof X||(i=a.getGroupKeyForNodeData(e),(null===(n=r.findPartForKey(i))||n instanceof j)&&(t.containingGroup=n))}}}Fb(t){const e=this.diagram.model,i=e.getKeyForNodeData(t);if(void 0!==i){const a=e.Ry(i),o=this.findPartForData(t);if(null!==a&&null!==o){for(var s=a.iterator;s.next();){var n,r=s.value;if(e.containsNodeData(r))o instanceof j&&e.getGroupKeyForNodeData(r)===i&&null!==(n=this.findPartForData(r))&&(n.containingGroup=o);else{const h=this.findLinkForData(r);null!==h&&o instanceof D&&(e.ze(r,!0)===i&&(h.fromNode=o),e.ze(r,!1)===i&&(h.toNode=o),n=e.getLabelKeysForLinkData(r),Array.isArray(n))&&n.some(t=>t===i&&(o.labeledLink=h,!0))}}e.en(i)}var t=e.getGroupKeyForNodeData(t);void 0!==t&&(t=this.findNodeForKey(t))instanceof j&&(o.containingGroup=t)}}bN(t){var e=this.diagram.model;if(t instanceof D){var i=e.getKeyForNodeData(t.data);if(void 0!==i){for(var s,n=t.linksConnected;n.next();){var r=n.value;e.sn(i,r.data)}if(t.isLinkLabel&&null!==(s=t.labeledLink)&&e.sn(i,s.data),t instanceof j)for(var a=t.memberParts;a.next();){var o=a.value.data;e.containsNodeData(o)&&e.sn(i,o)}}}}SN(t,e){let i=super.SN(t,e);var s,n;return t instanceof q&&(null!==(t=t.data)&&null!==e?"object"==typeof(s=(n=e.model).copyLinkData(t))&&null!==s&&(n.addLinkData(s),i=e.findLinkForData(s)):null!==i&&(n=this.diagram,null!==t)&&null!==n&&null!==n.commandHandler&&n.commandHandler.copiesClipboardData&&"object"==typeof(e=n.model.copyLinkData(t))&&null!==e&&(i.data=e)),i}insertLink(t,e,i,s){var n=this.diagram,r=n.model,a=n.toolManager.findTool("Linking");let o="",h=(null!==t&&(null===e&&(e=t),null===(o=e.portId))&&(o=""),"");null!==i&&(null===s&&(s=i),null===(h=s.portId))&&(h="");e=a.archetypeLinkData;if(e instanceof q){e.ui();s=e.copy();if(null!==s)return s.fromNode=t,s.fromPortId=o,s.toNode=i,s.toPortId=h,n.add(s),(l=a.archetypeLabelNodeData)instanceof D&&(l.ui(),null!==(l=l.copy()))&&(l.labeledLink=s,n.add(l)),s}else if(null!==e){var l=r.copyLinkData(e);if("object"==typeof l&&null!==l)return null!==t&&r.rg(l,r.getKeyForNodeData(t.data),!0),r.lg(l,o,!0),null!==i&&r.rg(l,r.getKeyForNodeData(i.data),!1),r.lg(l,h,!1),r.addLinkData(l),null===(s=a.archetypeLabelNodeData)||s instanceof D||"object"==typeof(e=r.copyNodeData(s))&&null!==e&&(r.addNodeData(e),void 0!==(t=r.getKeyForNodeData(e)))&&r.addLabelKeyForLinkData(l,t),n.findLinkForData(l)}return null}}class si extends ei{Ah=null;Eb(i,s){if(null!==i&&null!==s&&null===s.findTreeParentLink()){var n=this.diagram.toolManager.findTool("Linking");let t=i,e=s;if(this.diagram.isTreePathToChildren){if(null!==n&&n.Cu(t,e,null,!0))return null}else if(t=s,e=i,null!==n&&n.Cu(t,e,null,!0))return null;i=this.getLinkCategoryForData(s.data),n=this.findLinkTemplateForCategory(i);if(null!==n){n.ui();var r,n=n.copy();if(null!==n)return r=this.diagram.xe,this.diagram.xe=!0,n._o=i,n.si=s.data,n.fromNode=t,n.toNode=e,this.diagram.add(n),n.si=null,n.data=s.data,this.diagram.xe=r,n}}return null}getLinkCategoryForData(t){return this.diagram.model.getParentLinkCategoryForNodeData(t)}setLinkCategoryForData(t,e){this.diagram.model.setParentLinkCategoryForNodeData(t,e)}setFromNodeForLink(t,e,i){var s,n=this.diagram.model,e=(void 0===i&&(i=null),null!==e?e.data:null);this.diagram.isTreePathToChildren?n.setParentKeyForNodeData(t.data,n.getKeyForNodeData(e)):(s=this.Ah,this.Ah=t,null!==i&&n.setParentKeyForNodeData(i.data,void 0),i=null!==t.toNode?t.toNode.data:null,n.setParentKeyForNodeData(e,n.getKeyForNodeData(i)),this.Ah=s)}setToNodeForLink(t,e,i){var s,n=this.diagram.model,e=(void 0===i&&(i=null),null!==e?e.data:null);this.diagram.isTreePathToChildren?(s=this.Ah,this.Ah=t,null!==i&&n.setParentKeyForNodeData(i.data,void 0),i=null!==t.fromNode?t.fromNode.data:null,n.setParentKeyForNodeData(e,n.getKeyForNodeData(i)),this.Ah=s):n.setParentKeyForNodeData(t.data,n.getKeyForNodeData(e))}fN(t){this.diagram.model.setParentKeyForNodeData(t.data,void 0)}findLinkForKey(t){return null!=t&&null!==(t=this.diagram.model.findNodeDataForKey(t))?this.bl.getValue(t):null}doModelChanged(t){if(super.doModelChanged(t),this.diagram){var e=this.diagram;if(t.model===e.model){var i=t.change;if(e.W){e.W=!1;try{var s,n,r,a,o,h,l,u,d,c,g=t.modelChange;""!==g?2===i&&("nodeParentKey"===g?(s=t.object,n=t.newValue,r=this.findNodeForKey(n),a=this.findNodeForData(s),null!==this.Ah?null!==r&&(this.Ah.data=s,this.Ah.category=this.getLinkCategoryForData(s)):null!==a&&(null!==(o=a.findTreeParentLink())?null===r?e.remove(o):e.isTreePathToChildren?o.fromNode=r:o.toNode=r:this.Eb(r,a))):"parentLinkCategory"===g&&(h=t.object,l=this.findNodeForData(h),u=t.newValue,null!==l)&&"string"==typeof u&&null!==(d=l.findTreeParentLink())&&(d.category=u),e.isModified=!0):2===i&&(c=t.propertyName,t.object!==e.model||"nodeParentKeyProperty"!==c||e.undoManager.isUndoingRedoing||this.rebuildParts(),e.isModified=!0)}finally{e.W=!0}}}}}updateRelationshipsFromData(t){var e,i,s,n=t.data;null!==n&&null!==(e=t.diagram)&&(i=e.model,t instanceof D)&&(i=i.getParentKeyForNodeData(n),(s=e.findNodeForKey(i))!==t.findTreeParentNode())&&(n=t.findTreeParentLink(),null!==s?null!==n?e.isTreePathToChildren?n.fromNode=s:n.toNode=s:this.Eb(s,t):null!==n&&e.DP(n,!1))}Fy(t,e){super.Fy(t,e),"string"==typeof e&&null!==this.findPartForData(t)&&null!==(t=this.findLinkForData(t))&&t.updateTargetBindings(e)}Fb(t){var e=this.diagram.model,i=e.getKeyForNodeData(t);if(void 0!==i){var s=e.Ry(i),n=this.findPartForData(t);if(null!==s&&null!==n){for(var r=s.iterator;r.next();){var a=r.value;e.containsNodeData(a)&&n instanceof D&&e.getParentKeyForNodeData(a)===i&&(a=this.findNodeForData(a),this.Eb(n,a))}e.en(i)}s=e.getParentKeyForNodeData(t);void 0!==s&&n instanceof D&&(t=this.findNodeForKey(s),this.Eb(t,n))}}bN(t){var e=this.diagram.model;if(t instanceof D)for(var i,s,n=e.getKeyForNodeData(t.data),r=this.findLinkForData(t.data),a=(null!==r&&(r.isSelected=!1,r.isHighlighted=!1,null!==(i=r.layer))&&(0<=(s=i.re(-1,r,!1))&&this.diagram.raiseChangedEvent(4,"parts",i,r,null,s,null),null!==(s=r.layerChanged))&&s(r,i,null),this.diagram.isTreePathToChildren),o=t.linksConnected;o.next();){var h=o.value,h=(a?h.toNode:h.fromNode).data;e.containsNodeData(h)&&e.sn(n,h)}}insertLink(t,e,i,s){var n=this.diagram.model;let r=t,a=i;return this.diagram.isTreePathToChildren||(r=i,a=t),null!==r&&null!==a?(i=r.data,t=a.data,n.setParentKeyForNodeData(t,n.getKeyForNodeData(i)),a.findTreeParentLink()):null}}(s={})[s.OneWay=1]="OneWay",s[s.TwoWay=2]="TwoWay";var ni=s;class ri{l;MN;Ha;Dc;Lh;Fc;Rc;Ic;Vb;Te;Sd;mc;constructor(t,e,i,s){C.ji(this),void 0===t?t="":Xt.t(t,"string",ri,"constructor:targetprop"),void 0===e?e=t:Xt.t(e,"string",ri,"constructor:sourceprop"),void 0===i?i=null:null!==i&&Xt.t(i,"function",ri,"constructor:conv"),this.MN=-1,this.Te=null,this.Ha=t,this.Sd=0,this.mc=0,this.Dc=null,this.Lh=e,this.Fc=i,void 0===s?(this.Rc=1,this.Ic=null):(this.Rc=2,this.Ic=s),this.Vb=new C,this.l=2}copy(){var t=new this.constructor;return this.cloneProtected(t),t}cloneProtected(t){t.Ha=this.Ha,t.Sd=this.Sd,t.mc=this.mc,t.Dc=this.Dc,t.Lh=this.Lh,t.Fc=this.Fc,t.Rc=this.Rc,t.Ic=this.Ic,t.l=-2&this.l}static OneWay=1;static TwoWay=2;static parseEnum(i,s){return Xt.t(i,"function",ri,"parseEnum:ctor"),t=>{let e=parseInt(t);return isNaN(e)&&null===(e=Xt.Yh(i,t))?s:e}}ci(t){t in ni?this.mode=t:Xt.gr(this,t)}static toString(t){return Xt.toString(t)}toString(){return"Binding("+this.targetProperty+":"+this.sourceProperty+(-1!==this.targetId?" "+this.targetId:"")+" "+ni[this.mode]+")"}w(){return this.l=1|this.l,this}ut(){return this.l=-2&this.l,this}get targetId(){return this.MN}set targetId(t){this.f&&Xt.O(this),Xt.t(t,"number",ri,"targetId"),this.MN=t}get targetProperty(){return this.Ha}set targetProperty(t){this.f&&Xt.O(this),Xt.t(t,"string",ri,"targetProperty"),this.Ha=t}get sourceProperty(){return this.Lh}set sourceProperty(t){this.f&&Xt.O(this),Xt.t(t,"string",ri,"sourceProperty"),this.Lh=t}get f(){return 0!=(1&this.l)}get isToData(){return 0!=(2&this.l)}get isToObject(){return 0!=(4&this.l)}get isToModel(){return 0!=(8&this.l)}get isToTheme(){return 0!=(16&this.l)}get PN(){return this.isToTheme&&!(this.isToData||this.isToObject||this.isToModel)}rd(){return!1}get sourceName(){return this.Dc}set sourceName(t){this.f&&Xt.O(this),null!==t&&Xt.t(t,"string",ri,"sourceName"),this.Dc=t,this.l=null!==t?-3&this.l|4:2|this.l}get converter(){return this.Fc}set converter(t){this.f&&Xt.O(this),null!==t&&Xt.t(t,"function",ri,"converter"),this.Fc=t}get backConverter(){return this.Ic}set backConverter(t){this.f&&Xt.O(this),null!==t&&Xt.t(t,"function",ri,"backConverter"),this.Ic=t}get mode(){return this.Rc}set mode(t){this.f&&Xt.O(this),this.isToTheme&&2===t&&Xt.n("Theme Bindings cannot be TwoWay."),Xt.it(t,ni,"BindingMode"),this.Rc=t}makeTwoWay(t){return this.isToTheme&&Xt.n("Theme Bindings cannot be TwoWay."),this.mode=2,t&&(Xt.t(t,"function",ri,"makeTwoWay"),this.backConverter=t),this}ofObject(t){return this.f&&Xt.O(this),void 0===t&&(t=""),Yt,Xt.t(t,"string",ri,"ofObject:srcname"),this.sourceName=t,this}ofModel(){return this.f&&Xt.O(this),this.l=-3&this.l&-5|8,this.Dc=null,this}iL(t,e){var i=this.sourceName;let s=null;return s=null===i||""===i?t:"/"===i?e.part:"."===i?e:".."===i?e.panel:t.findObject(i)}check(t){var e=this.Ha,i=this.Lh,s=this.Fc;(this.rd()&&null===s&&null===this.Th&&""===e||null===s&&""===e)&&Xt.ft("Binding error: target property is the empty string: "+this.toString()),this.rd()&&this.PN&&""===i&&null===s&&null===this.Th&&Xt.ft("Binding error: theme bindings require a source property when not using a converter: "+this.toString()),t&&"string"==typeof e&&("function"!=typeof t.setAttribute&&0<e.length&&"_"!==e[0]&&!Xt.yw(t,e)?Xt.ft("Binding error: undefined target property: "+e+" on "+t.toString()):"name"===e&&t instanceof y&&Xt.ft("Binding error: cannot modify GraphObject.name on "+t.toString()))}updateTarget(i,s,n){var t=this.Lh;if(void 0===n||""===t||t===n){var n=this.Ha,r=this.Fc;let e=s;if(void 0!==(e=""===t||this.PN?e:x.Xt(s,t))){s=i.diagram?.themeManager??i.panel?.diagram?.themeManager;if(null===r)""===n||this.rd()&&void 0===(e=this.FT(s,e,i,n))||x.dt(i,n,e);else try{if(""!==n){let t=r(e,i);Yt,void 0===t&&Xt.ft('Binding warning: conversion function returned undefined when setting target property "'+n+'" on '+i.toString()+", function is: "+r),this.rd()&&void 0===(t=this.FT(s,t,i,n))||x.dt(i,n,t)}else r(e,i)}catch(t){Yt,Xt.ft("Binding error: "+t.toString()+' setting target property "'+n+'" on '+i.toString()+" with conversion function: "+r)}}}}updateSource(e,i,s,n){if(2===this.Rc){var r=this.Ha;if(void 0===s||r===s){var s=this.Lh,a=this.Ic;let t=e;if(void 0!==(t=""!==r?x.Xt(e,r):t)&&!this.Vb.contains(e))try{this.Vb.add(e);var o,h,l,u,d,c,g=null!==n?n.diagram:null,m=null!==g?g.model:null;if(null===a)""!==s?null!==m?(Yt,m.nodeKeyProperty===s&&m.containsNodeData(i)&&Xt.ft("Binding error: cannot have TwoWay Binding on node data key property: "+this.toString()),m.setDataProperty(i,s,t)):x.dt(i,s,t):null!==m&&null!==n&&0<=n.itemIndex&&null!==n.panel&&Array.isArray(n.panel.itemArray)&&(o=n.itemIndex,h=n.panel.itemArray,m.removeArrayItem(h,o),m.insertArrayItem(h,o,t));else try{""!==s?(l=a(t,i,m),null!==m?((Yt,m.nodeKeyProperty===s&&m.containsNodeData(i)&&Xt.ft("Binding error: cannot have TwoWay Binding on node data key property: "+this.toString()),void 0===l)&&Xt.ft(`Binding warning: conversion function returned undefined when setting source property "${s}" on ${i.toString()}, function is: `+a),m.setDataProperty(i,s,l)):x.dt(i,s,l)):void 0!==(u=a(t,i,m))&&null!==m&&null!==n&&0<=n.itemIndex&&null!==n.panel&&Array.isArray(n.panel.itemArray)&&(d=n.itemIndex,c=n.panel.itemArray,m.removeArrayItem(c,d),m.insertArrayItem(c,d,u))}catch(t){Yt,Xt.ft("Binding error: "+t.toString()+' setting source property "'+s+'" on '+i.toString()+" with conversion function: "+a)}}finally{this.Vb.remove(e)}}}}}class ai extends ri{Iy;Th;va;constructor(t,e,i,s,n){super(t,e,s),void 0===n&&(n=null),this.Iy=i=null==i?"":i,this.Th=n,this.va=null,this.l=16}cloneProtected(t){super.cloneProtected(t),t.Iy=this.Iy,t.Th=this.Th,t.va=this.va}rd(){return!0}get themeSource(){return this.Iy}set themeSource(t){this.f&&Xt.O(this),null!==t&&Xt.t(t,"string",ai,"themeSource"),this.Iy=t,this.va=null,this.l=null!==t?16|this.l:-17&this.l}get themeConverter(){return this.Th}set themeConverter(t){this.f&&Xt.O(this),null!==t&&Xt.t(t,"function",ai,"themeConverter"),this.Th=t}ofData(){return this.f&&Xt.O(this),this.l=2|this.l,this.Dc=null,this}FT(i,s,n,r){if(i&&((s=this.PN?this.Lh:s)||0===s)){let t=this.themeSource,e=(null!==this.va?t=this.va:"string"==typeof t&&t.includes(".")&&(this.va=t.split("."),t=this.va),i.findValue(s,t,r));return void 0===e&&Xt.ft(`Theme warning: ${s} could not be found when setting target property ${r}.`),e="function"==typeof this.Th?this.Th(e,n):e}}}class x{Tt;hg;Yo;Bb;Ce;Oc;Ec;ag;fg;cg;ug;qa;ar;zb;Xo;Xb;oi;Dh;dg=new C;gg=new C;Oy;constructor(t,e){C.ji(this),this.Tt="",this.hg="",this.Yo=!1,this.Bb={},this.Ce=[],this.oi=new L,this.Dh="key",this.Oc=null,this.Ec=null,this.ag=!1,this.fg=!1,this.cg=!1,this.ug=null,this.qa="category",this.ar=new L,this.Oy=100,this.zb=new O,this.Xo=!1,this.Xb=null,this.undoManager=new Q,void 0!==t&&(Array.isArray(t)?this.nodeDataArray=t:e=t),e&&(Object.assign(this,e),t=e.Changed)&&(delete this.Changed,this.addChangedListener(t))}cloneProtected(t){t.Tt=this.Tt,t.hg=this.hg,t.Yo=this.Yo,t.Dh=this.Dh,t.Oc=this.Oc,t.Ec=this.Ec,t.ag=this.ag,t.fg=this.fg,t.cg=this.cg,t.Oy=this.Oy,t.ug=this.ug,t.qa=this.qa}copy(){var t=new this.constructor;return this.cloneProtected(t),t}clear(){this.Ce=[],this.oi.clear(),this.ar.clear(),this.undoManager.clear()}toString(t){if(1<(t=void 0===t?0:t))return this.toJson();{let e=(""!==this.name?this.name:"")+" Model";if(0<t){e+=`
 node data:`;var i=this.nodeDataArray,s=i.length;for(let t=0;t<s;t++){var n=i[t];e+=" "+this.getKeyForNodeData(n)+":"+Xt.toString(n)}}return e}}toIncrementalData(t){Xt.s(t,F,x,"toIncrementalData:e"),1!==t.change&&Xt.n("Model.toIncrementalData argument is not a Transaction ChangedEvent:"+t.toString());var e=t.object;if(!(t.isTransactionFinished&&e instanceof R))return null;this.RT(e);e=this.NN(e,"FinishedUndo"===t.propertyName);return this.Wa=null,e}NN(t,e){const i=this;let s=!1;const n=new C,r=new C,a=new C,o=this.Wa,h=(t.changes.each(t=>{t.model===i&&("nodeDataArray"===t.modelChange?3===t.change?n.add(t.newValue):4===t.change&&a.add(t.oldValue):i.containsNodeData(t.object)?r.add(t.object):2!==t.change||i.modelData!==t.object&&"modelData"!==t.propertyName?null!==t.object&&(o&&o.contains(t.object)?o.get(t.object).each(t=>{i.containsNodeData(t)&&r.add(t)}):t.object instanceof x||i.Ea()&&i.containsLinkData(t.object)||i.IT(t.object).each(t=>{r.add(t)})):s=!0)}),this.gg),l=(h.clear(),n.each(t=>{h.add(i.getKeyForNodeData(t)),e||r.add(t)}),this.dg);l.clear(),a.each(t=>{l.add(i.getKeyForNodeData(t)),e&&r.add(t)});t=i.cloneDeep(r.toArray());let u=null;return s&&((u=null===u?{}:u).modelData=this.cloneDeep(this.modelData)),0<h.count&&(null===u&&(u={}),e?u.removedNodeKeys=h.toArray():u.insertedNodeKeys=h.toArray()),0<t.length&&((u=null===u?{}:u).modifiedNodeData=t),0<l.count&&(null===u&&(u={}),e?u.insertedNodeKeys=l.toArray():u.removedNodeKeys=l.toArray()),l.clear(),h.clear(),u}cloneDeep(t){return this.mg(t,!0)}mg(i,t,s,n,r){if(!Xt.Mt(i))return i;r=r||[];const a=Object.isExtensible(i);if(s=s||new L,a){var e=s.get(i);if(e)return e}else for(var o=(n=n||new L).iterator;o.next();){var h=o.key;if(o.value===i){h=s.get(h);if(h)return h}}function l(t,e){a?(void 0===t.__gohashid&&r.push(t),s.set(t,e)):(t=C.fu++,s.set(t,e),n.set(t,i))}let u;if(Array.isArray(i)){u=[],l(i,u);for(let t=0;t<i.length;t++){var d=i[t];u.push(this.mg(d,!1,s,n,r))}}else if(i instanceof U||i instanceof qt||i instanceof Z||i instanceof E||i instanceof J)u=i.copy(),l(i,u);else{if(i instanceof m||i instanceof W)return i;if(i instanceof O)u=(new O).addAll(this.mg(i.toArray(),!1,s,n,r)),l(i,u);else if(i instanceof C)u=(new C).addAll(this.mg(i.toArray(),!1,s,n,r)),l(i,u);else if(i instanceof L)u=(new L).addAll(this.mg(i.toArray(),!1,s,n,r)),l(i,u);else if(i instanceof Date)u=new Date(i.getTime()),l(i,u);else if(i instanceof RegExp)u=new RegExp(i),l(i,u),u.lastIndex=i.lastIndex;else if("function"==typeof i.copy)u=i.copy(),l(i,u);else{u={},l(i,u);for(const g in i){var c;"__gohashid"!==g&&(c=i[g],u[g]=this.mg(c,!1,s,n,r))}}}return t&&r.forEach(t=>{delete t.__gohashid}),u}Xe(t){return JSON.stringify(t).replace(/[\u007F-\uFFFF]/g,t=>{t="0000"+t.charCodeAt(0).toString(16);return"\\u"+t.substring(t.length-4)})}pg(){let t="";return""!==this.name&&(t+=`,
  "name": `+this.Xe(this.name)),""!==this.dataFormat&&(t+=`,
  "dataFormat": `+this.Xe(this.dataFormat)),this.isReadOnly&&(t+=`,
  "isReadOnly": `+this.isReadOnly),"key"!==this.nodeKeyProperty&&"string"==typeof this.nodeKeyProperty&&(t+=`,
  "nodeKeyProperty": `+this.Xe(this.nodeKeyProperty)),this.copiesArrays&&(t+=`,
  "copiesArrays": true`),this.copiesArrayObjects&&(t+=`,
  "copiesArrayObjects": true`),this.copiesKey&&(t+=`,
  "copiesKey": true`),100!==this.pointsDigits&&(t+=`,
  "pointsDigits": `+this.pointsDigits.toString()),"category"!==this.nodeCategoryProperty&&"string"==typeof this.nodeCategoryProperty&&(t+=`,
  "nodeCategoryProperty": `+this.Xe(this.nodeCategoryProperty)),t}Ey(t){t.name&&(this.name=t.name),t.dataFormat&&(this.dataFormat=t.dataFormat),t.isReadOnly&&(this.isReadOnly=!0),t.nodeKeyProperty&&(this.nodeKeyProperty=t.nodeKeyProperty),t.copiesArrays&&(this.copiesArrays=!0),t.copiesArrayObjects&&(this.copiesArrayObjects=!0),void 0!==t.copiesKey&&(this.copiesKey=t.copiesKey),void 0!==t.pointsDigits&&(this.pointsDigits=parseInt(t.pointsDigits)),t.nodeCategoryProperty&&(this.nodeCategoryProperty=t.nodeCategoryProperty)}OT(){var t=this.modelData;return`,
  "modelData": `+this.ET(t)}VT(t){t=t.modelData;Xt.Mt(t)&&(this.replaceJsonObjects(t),this.modelData=t)}CN(){var t=this.modelData;let e=!1;for(const s in t)if(!this.Yb(t,s,t[s])){e=!0;break}let i="";return(i=e?this.OT():i)+`,
  "nodeDataArray": `+this.Fh(this.nodeDataArray,!0)}AN(t){this.VT(t);t=t.nodeDataArray;Array.isArray(t)&&(this.replaceJsonObjects(t),this.nodeDataArray=t)}LN(e,i,s){if(e===i)return!0;if(typeof e==typeof i&&"function"!=typeof e&&"function"!=typeof i){if(Array.isArray(e)&&Array.isArray(i)){if(s.getValue(e)!==i){if(s.add(e,i),e.length!==i.length)return!1;for(let t=0;t<e.length;t++)if(!this.LN(e[t],i[t],s))return!1}return!0}if(Xt.Mt(e)&&Xt.Mt(i)){if(s.getValue(e)!==i){s.add(e,i);for(const o in e){var t=e[o];if(!this.Yb(e,o,t)){var n=i[o];if(void 0===n||!this.LN(t,n,s))return!1}}for(const h in i){var r=i[h];if(!this.Yb(i,h,r)){var a=e[h];if(void 0===a||!this.LN(a,r,s))return!1}}}return!0}}return!1}BT=`,
  "insertedNodeKeys": `;IO=`,
  "modifiedNodeData": `;zT=`,
  "removedNodeKeys": `;Wa=null;RT(t){let s=this.Wa;const n=(e,i)=>{i=i.part;if(i){i=i.data;if(e!==i){let t=s.get(e);null===t?((t=new C).add(i),s.add(e,t)):t.add(i)}}};null===s&&(s=new L,t.changes.each(t=>{var e,i,s;null!==t.diagram&&(2===(e=t.change)?(s=t.object.panel)&&(i=s.data)&&n(i,s):3!==e&&4!==e||(s=(i=t.object).itemArray)&&n(s,i))}),this.Wa=s)}IT(e){var i=new C;for(let t=0;t<this.nodeDataArray.length;t++){var s=this.nodeDataArray[t];this.Kb(e,s,s,i)}return i}Kb(e,i,s,n){if(Array.isArray(i))for(let t=0;t<i.length;t++){var r=i[t];if(r===e)return n.add(s),!0;if(this.Kb(e,r,s,n))return!0}else if(Xt.Mt(i)&&Object.getPrototypeOf(i)===Object.prototype)for(const a in i){var t=i[a];if(t===e)return n.add(s),!0;if(this.Kb(e,t,s,n))return!0}return!1}TN(t,e){const i=this;let s=!1;const n=new C,r=new C,a=new C,o=this.Wa,h=(t.changes.each(t=>{t.model===i&&("nodeDataArray"===t.modelChange?3===t.change?n.add(t.newValue):4===t.change&&a.add(t.oldValue):i.containsNodeData(t.object)?r.add(t.object):2!==t.change||i.modelData!==t.object&&"modelData"!==t.propertyName?null!==t.object&&(o&&o.contains(t.object)?o.get(t.object).each(t=>{i.containsNodeData(t)&&r.add(t)}):t.object instanceof x||i.Ea()&&i.containsLinkData(t.object)||i.IT(t.object).each(t=>{r.add(t)})):s=!0)}),this.gg),l=(h.clear(),n.each(t=>{h.add(i.getKeyForNodeData(t)),e||r.add(t)}),this.dg);l.clear(),a.each(t=>{l.add(i.getKeyForNodeData(t)),e&&r.add(t)});let u="";return s&&(u+=this.OT()),0<h.count&&(u+=(e?this.zT:this.BT)+this.Fh(h.toArray(),!0)),0<r.count&&(u+=this.IO+this.Fh(r.toArray(),!0)),0<l.count&&(u+=(e?this.BT:this.zT)+this.Fh(l.toArray(),!0)),l.clear(),h.clear(),u}Vy(t){(void 0!==t.name&&t.name!==this.name||void 0!==t.dataFormat&&t.dataFormat!==this.dataFormat||void 0!==t.isReadOnly&&t.isReadOnly!==this.isReadOnly||void 0!==t.nodeKeyProperty&&t.nodeKeyProperty!==this.nodeKeyProperty||void 0!==t.copiesArrays&&t.copiesArrays!==this.copiesArrays||void 0!==t.copiesArrayObjects&&t.copiesArrayObjects!==this.copiesArrayObjects||void 0!==t.copiesKey&&t.copiesKey!==this.copiesKey||void 0!==t.nodeCategoryProperty&&t.nodeCategoryProperty!==this.nodeCategoryProperty)&&Xt.n("applyIncrementalJson cannot change Model properties"),this.VT(t);var e=t.insertedNodeKeys,i=t.modifiedNodeData,s=new L;if(Array.isArray(i))for(let t=0;t<i.length;t++){var n=i[t],r=this.getKeyForNodeData(n);null!=r&&s.set(r,n)}if(Array.isArray(e)){var a=e.length;for(let t=0;t<a;t++){var o=e[t],h=this.findNodeDataForKey(o);null===h&&(h=s.get(o)||this.copyNodeData({}),this.setKeyForNodeData(h,o),this.addNodeData(h))}}if(Array.isArray(i)){var l=i.length;for(let t=0;t<l;t++){var u=i[t],d=this.getKeyForNodeData(u),c=this.findNodeDataForKey(d);if(null!==c){for(const p in u)"__gohashid"===p||p===this.nodeKeyProperty||(this.bf()||this._u())&&p===this.nodeIsGroupProperty||this.setDataProperty(c,p,u[p]);this.yg(u,c)}}}var g=t.removedNodeKeys;if(Array.isArray(g)){var m=g.length;for(let t=0;t<m;t++){var f=g[t],f=this.findNodeDataForKey(f);null!==f&&this.removeNodeData(f)}}}toIncrementalJson(t,e){Xt.s(t,F,x,"toIncrementalJson:e"),1!==t.change&&Xt.n("Model.toIncrementalJson argument is not a Transaction ChangedEvent:"+t.toString());var i=t.object;if(!(t.isTransactionFinished&&i instanceof R))return'{ "incremental": 0 }';void 0===e&&(e=Xt.an(this)),this.RT(i);i=this.TN(i,"FinishedUndo"===t.propertyName);return this.Wa=null,"2"===e?'{ "incremental": 2'+i+"}":'{ "class": '+this.Xe(e)+', "incremental": 1'+this.pg()+i+"}"}toIncrementalJSON(t,e){return this.toIncrementalJson(t,e)}toJson(t){return void 0===t&&(t=Xt.an(this)),'{ "class": '+this.Xe(t)+this.pg()+this.CN()+"}"}toJSON(t){return this.toJson(t)}applyIncrementalJson(t){let e=null;if("string"==typeof t)try{e=v.JSON.parse(t)}catch(t){Yt,Xt.ft("JSON.parse error: "+t.toString())}else"object"==typeof t?e=t:Xt.n("Unable to modify a Model from: "+t);var i=e.incremental;"number"!=typeof i&&Xt.n("Unable to apply non-incremental changes to Model: "+t),0!==i&&(this.startTransaction("applyIncrementalJson"),this.Vy(e),this.commitTransaction("applyIncrementalJson"))}applyIncrementalJSON(t){return this.applyIncrementalJson(t)}static fromJson(t,e){null!==(e=void 0===e?null:e)&&Xt.s(e,x,x,"fromJson:model");let i=null;if("string"==typeof t)try{i=v.JSON.parse(t)}catch(t){Yt,Xt.ft("JSON.parse error: "+t.toString())}else"object"==typeof t?i=t:Xt.n("Unable to construct a Model from: "+t);return null===e&&(null===(t=x.OO(i))||t instanceof x?e=t:Xt.n("Unable to construct a Model of declared class: "+i.class)),(e=null===e?x.constructGraphLinksModel():e).Ey(i),e.AN(i),e}static fromJSON(t,e){return this.fromJson(t,e)}static constructGraphLinksModel(){return Yt,Xt.n("Unable to construct a Model. Provided JSON requires GraphLinksModel, which is not loaded."),new x}static OO(t){let e=null,i=t.class;if("string"==typeof i)try{let t=null;0===i.indexOf("go.")?(i=i.substring(3),t=x.Ub(i)):null===(t=x.Ub(i))&&(t=v[i]),"function"==typeof t&&(e=new t)}catch{}return e}replaceJsonObjects(i){if(Array.isArray(i)){var e=i.length;for(let t=0;t<e;t++){var s=i[t];Xt.Mt(s)&&(i[t]=this.replaceJsonObjects(s))}}else if(Xt.Mt(i)){for(const a in i){var t=i[a];if(Xt.Mt(t)){var n=this.replaceJsonObjects(t);if(i[a]=n,"points"===a&&Array.isArray(n)){let e=n.length%2==0;for(let t=0;t<n.length;t++)if("number"!=typeof n[t]){e=!1;break}if(e){var r=new O;for(let t=0;t<n.length/2;t++)r.add(new U(n[2*t],n[2*t+1]));r.w(),i[a]=r}}}}return this.EO(i)}return i}writeJsonValue(t){return void 0===t?"undefined":null===t?"null":!0===t?"true":!1===t?"false":"string"==typeof t?this.Xe(t):"number"==typeof t?t===1/0?"9e9999":t===-1/0?"-9e9999":isNaN(t)?'{"class":"NaN"}':t.toString():t instanceof Date?'{"class":"Date", "value":"'+t.toJSON()+'"}':t instanceof Number?this.writeJsonValue(t.valueOf()):Array.isArray(t)?this.Fh(t):Xt.Mt(t)?this.ET(t):"function"==typeof t?"null":t.toString()}Fh(e,i){void 0===i&&(i=!1);var s=e.length;if(s<=0)return"[]";var n=new a;n.add("["),i&&1<s&&n.add(`
`);for(let t=0;t<s;t++){var r=e[t];void 0!==r&&(0<t&&(n.add(","),i)&&n.add(`
`),n.add(this.writeJsonValue(r)))}return i&&1<s&&n.add(`
`),n.add("]"),n.toString()}Yb(t,e,i){return void 0===i||"__gohashid"===e||"_"===e[0]||"function"==typeof i}qi(t){return isNaN(t)?"NaN":t===1/0?"9e9999":t===-1/0?"-9e9999":t}ET(t){var e=t;if(e instanceof U)t={class:"go.Point",x:this.qi(e.x),y:this.qi(e.y)};else if(e instanceof qt)t={class:"go.Size",width:this.qi(e.width),height:this.qi(e.height)};else if(e instanceof Z)t={class:"go.Rect",x:this.qi(e.x),y:this.qi(e.y),width:this.qi(e.width),height:this.qi(e.height)};else if(e instanceof E)t={class:"go.Margin",top:this.qi(e.top),right:this.qi(e.right),bottom:this.qi(e.bottom),left:this.qi(e.left)};else if(e instanceof J)t=e.isSpot()?{class:"go.Spot",x:this.qi(e.x),y:this.qi(e.y),offsetX:this.qi(e.offsetX),offsetY:this.qi(e.offsetY)}:{class:"go.Spot",enum:e.toString()};else if(e instanceof m){if(t={class:"go.Brush",type:ee[e.type]},1===e.type?t.color=e.color:2!==e.type&&3!==e.type||(t.start=e.start,t.end=e.end,3!==e.type)||(0!==e.startRadius&&(t.startRadius=this.qi(e.startRadius)),isNaN(e.endRadius))||(t.endRadius=this.qi(e.endRadius)),null!==e.colorStops){for(var i={},s=e.colorStops.iterator;s.next();){var n=s.key,r=s.value;i[n]=r}t.colorStops=i}}else if(e instanceof W)t={class:"go.Geometry",type:P[e.type]},0!==e.startX&&(t.startX=this.qi(e.startX)),0!==e.startY&&(t.startY=this.qi(e.startY)),0!==e.endX&&(t.endX=this.qi(e.endX)),0!==e.endY&&(t.endY=this.qi(e.endY)),e.spot1.equals(J.TopLeft)||(t.spot1=e.spot1),e.spot2.equals(J.BottomRight)||(t.spot2=e.spot2),4===e.type&&(t.path=W.stringify(e));else if(null!==x.Ub(Xt.an(e)))return Xt.ft("ERROR: trying to convert a GraphObject or Diagram or Model or Tool or Layout or UndoManager or other unknown data type into JSON text: "+e.toString()),"{}";let a="{",o=!0;for(const d in t){var h=x.Xt(t,d);if(!this.Yb(t,d,h))if(o?o=!1:a+=",",a+=this.Xe(d)+":","points"===d&&h instanceof O){let t="[";for(var l=h.iterator;l.next();){var u=l.value;1<t.length&&(t+=","),t=(t=t+this.XT(u.x)+",")+this.XT(u.y)}t+="]",a+=t}else a+=this.writeJsonValue(h)}return a+="}"}XT(t){var e;return t===1/0?"9e9999":t===-1/0?"-9e9999":isNaN(t)?"0":16<(e=this.pointsDigits)?t.toString():t.toFixed(e)}get pointsDigits(){return this.Oy}set pointsDigits(t){t<0?t=0:100<t&&(t=100),this.Oy=t}Wi(t){return"number"==typeof t?t:"NaN"===t?NaN:"9e9999"===t?1/0:"-9e9999"===t?-1/0:parseFloat(t)}EO(e){if("object"!=typeof e)return e;let t=e.class||"";if("string"!=typeof t||""===t)return e;if("NaN"===t)return NaN;if("Date"===t)return new Date(e.value);if(0!==t.indexOf("go."))return e;let i=e;if("Point"===(t=t.substring(3)))i=new U(this.Wi(e.x),this.Wi(e.y));else if("Size"===t)i=new qt(this.Wi(e.width),this.Wi(e.height));else if("Rect"===t)i=new Z(this.Wi(e.x),this.Wi(e.y),this.Wi(e.width),this.Wi(e.height));else if("Margin"===t)i=new E(this.Wi(e.top),this.Wi(e.right),this.Wi(e.bottom),this.Wi(e.left));else if("Spot"===t)i="string"==typeof e.enum?J.parse(e.enum):new J(this.Wi(e.x),this.Wi(e.y),this.Wi(e.offsetX),this.Wi(e.offsetY));else if("Brush"===t){var s=new m,n=(s.type=Xt.Yh(ee,e.type)??1,"string"==typeof e.color&&(s.color=e.color),e.start instanceof J&&(s.start=e.start),e.end instanceof J&&(s.end=e.end),"number"==typeof e.startRadius&&(s.startRadius=this.Wi(e.startRadius)),"number"==typeof e.endRadius&&(s.endRadius=this.Wi(e.endRadius)),e.colorStops);if(Xt.Mt(n))for(const o in n){var r=parseFloat(o);s.addColorStop(r,n[o])}i=s}else if("Geometry"===t){let t=null;(t="string"==typeof e.path?W.parse(e.path):new W).type=Xt.Yh(P,e.type)??1,"number"==typeof e.startX&&(t.startX=this.Wi(e.startX)),"number"==typeof e.startY&&(t.startY=this.Wi(e.startY)),"number"==typeof e.endX&&(t.endX=this.Wi(e.endX)),"number"==typeof e.endY&&(t.endY=this.Wi(e.endY)),e.spot1 instanceof J&&(t.spot1=e.spot1),e.spot2 instanceof J&&(t.spot2=e.spot2),i=t}else if("EnumValue"===t){let t=e.classType;0===t.indexOf("go.")&&(t=t.substring(3));var a=x.Ub(t);"function"==typeof a&&(i=Xt.Yh(a,e.name))}return i}get name(){return this.Tt}set name(t){var e=this.Tt;e!==t&&(Xt.t(t,"string",x,"name"),this.Tt=t,this.i("name",e,t))}get dataFormat(){return this.hg}set dataFormat(t){var e=this.hg;e!==t&&(Xt.t(t,"string",x,"dataFormat"),this.hg=t,this.i("dataFormat",e,t))}get isReadOnly(){return this.Yo}set isReadOnly(t){var e=this.Yo;e!==t&&(Xt.t(t,"boolean",x,"isReadOnly"),this.Yo=t,this.i("isReadOnly",e,t))}get modelData(){return this.Bb}set modelData(t){var e=this.Bb;e!==t&&(Xt.t(t,"object",x,"modelData"),this.Bb=t,this.i("modelData",e,t),this.updateTargetBindings(t))}addChangedListener(t){return Xt.t(t,"function",x,"addChangedListener:listener"),this.zb.add(t),this}removeChangedListener(t){Xt.t(t,"function",x,"removeChangedListener:listener"),this.zb.remove(t)}Gw(e){this.skipsUndoManager||this.undoManager.handleChanged(e);var i=this.zb,s=i.length;for(let t=0;t<s;t++)i.elt(t)(e)}raiseChangedEvent(t,e,i,s,n,r,a){this.Kt("",t,e,i,s,n,r,a)}raiseChanged(t,e,i,s,n){this.Kt("",2,t,this,e,i,s,n)}i(t,e,i,s,n){this.Kt("",2,t,this,e,i,s,n)}raiseDataChanged(t,e,i,s,n,r){this.Kt("",2,e,t,i,s,n,r)}Kt(t,e,i,s,n,r,a,o){void 0===a&&(a=null),void 0===o&&(o=null);var h=new F;h.model=this,h.change=e,h.modelChange=t,h.propertyName=i,h.object=s,h.oldValue=n,h.oldParam=a,h.newValue=r,h.newParam=o,this.Gw(h)}get undoManager(){return this.Xb}set undoManager(t){var e=this.Xb;e!==t&&(Xt.s(t,Q,x,"undoManager"),null!==e&&e.removeModel(this),null!==(this.Xb=t))&&t.addModel(this)}get skipsUndoManager(){return this.Xo}set skipsUndoManager(t){Xt.t(t,"boolean",x,"skipsUndoManager"),this.Xo=t}changeState(e,i){if(null!==e&&e.model===this)if(2===e.change){var t=e.object,s=e.propertyName,n=e.getValue(i);s===this.nodeKeyProperty&&this.containsNodeData(t)&&(void 0!==(r=e.getValue(!i))&&this.oi.remove(r),void 0!==n)&&this.oi.add(n,t),x.dt(t,s,n)}else if(3===e.change){var r=e.newParam;if("nodeDataArray"===e.modelChange){t=e.newValue;Xt.Mt(t)&&"number"==typeof r&&(s=this.getKeyForNodeData(t),i?(this.Ce[r]===t&&Xt.rf(this.Ce,r),void 0!==s&&this.oi.remove(s)):(this.Ce[r]!==t&&Xt.au(this.Ce,r,t),void 0!==s&&this.oi.add(s,t)))}else if(""===e.modelChange){let t=e.object;t&&!Array.isArray(t)&&e.propertyName&&(t=x.Xt(e.object,e.propertyName)),Array.isArray(t)&&"number"==typeof r&&(n=e.newValue,i?Xt.rf(t,r):Xt.au(t,r,n))}else Xt.n("unknown ChangeType.Insert modelChange: "+e.toString())}else if(4===e.change){s=e.oldParam;if("nodeDataArray"===e.modelChange){t=e.oldValue;Xt.Mt(t)&&"number"==typeof s&&(r=this.getKeyForNodeData(t),i?(this.Ce[s]!==t&&Xt.au(this.Ce,s,t),void 0!==r&&this.oi.add(r,t)):(this.Ce[s]===t&&Xt.rf(this.Ce,s),void 0!==r&&this.oi.remove(r)))}else if(""===e.modelChange){let t=e.object;t&&!Array.isArray(t)&&e.propertyName&&(t=x.Xt(e.object,e.propertyName)),Array.isArray(t)&&"number"==typeof s&&(n=e.oldValue,i?Xt.au(t,s,n):Xt.rf(t,s))}else Xt.n("unknown ChangeType.Remove modelChange: "+e.toString())}else 1!==e.change&&Xt.n("unknown ChangedEvent: "+e.toString())}startTransaction(t){return this.undoManager.startTransaction(t)}commitTransaction(t){return this.undoManager.commitTransaction(t)}rollbackTransaction(){return this.undoManager.rollbackTransaction()}commit(t,e){let i=e;void 0===i&&(i="");e=this.skipsUndoManager;null===i&&(this.skipsUndoManager=!0,i=""),this.undoManager.startTransaction(i);let s=!1;try{t(this),s=!0}finally{s?this.undoManager.commitTransaction(i):this.undoManager.rollbackTransaction(),this.skipsUndoManager=e}}updateTargetBindings(t,e){this.Kt("SourceChanged",1,e=void 0===e?"":e,t,null,null)}get nodeKeyProperty(){return this.Dh}set nodeKeyProperty(t){var e=this.Dh;e!==t&&(this.En(t,x,"nodeKeyProperty"),""===t&&Xt.n("Model.nodeKeyProperty may not be the empty string"),0<this.oi.count&&Xt.n("Cannot set Model.nodeKeyProperty when there is existing node data"),this.Dh=t,this.i("nodeKeyProperty",e,t))}En(t,e,i){"string"!=typeof t&&"function"!=typeof t&&Xt.Bi(t,"string or function",e,i)}getKeyForNodeData(t){if(null!==t){var e=this.Dh;if(""!==e){e=x.Xt(t,e);if(void 0!==e){if(this.isKeyType(e))return e;Xt.n("Key value for node data "+t+" is not a number or a string: "+e)}}}}setKeyForNodeData(t,e){var i,s;null!=e&&this.isKeyType(e)||Xt.Bi(e,"number or string",x,"setKeyForNodeData:key"),null!==t&&""!==(i=this.Dh)&&(this.containsNodeData(t)?(s=x.Xt(t,i))!==e&&null===this.findNodeDataForKey(e)&&(x.dt(t,i,e),void 0!==s&&this.oi.remove(s),this.oi.add(e,t),this.Kt("nodeKey",2,i,t,s,e),"string"==typeof i&&this.updateTargetBindings(t,i),this.By(s,e)):x.dt(t,i,e))}get makeUniqueKeyFunction(){return this.Oc}set makeUniqueKeyFunction(t){var e=this.Oc;e!==t&&(null!==t&&Xt.t(t,"function",x,"makeUniqueKeyFunction"),this.Oc=t,this.i("makeUniqueKeyFunction",e,t))}isKeyType(t){return"number"==typeof t||"string"==typeof t}containsNodeData(t){var e=this.getKeyForNodeData(t);return void 0!==e&&this.oi.getValue(e)===t}findNodeDataForKey(t){return null===t&&Xt.n("Model.findNodeDataForKey:key must not be null"),void 0!==t&&this.isKeyType(t)?this.oi.getValue(t):null}get nodeDataArray(){return this.Ce}set nodeDataArray(e){var t=this.Ce;if(t!==e){Xt.Hg(e,x,"nodeDataArray"),this.oi.clear(),this.DN();var i=e.length;for(let t=0;t<i;t++){var s=e[t];Xt.Mt(s)||Xt.n("Model.nodeDataArray must only contain Objects, not: "+s)}this.Ce=e;var n=new O;for(let t=0;t<i;t++){var r=e[t],a=this.getKeyForNodeData(r);void 0===a||null!==this.oi.getValue(a)?n.add(r):this.oi.add(a,r)}for(var o=n.iterator;o.next();){var h=o.value,l=(this.makeNodeDataKeyUnique(h),this.getKeyForNodeData(h));void 0!==l&&this.oi.add(l,h)}this.Kt("nodeDataArray",2,"nodeDataArray",this,t,e);for(let t=0;t<i;t++){var u=e[t];this.wg(u),this.xg(u)}}}makeNodeDataKeyUnique(i){if(null!==i){var s=this.Dh;if(""!==s){let e=this.getKeyForNodeData(i);if(void 0===e||this.oi.contains(e)){var t=this.Oc;if(null===t||null==(e=t(this,i))||this.oi.contains(e))if("string"==typeof e){let t=2;for(;this.oi.contains(e+t);)t++;x.dt(i,s,e+t)}else if(void 0===e||"number"==typeof e){let t=-this.oi.count-1;for(;this.oi.contains(t);)t--;x.dt(i,s,t)}else Yt,Xt.n("Model.getKeyForNodeData returned something other than a string or a number: "+e);else x.dt(i,s,e)}}}}addNodeData(t){null===t||this.containsNodeData(t)||this.PT(t,!0)}PT(e,i){let s=this.getKeyForNodeData(e);if(void 0===s||this.oi.getValue(s)!==e){this.makeNodeDataKeyUnique(e),void 0===(s=this.getKeyForNodeData(e))&&Xt.n("Model.makeNodeDataKeyUnique failed on "+e+".  Data not added to Model."),this.oi.add(s,e);let t=null;i&&(t=this.Ce.length,Xt.au(this.Ce,t,e)),this.Kt("nodeDataArray",3,"nodeDataArray",this,null,e,null,t),this.wg(e),this.xg(e)}}addNodeDataCollection(e){if(Array.isArray(e)){var i=e.length;for(let t=0;t<i;t++)this.addNodeData(e[t])}else for(var t=e.iterator;t.next();){var s=t.value;this.addNodeData(s)}}removeNodeData(t){null!==t&&this.MT(t,!0)}MT(t,e){var i=this.getKeyForNodeData(t);void 0!==i&&this.oi.remove(i);let s=null;if(e){if((s=this.Ce.indexOf(t))<0)return;Xt.rf(this.Ce,s)}this.Kt("nodeDataArray",4,"nodeDataArray",this,t,null,s,null),this.zy(t)}removeNodeDataCollection(e){if(Array.isArray(e)){var i=e.length;for(let t=0;t<i;t++)this.removeNodeData(e[t])}else for(var t=e.iterator;t.next();){var s=t.value;this.removeNodeData(s)}}mergeNodeDataArray(e){if(e!==this.nodeDataArray&&Array.isArray(e)){var t=this.dg,i=(t.clear(),t.addAll(this.oi.iteratorKeys),this.gg),s=(i.clear(),e.length);for(let t=0;t<s;t++){var n,r=e[t],a=this.getKeyForNodeData(r);void 0!==a?(i.add(a),(n=this.findNodeDataForKey(a))!==r&&(null!==n?(this.assignAllDataProperties(n,r),this.yg(r,n)):(n=this.cloneDeep(r),this.setKeyForNodeData(n,a),this.addNodeData(n)))):(a=this.cloneDeep(r),this.addNodeData(a),i.add(this.getKeyForNodeData(a)))}for(var o=t.iterator;o.next();){var h=o.value;i.contains(h)||(h=this.findNodeDataForKey(h))&&this.removeNodeData(h)}t.clear(),i.clear()}}By(t,e){void 0!==e&&(t=this.Ry(t))instanceof C&&this.ar.add(e,t)}DN(){}wg(t){}xg(t){}zy(t){}sn(e,i){if(void 0!==e){let t=this.ar.getValue(e);null===t&&(t=new C,this.ar.add(e,t)),t.add(i)}}en(t,e){var i;void 0!==t&&(i=this.ar.getValue(t))instanceof C&&(null==e||(i.remove(e),0===i.count))&&this.ar.remove(t)}Ry(t){return void 0!==t&&(t=this.ar.getValue(t))instanceof C?t:null}pE(t){void 0===t?this.ar.clear():this.ar.remove(t)}get copyNodeDataFunction(){return this.Ec}set copyNodeDataFunction(t){var e=this.Ec;e!==t&&(null!==t&&Xt.t(t,"function",x,"copyNodeDataFunction"),this.Ec=t,this.i("copyNodeDataFunction",e,t))}get copiesArrays(){return this.ag}set copiesArrays(t){var e=this.ag;e!==t&&(null!==t&&Xt.t(t,"boolean",x,"copiesArrays"),this.ag=t,this.i("copiesArrays",e,t))}get copiesArrayObjects(){return this.fg}set copiesArrayObjects(t){var e=this.fg;e!==t&&(null!==t&&Xt.t(t,"boolean",x,"copiesArrayObjects"),this.fg=t,this.i("copiesArrayObjects",e,t))}get copiesKey(){return this.cg}set copiesKey(t){var e=this.cg;e!==t&&(null!==t&&Xt.t(t,"boolean",x,"copiesKey"),this.cg=t,this.i("copiesKey",e,t))}copyNodeData(t){if(null===t)return null;let e=null;var i=this.Ec;return e=null!==i?i(t,this):this.Gb(t,!0),Xt.Mt(e),e}Gb(t,e){if(this.copiesArrays&&Array.isArray(t)){var i=t,s=[];for(let t=0;t<i.length;t++){var n=i[t],n=this.Gb(n,this.copiesArrayObjects);s.push(n)}return s}if(e&&Xt.Mt(t)){var r,a=t,e=a.constructor,o=e?new e:{},h=this.copiesKey||"string"!=typeof this.nodeKeyProperty?null:this.nodeKeyProperty;for(const l in a)"__gohashid"===l?o.__gohashid=void 0:l===h?o[h]=void 0:(r=x.Xt(a,l),this.VO(a,l,r)?x.dt(o,l,r):(r=this.Gb(r,!1),x.dt(o,l,r)));return o}return t instanceof U||t instanceof qt||t instanceof Z||t instanceof J||t instanceof E?t.copy():t}get afterCopyFunction(){return this.ug}set afterCopyFunction(t){var e=this.ug;e!==t&&(null!==t&&Xt.t(t,"function",x,"afterCopyFunction"),this.ug=t,this.i("afterCopyFunction",e,t))}VO(t,e,i){var s=Xt.an(i);return"GraphObject"===s||"Diagram"===s||"Layer"===s||"RowColumnDefinition"===s||"AnimationManager"===s||"Tool"===s||"CommandHandler"===s||"Layout"===s||"InputEvent"===s||"DiagramEvent"===s?(Yt,"_"!==e[0]&&Xt.ft('Warning: found GraphObject or Diagram reference when copying model data on property "'+e+'" of data object: '+t.toString()+`
Model data should not have any references to a Diagram or any part of a diagram, such as: `+i.toString()),!0):i instanceof x||i instanceof Q||i instanceof R||i instanceof F}static YT=!1;setDataProperty(t,e,i){if((Yt,Xt.t(t,"object",x,"setDataProperty:data"),Xt.t(e,"string",x,"setDataProperty:propname"),""===e)&&Xt.n("Model.setDataProperty: property name must not be an empty string when setting "+t+" to "+i),this.containsNodeData(t)){if(e===this.nodeKeyProperty)return void this.setKeyForNodeData(t,i);if(e===this.nodeCategoryProperty)return void this.setCategoryForNodeData(t,i)}else!x.YT&&t instanceof y&&(x.YT=!0,Xt.ft('Model.setDataProperty is modifying a GraphObject, "'+t.toString()+'"'),Xt.ft("  Is that really your intent?"));var s=x.Xt(t,e);s!==i&&(x.dt(t,e,i),this.raiseDataChanged(t,e,s,i))}set(t,e,i){this.setDataProperty(t,e,i)}assignAllDataProperties(t,e){if(e){var i=this.containsNodeData(t);for(const s in e)"__gohashid"===s||i&&s===this.nodeKeyProperty||this.setDataProperty(t,s,e[s])}}addArrayItem(t,e){this.insertArrayItem(t,-1,e)}insertArrayItem(t,e,i){(Yt,Xt.Hg(t,x,"insertArrayItem:arr"),Xt.r(e,x,"insertArrayItem:idx"),t===this.Ce)&&Xt.n("Model.insertArrayItem or Model.addArrayItem should not be called on the Model.nodeDataArray"),e<0&&(e=t.length),Xt.au(t,e,i),this.Kt("",3,"",t,null,i,null,e)}removeArrayItem(t,e){void 0===e&&(e=-1),Yt,Xt.Hg(t,x,"removeArrayItem:arr"),Xt.r(e,x,"removeArrayItem:idx"),t===this.Ce&&Xt.n("Model.removeArrayItem should not be called on the Model.nodeDataArray");var i=t[e=-1===e?t.length-1:e];Xt.rf(t,e),this.Kt("",4,"",t,i,null,e,null)}get nodeCategoryProperty(){return this.qa}set nodeCategoryProperty(t){var e=this.qa;e!==t&&(this.En(t,x,"nodeCategoryProperty"),this.qa=t,this.i("nodeCategoryProperty",e,t))}getCategoryForNodeData(t){var e;return null===t||""===(e=this.qa)||void 0===(e=x.Xt(t,e))?"":"string"==typeof e?e:void Xt.n("getCategoryForNodeData found a non-string category for "+t+": "+e)}setCategoryForNodeData(e,i){if(Xt.t(i,"string",x,"setCategoryForNodeData:cat"),null!==e){var s=this.qa;if(""!==s)if(this.containsNodeData(e)){let t=x.Xt(e,s);(t=void 0===t?"":t)!==i&&(x.dt(e,s,i),this.Kt("nodeCategory",2,s,e,t,i))}else x.dt(e,s,i)}}yg(t,e){this.setCategoryForNodeData(e,this.getCategoryForNodeData(t))}get type(){return"Model"}Qu(){return!1}bf(){return!1}_u(){return!1}Ea(){return!1}jw(){return!1}ma(){return!1}static initDiagramModel(){return new x}static Ub(t){return x.classMap[t]||(void 0!==v.go&&v.go[t]?v.go[t]:null)}static registerClass(t,e){x.classMap[e]=t}static classMap={};static Xt(t,e){if(!t||!e)return null;let i;try{"function"==typeof e?i=e(t):"function"==typeof t.getAttribute?null===(i=t.getAttribute(e))&&(i=void 0):i=t[e]}catch(t){Yt,Xt.ft("property get error: "+t.toString())}return i}static dt(t,e,i){if(t&&e)try{"function"==typeof e?e(t,i):"function"==typeof t.setAttribute?t.setAttribute(e,i):t[e]=i}catch(t){Yt,Xt.ft("property set error: "+t.toString())}}static{x.registerClass(m,"Brush"),x.registerClass(F,"ChangedEvent"),x.registerClass(W,"Geometry"),x.registerClass(E,"Margin"),x.registerClass(jt,"Panel"),x.registerClass(U,"Point"),x.registerClass(Z,"Rect"),x.registerClass(qt,"Size"),x.registerClass(J,"Spot"),x.registerClass(R,"Transaction"),x.registerClass(Q,"UndoManager")}}x.fromJSON=x.fromJson=x.fromJson;class oi extends x{ss;fr;pi;Rh;Vc;Bc;Ol;No;Co;ja;Ja;Za;nn;zc;Vn;bg;constructor(t,e,i){super(),this.ss=[],this.fr=new C,this.pi=new L,this.Rh="",this.Vc=null,this.Bc=null,this.Ol=null,this.No="from",this.Co="to",this.ja="",this.Ja="",this.Za="category",this.nn="",this.zc="isGroup",this.Vn="group",this.bg=!1,void 0!==e&&(this.linkDataArray=e),void 0!==t&&(Array.isArray(t)?this.nodeDataArray=t:i=t),i&&(Object.assign(this,i),e=i.Changed)&&(delete this.Changed,this.addChangedListener(e))}cloneProtected(t){super.cloneProtected(t),t.Rh=this.Rh,t.Vc=this.Vc,t.Bc=this.Bc,t.No=this.No,t.Co=this.Co,t.ja=this.ja,t.Ja=this.Ja,t.Za=this.Za,t.nn=this.nn,t.zc=this.zc,t.Vn=this.Vn,t.bg=this.bg}clear(){super.clear(),this.ss=[],this.pi.clear(),this.fr.clear()}toString(t){if(2<=(t=void 0===t?0:t))return this.toJson();{let s=(""!==this.name?this.name:"")+" GraphLinksModel";if(0<t){s+=`
 node data:`;let t=this.nodeDataArray,e=t.length,i=0;for(i=0;i<e;i++){var n=t[i];s+=" "+this.getKeyForNodeData(n)+":"+ri.toString(n)}for(s+=`
 link data:`,t=this.linkDataArray,e=t.length,i=0;i<e;i++){var r=t[i];s+=" "+this.ze(r,!0)+"--\x3e"+this.ze(r,!1)}}return s}}NN(t,e){""===this.linkKeyProperty&&(u=this.skipsUndoManager,this.skipsUndoManager=!0,this.linkKeyProperty="key",this.skipsUndoManager=u);let i=super.NN(t,e);const s=this,n=new C,r=new C,a=new C,o=this.Wa,h=(t.changes.each(t=>{t.model===s&&("linkDataArray"===t.modelChange?3===t.change?n.add(t.newValue):4===t.change&&a.add(t.oldValue):s.containsLinkData(t.object)?r.add(t.object):null!==t.object&&(null!==t.object&&o&&o.contains(t.object)?o.get(t.object).each(t=>{s.containsLinkData(t)&&r.add(t)}):t.object instanceof x||s.containsNodeData(t.object)||s.KT(t.object).each(t=>r.add(t))))}),this.gg),l=(h.clear(),n.each(t=>{h.add(s.getKeyForLinkData(t)),e||r.add(t)}),this.dg);l.clear(),a.each(t=>{l.add(s.getKeyForLinkData(t)),e&&r.add(t)});var u=s.cloneDeep(r.toArray());return 0<h.count&&(null===i&&(i={}),e?i.removedLinkKeys=h.toArray():i.insertedLinkKeys=h.toArray()),0<u.length&&((i=null===i?{}:i).modifiedLinkData=u),0<l.count&&(null===i&&(i={}),e?i.insertedLinkKeys=l.toArray():i.removedLinkKeys=l.toArray()),l.clear(),h.clear(),i}pg(){var t=super.pg();let e="";return"category"!==this.linkCategoryProperty&&"string"==typeof this.linkCategoryProperty&&(e+=`,
  "linkCategoryProperty": `+this.Xe(this.linkCategoryProperty)),""!==this.linkKeyProperty&&"string"==typeof this.linkKeyProperty&&(e+=`,
  "linkKeyProperty": `+this.Xe(this.linkKeyProperty)),"from"!==this.linkFromKeyProperty&&"string"==typeof this.linkFromKeyProperty&&(e+=`,
  "linkFromKeyProperty": `+this.Xe(this.linkFromKeyProperty)),"to"!==this.linkToKeyProperty&&"string"==typeof this.linkToKeyProperty&&(e+=`,
  "linkToKeyProperty": `+this.Xe(this.linkToKeyProperty)),""!==this.linkFromPortIdProperty&&"string"==typeof this.linkFromPortIdProperty&&(e+=`,
  "linkFromPortIdProperty": `+this.Xe(this.linkFromPortIdProperty)),""!==this.linkToPortIdProperty&&"string"==typeof this.linkToPortIdProperty&&(e+=`,
  "linkToPortIdProperty": `+this.Xe(this.linkToPortIdProperty)),""!==this.linkLabelKeysProperty&&"string"==typeof this.linkLabelKeysProperty&&(e+=`,
  "linkLabelKeysProperty": `+this.Xe(this.linkLabelKeysProperty)),"isGroup"!==this.nodeIsGroupProperty&&"string"==typeof this.nodeIsGroupProperty&&(e+=`,
  "nodeIsGroupProperty": `+this.Xe(this.nodeIsGroupProperty)),"group"!==this.nodeGroupKeyProperty&&"string"==typeof this.nodeGroupKeyProperty&&(e+=`,
  "nodeGroupKeyProperty": `+this.Xe(this.nodeGroupKeyProperty)),t+e}Ey(t){super.Ey(t),t.linkKeyProperty&&(this.linkKeyProperty=t.linkKeyProperty),t.linkFromKeyProperty&&(this.linkFromKeyProperty=t.linkFromKeyProperty),t.linkToKeyProperty&&(this.linkToKeyProperty=t.linkToKeyProperty),t.linkFromPortIdProperty&&(this.linkFromPortIdProperty=t.linkFromPortIdProperty),t.linkToPortIdProperty&&(this.linkToPortIdProperty=t.linkToPortIdProperty),t.linkCategoryProperty&&(this.linkCategoryProperty=t.linkCategoryProperty),t.linkLabelKeysProperty&&(this.linkLabelKeysProperty=t.linkLabelKeysProperty),t.nodeIsGroupProperty&&(this.nodeIsGroupProperty=t.nodeIsGroupProperty),t.nodeGroupKeyProperty&&(this.nodeGroupKeyProperty=t.nodeGroupKeyProperty)}CN(){return super.CN()+(`,
  "linkDataArray": `+this.Fh(this.linkDataArray,!0))}AN(t){super.AN(t);t=t.linkDataArray;Array.isArray(t)&&(this.replaceJsonObjects(t),this.linkDataArray=t)}UT=`,
  "insertedLinkKeys": `;BO=`,
  "modifiedLinkData": `;GT=`,
  "removedLinkKeys": `;KT(e){var i=new C;for(let t=0;t<this.linkDataArray.length;t++){var s=this.linkDataArray[t];this.Kb(e,s,s,i)}return i}TN(t,e){var i;""===this.linkKeyProperty&&(i=this.skipsUndoManager,this.skipsUndoManager=!0,this.linkKeyProperty="key",this.skipsUndoManager=i);const s=super.TN(t,e),n=this,r=new C,a=new C,o=new C,h=this.Wa,l=(t.changes.each(t=>{t.model===n&&("linkDataArray"===t.modelChange?3===t.change?r.add(t.newValue):4===t.change&&o.add(t.oldValue):n.containsLinkData(t.object)?a.add(t.object):null!==t.object&&(null!==t.object&&h&&h.contains(t.object)?h.get(t.object).each(t=>{n.containsLinkData(t)&&a.add(t)}):t.object instanceof x||n.containsNodeData(t.object)||n.KT(t.object).each(t=>a.add(t))))}),this.gg),u=(l.clear(),r.each(t=>{l.add(n.getKeyForLinkData(t)),e||a.add(t)}),this.dg);u.clear(),o.each(t=>{u.add(n.getKeyForLinkData(t)),e&&a.add(t)});let d=s;return 0<l.count&&(d+=(e?this.GT:this.UT)+this.Fh(l.toArray(),!0)),0<a.count&&(d+=this.BO+this.Fh(a.toArray(),!0)),0<u.count&&(d+=(e?this.UT:this.GT)+this.Fh(u.toArray(),!0)),u.clear(),l.clear(),d}Vy(t){(void 0!==t.linkCategoryProperty&&t.linkCategoryProperty!==this.linkCategoryProperty||void 0!==t.linkKeyProperty&&t.linkKeyProperty!==this.linkKeyProperty||void 0!==t.linkFromKeyProperty&&t.linkFromKeyProperty!==this.linkFromKeyProperty||void 0!==t.linkToKeyProperty&&t.linkToKeyProperty!==this.linkToKeyProperty||void 0!==t.linkFromPortIdProperty&&t.linkFromPortIdProperty!==this.linkFromPortIdProperty||void 0!==t.linkToPortIdProperty&&t.linkToPortIdProperty!==this.linkToPortIdProperty||void 0!==t.linkLabelKeysProperty&&t.linkLabelKeysProperty!==this.linkLabelKeysProperty||void 0!==t.nodeIsGroupProperty&&t.nodeIsGroupProperty!==this.nodeIsGroupProperty||void 0!==t.nodeGroupKeyProperty&&t.nodeGroupKeyProperty!==this.nodeGroupKeyProperty)&&Xt.n("applyIncrementalJson cannot change Model properties"),super.Vy(t);var e=t.insertedLinkKeys;if(Array.isArray(e)){var i=e.length;for(let t=0;t<i;t++){var s,n=e[t];null===this.findLinkDataForKey(n)&&(s=this.copyLinkData({}),this.setKeyForLinkData(s,n),this.addLinkData(s))}}var r=t.modifiedLinkData;if(Array.isArray(r)){var a=r.length;for(let t=0;t<a;t++){var o=r[t],h=this.getKeyForLinkData(o),l=this.findLinkDataForKey(h);if(null!==l){for(const g in o)"__gohashid"!==g&&g!==this.linkKeyProperty&&this.setDataProperty(l,g,o[g]);this.HT(o,l)}}}var u=t.removedLinkKeys;if(Array.isArray(u)){var d=u.length;for(let t=0;t<d;t++){var c=u[t],c=this.findLinkDataForKey(c);null!==c&&this.removeLinkData(c)}}}changeState(e,i){if(null!==e&&e.model===this){if(2===e.change){var s=e.object,n=e.propertyName;if(n===this.linkKeyProperty&&this.containsLinkData(s))return t=e.getValue(i),void 0!==(r=e.getValue(!i))&&this.pi.remove(r),void 0!==t&&this.pi.add(t,s),void x.dt(s,n,t)}else if(3===e.change){let t=e.newParam;if("linkDataArray"===e.modelChange)return r=e.newValue,void(Xt.Mt(r)&&"number"==typeof t&&(s=this.getKeyForLinkData(r),i?(this.fr.remove(r),this.ss[t]===r&&this.ss.splice(t,1),void 0!==s&&this.pi.remove(s)):(this.fr.add(r),this.ss[t]!==r&&this.ss.splice(t,0,r),void 0!==s&&this.pi.add(s,r))));if("linkLabelKeys"===e.modelChange)return n=this.getLabelKeysForLinkData(e.object),void(Array.isArray(n)&&"number"==typeof t&&(i?0<=(t=n.indexOf(e.newValue))&&n.splice(t,1):n.indexOf(e.newValue)<0&&n.splice(t,0,e.newValue)))}else if(4===e.change){var r,t=e.oldParam;if("linkDataArray"===e.modelChange)return s=e.oldValue,void(Xt.Mt(s)&&"number"==typeof t&&(r=this.getKeyForLinkData(s),i?(this.fr.add(s),this.ss[t]!==s&&this.ss.splice(t,0,s),void 0!==r&&this.pi.add(r,s)):(this.fr.remove(s),this.ss[t]===s&&this.ss.splice(t,1),void 0!==r&&this.pi.remove(r))));if("linkLabelKeys"===e.modelChange)return n=this.getLabelKeysForLinkData(e.object),void(Array.isArray(n)&&"number"==typeof t&&(i?n.indexOf(e.newValue)<0&&n.splice(t,0,e.newValue):0<=(t=n.indexOf(e.newValue))&&n.splice(t,1)))}super.changeState(e,i)}}get archetypeNodeData(){return this.Ol}set archetypeNodeData(t){var e=this.Ol;e!==t&&(null!==t&&Xt.t(t,"object",oi,"archetypeNodeData"),this.Ol=t,this.i("archetypeNodeData",e,t))}FN(t){var e;if(void 0!==t)return null!==(e=this.Ol)&&null===this.findNodeDataForKey(t)&&(e=this.copyNodeData(e),x.dt(e,this.nodeKeyProperty,t),this.addNodeData(e)),t}get linkFromKeyProperty(){return this.No}set linkFromKeyProperty(t){var e=this.No;e!==t&&(this.En(t,oi,"linkFromKeyProperty"),this.No=t,this.i("linkFromKeyProperty",e,t))}getFromKeyForLinkData(t){return this.ze(t,!0)}setFromKeyForLinkData(t,e){this.rg(t,e,!0)}get linkToKeyProperty(){return this.Co}set linkToKeyProperty(t){var e=this.Co;e!==t&&(this.En(t,oi,"linkToKeyProperty"),this.Co=t,this.i("linkToKeyProperty",e,t))}getToKeyForLinkData(t){return this.ze(t,!1)}setToKeyForLinkData(t,e){this.rg(t,e,!1)}ze(t,e){if(null!==t){var i=e?this.No:this.Co;if(""!==i){i=x.Xt(t,i);if(void 0!==i){if(this.isKeyType(i))return i;Xt.n((e?"FromKey":"ToKey")+" value for link data "+t+" is not a number or a string: "+i)}}}}rg(t,e,i){var s,n;void 0===(e=null===e?void 0:e)||this.isKeyType(e)||Xt.Bi(e,"number or string",oi,i?"setFromKeyForLinkData:key":"setToKeyForLinkData:key"),null!==t&&""!==(s=i?this.No:this.Co)&&(e=this.FN(e),this.containsLinkData(t)?(n=x.Xt(t,s))!==e&&(this.en(n,t),x.dt(t,s,e),null===this.findNodeDataForKey(e)&&this.sn(e,t),this.Kt(i?"linkFromKey":"linkToKey",2,s,t,n,e),"string"==typeof s)&&this.updateTargetBindings(t,s):x.dt(t,s,e))}get linkFromPortIdProperty(){return this.ja}set linkFromPortIdProperty(t){var e=this.ja;e!==t&&(this.En(t,oi,"linkFromPortIdProperty"),Yt,t!==this.linkFromKeyProperty&&t!==this.linkToKeyProperty||Xt.n("linkFromPortIdProperty name must not be the same as the GraphLinksModel.linkFromKeyProperty or linkToKeyProperty: "+t),this.ja=t,this.i("linkFromPortIdProperty",e,t))}getFromPortIdForLinkData(t){return this.Ob(t,!0)}setFromPortIdForLinkData(t,e){this.lg(t,e,!0)}get linkToPortIdProperty(){return this.Ja}set linkToPortIdProperty(t){var e=this.Ja;e!==t&&(this.En(t,oi,"linkToPortIdProperty"),Yt,t!==this.linkFromKeyProperty&&t!==this.linkToKeyProperty||Xt.n("linkFromPortIdProperty name must not be the same as the GraphLinksModel.linkFromKeyProperty or linkToKeyProperty: "+t),this.Ja=t,this.i("linkToPortIdProperty",e,t))}getToPortIdForLinkData(t){return this.Ob(t,!1)}setToPortIdForLinkData(t,e){this.lg(t,e,!1)}Ob(t,e){return null===t||""===(e=e?this.ja:this.Ja)||void 0===(t=x.Xt(t,e))?"":t}lg(e,i,s){if(Xt.t(i,"string",oi,s?"setFromPortIdForLinkData:portname":"setToPortIdForLinkData:portname"),null!==e){var n=s?this.ja:this.Ja;if(""!==n)if(this.containsLinkData(e)){let t=x.Xt(e,n);(t=void 0===t?"":t)!==i&&(x.dt(e,n,i),this.Kt(s?"linkFromPortId":"linkToPortId",2,n,e,t,i),"string"==typeof n)&&this.updateTargetBindings(e,n)}else x.dt(e,n,i)}}get linkLabelKeysProperty(){return this.nn}set linkLabelKeysProperty(t){var e=this.nn;e!==t&&(this.En(t,oi,"linkLabelKeysProperty"),this.nn=t,this.i("linkLabelKeysProperty",e,t))}getLabelKeysForLinkData(t){var e;return null===t||""===(e=this.nn)||void 0===(t=x.Xt(t,e))?oi.EmptyArray:t}setLabelKeysForLinkData(i,s){if(Xt.Hg(s,oi,"setLabelKeysForLinkData:arr"),null!==i){var t=this.nn;if(""!==t)if(this.containsLinkData(i)){let e=x.Xt(i,t);if((e=void 0===e?oi.EmptyArray:e)!==s){if(Array.isArray(e)){var n=e.length;for(let t=0;t<n;t++){var r=e[t];this.en(r,i)}}x.dt(i,t,s);var a=s.length;for(let t=0;t<a;t++){var o=s[t];null===this.findNodeDataForKey(o)&&this.sn(o,i)}this.Kt("linkLabelKeys",2,t,i,e,s),"string"==typeof t&&this.updateTargetBindings(i,t)}}else x.dt(i,t,s)}}addLabelKeyForLinkData(t,e){var i,s,n;null!=e&&(this.isKeyType(e)||Xt.Bi(e,"number or string",oi,"addLabelKeyForLinkData:key"),null!==t)&&""!==(i=this.nn)&&(void 0===(s=x.Xt(t,i))?((n=[]).push(e),this.setLabelKeysForLinkData(t,n)):Array.isArray(s)?0<=s.indexOf(e)||(n=s.length,s.push(e),this.containsLinkData(t)&&(null===this.findNodeDataForKey(e)&&this.sn(e,t),this.Kt("linkLabelKeys",3,i,t,null,e,null,n))):Xt.n(i+" property is not an Array; cannot addLabelKeyForLinkData: "+t))}removeLabelKeyForLinkData(t,e){var i,s,n;null!=e&&(this.isKeyType(e)||Xt.Bi(e,"number or string",oi,"removeLabelKeyForLinkData:key"),null!==t)&&""!==(i=this.nn)&&(s=x.Xt(t,i),Array.isArray(s)?(n=s.indexOf(e))<0||(s.splice(n,1),this.containsLinkData(t)&&(this.en(e,t),this.Kt("linkLabelKeys",4,i,t,e,null,n,null))):void 0!==s&&Xt.n(i+" property is not an Array; cannot removeLabelKeyforLinkData: "+t))}get linkDataArray(){return this.ss}set linkDataArray(e){var t=this.ss;if(t!==e){Xt.Hg(e,oi,"linkDataArray"),this.pi.clear();var i=e.length;for(let t=0;t<i;t++){var s=e[t];Xt.Mt(s)||Xt.n("GraphLinksModel.linkDataArray must only contain Objects, not: "+s)}if(this.ss=e,""!==this.linkKeyProperty){var n=new O;for(let t=0;t<i;t++){var r=e[t],a=this.getKeyForLinkData(r);void 0===a||null!==this.pi.getValue(a)?n.add(r):this.pi.add(a,r)}for(var o=n.iterator;o.next();){var h=o.value,l=(this.makeLinkDataKeyUnique(h),this.getKeyForLinkData(h));void 0!==l&&this.pi.add(l,h)}}var u=new C;for(let t=0;t<i;t++){var d=e[t];u.add(d)}this.fr=u,this.Kt("linkDataArray",2,"linkDataArray",this,t,e);for(let t=0;t<i;t++){var c=e[t];this.RN(c)}}}get linkKeyProperty(){return this.Rh}set linkKeyProperty(t){var e=this.Rh;if(e!==t){this.En(t,oi,"linkKeyProperty"),this.Rh=t,this.pi.clear();var i=this.linkDataArray.length;for(let e=0;e<i;e++){var s=this.linkDataArray[e];let t=this.getKeyForLinkData(s);void 0===t&&(this.makeLinkDataKeyUnique(s),t=this.getKeyForLinkData(s)),void 0!==t&&this.pi.add(t,s)}this.i("linkKeyProperty",e,t)}}getKeyForLinkData(t){if(null!==t){var e=this.Rh;if(""!==e){e=x.Xt(t,e);if(void 0!==e){if(this.isKeyType(e))return e;Xt.n("Key value for link data "+t+" is not a number or a string: "+e)}}}}setKeyForLinkData(t,e){var i,s;null!=e&&this.isKeyType(e)||Xt.Bi(e,"number or string",oi,"setKeyForLinkData:key"),null!==t&&""!==(i=this.Rh)&&(this.containsLinkData(t)?(s=x.Xt(t,i))!==e&&null===this.findLinkDataForKey(e)&&(x.dt(t,i,e),void 0!==s&&this.pi.remove(s),this.pi.add(e,t),this.Kt("linkKey",2,i,t,s,e),"string"==typeof i)&&this.updateTargetBindings(t,i):x.dt(t,i,e))}get makeUniqueLinkKeyFunction(){return this.Vc}set makeUniqueLinkKeyFunction(t){var e=this.Vc;e!==t&&(null!==t&&Xt.t(t,"function",oi,"makeUniqueLinkKeyFunction"),this.Vc=t,this.i("makeUniqueLinkKeyFunction",e,t))}findLinkDataForKey(t){return null===t&&Xt.n("GraphLinksModel.findLinkDataForKey:key must not be null"),void 0!==t&&this.isKeyType(t)?this.pi.getValue(t):null}makeLinkDataKeyUnique(i){if(null!==i){var s=this.Rh;if(""!==s){let e=this.getKeyForLinkData(i);if(void 0===e||this.pi.contains(e)){var t=this.Vc;if(null===t||null==(e=t(this,i))||this.pi.contains(e))if("string"==typeof e){let t=2;for(;this.pi.contains(e+t);)t++;x.dt(i,s,e+t)}else if(void 0===e||"number"==typeof e){let t=-this.pi.count-1;for(;this.pi.contains(t);)t--;x.dt(i,s,t)}else Yt,Xt.n("GraphLinksModel.getKeyForLinkData returned something other than a string or a number: "+e);else x.dt(i,s,e)}}}}containsLinkData(t){return null!==t&&this.fr.contains(t)}addLinkData(t){null===t||this.containsLinkData(t)||this.DT(t,!0)}DT(e,t){if(""!==this.linkKeyProperty){let t=this.getKeyForLinkData(e);if(void 0!==t&&this.pi.getValue(t)===e)return;this.makeLinkDataKeyUnique(e),void 0===(t=this.getKeyForLinkData(e))&&Xt.n("GraphLinksModel.makeLinkDataKeyUnique failed on "+e+". Data not added to model."),this.pi.add(t,e)}this.fr.add(e);let i=null;t&&(i=this.ss.length,this.ss.splice(i,0,e)),this.Kt("linkDataArray",3,"linkDataArray",this,null,e,null,i),this.RN(e)}addLinkDataCollection(e){if(Array.isArray(e)){var i=e.length;for(let t=0;t<i;t++)this.addLinkData(e[t])}else for(var t=e.iterator;t.next();){var s=t.value;this.addLinkData(s)}}removeLinkData(t){null!==t&&this.TT(t,!0)}TT(t,e){this.fr.remove(t);var i=this.getKeyForLinkData(t);void 0!==i&&this.pi.remove(i);let s=null;if(e){if((s=this.ss.indexOf(t))<0)return;this.ss.splice(s,1)}this.Kt("linkDataArray",4,"linkDataArray",this,t,null,s,null),this.zO(t)}removeLinkDataCollection(e){if(Array.isArray(e)){var i=e.length;for(let t=0;t<i;t++)this.removeLinkData(e[t])}else for(var t=e.iterator;t.next();){var s=t.value;this.removeLinkData(s)}}mergeLinkDataArray(e){if(""===this.linkKeyProperty&&Xt.n("GraphLinksModel.linkKeyProperty must not be an empty string for .mergeLinkDataArray() to succeed."),e!==this.linkDataArray&&Array.isArray(e)){var t=this.dg,i=(t.clear(),t.addAll(this.pi.iteratorKeys),this.gg),s=(i.clear(),e.length);for(let t=0;t<s;t++){var n,r=e[t],a=this.getKeyForLinkData(r);void 0!==a?(i.add(a),(n=this.findLinkDataForKey(a))!==r&&(null!==n?(this.assignAllDataProperties(n,r),this.HT(r,n)):(n=this.cloneDeep(r),this.setKeyForLinkData(n,a),this.addLinkData(n)))):(a=this.cloneDeep(r),this.addLinkData(a),i.add(this.getKeyForLinkData(a)))}for(var o=t.iterator;o.next();){var h=o.value;i.contains(h)||(h=this.findLinkDataForKey(h))&&this.removeLinkData(h)}t.clear(),i.clear()}}RN(e){let i=this.ze(e,!0);i=this.FN(i),null===this.findNodeDataForKey(i)&&this.sn(i,e),i=this.ze(e,!1),i=this.FN(i),null===this.findNodeDataForKey(i)&&this.sn(i,e);var s=this.getLabelKeysForLinkData(e);if(Array.isArray(s)){var n=s.length;for(let t=0;t<n;t++)i=s[t],null===this.findNodeDataForKey(i)&&this.sn(i,e)}}zO(e){var i=this.ze(e,!0),s=(this.en(i,e),i=this.ze(e,!1),this.en(i,e),this.getLabelKeysForLinkData(e));if(Array.isArray(s)){var n=s.length;for(let t=0;t<n;t++)i=s[t],this.en(i,e)}}get copyLinkDataFunction(){return this.Bc}set copyLinkDataFunction(t){var e=this.Bc;e!==t&&(null!==t&&Xt.t(t,"function",oi,"copyLinkDataFunction"),this.Bc=t,this.i("copyLinkDataFunction",e,t))}copyLinkData(t){if(null===t)return null;let e=null;var i=this.Bc;return e=null!==i?i(t,this):this.Gb(t,!0),Xt.Mt(e)&&(""!==this.No&&x.dt(e,this.No,void 0),""!==this.Co&&x.dt(e,this.Co,void 0),""!==this.nn)&&x.dt(e,this.nn,[]),e}get nodeIsGroupProperty(){return this.zc}set nodeIsGroupProperty(t){var e=this.zc;e!==t&&(this.En(t,oi,"nodeIsGroupProperty"),this.zc=t,this.i("nodeIsGroupProperty",e,t))}isGroupForNodeData(t){var e;return null!==t&&""!==(e=this.zc)&&!!x.Xt(t,e)}isGroupForData(t){return this.isGroupForNodeData(t)}get nodeGroupKeyProperty(){return this.Vn}set nodeGroupKeyProperty(t){var e=this.Vn;e!==t&&(this.En(t,oi,"nodeGroupKeyProperty"),this.Vn=t,this.i("nodeGroupKeyProperty",e,t))}get copiesGroupKeyOfNodeData(){return this.bg}set copiesGroupKeyOfNodeData(t){this.bg!==t&&(Xt.t(t,"boolean",oi,"copiesGroupKeyOfNodeData"),this.bg=t)}getGroupKeyForNodeData(t){if(null!==t){var e=this.Vn;if(""!==e){e=x.Xt(t,e);if(void 0!==e){if(this.isKeyType(e))return e;Xt.n("GroupKey value for node data "+t+" is not a number or a string: "+e)}}}}getGroupForData(t){return this.getGroupKeyForNodeData(t)}setGroupKeyForNodeData(t,e){var i,s;void 0===(e=null===e?void 0:e)||this.isKeyType(e)||Xt.Bi(e,"number or string",oi,"setGroupKeyForNodeData:key"),null!==t&&""!==(i=this.Vn)&&(this.containsNodeData(t)?(s=x.Xt(t,i))!==e&&(this.en(s,t),x.dt(t,i,e),null===this.findNodeDataForKey(e)&&this.sn(e,t),this.Kt("nodeGroupKey",2,i,t,s,e),"string"==typeof i)&&this.updateTargetBindings(t,i):x.dt(t,i,e))}setGroupForData(t,e){this.setGroupKeyForNodeData(t,e)}copyNodeData(t){return null===t?null:(t=super.copyNodeData(t),this.copiesGroupKeyOfNodeData||""===this.Vn||void 0===x.Xt(t,this.Vn)||x.dt(t,this.Vn,void 0),t)}setDataProperty(t,e,i){if((Yt,Xt.t(t,"object",oi,"setDataProperty:data"),Xt.t(e,"string",oi,"setDataProperty:propname"),""===e)&&Xt.n("GraphLinksModel.setDataProperty: property name must not be an empty string when setting "+t+" to "+i),this.containsNodeData(t)){if(e===this.nodeKeyProperty)return void this.setKeyForNodeData(t,i);if(e===this.nodeCategoryProperty)return void this.setCategoryForNodeData(t,i);if(e===this.nodeGroupKeyProperty)return void this.setGroupKeyForNodeData(t,i);Yt,e===this.nodeIsGroupProperty&&Xt.n("GraphLinksModel.setDataProperty: property name must not be the nodeIsGroupProperty: "+e)}else if(this.containsLinkData(t)){if(e===this.linkFromKeyProperty)return void this.rg(t,i,!0);if(e===this.linkToKeyProperty)return void this.rg(t,i,!1);if(e===this.linkFromPortIdProperty)return void this.lg(t,i,!0);if(e===this.linkToPortIdProperty)return void this.lg(t,i,!1);if(e===this.linkKeyProperty)return void this.setKeyForLinkData(t,i);if(e===this.linkCategoryProperty)return void this.setCategoryForLinkData(t,i);if(e===this.linkLabelKeysProperty)return void this.setLabelKeysForLinkData(t,i)}var s=x.Xt(t,e);s!==i&&(x.dt(t,e,i),this.raiseDataChanged(t,e,s,i))}assignAllDataProperties(t,e){if(e){var i=this.containsNodeData(t),s=this.containsLinkData(t);for(const n in e)if("__gohashid"!==n&&(!i||n!==this.nodeKeyProperty)){if(i&&n===this.nodeIsGroupProperty&&x.Xt(t,n)===e[n])continue;if(s&&n===this.linkKeyProperty)continue;this.setDataProperty(t,n,e[n])}}}By(t,e){super.By(t,e);for(var i=this.oi.iterator;i.next();){var s=i.value;this.IN(s,t,e)}for(var n=this.fr.iterator;n.next();){var r=n.value;this.XO(r,t,e)}}IN(t,e,i){var s;this.getGroupKeyForNodeData(t)===e&&(s=this.Vn,x.dt(t,s,i),this.Kt("nodeGroupKey",2,s,t,e,i),"string"==typeof s)&&this.updateTargetBindings(t,s)}XO(e,i,s){this.ze(e,!0)===i&&(t=this.No,x.dt(e,t,s),this.Kt("linkFromKey",2,t,e,i,s),"string"==typeof t)&&this.updateTargetBindings(e,t),this.ze(e,!1)===i&&(t=this.Co,x.dt(e,t,s),this.Kt("linkToKey",2,t,e,i,s),"string"==typeof t)&&this.updateTargetBindings(e,t);var t,n=this.getLabelKeysForLinkData(e);if(Array.isArray(n)){var r=n.length,a=this.nn;for(let t=0;t<r;t++)n[t]===i&&(n[t]=s,this.Kt("linkLabelKeys",3,a,e,i,s,t,t))}}DN(){super.DN();var e=this.linkDataArray,i=e.length;for(let t=0;t<i;t++){var s=e[t];this.RN(s)}}wg(t){super.wg(t);var e=this.getKeyForNodeData(t),t=this.Ry(e);if(null!==t){for(var i=Xt.ct(),s=t.iterator;s.next();){var n=s.value;if(this.containsNodeData(n))this.getGroupKeyForNodeData(n)===e&&(r=this.Vn,this.Kt("nodeGroupKey",2,r,n,e,e),"string"==typeof r&&this.updateTargetBindings(n,r),i.push(n));else{this.ze(n,!0)===e&&(r=this.No,this.Kt("linkFromKey",2,r,n,e,e),"string"==typeof r&&this.updateTargetBindings(n,r),i.push(n)),this.ze(n,!1)===e&&(a=this.Co,this.Kt("linkToKey",2,a,n,e,e),"string"==typeof a&&this.updateTargetBindings(n,a),i.push(n));var r,a,o=this.getLabelKeysForLinkData(n);if(Array.isArray(o)){var h=o.length,l=this.nn;for(let t=0;t<h;t++)o[t]===e&&(this.Kt("linkLabelKeys",3,l,n,e,e,t,t),i.push(n))}}}for(let t=0;t<i.length;t++)this.en(e,i[t]);Xt.ot(i)}}xg(t){super.xg(t);var e=this.getGroupKeyForNodeData(t);null===this.findNodeDataForKey(e)&&this.sn(e,t)}zy(t){super.zy(t);var e=this.getGroupKeyForNodeData(t);this.en(e,t)}get linkCategoryProperty(){return this.Za}set linkCategoryProperty(t){var e=this.Za;e!==t&&(this.En(t,oi,"linkCategoryProperty"),this.Za=t,this.i("linkCategoryProperty",e,t))}getCategoryForLinkData(t){var e;return null===t||""===(e=this.Za)||void 0===(e=x.Xt(t,e))?"":"string"==typeof e?e:void Xt.n("getCategoryForLinkData found a non-string category for "+t+": "+e)}getLinkCategoryForData(t){return this.getCategoryForLinkData(t)}setCategoryForLinkData(e,i){if(Xt.t(i,"string",oi,"setCategoryForLinkData:cat"),null!==e){var s=this.Za;if(""!==s)if(this.containsLinkData(e)){let t=x.Xt(e,s);(t=void 0===t?"":t)!==i&&(x.dt(e,s,i),this.Kt("linkCategory",2,s,e,t,i),"string"==typeof s)&&this.updateTargetBindings(e,s)}else x.dt(e,s,i)}}setLinkCategoryForData(t,e){this.setCategoryForLinkData(t,e)}yg(t,e){super.yg(t,e),this.setGroupKeyForNodeData(e,this.getGroupKeyForNodeData(t))}HT(t,e){this.setCategoryForLinkData(e,this.getCategoryForLinkData(t)),this.setFromKeyForLinkData(e,this.getFromKeyForLinkData(t)),this.setToKeyForLinkData(e,this.getToKeyForLinkData(t)),this.setLabelKeysForLinkData(e,this.getLabelKeysForLinkData(t)),this.setFromPortIdForLinkData(e,this.getFromPortIdForLinkData(t)),this.setToPortIdForLinkData(e,this.getToPortIdForLinkData(t))}get type(){return"GraphLinksModel"}bf(){return!0}Ea(){return!0}jw(){return!0}ma(){return!0}static EmptyArray=Object.freeze([])}x.registerClass(oi,"GraphLinksModel"),x.constructGraphLinksModel=x.constructGraphLinksModel=()=>new oi,x.initDiagramModel=x.initDiagramModel=()=>new oi;class hi extends x{Bn;kg;$a;constructor(t,e){super(),this.Bn="parent",this.kg=!1,this.$a="parentLinkCategory",void 0!==t&&(Array.isArray(t)?this.nodeDataArray=t:e=t),e&&(Object.assign(this,e),t=e.Changed)&&(delete this.Changed,this.addChangedListener(t))}cloneProtected(t){super.cloneProtected(t),t.Bn=this.Bn,t.kg=this.kg,t.$a=this.$a}toString(t){if(2<=(t=void 0===t?0:t))return this.toJson();{let e=(""!==this.name?this.name:"")+" TreeModel";if(0<t){e+=`
 node data:`;var i=this.nodeDataArray,s=i.length;for(let t=0;t<s;t++){var n=i[t];e+=" "+this.getKeyForNodeData(n)+":"+ri.toString(n)}}return e}}pg(){var t=super.pg();let e="";return"parent"!==this.nodeParentKeyProperty&&"string"==typeof this.nodeParentKeyProperty&&(e+=`,
  "nodeParentKeyProperty": `+this.Xe(this.nodeParentKeyProperty)),t+e}Ey(t){super.Ey(t),t.nodeParentKeyProperty&&(this.nodeParentKeyProperty=t.nodeParentKeyProperty)}Vy(t){void 0!==t.nodeParentKeyProperty&&t.nodeParentKeyProperty!==this.nodeParentKeyProperty&&Xt.n("applyIncrementalJson cannot change Model properties"),super.Vy(t)}maybeEnsureLinkReference(t){return t}get nodeParentKeyProperty(){return this.Bn}set nodeParentKeyProperty(t){var e=this.Bn;e!==t&&(this.En(t,hi,"nodeParentKeyProperty"),this.Bn=t,this.i("nodeParentKeyProperty",e,t))}get copiesParentKeyOfNodeData(){return this.kg}set copiesParentKeyOfNodeData(t){this.kg!==t&&(Xt.t(t,"boolean",hi,"copiesParentKeyOfNodeData"),this.kg=t)}getParentKeyForNodeData(t){if(null!==t){var e=this.Bn;if(""!==e){e=x.Xt(t,e);if(void 0!==e){if(this.isKeyType(e))return e;Xt.n("ParentKey value for node data "+t+" is not a number or a string: "+e)}}}}setParentKeyForNodeData(t,e){var i,s;void 0===(e=null===e?void 0:e)||this.isKeyType(e)||Xt.Bi(e,"number or string",hi,"setParentKeyForNodeData:key"),null!==t&&""!==(i=this.Bn)&&(e=this.maybeEnsureLinkReference(e),this.containsNodeData(t)?(s=x.Xt(t,i))!==e&&(this.en(s,t),x.dt(t,i,e),null===this.findNodeDataForKey(e)&&this.sn(e,t),this.Kt("nodeParentKey",2,i,t,s,e),"string"==typeof i)&&this.updateTargetBindings(t,i):x.dt(t,i,e))}get parentLinkCategoryProperty(){return this.$a}set parentLinkCategoryProperty(t){var e=this.$a;e!==t&&(this.En(t,hi,"parentLinkCategoryProperty"),this.$a=t,this.i("parentLinkCategoryProperty",e,t))}get linkCategoryProperty(){return this.parentLinkCategoryProperty}set linkCategoryProperty(t){this.parentLinkCategoryProperty=t}getParentLinkCategoryForNodeData(t){var e;return null===t||""===(e=this.$a)||void 0===(e=x.Xt(t,e))?"":"string"==typeof e?e:void Xt.n("getParentLinkCategoryForNodeData found a non-string category for "+t+": "+e)}getLinkCategoryForData(t){return this.getParentLinkCategoryForNodeData(t)}setParentLinkCategoryForNodeData(e,i){if(Xt.t(i,"string",hi,"setParentLinkCategoryForNodeData:cat"),null!==e){var s=this.$a;if(""!==s)if(this.containsNodeData(e)){let t=x.Xt(e,s);(t=void 0===t?"":t)!==i&&(x.dt(e,s,i),this.Kt("parentLinkCategory",2,s,e,t,i),"string"==typeof s)&&this.updateTargetBindings(e,s)}else x.dt(e,s,i)}}setLinkCategoryForData(t,e){this.setParentLinkCategoryForNodeData(t,e)}copyNodeData(t){return null===t?null:(t=super.copyNodeData(t),this.copiesParentKeyOfNodeData||""===this.Bn||void 0===x.Xt(t,this.Bn)||x.dt(t,this.Bn,void 0),t)}setDataProperty(t,e,i){if((Yt,Xt.t(t,"object",hi,"setDataProperty:data"),Xt.t(e,"string",hi,"setDataProperty:propname"),""===e)&&Xt.n("TreeModel.setDataProperty: property name must not be an empty string when setting "+t+" to "+i),this.containsNodeData(t)){if(e===this.nodeKeyProperty)return void this.setKeyForNodeData(t,i);if(e===this.nodeCategoryProperty)return void this.setCategoryForNodeData(t,i);if(e===this.nodeParentKeyProperty)return void this.setParentKeyForNodeData(t,i)}var s=x.Xt(t,e);s!==i&&(x.dt(t,e,i),this.raiseDataChanged(t,e,s,i))}By(t,e){super.By(t,e);for(var i=this.oi.iterator;i.next();){var s=i.value;this.IN(s,t,e)}}IN(t,e,i){var s;this.getParentKeyForNodeData(t)===e&&(s=this.Bn,x.dt(t,s,i),this.Kt("nodeParentKey",2,s,t,e,i),"string"==typeof s)&&this.updateTargetBindings(t,s)}wg(t){super.wg(t);var e=this.getKeyForNodeData(t),t=this.Ry(e);if(null!==t){for(var i=Xt.ct(),s=t.iterator;s.next();){var n,r=s.value;this.containsNodeData(r)&&this.getParentKeyForNodeData(r)===e&&(n=this.Bn,this.Kt("nodeParentKey",2,n,r,e,e),"string"==typeof n&&this.updateTargetBindings(r,n),i.push(r))}for(let t=0;t<i.length;t++)this.en(e,i[t]);Xt.ot(i)}}xg(t){super.xg(t);var e=this.getParentKeyForNodeData(t),e=this.maybeEnsureLinkReference(e);null===this.findNodeDataForKey(e)&&this.sn(e,t)}zy(t){super.zy(t);var e=this.getParentKeyForNodeData(t);this.en(e,t)}yg(t,e){super.yg(t,e),this.setParentLinkCategoryForNodeData(e,this.getParentLinkCategoryForNodeData(t)),this.setParentKeyForNodeData(e,this.getParentKeyForNodeData(t))}get type(){return"TreeModel"}Qu(){return!0}jw(){return!0}}x.registerClass(hi,"TreeModel");(s={})[s.ConstantSpacing=0]="ConstantSpacing",s[s.ConstantDistance=1]="ConstantDistance",s[s.ConstantAngle=2]="ConstantAngle",s[s.Packed=3]="Packed";var li=s,ui=((s={})[s.Clockwise=10]="Clockwise",s[s.Counterclockwise=11]="Counterclockwise",s[s.BidirectionalLeft=12]="BidirectionalLeft",s[s.BidirectionalRight=13]="BidirectionalRight",s),di=((s={})[s.Forwards=20]="Forwards",s[s.Reverse=21]="Reverse",s[s.Ascending=22]="Ascending",s[s.Descending=23]="Descending",s[s.Optimized=24]="Optimized",s),ci=((s={})[s.Pythagorean=30]="Pythagorean",s[s.Circular=31]="Circular",s);class gi extends Qe{me;Xc;Hb;Sg;vb;Ih;ON;EN;VN;Ls;Xy;Yy;Qa;Ky;vT;Mg;Pg;Ng;Yc;vi;C;Pe;Ne;On;Cg;constructor(t){super(),this.me=0,this.Xc=0,this.Hb=0,this.Sg=360,this.vb=0,this.Ih=0,this.ON=new U,this.EN=30,this.VN=0,this.Ls=0,this.Xy=0,this.Yy=new mi,this.Qa=0,this.Ky=0,this.vT=600,this.Mg=NaN,this.Pg=1,this.Ng=0,this.Yc=360,this.vi=0,this.C=10,this.Pe=24,this.Ne=We.standardComparer,this.On=6,this.Cg=30,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Mg=this.Mg,t.Pg=this.Pg,t.Ng=this.Ng,t.Yc=this.Yc,t.vi=this.vi,t.C=this.C,t.Pe=this.Pe,t.Ne=this.Ne,t.On=this.On,t.Cg=this.Cg}ci(t){t in di?this.sorting=t:t in ui?this.direction=t:t in li?this.arrangement=t:t in ci?this.nodeDiameterFormula=t:super.ci(t)}createNetwork(){return new fi(this)}YO(i,e,s){i=this.KO(i);let t=this.vb,n=this.EN,r=this.me,a=this.Xc,o=this.Hb,h=this.Sg,l=this.Ih,u=this.VN,d=this.Ls,c=this.Xy;if(t=this.arrangement,n=this.nodeDiameterFormula,r=this.radius,(!isFinite(r)||r<=0)&&(r=NaN),a=this.aspectRatio,(!isFinite(a)||a<=0)&&(a=1),o=this.startAngle,isFinite(o)||(o=0),h=this.sweepAngle,(!isFinite(h)||360<h||h<1)&&(h=360),l=this.spacing,isFinite(l)||(l=NaN),3===t&&31===n?t=0:3===t&&31!==n&&(n=31,t=this.arrangement),(12===this.direction||13===this.direction)&&24!==this.sorting){for(let t=0;!(t>=i.length||(e.add(i.elt(t)),t+1>=i.length));t+=2)s.add(i.elt(t+1));12===this.direction?(3===this.arrangement&&e.reverse(),(i=new O).addAll(e),i.addAll(s)):(3===this.arrangement&&s.reverse(),(i=new O).addAll(s),i.addAll(e))}var g=i.length;let m=u=0;for(let e=0;e<i.length;e++){var f=o+h*m*(10===this.direction?1:-1)/g;let t=i.elt(e).diameter;isNaN(t)&&(t=i.elt(e).Oh(f)),h<360&&(0===e||e===i.length-1)&&(t/=2),u+=t,m++}if(isNaN(r)||3===t){if(isNaN(l)&&(l=6),0!==t&&3!==t){let e=-1/0;for(let t=0;t<g;t++){var p=i.elt(t),v=i.elt(t===g-1?0:t+1);isNaN(p.diameter)&&p.Oh(0),isNaN(v.diameter)&&v.Oh(0),e=Math.max(e,(p.diameter+v.diameter)/2)}c=e+l,2===t?(y=2*Math.PI/g,y=(e+l)/y,1<a?(r=y,d=r*a):(d=y,r=d)):r=this.qb(c*(360<=h?g:g-1),a,o*Math.PI/180,h*Math.PI/180)}else r=this.qb(u+(360<=h?g:g-1)*(3!==t?l:1.6*l),a,o*Math.PI/180,h*Math.PI/180);d=r*a}else{d=r*a;var y=this.BN(r,d,o*Math.PI/180,h*Math.PI/180);if(isNaN(l))0===t&&(l=(y-u)/(360<=h?g:g-1));else if(0===t){var x=(y-u)/(360<=h?g:g-1);x<l?(r=this.qb(u+l*(360<=h?g:g-1),a,o*Math.PI/180,h*Math.PI/180),d=r*a):l=x}else{let e=-1/0;for(let t=0;t<g;t++){var A=i.elt(t),w=i.elt(t===g-1?0:t+1);isNaN(A.diameter)&&A.Oh(0),isNaN(w.diameter)&&w.Oh(0),e=Math.max(e,(A.diameter+w.diameter)/2)}var x=e+l,b=this.qb(x*(360<=h?g:g-1),a,o*Math.PI/180,h*Math.PI/180);c=b>r?(r=b,d=r*a,x):y/(360<=h?g:g-1)}}return this.vb=t,this.EN=n,this.me=r,this.Xc=a,this.Hb=o,this.Sg=h,this.Ih=l,this.VN=u,this.Ls=d,this.Xy=c,i}doLayout(e){Yt,null===e&&Xt.n("Layout.doLayout(collection) argument must not be null but a Diagram, a Group, or an Iterable of Parts"),null===this.network&&(this.network=this.makeNetwork(e)),this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin);e=this.network.vertexes;if(e.count<=1)1===e.count&&((r=e.first()).centerX=0,r.centerY=0);else{let t=new O;t.addAll(e.iterator);var s=new O,n=new O,r=(t=this.YO(t,s,n),this.vb),a=this.me,o=this.Hb,h=this.Sg,l=this.Ih,u=this.Ls,d=this.Xy;if(12!==this.direction&&13!==this.direction||3!==r)if(12===this.direction||13===this.direction){let i=0;switch(r){case 1:i=180*this.Wb(a,u,o,d)/Math.PI;break;case 0:{let t=0,e=0;var c=s.first(),c=(null!==c&&(t=c.Oh(Math.PI/2)),n.first());null!==c&&(e=c.Oh(Math.PI/2)),i=180*this.Wb(a,u,o,l+(t+e)/2)/Math.PI;break}case 2:i=h/t.length}if(12===this.direction){switch(r){case 1:this.Uy(s,h/2,o,11);break;case 0:this.Gy(s,h/2,o,11);break;case 2:this.Hy(s,h/2,o,11)}switch(r){case 1:this.Uy(n,h/2,o+i,10);break;case 0:this.Gy(n,h/2,o+i,10);break;case 2:this.Hy(n,h/2,o+i,10)}}else{switch(r){case 1:this.Uy(n,h/2,o,11);break;case 0:this.Gy(n,h/2,o,11);break;case 2:this.Hy(n,h/2,o,11)}switch(r){case 1:this.Uy(s,h/2,o+i,10);break;case 0:this.Gy(s,h/2,o+i,10);break;case 2:this.Hy(s,h/2,o+i,10)}}}else switch(r){case 1:this.Uy(t,h,o,this.direction);break;case 0:this.Gy(t,h,o,this.direction);break;case 2:this.Hy(t,h,o,this.direction);break;case 3:this.qT(t,h,o,this.direction)}else this.qT(t,h,o-h/2,10)}this.updateParts(),this.network=null,this.isValidLayout=!0}Hy(e,t,i,s){var n=this.Sg,r=this.me,a=this.Ls,o=i*Math.PI/180,h=t*Math.PI/180,l=e.length;for(let t=0;t<l;t++){var u=o+(10===s?t*h/(360<=n?l:l-1):-t*h/l),d=e.elt(t),c=r*Math.tan(u)/a,c=Math.sqrt((r*r+a*a*c*c)/(1+c*c));d.centerX=c*Math.cos(u),d.centerY=c*Math.sin(u),d.actualAngle=180*u/Math.PI}}Gy(e,t,i,s){var n=this.me,r=this.Ls,a=this.Ih;let o=i*Math.PI/180;var h=e.length;for(let t=0;t<h;t++){var l=e.elt(t),u=e.elt(t===h-1?0:t+1),d=n*Math.cos(o),c=r*Math.sin(o),d=(l.centerX=d,l.centerY=c,l.actualAngle=180*o/Math.PI,isNaN(l.diameter)&&l.Oh(0),isNaN(u.diameter)&&u.Oh(0),(l.diameter+u.diameter)/2),c=this.Wb(n,r,10===s?o:-o,d+a);o+=10===s?c:-c}}Uy(e,t,i,s){var n=this.me,r=this.Ls,a=this.Xy;let o=i*Math.PI/180;var h=e.length;for(let t=0;t<h;t++){var l=e.elt(t),l=(l.centerX=n*Math.cos(o),l.centerY=r*Math.sin(o),l.actualAngle=180*o/Math.PI,this.Wb(n,r,10===s?o:-o,a));o+=10===s?l:-l}}qT(t,e,i,s){let n=this.Ky;var r=this.Sg;if(this.Qa=0,this.Yy=new mi,e<360){for(n=i+(10===s?r:-r);n<0;)n+=360;180<(n%=360)&&(n-=360),n*=Math.PI/180,this.Ky=n,this.WT(t,e,i,s)}else this.jT(t,e,i,s);this.Yy.commit(t)}jT(s,n,r,a){var o=this.me,h=this.Ls,l=this.Ih,u=this.Xc;let e=o*Math.cos(r*Math.PI/180),i=h*Math.sin(r*Math.PI/180);var d=s.toArray();if(3===d.length)d[0].centerX=o,d[0].centerY=0,d[1].centerX=d[0].centerX-d[0].width/2-d[1].width/2-l,d[1].y=d[0].y,d[2].centerX=(d[0].centerX+d[1].centerX)/2,d[2].y=d[0].y-d[2].height-l;else if(4===d.length)d[0].centerX=o,d[0].centerY=0,d[2].centerX=-d[0].centerX,d[2].centerY=d[0].centerY,d[1].centerX=0,d[1].y=Math.min(d[0].y,d[2].y)-d[1].height-l,d[3].centerX=0,d[3].y=Math.max(d[0].y+d[0].height+l,d[2].y+d[2].height+l);else{var c=U.a();for(let t=0;t<d.length&&(d[t].centerX=e,d[t].centerY=i,!(t>=d.length-1));t++)this.JT(e,i,d,t,a,c)||this.ZT(e,i,d,t,a,c),e=c.x,i=c.y;if(U.o(c),this.Qa++,!(23<this.Qa)){var h=d[0].centerX,o=d[0].centerY,g=d[d.length-1].centerX,m=d[d.length-1].centerY;let t=Math.abs(h-g)-((d[0].width+d[d.length-1].width)/2+l);var f,p,l=Math.abs(o-m)-((d[0].height+d[d.length-1].height)/2+l);let e=0,i=(Math.abs(l)<1?((f=Math.abs(h-g))<(p=(d[0].width+d[d.length-1].width)/2)&&(e=0),t=f-p):e=0<l?l:Math.abs(t)<1?0:t,!1);i=Math.abs(g)>Math.abs(m)?0<g!=m<o:0<m!=h<g,(i=10===a?i:!i)&&(e=-Math.abs(e),e=Math.min(e,-d[d.length-1].width),e=Math.min(e,-d[d.length-1].height)),this.Yy.UO(e,d),1<Math.abs(e)&&(this.Qa<8?this.me-=e/(2*Math.PI):d.length<5&&10<e?this.me/=2:this.me-=0<e?1.7:-2.3,this.Ls=this.me*u,this.jT(s,n,r,a))}}}WT(t,e,i,s){var n=this.me,r=this.Ls,a=this.Xc;let o=n*Math.cos(i*Math.PI/180),h=r*Math.sin(i*Math.PI/180);var l,u=U.a(),d=t.toArray();for(let t=0;t<d.length&&(d[t].centerX=o,d[t].centerY=h,!(t>=d.length-1));t++)this.JT(o,h,d,t,s,u)||this.ZT(o,h,d,t,s,u),o=u.x,h=u.y;U.o(u),this.Qa++,23<this.Qa||(l=Math.atan2(h,o),l=10===s?this.Ky-l:l-this.Ky,l=(l=Math.abs(l)<Math.abs(l-2*Math.PI)?l:l-2*Math.PI)*(n+r)/2,this.Yy.GO(l,d),1<Math.abs(l)&&(this.Qa<8?this.me-=l/(2*Math.PI):this.me-=0<l?1.7:-2.3,this.Ls=this.me*a,this.WT(t,e,i,s)))}JT(t,e,i,s,n,r){var a=this.Ih,o=this.me,h=this.Ls;let l=0,u=0;a=(i[s].width+i[s+1].width)/2+a;let d=!1;if(0<=e!=(10===n)){if((l=t+a)>o){if((l=t-a)<-o)return r.x=l,r.y=u,!1;d=!0}}else if((l=t-a)<-o){if((l=t+a)>o)return r.x=l,r.y=u,!1;d=!0}return u=Math.sqrt(1-Math.min(1,l*l/(o*o)))*h,e<0!==d&&(u=-u),Math.abs(e-u)>(i[s].height+i[s+1].height)/2?(r.x=l,r.y=u,!1):(r.x=l,r.y=u,!0)}ZT(t,e,i,s,n,r){var a=this.Ih,o=this.me,h=this.Ls;let l=0,u=0;a=(i[s].height+i[s+1].height)/2+a;let d=!1;if(0<=t!=(10===n)){if((u=e-a)<-h){if((u=e+a)>h)return r.x=l,r.y=u,!1;d=!0}}else if((u=e+a)>h){if((u=e-a)<-h)return r.x=l,r.y=u,!1;d=!0}return l=Math.sqrt(1-Math.min(1,u*u/(h*h)))*o,t<0!==d&&(l=-l),Math.abs(t-l)>(i[s].width+i[s+1].width)/2?(r.x=l,r.y=u,!1):(r.x=l,r.y=u,!0)}commitLayout(){this.commitNodes(),this.isRouting&&this.commitLinks()}commitNodes(){var t=null!==this.group&&this.group.hasPlaceholder(),e=t?this.group.location.copy():null;let i=this.actualCenter;t?i=new U(0,0):(i.x=this.arrangementOrigin.x+this.me,i.y=this.arrangementOrigin.y+this.Ls);for(var s,n=this.network.vertexes.iterator;n.next();){var r=n.value;r.x+=i.x,r.y+=i.y,r.commit()}t&&(this.group.ensureBounds(),t=this.group.position.copy(),s=this.group.location.copy(),e=e.subtract(s.subtract(t)),this.group.move(e),this.ON=e.subtract(t))}commitLinks(){for(var t=this.network.edges.iterator;t.next();)t.value.commit()}BN(t,e,i,s){var n=this.vT;if(Math.abs(this.Xc-1)<.001)return void 0!==i&&void 0!==s?s*t:2*Math.PI*t;var r=e<t?Math.sqrt(t*t-e*e)/t:Math.sqrt(e*e-t*t)/e;let a=0,o=0,h=(o=void 0!==i&&void 0!==s?s/(n+1):Math.PI/(2*(n+1)),0);for(let t=0;t<=n;t++){h=void 0!==i&&void 0!==s?i+t*s/n:t*Math.PI/(2*n);var l=Math.sin(h);a+=Math.sqrt(1-r*r*l*l)*o}return void 0!==i&&void 0!==s?(e<t?t:e)*a:4*(e<t?t:e)*a}qb(t,e,i,s){let n=0;return t/(n=void 0!==i&&void 0!==s?this.BN(1,e,i,s):this.BN(1,e))}Wb(e,i,s,n){if(Math.abs(this.Xc-1)<.001)return n/e;var r=i<e?Math.sqrt(e*e-i*i)/e:Math.sqrt(i*i-e*e)/i;let a=0;var o=2*Math.PI/(700*this.network.vertexes.count);i<e&&(s+=Math.PI/2);for(let t=0;;t++){var h=s+t*o,h=Math.sin(h);if((a+=(i<e?e:i)*Math.sqrt(1-r*r*h*h)*o)>=n)return t*o}}KO(t){switch(this.sorting){case 20:break;case 21:t.reverse();break;case 22:t.sort(this.comparer);break;case 23:t.sort(this.comparer),t.reverse();break;case 24:return this.HO(this.vO(t));default:Xt.n("Invalid sorting type.")}return t}vO(n){var r=[];for(let t=0;t<n.length;t++)r.push(0);var a=new O;for(let s=0;s<n.length;s++){let e=-1,i=-1;if(0===s)for(let t=0;t<n.length;t++){var o=n.elt(t).edgesCount;o>e&&(e=o,i=t)}else for(let t=0;t<n.length;t++){var h=r[t];h>e&&(e=h,i=t)}a.add(n.elt(i)),r[i]=-1;var l=n.elt(i);let t=0;for(var u=l.sourceEdges;u.next();){var d=u.value.fromVertex;!((t=n.indexOf(d))<0)&&0<=r[t]&&r[t]++}for(var c=l.destinationEdges;c.next();){var g=c.value.toVertex;!((t=n.indexOf(g))<0)&&0<=r[t]&&r[t]++}}return a}HO(i){var a=[];for(let e=0;e<i.length;e++){var s=i.elt(e);a[e]=[];let t=0;for(var n=s.destinationEdges;n.next();){var r=n.value.toVertex;(t=i.indexOf(r))!==e&&a[e].indexOf(t)<0&&a[e].push(t)}for(var o=s.sourceEdges;o.next();){var h=o.value.fromVertex;(t=i.indexOf(h))!==e&&a[e].indexOf(t)<0&&a[e].push(t)}}var l=[];for(let t=0;t<a.length;t++)l[t]=0;var u=[],d=[],c=[],g=[],e=new O;let t=0;for(let r=0;r<a.length;r++){var m=a[r].length;if(1===m)g.push(r);else if(0===m)e.add(i.elt(r));else{if(0===t)u.push(r);else{let e=1/0,i=1/0,n=-1;var f=[];for(let t=0;t<u.length;t++)a[u[t]].indexOf(u[t===u.length-1?0:t+1])<0&&f.push(t===u.length-1?0:t+1);if(0===f.length)for(let t=0;t<u.length;t++)f.push(t);for(let t=0;t<f.length;t++){var p,v=f[t],y=this.qO(a[r],d,c,l,v,u);let s=0;for(let t=0;t<a[r].length;t++){var x=a[r][t],x=u.indexOf(x);0<=x&&(x=Math.abs(v-(v<=x?x+1:x)),s+=x<u.length+1-x?x:u.length+1-x)}for(let i=0;i<d.length;i++){let t=l[d[i]],e=l[c[i]];t>=v&&t++,e>=v&&e++,t>e&&(p=e,e=t,t=p),e-t<(u.length+2)/2==(t<v&&v<=e)&&s++}(y<e||y===e&&s<i)&&(e=y,i=s,n=v)}u.splice(n,0,r);for(let t=0;t<u.length;t++)l[u[t]]=t;for(let t=0;t<a[r].length;t++){var A=a[r][t];0<=u.indexOf(A)&&(d.push(r),c.push(A))}}t++}}let w=!1;for(var b=u.length;;){w=!0;for(let t=0;t<g.length;t++){var P=g[t],S=a[P][0],k=u.indexOf(S);if(0<=k){let e=0;for(let t=0;t<a[S].length;t++){var M,N=a[S][t],N=u.indexOf(N);N<0||N===k||(M=k<N?N-k:k-N,e+=N<k!=b-M<M?1:-1)}u.splice(e<0?k:k+1,0,P),g.splice(t,1),t--}else w=!1}if(w)break;u.push(g[0]),g.splice(0,1)}for(let t=0;t<u.length;t++){var C=u[t];e.add(i.elt(C))}return e}qO(s,n,r,a,o,h){let l=0;for(let t=0;t<n.length;t++){var u=n[t],d=r[t],u=a[u],d=a[d];let e=0,i=0;if(i=u<d?(e=u,d):(e=d,u),e<o&&o<=i)for(let t=0;t<s.length;t++){var c=s[t];h.indexOf(c)<0||e<a[c]&&a[c]<i||e===a[c]||i===a[c]||l++}else for(let t=0;t<s.length;t++){var g=s[t];h.indexOf(g)<0||!(e<a[g]&&a[g]<i)||e===a[g]||i===a[g]||l++}}return l}get radius(){return this.Mg}set radius(t){this.Mg!==t&&(Xt.t(t,"number",gi,"radius"),0<t||isNaN(t))&&(this.Mg=t,this.invalidateLayout())}get aspectRatio(){return this.Pg}set aspectRatio(t){this.Pg!==t&&(Xt.t(t,"number",gi,"aspectRatio"),0<t)&&(this.Pg=t,this.invalidateLayout())}get startAngle(){return this.Ng}set startAngle(t){this.Ng!==t&&(Xt.t(t,"number",gi,"startAngle"),this.Ng=t,this.invalidateLayout())}get sweepAngle(){return this.Yc}set sweepAngle(t){this.Yc!==t&&(Xt.t(t,"number",gi,"sweepAngle"),this.Yc=0<t&&t<=360?t:360,this.invalidateLayout())}get arrangement(){return this.vi}set arrangement(t){this.vi!==t&&(Xt.it(t,li,"CircularArrangement"),3===t||0===t||1===t||2===t)&&(this.vi=t,this.invalidateLayout())}get direction(){return this.C}set direction(t){this.C!==t&&(Xt.it(t,ui,"CircularDirection"),10===t||11===t||12===t||13===t)&&(this.C=t,this.invalidateLayout())}get sorting(){return this.Pe}set sorting(t){this.Pe!==t&&(Xt.it(t,di,"CircularSorting"),this.Pe=t,this.invalidateLayout())}get comparer(){return this.Ne}set comparer(t){this.Ne!==t&&(Xt.t(t,"function",gi,"comparer"),this.Ne=t,this.invalidateLayout())}get spacing(){return this.On}set spacing(t){this.On!==t&&(Xt.t(t,"number",gi,"spacing"),this.On=t,this.invalidateLayout())}get nodeDiameterFormula(){return this.Cg}set nodeDiameterFormula(t){this.Cg!==t&&(Xt.it(t,ci,"CircularNodeDiameterFormula"),30===t||31===t)&&(this.Cg=t,this.invalidateLayout())}get actualXRadius(){return this.me}get actualYRadius(){return this.Ls}get actualSpacing(){return this.Ih}get actualCenter(){return this.ON}static ConstantSpacing=0;static ConstantDistance=1;static ConstantAngle=2;static Packed=3;static Clockwise=10;static Counterclockwise=11;static BidirectionalLeft=12;static BidirectionalRight=13;static Forwards=20;static Reverse=21;static Ascending=22;static Descending=23;static Optimized=24;static Pythagorean=30;static Circular=31}class mi{Kc;_a;Uc;constructor(){this.Kc=-1/0,this._a=null,this.Uc=null}UO(t,e){if(0<t&&this.Kc<0||Math.abs(t)<Math.abs(this.Kc)&&!(t<0&&0<this.Kc)){this.Kc=t,this._a=[],this.Uc=[];for(let t=0;t<e.length;t++)this._a[t]=e[t].bounds.x,this.Uc[t]=e[t].bounds.y}}GO(t,e){if(Math.abs(t)<Math.abs(this.Kc)){this.Kc=t,this._a=[],this.Uc=[];for(let t=0;t<e.length;t++)this._a[t]=e[t].bounds.x,this.Uc[t]=e[t].bounds.y}}commit(e){if(null!==this._a&&null!==this.Uc)for(let t=0;t<this._a.length;t++){var i=e.elt(t);i.x=this._a[t],i.y=this.Uc[t]}}}class fi extends Ue{constructor(t){super(t)}createVertex(){return new pi(this)}createEdge(){return new vi(this)}}class pi extends We{Ao;jb;constructor(t){super(t),this.Ao=NaN,this.jb=NaN}Oh(t){var e,i=this.network;return null===i||null===(i=i.layout)?NaN:3===i.arrangement?31===i.nodeDiameterFormula?(this.Ao=Math.max(this.width,this.height),this.Ao):(e=Math.abs(Math.sin(t)),t=Math.abs(Math.cos(t)),0===e?this.width:0===t?this.height:(this.Ao=Math.min(this.height/e,this.width/t),this.Ao)):(31===i.nodeDiameterFormula?this.Ao=Math.max(this.width,this.height):this.Ao=Math.sqrt(this.width*this.width+this.height*this.height),this.Ao)}get diameter(){return this.Ao}set diameter(t){this.Ao!==t&&(Xt.t(t,"number",pi,"diameter"),this.Ao=t)}get actualAngle(){return this.jb}set actualAngle(t){this.jb!==t&&(Xt.t(t,"number",pi,"actualAngle"),this.jb=t)}}class vi extends Ze{constructor(t){super(t)}}class yi extends Qe{vy;Eh;Ts;Ag;zn;Ye;Lg;Tg;Dg;Gc;Fg;Rg;Hc;vc;qc;Wc;Ig;Og;jc;tf;constructor(t){super(),this.vy=0,this.Eh=0,this.Ts=new qt(100,100).w(),this.Ag=!1,this.zn=!0,this.Ye=!1,this.Lg=100,this.Tg=300,this.Dg=1,this.Gc=1e3,this.Fg=10,this.Rg=Math,this.Hc=.05,this.vc=50,this.qc=150,this.Wc=0,this.Ig=10,this.Og=5,this.jc=NaN,this.tf=10,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Ts.c(this.Ts),t.Ag=this.Ag,t.zn=this.zn,t.Ye=this.Ye,t.Lg=this.Lg,t.Tg=this.Tg,t.Dg=this.Dg,t.Gc=this.Gc,t.Fg=this.Fg,t.Rg=this.Rg,t.Hc=this.Hc,t.vc=this.vc,t.qc=this.qc,t.Wc=this.Wc,t.Ig=this.Ig,t.Og=this.Og,t.jc=this.jc,t.tf=this.tf}createNetwork(){return new xi(this)}doLayout(t){Yt,null===t&&Xt.n("Layout.doLayout(collection) argument must not be null but a Diagram, a Group, or an Iterable of Parts"),this.network=this.makeNetwork(t);var e=this.network.vertexes.iterator,t=this.maxIterations;if(0<this.network.vertexes.count){for(this.network.deleteSelfEdges(),e=this.network.vertexes.iterator;e.next();){var i=e.value;i.charge=this.electricalCharge(i),i.mass=this.gravitationalMass(i)}for(var s=this.network.edges.iterator;s.next();){var n=s.value;n.stiffness=this.springStiffness(n),n.length=this.springLength(n)}if(this.zN(),this.Eh=0,this.needsPrelayout()){var r=this.network,a=r.splitIntoSubNetworks(!1);let t=a.iterator;for(;t.next();){var o=t.value;this.doConnectedSubnetLayout(o)}for(t=a.iterator,this.WO(t,r),t=a.iterator;t.next();){for(var h=t.value,l=h.vertexes.iterator;l.next();){var u=l.value;r.addVertex(u)}for(var d=h.edges.iterator;d.next();){var c=d.value;r.addEdge(c)}}}else this.$T(this.network,this.maxIterations);this.updateParts()}this.maxIterations=t,this.isValidLayout=!0}needsPrelayout(){if(!(this.network.vertexes.count<3)){let t=0,e=0;for(var i=this.network.vertexes.first().bounds,s=this.network.vertexes.iterator;s.next();){var n=s.value,r=n.bounds;if(isNaN(n.x)||isNaN(n.y)||r.intersectsRect(i)&&2<++t)return!0;if(10<e)return!1;e++}}return!1}doConnectedSubnetLayout(t){let e=t.vertexes.iterator;for(;e.next();){var i=e.value;i.hierarchicalVertexes.add(i)}let s=t,n=this.jc;if((n=isNaN(n)?t.edges.count/t.vertexes.count:n)<t.vertexes.count)for(;s.vertexes.count>Math.max(100,Math.sqrt(n*t.vertexes.count));)s=this.coarsenNetwork(s);let r=0,a=(e=s.vertexes.iterator,this.randomNumberGenerator);for(null===a&&(this.randomNumberGenerator=a=new bi(0));e.next();){e.value.idInCluster=r++;for(var o=10*(a.random()-.5),h=10*(a.random()-.5),l=(e.value.x=o,e.value.y=h,e.value.hierarchicalVertexes.iterator);l.next();)l.value.x=o,l.value.y=h}var u=this.computePairwiseDistances(s);this.jO(s,u,this.maxPrelayoutIterations,t.vertexes.count),this.$T(t,this.maxIterations)}computePairwiseDistances(t){var e=t.vertexes.count,i=new Array(e);for(let t=0;t<e;t++)i[t]=new Array(e).fill(-1),i[t][t]=0;for(var s=t.vertexes.iterator,n=new Map,r=[];s.next();){var a=s.value,r=[a];for((n=new Map).set(a.idInCluster,0);0<r.length;)for(var o=r.shift(),h=o.vertexes.iterator;h.next();){var l=h.value;n.has(l.idInCluster)||(n.set(l.idInCluster,n.get(o.idInCluster)+1),r.push(l))}for(let t=0;t<e;t++){var u=Math.min(i[a.idInCluster][t],i[t][a.idInCluster]),d=n.get(t);(u<0||d<u)&&(i[a.idInCluster][t]=d,i[t][a.idInCluster]=d)}}return i}coarsenNetwork(t){var i=this.createNetwork(),s=new Map;let e=0,n=t.vertexes.iterator;for(;n.next();)n.value.idInCluster=e++;for(n=t.vertexes.iterator;n.next();){var r=n.value;if(!s.has(r.idInCluster)){let t=Number.MAX_SAFE_INTEGER,e=null;for(var a=r.vertexes.iterator;a.next();){var o=a.value;s.has(o.idInCluster)||o.hierarchicalVertexes.length<t&&(t=o.hierarchicalVertexes.length,e=o)}var h=i.createVertex();h.hierarchicalVertexes.addAll(r.hierarchicalVertexes),null!=e&&h.hierarchicalVertexes.addAll(e.hierarchicalVertexes),s.set(r.idInCluster,h),null!=e&&s.set(e.idInCluster,h),i.addVertex(h)}}for(var l=t.edges.iterator;l.next();){var u,d=l.value,c=s.get(d.fromVertex.idInCluster),d=s.get(d.toVertex.idInCluster);c!==d&&((u=i.createEdge()).fromVertex=c,u.toVertex=d,i.addEdge(u))}return i}Fw(t,e){let i=!0;for(var s=t.vertexes.iterator;s.next();){var n=s.value;i?(i=!1,e.set(n.bounds)):e.unionRect(n.bounds)}return e}WO(t,e){Yt,Xt.s(e,xi,yi,"arrangeConnectedGraphs:singletons");var i=this.arrangementSpacing,s=t.count;let n=!0,r=0,a=0;var o=Xt.ct();for(let t=0;t<s+e.vertexes.count+2;t++)o[t]=null;let h=0;t.reset();var l=Z.a();let u;for(;t.next();){var d=t.value;if(this.Fw(d,l),n)n=!1,r=l.x+l.width/2,a=l.y+l.height/2,o[0]=new U(l.x+l.width+i.width,l.y),o[1]=new U(l.x,l.y+l.height+i.height),h=2;else{var c=this.QT(o,h,r,a,l.width,l.height,i),g=o[c],m=new U(g.x+l.width+i.width,g.y),f=new U(g.x,g.y+l.height+i.height),p=(c+1<h&&o.splice(c+1,0,null),o[c]=m,o[c+1]=f,h++,g.x-l.x),v=g.y-l.y;for(u=d.vertexes.iterator;u.next();){var y=u.value;y.centerX+=p,y.centerY+=v}}}for(Z.o(l),u=e.vertexes.iterator;u.next();){var x,A,w,b=u.value,P=b.bounds;h<2?(r=P.x+P.width/2,a=P.y+P.height/2,o[0]=new U(P.x+P.width+i.width,P.y),o[1]=new U(P.x,P.y+P.height+i.height),h=2):(A=o[x=this.QT(o,h,r,a,P.width,P.height,i)],w=new U(A.x+P.width+i.width,A.y),P=new U(A.x,A.y+P.height+i.height),x+1<h&&o.splice(x+1,0,null),o[x]=w,o[x+1]=P,h++,b.centerX=A.x+b.width/2,b.centerY=A.y+b.height/2)}Xt.ot(o)}QT(i,s,t,n,r,a,o){let h=9e19,l=-1;t:for(let e=0;e<s;e++){var u=i[e],d=u.x-t,c=u.y-n,d=d*d+c*c;if(d<h){for(let t=e-1;0<=t;t--)if(i[t].y>u.y&&i[t].x-u.x<r+o.width)continue t;for(let t=e+1;t<s;t++)if(i[t].x>u.x&&i[t].y-u.y<a+o.height)continue t;l=e,h=d}}return l}zN(){if(this.comments)for(var t=this.network.vertexes.iterator;t.next();){var e=t.value;this.addComments(e)}}addComments(i){var t=i.node;if(null!==t)for(var e=t.findNodesConnected();e.next();){var s=e.value;if("Comment"===s.category&&s.isVisible()){let t=this.network.findVertex(s),e=((t=null===t?this.network.addNode(s):t).charge=this.defaultCommentElectricalCharge,null);for(var n=t.destinationEdges;n.next();){var r=n.value;if(r.toVertex===i){e=r;break}}if(null===e)for(var a=t.sourceEdges;a.next();){var o=a.value;if(o.fromVertex===i){e=o;break}}(e=null===e?this.network.linkVertexes(i,t,null):e).length=this.defaultCommentSpringLength}}}XN(t,e){Yt,Xt.s(t,Ai,yi,"getNodeDistance:vertexA"),Xt.s(e,Ai,yi,"getNodeDistance:vertexB");var i,s,t=t.bounds,n=t.x,r=t.y,a=t.width,t=t.height,e=e.bounds,o=e.x,h=e.y,l=e.width,e=e.height;return n+a<o?h+e<r?(s=n+a-o,i=r-h-e,I.Cw(s*s+i*i)):r+t<h?(s=n+a-o,i=r+t-h,I.Cw(s*s+i*i)):o-(n+a):o+l<n?h+e<r?(s=n-o-l,i=r-h-e,I.Cw(s*s+i*i)):r+t<h?(a=n-o-l,s=r+t-h,I.Cw(a*a+s*s)):n-(o+l):h+e<r?r-(h+e):r+t<h?h-(r+t):.1}$T(t,e){Yt,Xt.r(e,yi,"performIterations:num");for(var i=this.Eh+e;this.Eh<i&&(this.Eh++,this.JO(t)););}JO(t){var i=t.vertexes.toArray();if(i.length<=0)return!1;var e=i[0];e.forceX=0,e.forceY=0;let s=e.centerX,n=s,r=e.centerY,a=r;for(let t=1;t<i.length;t++){var o=i[t],h=(o.forceX=0,o.forceY=0,o.centerX),o=o.centerY;s=Math.min(s,h),n=Math.max(n,h),r=Math.min(r,o),a=Math.max(a,o)}var l=n-s>a-r,u=(l?i.sort((t,e)=>null===t||null===e||t===e?0:t.centerX-e.centerX):i.sort((t,e)=>null===t||null===e||t===e?0:t.centerY-e.centerY),this.Gc);let d=0,c=0,g=0;for(let e=0;e<i.length;e++){var m=i[e],f=m.bounds,p=m.focus,v=f.x+p.x,y=f.y+p.y;c=m.charge*this.electricalFieldX(v,y),g=m.charge*this.electricalFieldY(v,y),c+=m.mass*this.gravitationalFieldX(v,y),g+=m.mass*this.gravitationalFieldY(v,y),m.forceX+=c,m.forceY+=g;for(let t=e+1;t<i.length;t++){var x=i[t];if(this.shouldInteract(m,x)&&t!==e){var A=x.bounds,w=x.focus,b=A.x+w.x,A=A.y+w.y;if(u<v-b||u<b-v){if(l)break}else{if(u<y-A||u<A-y){if(l)continue;break}var w=this.XN(m,x),P=2*m.charge,S=2*x.charge;if(1<w)d=P*S/(w*w),c=d*(v-b)/w,g=d*(y-A)/w;else{let t=this.randomNumberGenerator;null===t&&(this.randomNumberGenerator=t=new bi(0));var k,w=t.random(),M=t.random();c=b<v?P*S*(1+(c=Math.abs(x.bounds.right-m.bounds.x)))*w:v<b?-P*S*(1+(c=Math.abs(x.bounds.x-m.bounds.right)))*w:P*S*((1+(k=Math.max(x.width,m.width)))*w-k/2),g=A<y?P*S*(1+(g=Math.abs(x.bounds.bottom-m.bounds.y)))*M:v<b?-P*S*(1+(g=Math.abs(x.bounds.y-m.bounds.bottom)))*M:P*S*((1+(w=Math.max(x.height,m.height)))*M-w/2)}m.forceX+=c,m.forceY+=g,x.forceX-=c,x.forceY-=g}}}}for(var N=t.edges.iterator;N.next();){var C=N.value,L=C.fromVertex,D=C.toVertex,T=L.bounds,B=L.focus,O=T.x+B.x,T=T.y+B.y,B=D.bounds,G=D.focus,E=B.x+G.x,B=B.y+G.y,G=this.XN(L,D);1<G&&(d=.1*C.stiffness*(G-C.length),c=.5*d*(L.width+D.height)*(O-E)/G,g=.5*d*(L.width+D.height)*(T-B)/G),L.forceX-=c,L.forceY-=g,D.forceX+=c,D.forceY+=g}let F=0;for(let t=0;t<i.length;t++){var R=i[t];this.isFixed(R)?this.moveFixedVertex(R):F=Math.max(F,this.moveVertex(R)||0)}return F>this.epsilonDistance*this.epsilonDistance}jO(t,i,e,s){Yt,Xt.r(e,yi,"performIterations:num");var n,r,a=this.Eh+e,o=Math.sqrt(s),h=(this.vy=this.tf*t.vertexes.count,t.vertexes.toArray());let l=0,u,d=0;for(;this.Eh<a;){this.Eh++,u=l;for(let e=l=0;e<h.length;e++){h[e].forceX=0;for(let t=h[e].forceY=0;t<h.length;t++)e!==t&&(n=this.XN(h[e],h[t]),r=i[h[e].idInCluster][h[t].idInCluster],r=(n-this.tf*o*r)/n,h[e].forceX+=r*(h[t].x-h[e].x),h[e].forceY+=r*(h[t].y-h[e].y));var c=Math.sqrt(h[e].forceX*h[e].forceX+h[e].forceY*h[e].forceY);if(0<c){h[e].forceX=this.vy*h[e].forceX/c,h[e].forceY=this.vy*h[e].forceY/c,h[e].x+=h[e].forceX,h[e].y+=h[e].forceY;for(var g=h[e].hierarchicalVertexes.iterator;g.next();){var m=g.value;m.centerX+=h[e].forceX,m.centerY+=h[e].forceY}}l+=c*c}if(l>=u){if(5<=++d)break}else d=0;this.vy*=.95}}moveVertex(t){let e=t.forceX,i=t.forceY;var s=this.moveLimit;return e<-s?e=-s:e>s&&(e=s),i<-s?i=-s:i>s&&(i=s),t.centerX+=e,t.centerY+=i,e*e+i*i}shouldInteract(t,e){return!0}moveFixedVertex(t){}commitLayout(){this.qy(),this.commitNodes(),this.isRouting&&this.commitLinks()}qy(){if(this.setsPortSpots)for(var t=this.network.edges.iterator;t.next();){var e=t.value.link;null!==e&&(e.fromSpot=J.Default,e.toSpot=J.Default)}}commitNodes(){let t=0,e=0;this.arrangesToOrigin&&(i=Z.a(),this.Fw(this.network,i),s=this.arrangementOrigin,t=s.x-i.x,e=s.y-i.y,Z.o(i));for(var i,s,n=Z.a(),r=this.network.vertexes.iterator;r.next();){var a=r.value;0===t&&0===e||(n.c(a.bounds),n.x+=t,n.y+=e,a.bounds=n),a.commit()}Z.o(n)}commitLinks(){for(var t=this.network.edges.iterator;t.next();)t.value.commit()}springStiffness(t){t=t.stiffness;return isNaN(t)?this.Hc:t}springLength(t){t=t.length;return isNaN(t)?this.vc:t}electricalCharge(t){t=t.charge;return isNaN(t)?this.qc:t}electricalFieldX(t,e){return 0}electricalFieldY(t,e){return 0}gravitationalMass(t){t=t.mass;return isNaN(t)?this.Wc:t}gravitationalFieldX(t,e){return 0}gravitationalFieldY(t,e){return 0}isFixed(t){return t.isFixed}get currentIteration(){return this.Eh}get arrangementSpacing(){return this.Ts}set arrangementSpacing(t){Xt.s(t,qt,yi,"arrangementSpacing"),this.Ts.equals(t)||(this.Ts.c(t),this.invalidateLayout())}get arrangesToOrigin(){return this.Ag}set arrangesToOrigin(t){this.Ag!==t&&(Xt.t(t,"boolean",yi,"arrangesToOrigin"),this.Ag=t,this.invalidateLayout())}get setsPortSpots(){return this.zn}set setsPortSpots(t){this.zn!==t&&(Xt.t(t,"boolean",yi,"setsPortSpots"),this.zn=t,this.invalidateLayout())}get comments(){return this.Ye}set comments(t){this.Ye!==t&&(Xt.t(t,"boolean",yi,"comments"),this.Ye=t,this.invalidateLayout())}get maxPrelayoutIterations(){return this.Lg}set maxPrelayoutIterations(t){this.Lg!==t&&(Xt.t(t,"number",yi,"maxPrelayoutIterations"),0<=t)&&(this.Lg=t,this.invalidateLayout())}get maxIterations(){return this.Tg}set maxIterations(t){this.Tg!==t&&(Xt.t(t,"number",yi,"maxIterations"),0<=t)&&(this.Tg=t,this.invalidateLayout())}get epsilonDistance(){return this.Dg}set epsilonDistance(t){this.Dg!==t&&(Xt.t(t,"number",yi,"epsilonDistance"),0<t)&&(this.Dg=t,this.invalidateLayout())}get infinityDistance(){return this.Gc}set infinityDistance(t){this.Gc!==t&&(Xt.t(t,"number",yi,"infinityDistance"),1<t)&&(this.Gc=t,this.invalidateLayout())}get moveLimit(){return this.Fg}set moveLimit(t){this.Fg!==t&&(Xt.t(t,"number",yi,"moveLimit"),this.Fg=t,this.invalidateLayout())}get randomNumberGenerator(){return this.Rg}set randomNumberGenerator(t){this.Rg!==t&&(null!==t&&"function"!=typeof t.random&&Xt.n('ForceDirectedLayout.randomNumberGenerator must have a "random()" function on it: '+t),this.Rg=t)}get defaultSpringStiffness(){return this.Hc}set defaultSpringStiffness(t){this.Hc!==t&&(Xt.t(t,"number",yi,"defaultSpringStiffness"),this.Hc=t,this.invalidateLayout())}get defaultSpringLength(){return this.vc}set defaultSpringLength(t){this.vc!==t&&(Xt.t(t,"number",yi,"defaultSpringLength"),this.vc=t,this.invalidateLayout())}get defaultElectricalCharge(){return this.qc}set defaultElectricalCharge(t){this.qc!==t&&(Xt.t(t,"number",yi,"defaultElectricalCharge"),this.qc=t,this.invalidateLayout())}get defaultGravitationalMass(){return this.Wc}set defaultGravitationalMass(t){this.Wc!==t&&(Xt.t(t,"number",yi,"defaultGravitationalMass"),this.Wc=t,this.invalidateLayout())}get defaultCommentSpringLength(){return this.Ig}set defaultCommentSpringLength(t){this.Ig!==t&&(Xt.t(t,"number",yi,"defaultCommentSpringLength"),this.Ig=t,this.invalidateLayout())}get defaultCommentElectricalCharge(){return this.Og}set defaultCommentElectricalCharge(t){this.Og!==t&&(Xt.t(t,"number",yi,"defaultCommentElectricalCharge"),this.Og=t,this.invalidateLayout())}get prelayoutQuality(){return this.jc}set prelayoutQuality(t){this.jc!==t&&(Xt.t(t,"number",yi,"prelayoutQuality"),this.jc=t,this.invalidateLayout())}get prelayoutSpread(){return this.tf}set prelayoutSpread(t){this.tf!==t&&(Xt.t(t,"number",yi,"prelayoutSpread"),this.tf=t,this.invalidateLayout())}}class xi extends Ue{constructor(t){super(t)}createVertex(){return new Ai(this)}createEdge(){return new wi(this)}}class Ai extends We{Jb;Zb;$b;Qb;_b;hierarchicalVertexes;idInCluster;constructor(t){super(t),this.Jb=!1,this.Zb=NaN,this.$b=NaN,this.Qb=0,this._b=0,this.hierarchicalVertexes=new O,this.idInCluster=-1}get isFixed(){return this.Jb}set isFixed(t){this.Jb!==t&&(Xt.t(t,"boolean",Ai,"isFixed"),this.Jb=t)}get charge(){return this.Zb}set charge(t){this.Zb!==t&&(Xt.t(t,"number",Ai,"charge"),this.Zb=t)}get mass(){return this.$b}set mass(t){this.$b!==t&&(Xt.t(t,"number",Ai,"mass"),this.$b=t)}get forceX(){return this.Qb}set forceX(t){this.Qb!==t&&(Xt.t(t,"number",Ai,"forceX"),this.Qb=t)}get forceY(){return this._b}set forceY(t){this._b!==t&&(Xt.t(t,"number",Ai,"forceY"),this._b=t)}}class wi extends Ze{tk;ik;constructor(t){super(t),this.tk=NaN,this.ik=NaN}get stiffness(){return this.tk}set stiffness(t){this.tk!==t&&(Xt.t(t,"number",wi,"stiffness"),this.tk=t)}get length(){return this.ik}set length(t){this.ik!==t&&(Xt.t(t,"number",wi,"length"),this.ik=t)}}class bi{I;R;Q;M;A;seed;constructor(t){this.seed=t=void 0===t?42:t,this.A=48271,this.M=2147483647,this.Q=this.M/this.A,this.R=this.M%this.A,this.I=1/this.M,this.random()}random(){var t=this.seed/this.Q,e=this.seed%this.Q,e=this.A*e-this.R*t;return this.seed=0<e?e:e+this.M,this.seed*this.I}}(s={})[s.DepthFirst=0]="DepthFirst",s[s.Greedy=1]="Greedy",s[s.FromLayers=2]="FromLayers";var s,Pi,Si=s,ki=((s={})[s.OptimalLinkLength=10]="OptimalLinkLength",s[s.LongestPathSink=11]="LongestPathSink",s[s.LongestPathSource=12]="LongestPathSource",s),Mi=((s={})[s.DepthFirstOut=20]="DepthFirstOut",s[s.DepthFirstIn=21]="DepthFirstIn",s[s.Naive=22]="Naive",s),Ni=((s={})[s.None=30]="None",s[s.Less=31]="Less",s[s.More=32]="More",s);(s={})[s.None=0]="None",s[s.Expand=1]="Expand",s[s.Straighten=2]="Straighten",s[s.Median=4]="Median",s[s.MaybeExpand=8]="MaybeExpand",s[s.All=15]="All",(Pi={})[Pi.None=0]="None",Pi[Pi.UpperLeft=1]="UpperLeft",Pi[Pi.UpperRight=2]="UpperRight",Pi[Pi.LowerLeft=4]="LowerLeft",Pi[Pi.LowerRight=8]="LowerRight",Pi[Pi.All=15]="All";class Ci extends Qe{Ds;te;C;Jc;Zc;$c;ef;Qc;cr;_c;zn;Lt;Wy;Wt;Eg;Fs;yi;on;Rs;Is;Gt;Vg;sf;Bg;rn;tu;ur;Xn;Yn;YN;constructor(t){super(),this.Ds=25,this.te=25,this.C=0,this.Jc=0,this.Zc=10,this.$c=20,this.ef=4,this.Qc=31,this.cr=15,this._c=10,this.zn=!0,this.Lt=-1,this.Wy=-1,this.Wt=-1,this.Eg=0,this.Fs=0,this.yi=null,this.on=null,this.Rs=null,this.Is=null,this.Gt=null,this.Vg=0,this.sf=null,this.Bg=null,this.rn=0,this.tu=null,this.ur=new U,this.Xn=[],this.Xn.length=100,this.Yn=15,this.YN=0,t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Ds=this.Ds,t.te=this.te,t.C=this.C,t.Jc=this.Jc,t.Zc=this.Zc,t.$c=this.$c,t.ef=this.ef,t.Qc=this.Qc,t.cr=this.cr,t._c=this._c,t.zn=this.zn,t.Yn=this.Yn}ci(t){t in Ni?this.aggressiveOption=t:t in Si?this.cycleRemoveOption=t:t in Mi?this.initializeOption=t:t in ki?this.layeringOption=t:super.ci(t)}createNetwork(){return new Li(this)}doLayout(t){Yt,null===t&&Xt.n("Layout.doLayout(collection) argument must not be null but a Diagram, a Group, or an Iterable of Parts"),null===this.network&&(this.network=this.makeNetwork(t)),this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin),this.ZO(),0<this.network.vertexes.count&&(this.network.deleteSelfEdges(),2!==this.cycleRemoveOption&&this.removeCycles(),this.$O(),2===this.cycleRemoveOption&&this.removeCycles(),this.QO(),this._O(),this.t3(),this.reduceCrossings(),this.straightenAndPack(),this.updateParts()),this.network=null,this.isValidLayout=!0}linkMinLength(t){return 1}linkLengthWeight(t){return 1}linkStraightenWeight(t){var e=t.fromVertex.node||t.fromVertex.data,t=t.toVertex.node||t.toVertex.data;return null===e&&null===t?8:null===e||null===t?4:1}nodeMinLayerSpace(t,e){return null===t.node&&null===t.data?0:90===this.C||270===this.C?e?t.focus.y+10:t.bounds.height-t.focus.y+10:e?t.focus.x+10:t.bounds.width-t.focus.x+10}nodeMinColumnSpace(t,e){var i;return null===t.node&&null===t.data?0:null!==(i=e?t.ek:t.sk)?i:90===(i=this.C)||270===i?e?t.ek=t.focus.x/this.te+1|0:t.sk=(t.bounds.width-t.focus.x)/this.te+1|0:e?t.ek=t.focus.y/this.te+1|0:t.sk=(t.bounds.height-t.focus.y)/this.te+1|0}ie(){null===this.sf&&(this.sf=[]);let t=0;for(var e=this.network.vertexes.iterator;e.next();){var i=e.value;this.sf[t]=i.layer,t++,this.sf[t]=i.column,t++,this.sf[t]=i.index,t++}return this.sf}ns(t){let e=0;for(var i=this.network.vertexes.iterator;i.next();){var s=i.value;s.layer=t[e],e++,s.column=t[e],e++,s.index=t[e],e++}}_T(p,v){Yt,Xt.r(p,Ci,"crossingMatrix:unfixedLayer"),Xt.r(v,Ci,"crossingMatrix:direction");var y=this.Vh(p),x=this.yi[p],A=((null===this.Bg||this.Bg.length<x*x)&&(this.Bg=[]),this.Bg);for(let f=0;f<x;f++){let t=0;var w=y[f],b=w.near;let i=0;null!==b&&b!==w&&b.layer===w.layer&&(t+=Math.max(0,Math.abs(b.index-w.index)-1));let e,s=0,n,r=0,a=0,o=0,h,l=0,u,d=0,c=0,g=0,m;if(0<=v)for(e=y[f].Mo,s=0;s<e.length;s++)if((n=e[s]).valid&&n.fromVertex.layer!==p)for(r=n.fromVertex.index,a=n.portToPos,o=n.portFromPos,l=s+1;l<e.length;l++)(u=e[l]).valid&&u.fromVertex.layer!==p&&(d=u.fromVertex.index,c=u.portToPos,g=u.portFromPos,a<c&&(r>d||r===d&&o>g)&&t++,c<a)&&(d>r||d===r&&g>o)&&t++;if(v<=0)for(e=y[f].hr,s=0;s<e.length;s++)if((n=e[s]).valid&&n.toVertex.layer!==p)for(r=n.toVertex.index,a=n.portToPos,o=n.portFromPos,l=s+1;l<e.length;l++)(u=e[l]).valid&&u.toVertex.layer!==p&&(d=u.toVertex.index,c=u.portToPos,g=u.portFromPos,o<g&&(r>d||r===d&&a>c)&&t++,g<o)&&(d>r||d===r&&c>a)&&t++;for(A[f*x+f]=t,i=f+1;i<x;i++){let t=0,e=0;if(0<=v)for(h=y[f].Mo,m=y[i].Mo,s=0;s<h.length;s++)if((n=h[s]).valid&&n.fromVertex.layer!==p)for(r=n.fromVertex.index,a=n.portToPos,o=n.portFromPos,l=0;l<m.length;l++)(u=m[l]).valid&&u.fromVertex.layer!==p&&(d=u.fromVertex.index,c=u.portToPos,g=u.portFromPos,(r<d||r===d&&o<g)&&e++,d<r||d===r&&g<o)&&t++;if(v<=0)for(h=y[f].hr,m=y[i].hr,s=0;s<h.length;s++)if((n=h[s]).valid&&n.toVertex.layer!==p)for(r=n.toVertex.index,a=n.portToPos,o=n.portFromPos,l=0;l<m.length;l++)(u=m[l]).valid&&u.toVertex.layer!==p&&(d=u.toVertex.index,c=u.portToPos,g=u.portFromPos,(r<d||r===d&&a<c)&&e++,d<r||d===r&&c<a)&&t++;A[f*x+i]=t,A[i*x+f]=e}}return this.Bh(p,y),A}countCrossings(){let i=0;for(let t=0;t<=this.Lt;t++){var s=this._T(t,1),n=this.yi[t];for(let e=0;e<n;e++)for(let t=e;t<n;t++)i+=s[e*n+t]}return i}i3(a,o,h){var l=this.Vh(a),e=this.yi[a];let u=0;for(let t=0;t<e;t++){let e=null,i=(o<=0&&(e=l[t].Mo),null);0<=o&&(i=l[t].hr);let s,n=0,r=0;if(null!==e)for(let t=0;t<e.length;t++)(s=e[t]).valid&&s.fromVertex.layer!==a&&(n=s.fromVertex.column+s.portFromColOffset,r=s.toVertex.column+s.portToColOffset,u+=h?Math.abs(n-r)*this.linkStraightenWeight(s):Math.abs(n-r));if(null!==i)for(let t=0;t<i.length;t++)(s=i[t]).valid&&s.toVertex.layer!==a&&(n=s.fromVertex.column+s.portFromColOffset,r=s.toVertex.column+s.portToColOffset,u+=h?(Math.abs(n-r)+1)*this.linkStraightenWeight(s):Math.abs(n-r))}return this.Bh(a,l),u}nk(e){let i=0;for(let t=0;t<=this.Lt;t++)i+=this.i3(t,1,e);return i}jy(){let t=1/0;this.Wt=-1;for(var e=this.network.vertexes.iterator;e.next();){var i=e.value;t=Math.min(t,i.column-this.nodeMinColumnSpace(i,!0)),this.Wt=Math.max(this.Wt,i.column+this.nodeMinColumnSpace(i,!1))}for(e.reset();e.next();)e.value.column-=t;this.Wt-=t}Jy(a,o){Yt,Xt.r(a,Ci,"barycenters:unfixedLayer"),Xt.r(o,Ci,"barycenters:direction");var h=this.Vh(a),e=this.yi[a],l=[];for(let t=0;t<e;t++){var u=h[t];let e=null,i=(o<=0&&(e=u.Mo),null),s=(0<=o&&(i=u.hr),0),n=0;var d=u.near;null!==d&&d.layer===u.layer&&(s+=d.column-1,n++);let r;if(null!==e)for(let t=0;t<e.length;t++){var c=(r=e[t]).fromVertex;r.valid&&!r.rev&&c.layer!==a&&(s+=c.column,n++)}if(null!==i)for(let t=0;t<i.length;t++){var g=(r=i[t]).toVertex;r.valid&&!r.rev&&g.layer!==a&&(s+=g.column,n++)}0===n?l[t]=-1:l[t]=s/n}return this.Bh(a,h),l}tD(r,a){Yt,Xt.r(r,Ci,"medians:unfixedLayer"),Xt.r(a,Ci,"medians:direction");var o=this.Vh(r),e=this.yi[r],h=[];for(let t=0;t<e;t++){var l=o[t];let e=null,i=(a<=0&&(e=l.Mo),null),s=(0<=a&&(i=l.hr),0);var u=[],d=l.near;null!==d&&d.layer===l.layer&&(u[s]=d.column-1,s++);let n;if(null!==e)for(let t=0;t<e.length;t++){var c=(n=e[t]).fromVertex;n.valid&&!n.rev&&c.layer!==r&&(u[s]=c.column+n.portFromColOffset,s++)}if(null!==i)for(let t=0;t<i.length;t++){var g=(n=i[t]).toVertex;n.valid&&!n.rev&&g.layer!==r&&(u[s]=g.column+n.portToColOffset,s++)}0===s?h[t]=-1:(u.sort((t,e)=>t-e),l=s>>1,1&s?h[t]=u[l]:h[t]=u[l-1]+u[l]>>1)}return this.Bh(r,o),h}Zy(i,s,n,r,a){if(i.component===n){i.component=s;let t=0,e=0;if(r)for(var o=i.destinationEdges;o.next();){var h=o.value,l=h.toVertex;t=i.layer-l.layer,e=this.linkMinLength(h),t===e&&this.Zy(l,s,n,r,a)}if(a)for(var u=i.sourceEdges;u.next();){var d=u.value,c=d.fromVertex;t=c.layer-i.layer,e=this.linkMinLength(d),t===e&&this.Zy(c,s,n,r,a)}}}KN(t,e,i,s,n){if(t.component===i){if(t.component=e,s)for(var r=t.destinationEdges;r.next();){var a=r.value.toVertex;this.KN(a,e,i,s,n)}if(n)for(var o=t.sourceEdges;o.next();){var h=o.value.fromVertex;this.KN(h,e,i,s,n)}}}removeCycles(){for(var t=this.network.edges.iterator;t.next();)t.value.rev=!1;switch(this.Jc){default:case 1:this.e3();break;case 0:this.s3();break;case 2:this.o3()}}o3(){var t=this.network,i=t.vertexes.iterator;let s=1/0;for(;i.next();){var e=i.value;s=Math.min(s,e.layer)}if(s<1/0){if(s<0)for(i.reset();i.next();)i.value.layer-=s;var n=[];for(i.reset();i.next();){var r=i.value,a=n[r.layer];void 0===a?n[r.layer]=[r]:a.push(r)}let e=0;for(let t=0;t<n.length;t++){var o=n[t];if(o&&0!==o.length){if(0<t)for(let t=0;t<o.length;t++)o[t].layer-=e}else e++}for(var h=t.edges.iterator;h.next();){var l=h.value,u=l.fromVertex,d=l.toVertex;u.layer<d.layer&&(t.reverseEdge(l),l.rev=!0)}}}e3(){var e=this.network;let i=0,s=e.vertexes.count-1;for(var n=[],t=(n.length=s+1,e.vertexes.iterator);t.next();)t.value.ee=!0;for(;null!==this.r3(e);){let t;for(t=this.iD(e);null!==t;)n[s]=t,s--,t.ee=!1,t=this.iD(e);for(t=this.eD(e);null!==t;)n[i]=t,i++,t.ee=!1,t=this.eD(e);null!==(t=this.l3(e))&&(n[i]=t,i++,t.ee=!1)}for(let t=0;t<e.vertexes.count;t++)n[t].index=t;for(var r=e.edges.iterator;r.next();){var a=r.value,o=a.fromVertex,h=a.toVertex;o.index>h.index&&(e.reverseEdge(a),a.rev=!0)}}r3(t){for(var e=t.vertexes.iterator;e.next();){var i=e.value;if(i.ee)return i}return null}iD(t){for(var e=t.vertexes.iterator;e.next();){var i=e.value;if(i.ee){let t=!0;for(var s=i.destinationEdges;s.next();)if(s.value.toVertex.ee){t=!1;break}if(t)return i}}return null}eD(t){for(var e=t.vertexes.iterator;e.next();){var i=e.value;if(i.ee){let t=!0;for(var s=i.sourceEdges;s.next();)if(s.value.fromVertex.ee){t=!1;break}if(t)return i}}return null}l3(t){let i=null,s=0;for(var e=this.network.vertexes.iterator;e.next();){var n=e.value;if(n.ee){let t=0;for(var r=n.destinationEdges;r.next();)r.value.toVertex.ee&&t++;let e=0;for(var a=n.sourceEdges;a.next();)a.value.fromVertex.ee&&e++;(null===i||s<t-e)&&(i=n,s=t-e)}}return i}s3(){for(var t=this.network.vertexes.iterator;t.next();){var e=t.value;e.iu=-1,e.Qn=-1}for(var i=this.network.edges.iterator;i.next();)i.value.forest=!1;for(this.Vg=0,t.reset();t.next();){var s=t.value;0===s.sourceEdges.count&&this.UN(s)}for(t.reset();t.next();){var n=t.value;-1===n.iu&&this.UN(n)}for(i.reset();i.next();){var r,a,o,h,l=i.value;l.forest||(r=(a=l.fromVertex).iu,a=a.Qn,o=(h=l.toVertex).iu,h=h.Qn,o<r&&a<h&&(this.network.reverseEdge(l),l.rev=!0))}}UN(t){t.iu=this.Vg,this.Vg++;for(var e=t.destinationEdges;e.next();){var i=e.value,s=i.toVertex;-1===s.iu&&(i.forest=!0,this.UN(s))}t.Qn=this.Vg,this.Vg++}$O(){for(var t=this.network.vertexes.iterator;t.next();)t.value.layer=-1;for(this.Lt=-1,this.assignLayers(),t.reset();t.next();){var e=t.value;this.Lt=Math.max(this.Lt,e.layer)}}assignLayers(){switch(this.Zc){case 11:this.sD();break;case 12:this.h3();break;default:this.a3()}}sD(){for(var t=this.network.vertexes.iterator;t.next();){var e=t.value,e=this.nD(e);this.Lt=Math.max(e,this.Lt)}}nD(t){let e=0;if(-1===t.layer){for(var i=t.destinationEdges;i.next();){var s=i.value,n=s.toVertex,s=this.linkMinLength(s);e=Math.max(e,this.nD(n)+s)}t.layer=e}else e=t.layer;return e}h3(){for(var t=this.network.vertexes.iterator;t.next();){var e=t.value,e=this.oD(e);this.Lt=Math.max(e,this.Lt)}for(t.reset();t.next();){var i=t.value;i.layer=this.Lt-i.layer}}oD(t){let e=0;if(-1===t.layer){for(var i=t.sourceEdges;i.next();){var s=i.value,n=s.fromVertex,s=this.linkMinLength(s);e=Math.max(e,this.oD(n)+s)}t.layer=e}else e=t.layer;return e}a3(){this.sD();for(var t=this.network.vertexes.iterator;t.next();)t.value.ee=!1;for(t.reset();t.next();){var e=t.value;0===e.sourceEdges.count&&this.rD(e)}let i=1/0;for(t.reset();t.next();){var s=t.value;i=Math.min(i,s.layer)}for(this.Lt=-1,t.reset();t.next();){var n=t.value;n.layer-=i,this.Lt=Math.max(this.Lt,n.layer)}}rD(t){if(!t.ee){t.ee=!0;for(var e=t.destinationEdges;e.next();){var i=e.value.toVertex;this.rD(i)}this.f3(t),this.c3(t)}}f3(e){for(var i=this.network.vertexes.iterator;i.next();)i.value.component=-1;var s=e.Mo;let a=s.length;for(let t=0;t<a;t++){var n=s[t],r=n.fromVertex,o=n.toVertex,n=this.linkMinLength(n);r.layer-o.layer>n&&this.Zy(r,0,-1,!0,!1)}for(this.Zy(e,1,-1,!0,!0);0!==e.component;){let s=0,n=1/0,t=0,r=null;for(var h=this.network.vertexes.iterator;h.next();){var l=h.value;if(1===l.component){let e=0,i=!1;var u=l.Mo;a=u.length;for(let t=0;t<a;t++){var d=u[t],c=d.fromVertex;e+=this.linkLengthWeight(d),1!==c.component&&(s+=this.linkLengthWeight(d),c=c.layer-l.layer,d=this.linkMinLength(d),n=Math.min(n,c-d))}var g=l.hr;a=g.length;for(let t=0;t<a;t++){var m=g[t],f=m.toVertex;e-=this.linkLengthWeight(m),1!==f.component?s-=this.linkLengthWeight(m):i=!0}(null===r||e<t)&&!i&&(r=l,t=e)}}if(0<s){for(i.reset();i.next();){var p=i.value;1===p.component&&(p.layer+=n)}e.component=0}else r.component=0}}c3(e){for(var i=this.network.vertexes.iterator;i.next();)i.value.component=-1;for(this.Zy(e,1,-1,!0,!1);0!==e.component;){let n=0,r=1/0,t=0,a=null;for(var s=this.network.vertexes.iterator;s.next();){var o=s.value;if(1===o.component){let e=0,i=!1;var h=o.Mo;let s=h.length;for(let t=0;t<s;t++){var l=h[t],u=l.fromVertex;e+=this.linkLengthWeight(l),1!==u.component?n+=this.linkLengthWeight(l):i=!0}var d=o.hr;s=d.length;for(let t=0;t<s;t++){var c=d[t],g=c.toVertex;e-=this.linkLengthWeight(c),1!==g.component&&(n-=this.linkLengthWeight(c),g=o.layer-g.layer,c=this.linkMinLength(c),r=Math.min(r,g-c))}(null===a||e>t)&&!i&&(a=o,t=e)}}if(n<0){for(i.reset();i.next();){var m=i.value;1===m.component&&(m.layer-=r)}e.component=0}else a.component=0}}QO(){for(var d=this.network,e=[],t=d.edges.iterator;t.next();){var i=t.value;i.valid=!1,e.push(i)}for(let t=0;t<e.length;t++){var c=e[t];let u=c.fromVertex;var g=c.toVertex;if(!(c.valid||(null===u.node&&null===u.data||null===g.node&&null===g.data)&&u.layer===g.layer)){let n=0,r=0,a=0,o=0;if(null!==c.link){var m=c.link;if(null===m)continue;var f=u.node,p=g.node;if(null===f||null===p)continue;let t=m.fromNode,e=m.toNode,i=m.fromPort;for(;null!==i&&!i.isVisibleObject();)i=i.panel;let s=m.toPort;for(;null!==s&&!s.isVisibleObject();)s=s.panel;c.rev&&(m=t,v=i,t=e,i=s,e=m,s=v);var m=u.focus,v=g.focus,y=(c.rev?g:u).bounds,x=U.a(),f=(f!==t?y.isReal()&&t.isVisible()?t.actualBounds.isReal()?(t.getRelativePoint(i,J.Center,x),x.x+=t.actualBounds.x-y.x,x.y+=t.actualBounds.y-y.y):(t.getRelativePoint(i,J.Center,x),x.isReal()||x.c(m)):x.c(m):y.isReal()&&(t.getRelativePoint(i,J.Center,x),x.isReal())||x.c(m),(c.rev?u:g).bounds),y=U.a();p!==e?f.isReal()&&e.isVisible()?e.actualBounds.isReal()?(e.getRelativePoint(s,J.Center,y),y.x+=e.actualBounds.x-f.x,y.y+=e.actualBounds.y-f.y):(e.getRelativePoint(s,J.Center,y),y.isReal()||y.c(v)):y.c(v):f.isReal()&&(e.getRelativePoint(s,J.Center,y),y.isReal())||y.c(v),o=90===this.C||270===this.C?(n=Math.round((x.x-m.x)/this.te),a=x.x,r=Math.round((y.x-v.x)/this.te),y.x):(n=Math.round((x.y-m.y)/this.te),a=x.y,r=Math.round((y.y-v.y)/this.te),y.y),U.o(x),U.o(y),c.portFromColOffset=n,c.portFromPos=a,c.portToColOffset=r,c.portToPos=o}else c.portFromColOffset=0,c.portFromPos=0,c.portToColOffset=0,c.portToPos=0;let t=u.layer;var A=g.layer,p=this.u3(c),f=1===p||3===p,m=2===p||3===p;let e,i,s=null,h,l=(m&&(s=this.d3(u,g),h=1,(i=d.createVertex()).node=null,i.ok=1,i.layer=t,i.near=u,d.addVertex(i),(e=d.linkVertexes(u,i,c.link)).valid=!1,e.rev=c.rev,e.portFromColOffset=n,e.portToColOffset=0,e.portFromPos=a,e.portToPos=0,u=i),1);if(f&&l--,t-A>l&&0<t){for(c.valid=!1,(i=d.createVertex()).node=null,i.ok=2,i.layer=t-1,s&&h<s.length&&i.layer===s[h].layer&&(i.near=s[h++]),d.addVertex(i),(e=d.linkVertexes(u,i,c.link)).valid=!0,e.rev=c.rev,e.portFromColOffset=m?0:n,e.portToColOffset=0,e.portFromPos=m?0:a,e.portToPos=0,u=i,t--;t-A>l&&0<t;)(i=d.createVertex()).node=null,i.ok=3,i.layer=t-1,s&&h<s.length&&i.layer===s[h].layer&&(i.near=s[h++]),d.addVertex(i),(e=d.linkVertexes(u,i,c.link)).valid=!0,e.rev=c.rev,e.portFromColOffset=0,e.portToColOffset=0,e.portFromPos=0,e.portToPos=0,u=i,t--;(e=d.linkVertexes(i,g,c.link)).valid=!f,f&&(i.near=g),e.rev=c.rev,e.portFromColOffset=0,e.portToColOffset=r,e.portFromPos=0,e.portToPos=o}else c.valid=!0}}}u3(t){let e=0;var i=t.link;if(null!==i){var s=i.fromPort,n=i.toPort;if(null!==s&&null!==n){var r=i.fromNode,a=i.toNode;if(null!==r&&null!==a){var o=this.rk(!0),h=this.rk(!1),l=this.setsPortSpots?o:i.computeSpot(!0,s),u=this.setsPortSpots?h:i.computeSpot(!1,n),d=i.isOrthogonal;if(l.isSide()&&l.includesSide(h)&&u.isSide()&&u.includesSide(o))return 0;h=i.getLinkPoint(r,s,l,!0,d,a,n,U.a()),o=i.getLinkDirection(r,s,h,l,!0,d,a,n),h=(U.o(h),(!l.isNone()&&o===this.lD(t,!0)||this.setsPortSpots&&null!==r&&1===r.ports.count&&t.rev)&&(e+=1),i.getLinkPoint(a,n,u,!1,d,r,s,U.a())),l=i.getLinkDirection(a,n,h,u,!1,d,r,s);U.o(h),(!u.isNone()&&l===this.lD(t,!1)||this.setsPortSpots&&null!==a&&1===a.ports.count&&t.rev)&&(e+=2)}}}return e}lD(t,e){return 90===this.C?e&&!t.rev||!e&&t.rev?270:90:180===this.C?e&&!t.rev||!e&&t.rev?0:180:270===this.C?e&&!t.rev||!e&&t.rev?90:270:e&&!t.rev||!e&&t.rev?180:0}d3(t,e){var i=[];return i.push(e),this.hD(t,i)?i.reverse():[]}hD(t,e){for(var i=e[e.length-1].sourceEdges.iterator;i.next();){var s=i.value;if(!s.rev&&s.valid){s=s.fromVertex;if(e.push(s),s===t||this.hD(t,e))return!0;e.pop()}}return!1}_O(){var e=this.yi=[];for(let t=0;t<=this.Lt;t++)e[t]=0;for(var t=this.network.vertexes.iterator;t.next();)t.value.index=-1;this.initializeIndices(),this.Wy=-1,this.Eg=0;for(let t=this.Fs=0;t<=this.Lt;t++)e[t]>e[this.Fs]&&(this.Wy=e[t]-1,this.Fs=t),e[t]<e[this.Eg]&&(this.Eg=t);this.tu=[];for(let t=0;t<e.length;t++)this.tu[t]=[];for(t.reset();t.next();){var i=t.value,s=i.layer;this.tu[s][i.index]=i}}initializeIndices(){switch(this.$c){default:case 22:this.g3();break;case 20:this.m3();break;case 21:this.p3()}}g3(){let t=null;for(var e=this.network.vertexes.iterator;e.next();){var i,s=e.value;s.near&&(null===t&&(t=new Map),s.layer===s.near.layer)&&((i=t.get(s.near)||[]).push(s),t.set(s.near,i))}for(e.reset();e.next();){var n=e.value;if(!n.near){const r=n.layer;n.index=this.yi[r],this.yi[r]++,t&&(n=t.get(n),Array.isArray(n))&&n.forEach(t=>{t.index=this.yi[r],this.yi[r]++})}}}m3(){let e=null;for(var i=this.network.vertexes.iterator;i.next();){var t,s=i.value;s.near&&(null===e&&(e=new Map),s.layer===s.near.layer)&&((t=e.get(s.near)||[]).push(s),e.set(s.near,t))}for(let t=this.Lt;0<=t;t--)for(i.reset();i.next();){var n=i.value;n.layer===t&&-1===n.index&&this.aD(n,e)}}aD(t,i){if(!t.near){const h=t.layer;t.index=this.yi[h],this.yi[h]++,i&&(s=i.get(t),Array.isArray(s))&&s.forEach(t=>{t.index=this.yi[h],this.yi[h]++});var s,n=t.hr;let e=!0;for(;e;){e=!1;for(let t=0;t<n.length-1;t++){var r=n[t],a=n[t+1];r.portFromColOffset>a.portFromColOffset&&(e=!0,n[t]=a,n[t+1]=r)}}for(let t=0;t<n.length;t++){var o=n[t];o.valid&&-1===(o=o.toVertex).index&&this.aD(o,i)}}}p3(){let e=null;for(var i=this.network.vertexes.iterator;i.next();){var t,s=i.value;s.near&&(null===e&&(e=new Map),s.layer===s.near.layer)&&((t=e.get(s.near)||[]).push(s),e.set(s.near,t))}for(let t=0;t<=this.Lt;t++)for(i.reset();i.next();){var n=i.value;n.layer===t&&-1===n.index&&this.fD(n,e)}}fD(i,s){if(!i.near){const l=i.layer;i.index=this.yi[l],this.yi[l]++,s&&(n=s.get(i),Array.isArray(n))&&n.forEach(t=>{t.index=this.yi[l],this.yi[l]++});var n,r,a=i.Mo;let t=!0,e=0;for(;t;)for(t=!1,e=0;e<a.length-1;e++){var o=a[e],h=a[e+1];o.portToColOffset>h.portToColOffset&&(t=!0,a[e]=h,a[e+1]=o)}for(e=0;e<a.length;e++)(r=a[e]).valid&&-1===(r=r.fromVertex).index&&this.fD(r,s)}}t3(){this.Wt=-1;for(let t=0;t<=this.Lt;t++){var i=this.Vh(t);let e=0;var s=this.yi[t];for(let t=0;t<s;t++){var n=i[t];e+=this.nodeMinColumnSpace(n,!0),n.column=e,e=(e+=1)+this.nodeMinColumnSpace(n,!1)}this.Wt=Math.max(this.Wt,e-1),this.Bh(t,i)}}reduceCrossings(){let t=this.countCrossings(),e=this.ie(),i=0,s=0,n=0;for(i=0;i<this.ef;i++){for(s=0;s<=this.Lt;s++)this.lk(s,1),this.gs(s,1,!1,1);for((n=this.countCrossings())<t&&(t=n,e=this.ie()),s=this.Lt;0<=s;s--)this.lk(s,-1),this.gs(s,-1,!1,-1);(n=this.countCrossings())<t&&(t=n,e=this.ie())}for(this.ns(e),i=0;i<this.ef;i++){for(s=0;s<=this.Lt;s++)this.lk(s,0),this.gs(s,0,!1,0);for((n=this.countCrossings())<t&&(t=n,e=this.ie()),s=this.Lt;0<=s;s--)this.lk(s,0),this.gs(s,0,!1,0);(n=this.countCrossings())<t&&(t=n,e=this.ie())}this.ns(e);let r=!1,a=0,o=0,h=0,l=0;switch(this.Qc){case 30:break;case 32:for(h=t+1;(l=this.countCrossings())<h;)for(h=l,a=this.Lt;0<=a;a--)for(o=0;o<=a;o++){for(r=!0;r;)for(r=!1,s=a;s>=o;s--)r=this.gs(s,-1,!1,-1)||r;for((n=this.countCrossings())>=t?this.ns(e):(t=n,e=this.ie()),r=!0;r;)for(r=!1,s=a;s>=o;s--)r=this.gs(s,1,!1,1)||r;for((n=this.countCrossings())>=t?this.ns(e):(t=n,e=this.ie()),r=!0;r;)for(r=!1,s=o;s<=a;s++)r=this.gs(s,1,!1,1)||r;for(n>=t?this.ns(e):(t=n,e=this.ie()),r=!0;r;)for(r=!1,s=o;s<=a;s++)r=this.gs(s,-1,!1,-1)||r;for(n>=t?this.ns(e):(t=n,e=this.ie()),r=!0;r;)for(r=!1,s=a;s>=o;s--)r=this.gs(s,0,!1,0)||r;for(n>=t?this.ns(e):(t=n,e=this.ie()),r=!0;r;)for(r=!1,s=o;s<=a;s++)r=this.gs(s,0,!1,0)||r;n>=t?this.ns(e):(t=n,e=this.ie())}break;default:for(a=this.Lt,o=0,h=t+1;(l=this.countCrossings())<h;){for(h=l,r=!0;r;)for(r=!1,s=a;s>=o;s--)r=this.gs(s,-1,!1,-1)||r;for((n=this.countCrossings())>=t?this.ns(e):(t=n,e=this.ie()),r=!0;r;)for(r=!1,s=a;s>=o;s--)r=this.gs(s,1,!1,1)||r;for((n=this.countCrossings())>=t?this.ns(e):(t=n,e=this.ie()),r=!0;r;)for(r=!1,s=o;s<=a;s++)r=this.gs(s,1,!1,1)||r;for(n>=t?this.ns(e):(t=n,e=this.ie()),r=!0;r;)for(r=!1,s=o;s<=a;s++)r=this.gs(s,-1,!1,-1)||r;for(n>=t?this.ns(e):(t=n,e=this.ie()),r=!0;r;)for(r=!1,s=a;s>=o;s--)r=this.gs(s,0,!1,0)||r;for(n>=t?this.ns(e):(t=n,e=this.ie()),r=!0;r;)for(r=!1,s=o;s<=a;s++)r=this.gs(s,0,!1,0)||r;n>=t?this.ns(e):(t=n,e=this.ie())}}this.ns(e)}lk(t,e){Yt,Xt.r(t,Ci,"medianBarycenterCrossingReduction:unfixedLayer"),Xt.r(e,Ci,"medianBarycenterCrossingReduction:direction");let i=0,s=!1;var n,r=this.Vh(t),a=this.yi[t],o=this.tD(t,e),h=this.Jy(t,e);for(i=0;i<a;i++)-1===h[i]&&(h[i]=r[i].column),-1===o[i]&&(o[i]=r[i].column);let l=!0,u;for(;l;)for(l=!1,i=0;i<a-1;i++)(o[i+1]<o[i]||o[i+1]===o[i]&&h[i+1]<h[i])&&(s=!0,l=!0,n=o[i],o[i]=o[i+1],o[i+1]=n,n=h[i],h[i]=h[i+1],h[i+1]=n,u=r[i],r[i]=r[i+1],r[i+1]=u);let d=0;for(i=0;i<a;i++)(u=r[i]).index=i,d+=this.nodeMinColumnSpace(u,!0),u.column=d,d=(d+=1)+this.nodeMinColumnSpace(u,!1);return this.Bh(t,r),s}gs(f,t,p,v){var y=this.Vh(f),x=this.yi[f],A=this._T(f,t);let w=0,b;if(!p||0<v)for(b=[],w=0;w<x;w++)b[w]=-1;else b=this.Jy(f,-1);let P;if(!p||v<0)for(P=[],w=0;w<x;w++)P[w]=-1;else P=this.Jy(f,1);let S=!1,k=!0;for(;k;)for(k=!1,w=0;w<x-1;w++){var M=A[y[w].index*x+y[w+1].index],N=A[y[w+1].index*x+y[w].index];let t=0,e=0;var C=y[w].column,L=y[w+1].column,D=this.nodeMinColumnSpace(y[w],!0),T=this.nodeMinColumnSpace(y[w],!1),B=C-D+this.nodeMinColumnSpace(y[w+1],!0),G=L-T+this.nodeMinColumnSpace(y[w+1],!1);let i=0,s=0,n=0,r=0,a=0,o=0,h=0,l,u=0,d,c=0;var F=y[w].sourceEdges.iterator;if(p&&v<=0)for(;F.next();){var R=F.value;l=R.fromVertex,R.valid&&l.layer!==f&&(n=this.linkStraightenWeight(R),r=R.portFromColOffset,a=R.portToColOffset,o=l.column,i+=(Math.abs(C+a-(o+r))+1)*n,s+=(Math.abs(G+a-(o+r))+1)*n)}for(F.reset();F.next();){var O=F.value;if(l=O.fromVertex,O.valid&&l.layer===f){for(u=0;u<y.length&&y[u]!==l;)u++;u<w&&(t+=2*(w-u),e+=2*(w+1-u)),u===w+1&&(t+=1),u>w+1&&(t+=4*(u-w),e+=4*(u-(w+1)))}}var E=y[w].destinationEdges.iterator;if(p&&0<=v)for(;E.next();){var H=E.value;d=H.toVertex,H.valid&&d.layer!==f&&(n=this.linkStraightenWeight(H),r=H.portFromColOffset,a=H.portToColOffset,h=d.column,i+=(Math.abs(C+r-(h+a))+1)*n,s+=(Math.abs(G+r-(h+a))+1)*n)}for(E.reset();E.next();){var I=E.value;if(d=I.toVertex,I.valid&&d.layer===f){for(c=0;c<y.length&&y[c]!==d;)c++;c===w+1&&(e+=1)}}var K=y[w+1].sourceEdges.iterator;if(p&&v<=0)for(;K.next();){var V=K.value;l=V.fromVertex,V.valid&&l.layer!==f&&(n=this.linkStraightenWeight(V),r=V.portFromColOffset,a=V.portToColOffset,o=l.column,i+=(Math.abs(L+a-(o+r))+1)*n,s+=(Math.abs(B+a-(o+r))+1)*n)}for(K.reset();K.next();){var z=K.value;if(l=z.fromVertex,z.valid&&l.layer===f){for(u=0;u<y.length&&y[u]!==l;)u++;u<w&&(t+=2*(w+1-u),e+=2*(w-u)),u===w&&(e+=1),u>w+1&&(t+=4*(u-(w+1)),e+=4*(u-w))}}var Y=y[w+1].destinationEdges.iterator;if(p&&0<=v)for(;Y.next();){var X=Y.value;d=X.toVertex,X.valid&&d.layer!==f&&(n=this.linkStraightenWeight(X),r=X.portFromColOffset,a=X.portToColOffset,h=d.column,i+=(Math.abs(L+r-(h+a))+1)*n,s+=(Math.abs(B+r-(h+a))+1)*n)}for(Y.reset();Y.next();){var q=Y.value;if(d=q.toVertex,q.valid&&d.layer===f){for(c=0;c<y.length&&y[c]!==d;)c++;c===w&&(t+=1)}}let g=0,m=0;var D=b[y[w].index],T=P[y[w].index],j=b[y[w+1].index],Q=P[y[w+1].index];-1!==D&&(g+=Math.abs(D-C),m+=Math.abs(D-G)),-1!==T&&(g+=Math.abs(T-C),m+=Math.abs(T-G)),-1!==j&&(g+=Math.abs(j-L),m+=Math.abs(j-B)),-1!==Q&&(g+=Math.abs(Q-L),m+=Math.abs(Q-B)),(e<t-.5||e===t&&N<M-.5||e===t&&N===M&&s<i-.5||e===t&&N===M&&s===i&&m<g-.5)&&(S=!0,k=!0,y[w].column=G,y[w+1].column=B,D=y[w],y[w]=y[w+1],y[w+1]=D)}for(w=0;w<x;w++)y[w].index=w;return this.Bh(f,y),S}straightenAndPack(){if(0!==this.Yn)this.y3();else{let i=0,e=!1,t=0!=(1&this.cr);var s=0!=(8&this.cr);if(t=1e3<this.network.edges.count&&s?!1:t){var n=[];let t=0;for(t=0;t<=this.Lt;t++)n[t]=0;let e=0;for(var r=this.network.vertexes.iterator;r.next();){var a=r.value,a=(i=a.layer,e=a.column,this.nodeMinColumnSpace(a,!1));n[i]=Math.max(n[i],e+a)}for(r.reset();r.next();){var o=r.value;i=o.layer,e=o.column,o.column=(8*(this.Wt-n[i])>>1)+8*e}this.Wt*=8}if(2&this.cr){e=!0;let t=0;for(;e&&t<this._c;){for(e=!1,i=this.Fs+1;i<=this.Lt;i++)e=this.zg(i,1)||e;for(i=this.Fs-1;0<=i;i--)e=this.zg(i,-1)||e;e=this.zg(this.Fs,0)||e,t++}}if(4&this.cr){for(i=this.Fs+1;i<=this.Lt;i++)this.GN(i,1);for(i=this.Fs-1;0<=i;i--)this.GN(i,-1);this.GN(this.Fs,0)}if(t&&(this.cD(-1),this.cD(1)),2&this.cr){e=!0;let t=0;for(;e&&t<this._c;){for(e=!1,e=this.zg(this.Fs,0)||e,i=this.Fs+1;i<=this.Lt;i++)e=this.zg(i,0)||e;for(i=this.Fs-1;0<=i;i--)e=this.zg(i,0)||e;t++}}}}zg(t,e){Yt,Xt.r(t,Ci,"bendStraighten:unfixedLayer"),Xt.r(e,Ci,"bendStraighten:direction");let i=!1;for(;this.w3(t,e);)i=!0;return i}w3(d,c){Yt,Xt.r(d,Ci,"shiftbendStraighten:unfixedLayer"),Xt.r(c,Ci,"shiftbendStraighten:direction");let g=0;var m=this.Vh(d),f=this.yi[d],p=this.Jy(d,-1);if(0<c)for(g=0;g<f;g++)p[g]=-1;var v=this.Jy(d,1);if(c<0)for(g=0;g<f;g++)v[g]=-1;let y=!1,x=!0;for(;x;)for(x=!1,g=0;g<f;g++){var A=m[g].column,w=this.nodeMinColumnSpace(m[g],!0),b=this.nodeMinColumnSpace(m[g],!1);let t=0,e=(t=g-1<0||A-m[g-1].column-1>w+this.nodeMinColumnSpace(m[g-1],!1)?A-1:A,0),i=(e=g+1>=f||m[g+1].column-A-1>b+this.nodeMinColumnSpace(m[g+1],!0)?A+1:A,0),s=0,n=0,r=0,a=0,o=0;if(c<=0)for(var P=m[g].sourceEdges.iterator;P.next();){var S=P.value,k=S.fromVertex;S.valid&&k.layer!==d&&(r=this.linkStraightenWeight(S),a=S.portFromColOffset,o=S.portToColOffset,S=k.column,i+=(Math.abs(A+o-(S+a))+1)*r,s+=(Math.abs(t+o-(S+a))+1)*r,n+=(Math.abs(e+o-(S+a))+1)*r)}if(0<=c)for(var M=m[g].destinationEdges.iterator;M.next();){var N=M.value,C=N.toVertex;N.valid&&C.layer!==d&&(r=this.linkStraightenWeight(N),a=N.portFromColOffset,o=N.portToColOffset,N=C.column,i+=(Math.abs(A+a-(N+o))+1)*r,s+=(Math.abs(t+a-(N+o))+1)*r,n+=(Math.abs(e+a-(N+o))+1)*r)}let h=0,l=0,u=0;w=p[m[g].index],b=v[m[g].index];-1!==w&&(h+=Math.abs(w-A),l+=Math.abs(w-t),u+=Math.abs(w-e)),-1!==b&&(h+=Math.abs(b-A),l+=Math.abs(b-t),u+=Math.abs(b-e)),s<i||s===i&&l<h?(y=!0,x=!0,m[g].column=t):(n<i||n===i&&u<h)&&(y=!0,x=!0,m[g].column=e)}return this.Bh(d,m),this.jy(),y}GN(t,e){Yt,Xt.r(t,Ci,"medianStraighten:unfixedLayer"),Xt.r(e,Ci,"medianStraighten:direction");let r=0;var a=this.Vh(t),o=this.yi[t],i=this.tD(t,e),h=[];for(r=0;r<o;r++)h[r]=i[r];let l=!1,u=!0;for(;u;)for(u=!1,r=0;r<o;r++){var d=a[r].column,c=this.nodeMinColumnSpace(a[r],!0),g=this.nodeMinColumnSpace(a[r],!1);let t=0,e=0,i=0,s=0,n=0;-1===h[r]?t=0===r&&r===o-1?d:0===r?(e=a[r+1].column)-d===g+this.nodeMinColumnSpace(a[r+1],!0)?d-1:d:r===o-1?d-(i=a[r-1].column)===c+this.nodeMinColumnSpace(a[r-1],!1)?d+1:d:(i=a[r-1].column,n=i+this.nodeMinColumnSpace(a[r-1],!1)+c+1,e=a[r+1].column,s=e-this.nodeMinColumnSpace(a[r+1],!0)-g-1,(n+s)/2|0):0===r&&r===o-1?t=h[r]:0===r?(e=a[r+1].column,s=e-this.nodeMinColumnSpace(a[r+1],!0)-g-1,t=Math.min(h[r],s)):r===o-1?(i=a[r-1].column,n=i+this.nodeMinColumnSpace(a[r-1],!1)+c+1,t=Math.max(h[r],n)):(i=a[r-1].column,n=i+this.nodeMinColumnSpace(a[r-1],!1)+c+1,e=a[r+1].column,s=e-this.nodeMinColumnSpace(a[r+1],!0)-g-1,n<h[r]&&h[r]<s?t=h[r]:n>=h[r]?t=n:s<=h[r]&&(t=s)),t!==d&&(l=!0,u=!0,a[r].column=t)}return this.Bh(t,a),this.jy(),l}x3(){for(let t=0;t<=this.Wt;t++)for(;this.b3(t,1););this.jy()}b3(t,e){Yt,Xt.r(t,Ci,"packAux:column"),Xt.r(e,Ci,"packAux:direction");let i=!0;for(var s=this.network.vertexes.iterator;s.next();){var n=s.value,r=this.nodeMinColumnSpace(n,!0),a=this.nodeMinColumnSpace(n,!1);if(n.column-r<=t&&n.column+a>=t){i=!1;break}}let o=!1;if(i){if(0<e)for(s.reset();s.next();){var h=s.value;h.column>t&&(--h.column,o=!0)}if(e<0)for(s.reset();s.next();){var l=s.value;l.column<t&&(l.column+=1,o=!0)}}return o}k3(){this.x3();for(let t=0;t<this.Wt;t++)for(;this.S3(t,1););this.jy()}S3(t,e){Yt,Xt.r(t,Ci,"tightPackAux:column"),Xt.r(e,Ci,"tightPackAux:direction");let i=e<0?t-1:0<e?t+1:t,s=0;var n=[],r=[];for(s=0;s<=this.Lt;s++)n[s]=!1,r[s]=!1;for(var a=this.network.vertexes.iterator;a.next();){var o=a.value,h=o.column-this.nodeMinColumnSpace(o,!0),l=o.column+this.nodeMinColumnSpace(o,!1);h<=t&&t<=l&&(n[o.layer]=!0),h<=i&&l>=i&&(r[o.layer]=!0)}let u=!0,d=!1;for(s=0;s<=this.Lt;s++)u=u&&!(n[s]&&r[s]);if(u){if(0<e)for(a.reset();a.next();){var c=a.value;c.column>t&&(--c.column,d=!0)}if(e<0)for(a.reset();a.next();){var g=a.value;g.column<t&&(g.column+=1,d=!0)}}return d}cD(t){Yt,Xt.r(t,Ci,"componentPack:direction"),this.k3();let e=0,i,s=0,n=0,r=0;if(0<t)for(e=0;e<=this.Wt;e++)for(i=this.ie(),s=this.nk(!0),n=s+1;s<n;)n=s,this.uD(e,1),(r=this.nk(!0))>s?this.ns(i):r<s&&(s=r,i=this.ie());if(t<0)for(e=this.Wt;0<=e;e--)for(i=this.ie(),s=this.nk(!0),n=s+1;s<n;)n=s,this.uD(e,-1),(r=this.nk(!0))>s?this.ns(i):r<s&&(s=r,i=this.ie());this.jy()}uD(t,i){this.rn=0;for(var e=this.network.vertexes.iterator;e.next();)e.value.component=-1;if(0<i)for(e.reset();e.next();){var s=e.value;s.column-this.nodeMinColumnSpace(s,!0)<=t&&(s.component=this.rn)}if(i<0)for(e.reset();e.next();){var n=e.value;n.column+this.nodeMinColumnSpace(n,!1)>=t&&(n.component=this.rn)}for(this.rn++,e.reset();e.next();){var r=e.value;-1===r.component&&(this.KN(r,this.rn,-1,!0,!0),this.rn++)}let a=0;var o=[];for(a=0;a<this.rn*this.rn;a++)o[a]=!1;var h=[];for(a=0;a<(this.Lt+1)*(this.Wt+1);a++)h[a]=-1;for(e.reset();e.next();){var l=e.value,u=l.layer,d=Math.max(0,l.column-this.nodeMinColumnSpace(l,!0)),c=Math.min(this.Wt,l.column+this.nodeMinColumnSpace(l,!1));for(let t=d;t<=c;t++)h[u*(this.Wt+1)+t]=l.component}for(let e=0;e<=this.Lt;e++){if(0<i)for(let t=0;t<this.Wt;t++)-1!==h[e*(this.Wt+1)+t]&&-1!==h[e*(this.Wt+1)+t+1]&&h[e*(this.Wt+1)+t]!==h[e*(this.Wt+1)+t+1]&&(o[h[e*(this.Wt+1)+t]*this.rn+h[e*(this.Wt+1)+t+1]]=!0);if(i<0)for(let t=this.Wt;0<t;t--)-1!==h[e*(this.Wt+1)+t]&&-1!==h[e*(this.Wt+1)+t-1]&&h[e*(this.Wt+1)+t]!==h[e*(this.Wt+1)+t-1]&&(o[h[e*(this.Wt+1)+t]*this.rn+h[e*(this.Wt+1)+t-1]]=!0)}var g=[];for(a=0;a<this.rn;a++)g[a]=!0;var m,f=[];for(f.push(0);0!==f.length;)if(m=f[f.length-1],f.pop(),g[m])for(g[m]=!1,a=0;a<this.rn;a++)o[m*this.rn+a]&&f.splice(0,0,a);let p=!1;if(0<i)for(e.reset();e.next();){var v=e.value;g[v.component]&&(--v.column,p=!0)}if(i<0)for(e.reset();e.next();){var y=e.value;g[y.component]&&(y.column+=1,p=!0)}return p}y3(){var e=Xt.ct(),i=this.tu.length;for(let t=0;t<=i;t++)e[t]=[];for(var t=this.network.vertexes.iterator;t.next();){var s=t.value;e[i-s.layer][s.index]=s}var n=new C;this.M3(e,n);let r=null,a=null,o=null,h=null;const l=0!=(1&this.Yn),u=0!=(2&this.Yn),d=0!=(4&this.Yn),c=0!=(8&this.Yn);l&&(this.cl(e,n,!0),r=this.hk(e,!0,!1)),e.reverse(),d&&(this.cl(e,n,!1),o=this.hk(e,!1,!1));for(const g of e)g.reverse();c&&(this.cl(e,n,!1),h=this.hk(e,!1,!0)),e.reverse(),u&&(this.cl(e,n,!0),a=this.hk(e,!0,!0)),Xt.ot(e),this.P3(r,a,o,h),this.network.vertexes.each(t=>{var e=Xt.ct(),i=(l&&e.push(r.get(t)),u&&e.push(a.get(t)),d&&e.push(o.get(t)),c&&e.push(h.get(t)),e.sort((t,e)=>t-e),e.length),s=Math.floor((i-1)/2),i=Math.ceil((i-1)/2),s=(e[s]+e[i])/2;Xt.ot(e),t.pe=s})}M3(e,n){var i=e.length;for(let t=1;t<i-1;t++){let i=0,s=0;var r=e[t],a=e[t+1];for(let e=0;s<a.length;e++){var o=a[e],h=this.N3(o);if(e===a.length-1||h){let t=r.length-1;for(h&&(t=o.getProperSourceVertexes()[0].index);s<=e;){for(const u of a[s].getProperSourceEdges()){var l=u.fromVertex.index;(l<i||l>t)&&n.add(u)}s++}i=t}}}}N3(t){if(null===t.node){t=t.getProperSourceVertexes();if(0<t.length)return null===t[0].node}return!1}cl(t,s,n){this.C3(t);for(const e of t){let i=-1;for(const h of e){var r=n?h.getProperSourceVertexes():h.getProperDestinationVertexes(),a=r.length;if(0<a){r.sort((t,e)=>t.zh-e.zh);a=(a-1)/2;for(let e=Math.floor(a),t=Math.ceil(a);e<=t;e++)if(h.Kn===h){var o=r[e];let t;t=n?o.getDestinationEdge(h):h.getDestinationEdge(o),!s.contains(t)&&i<o.zh&&((o.Kn=h).nf=o.nf,h.Kn=o.nf,i=o.zh)}}}}}C3(t){for(let e=0;e<t.length;e++){var i=t[e];for(let t=0;t<i.length;t++){var s=i[t];((s.nf=s).Kn=s).dD=e,s.zh=t}}}hk(n,t,e){var r=90===this.C||270===this.C;for(const l of n)for(const u of l)u.os=u,u.eu=1/0,u.pe=NaN,u.Un=0;this.A3(n,t,e);for(const d of n)for(const c of d)c.nf===c&&this.gD(c,n);for(let s=0;s<n.length;s++)if(!(n[s].length<=0)){var a,o,h=n[s][0];if(h.os===h){h.os.eu===1/0&&(h.os.eu=0);let t=s,e=0,i;do{for(i=n[t][e];i.Kn!==i.nf;)i=i.Kn,t++,0<i.zh&&(a=this.mD(i,n),o=r?a.width:a.height,o=i.os.eu+i.pe+i.Un-(a.pe+a.Un+o+this.columnSpacing),a.os.eu=Math.min(a.os.eu,o))}while(e=i.zh+1,t<n.length&&e<n[t].length&&i.os===n[t][e].os)}}var i=new L;for(const g of n)for(const m of g){m.pe=m.pe+m.os.eu+m.Un;var s=r?m.width:m.height;i.add(m,e?-m.pe-s:m.pe)}return i}A3(t,a,o){var h=90===this.C||270===this.C;for(const e of t)for(const i of e)if(i.nf===i){let n=0,r=i;for(;r.Kn!==i;){var l=r.Kn,u=h?r.width:r.height,d=h?l.width:l.height;let t,e,i,s;s=(a?(i=r.getDestinationEdge(l),t=i.portFromPos,e=i.portToPos,null!==i.link&&(r.node&&r.node!==i.link.fromNode&&(t=h?r.focusX:r.focusY),l.node)&&l.node!==i.link.toNode&&(e=h?l.focusX:l.focusY)):(i=l.getDestinationEdge(r),t=i.portToPos,e=i.portFromPos,null!==i.link&&(r.node&&r.node!==i.link.toNode&&(t=h?r.focusX:r.focusY),l.node)&&l.node!==i.link.fromNode&&(e=h?l.focusX:l.focusY)),o?r.Un+(u-t)-(d-e):r.Un+t-e),l.Un=s,n=Math.min(n,s),r=r.Kn}for(r=i;r.Un=r.Un-n,(r=r.Kn)!==i;);}}gD(e,i){if(isNaN(e.pe)){e.pe=0;let t=e;do{var s,n,r;0<t.zh&&(r=(s=this.mD(t,i)).nf,this.gD(r,i),e.os===e&&(e.os=r.os),n=90===this.C||270===this.C?s.width:s.height,e.os===r.os)&&(r=r.pe+s.Un+n-t.Un+this.columnSpacing,e.pe=Math.max(e.pe,r)),t=t.Kn}while(t!==e);for(;t.Kn!==e;)(t=t.Kn).pe=e.pe,t.os=e.os}}mD(t,e){var i=t.dD,t=t.zh;return t<1&&Xt.n("Could not determine previous vertex in layer"),e[i][t-1]}P3(...e){let i=-1;var s,n=Xt.ct(),r=Xt.ct();let a=1/0;for(let t=0;t<4;t++)e[t]&&(s=this.L3(e[t],n,r,t))<a&&(i=t,a=s);for(let t=0;t<4;t++){const o=e[t];if(o){const h=0===t||2===t?n[i]-n[t]:r[i]-r[t];0!=h&&o.each(t=>{o.set(t.key,t.value+h)})}}Xt.ot(n),Xt.ot(r)}L3(t,e,i,s){if(!t||0===t.count)return e[s]=0,1/(i[s]=0);let n=1/0,r=-1/0;return t.each(t=>{var e=t.key,t=t.value,e=90===this.C||270===this.C?e.width:e.height;t<n&&(n=t),t+e>r&&(r=t+e)}),e[s]=n,(i[s]=r)-n}commitLayout(){this.qy(),this.commitNodes(),this.HN(),this.isRouting&&this.commitLinks()}qy(){if(this.setsPortSpots)for(var t=this.rk(!0),e=this.rk(!1),i=this.network.edges.iterator;i.next();){var s=i.value.link;null!==s&&(s.fromSpot=t,s.toSpot=e)}}rk(t){return 270===this.C?t?J.MiddleTop:J.MiddleBottom:90===this.C?t?J.MiddleBottom:J.MiddleTop:180===this.C?t?J.MiddleLeft:J.MiddleRight:t?J.MiddleRight:J.MiddleLeft}commitNodes(){this.on=[],this.Rs=[],this.Is=[],this.Gt=[];for(let t=0;t<=this.Lt;t++)this.on[t]=0,this.Rs[t]=0,this.Is[t]=0,this.Gt[t]=0;for(var i=this.network.vertexes.iterator;i.next();){var t=i.value,e=t.layer;this.on[e]=Math.max(this.on[e],this.nodeMinLayerSpace(t,!0)),this.Rs[e]=Math.max(this.Rs[e],this.nodeMinLayerSpace(t,!1))}let s=0;var n=this.Ds;for(let e=0;e<=this.Lt;e++){let t=n;this.on[e]+this.Rs[e]<=0&&(t=0),0<e&&(s+=t/2),90===this.C||0===this.C?(s+=this.Rs[e],this.Is[e]=s,s+=this.on[e]):(s+=this.on[e],this.Is[e]=s,s+=this.Rs[e]),e<this.Lt&&(s+=t/2),this.Gt[e]=s}var r=s,a=this.arrangementOrigin;for(let t=0;t<=this.Lt;t++)270===this.C?this.Is[t]=a.y+this.Is[t]:90===this.C?(this.Is[t]=a.y+r-this.Is[t],this.Gt[t]=r-this.Gt[t]):180===this.C?this.Is[t]=a.x+this.Is[t]:(this.Is[t]=a.x+r-this.Is[t],this.Gt[t]=r-this.Gt[t]);var o=0!==this.Yn,h=(i.reset(),270===this.C||90===this.C);let l=1/0,u=1/0,d=1/0,c=-1/0;for(;i.next();){var g=i.value,m=g.layer,f=0|g.column;let t=0,e=0;e=h?(t=a.x+this.te*f,this.Is[m]):(t=this.Is[m],a.y+this.te*f),g.centerX=t,g.centerY=e,o&&isFinite(g.pe)&&(h?g.node?g.x=a.x+g.pe:g.centerX=a.x+g.pe:g.node?g.y=a.y+g.pe:g.centerY=a.y+g.pe),l=Math.min(g.x,l),u=Math.min(g.y,u),c=h?(d=l,Math.max(c,g.bounds.right)):(d=u,Math.max(c,g.bounds.bottom))}this.YN=c-d;var p=a.x-l,v=a.y-u;for(this.ur=new U(o&&h?0:p,o&&!h?0:v),i.reset();i.next();){var y=i.value;y.x+=p,y.y+=v,y.commit()}}HN(){let e=0;var t=this.Ds;for(let t=0;t<=this.Lt;t++)e=(e+=this.on[t])+this.Rs[t];e+=this.Lt*t;var i=[],s=0!==this.Yn?this.YN:this.te*this.Wt;for(let t=this.maxLayer;0<=t;t--)270===this.C?0===t?i.push(new Z(0,0,s,Math.abs(this.Gt[0]))):i.push(new Z(0,this.Gt[t-1],s,Math.abs(this.Gt[t-1]-this.Gt[t]))):90===this.C?0===t?i.push(new Z(0,this.Gt[0],s,Math.abs(this.Gt[0]-e))):i.push(new Z(0,this.Gt[t],s,Math.abs(this.Gt[t-1]-this.Gt[t]))):180===this.C?0===t?i.push(new Z(0,0,Math.abs(this.Gt[0]),s)):i.push(new Z(this.Gt[t-1],0,Math.abs(this.Gt[t-1]-this.Gt[t]),s)):0===t?i.push(new Z(this.Gt[0],0,Math.abs(this.Gt[0]-e),s)):i.push(new Z(this.Gt[t],0,Math.abs(this.Gt[t-1]-this.Gt[t]),s));this.commitLayers(i,this.ur)}commitLayers(t,e){}commitLinks(){var t=this.network.edges.iterator;let x;for(;t.next();)null!==(x=t.value.link)&&(x.startRoute(),x.clearPoints(),x.commitRoute());for(t.reset();t.next();)null!==(x=t.value.link)&&x.updateRoute();for(t.reset();t.next();){var A=t.value;if(null!==(x=A.link)&&0!==x.pointsCount){x.startRoute();var e,w=x;let g=w.fromNode,m=w.toNode,f=w.fromPort,p=w.toPort;null!==g&&null!==(e=g.findVisibleNode())&&e!==g&&(g=e,f=e.port),null!==m&&null!==(e=m.findVisibleNode())&&e!==m&&(m=e,p=e.port);var b=x.computeSpot(!0,f),P=x.computeSpot(!1,p);let v=A.fromVertex,y=A.toVertex;if(A.valid){if(9===x.curve&&4===x.pointsCount)if(v.column===y.column&&0===this.alignOption){var n=x.getLinkPoint(g,f,b,!0,!1,m,p),r=x.getLinkPoint(m,p,P,!1,!1,g,f);n.isReal()||n.set(g.actualBounds.center),r.isReal()||r.set(m.actualBounds.center),x.clearPoints(),x.addPointAt(n.x,n.y),x.addPointAt((2*n.x+r.x)/3,(2*n.y+r.y)/3),x.addPointAt((n.x+2*r.x)/3,(n.y+2*r.y)/3),x.addPointAt(r.x,r.y)}else{let i=!1,s=!1;if(null!==f&&b===J.None&&(i=!0),null!==p&&P===J.None&&(s=!0),i||s){let t=null,e=(i&&((t=x.getLinkPointFromPoint(g,f,f.getDocumentPoint(J.Center),x.getPoint(3),!0)).isReal()||t.set(g.actualBounds.center),x.setPointAt(0,t.x,t.y)),null);s&&((e=x.getLinkPointFromPoint(m,p,p.getDocumentPoint(J.Center),x.getPoint(0),!1)).isReal()||e.set(m.actualBounds.center),x.setPointAt(3,e.x,e.y)),t&&(n=x.getPoint(2),x.setPointAt(1,(2*t.x+n.x)/3,(2*t.y+n.y)/3)),e&&(r=x.getPoint(1),x.setPointAt(2,(2*e.x+r.x)/3,(2*e.y+r.y)/3))}}x.commitRoute()}else if(v.layer===y.layer)x.commitRoute();else{let t=!1,i=!1;var S,k=this.Ds;let e=0,s=x.firstPickIndex+1;x.isOrthogonal?(i=!0,4<(e=x.pointsCount)&&x.points.removeRange(2,e-3)):9===x.curve?(t=!0,4<(e=x.pointsCount)&&x.points.removeRange(2,e-3),4===e&&(s=2)):(e=x.pointsCount,C=b===J.None,S=P===J.None,2<e&&C&&S?x.points.removeRange(1,e-2):3<e&&C&&!S?x.points.removeRange(1,e-3):3<e&&!C&&S?x.points.removeRange(2,e-2):4<e&&!C&&!S&&x.points.removeRange(2,e-3));let n,r,a=0,o=0,h=0,l=0,u=0,d=0,c=0;if(A.rev){let e=0;for(;null!==y&&v!==y;){n=null,r=null;for(var M=y.sourceEdges.iterator;M.next();){var N=M.value;if(N.link===A.link&&(n=N.fromVertex,r=N.toVertex,null===n.node))break}if(null===n)break;if(n!==v)if(a=x.getPoint(s-1).x,o=x.getPoint(s-1).y,h=n.centerX,l=n.centerY,i)180===this.C||0===this.C?s===x.firstPickIndex+1?(x.insertPointAt(s++,a,o),x.insertPointAt(s++,a,l)):(null!==r?r.centerY:o)!==l&&(u=this.Gt[n.layer-1]+this.ur.x,x.insertPointAt(s++,u,o),x.insertPointAt(s++,u,l)):s===x.firstPickIndex+1?(x.insertPointAt(s++,a,o),x.insertPointAt(s++,h,o)):(null!==r?r.centerX:a)!==h&&(u=this.Gt[n.layer-1]+this.ur.y,x.insertPointAt(s++,a,u),x.insertPointAt(s++,h,u));else if(s===x.firstPickIndex+1)if(d=Math.max(10,this.on[y.layer]),c=Math.max(10,this.Rs[y.layer]),t)180===this.C?h<=y.bounds.x?(e=y.bounds.x,x.insertPointAt(s++,e-d,l),x.insertPointAt(s++,e,l),x.insertPointAt(s++,e+c,l)):(x.insertPointAt(s++,h-d,l),x.insertPointAt(s++,h,l),x.insertPointAt(s++,h+c,l)):90===this.C?l>=y.bounds.bottom?(e=y.bounds.y+y.bounds.height,x.insertPointAt(s++,h,e+c),x.insertPointAt(s++,h,e),x.insertPointAt(s++,h,e-d)):(x.insertPointAt(s++,h,l+c),x.insertPointAt(s++,h,l),x.insertPointAt(s++,h,l-d)):270===this.C?l<=y.bounds.y?(e=y.bounds.y,x.insertPointAt(s++,h,e-d),x.insertPointAt(s++,h,e),x.insertPointAt(s++,h,e+c)):(x.insertPointAt(s++,h,l-d),x.insertPointAt(s++,h,l),x.insertPointAt(s++,h,l+c)):0===this.C&&(h>=y.bounds.right?(e=y.bounds.x+y.bounds.width,x.insertPointAt(s++,e+c,l),x.insertPointAt(s++,e,l),x.insertPointAt(s++,e-d,l)):(x.insertPointAt(s++,h+c,l),x.insertPointAt(s++,h,l),x.insertPointAt(s++,h-d,l)));else{x.insertPointAt(s++,a,o);let t=0;180===this.C||0===this.C?((180===this.C?h>=y.bounds.right:h<=y.bounds.x)&&(t=(0===this.C?-d:c)/2),x.insertPointAt(s++,a+t,l)):((270===this.C?l>=y.bounds.bottom:l<=y.bounds.y)&&(t=(90===this.C?-d:c)/2),x.insertPointAt(s++,h,o+t)),x.insertPointAt(s++,h,l)}else d=Math.max(10,this.on[n.layer]),c=Math.max(10,this.Rs[n.layer]),t?180===this.C?(x.insertPointAt(s++,h-d-k,l),x.insertPointAt(s++,Math.min(h-d+k/2,h),l),x.insertPointAt(s++,h,l),x.insertPointAt(s++,h,l),x.insertPointAt(s++,Math.max(h+c-k/2,h),l),x.insertPointAt(s++,h+c+k,l)):90===this.C?(x.insertPointAt(s++,h,l+c+k),x.insertPointAt(s++,h,Math.max(l+c-k/2,l)),x.insertPointAt(s++,h,l),x.insertPointAt(s++,h,l),x.insertPointAt(s++,h,Math.min(l-d+k/2,l)),x.insertPointAt(s++,h,l-d-k)):270===this.C?(x.insertPointAt(s++,h,l-d-k),x.insertPointAt(s++,h,Math.min(l-d+k/2,l)),x.insertPointAt(s++,h,l),x.insertPointAt(s++,h,l),x.insertPointAt(s++,h,Math.max(l+c-k/2,l)),x.insertPointAt(s++,h,l+c+k)):(x.insertPointAt(s++,h+c+k,l),x.insertPointAt(s++,Math.max(h+c-k/2,h),l),x.insertPointAt(s++,h,l),x.insertPointAt(s++,h,l),x.insertPointAt(s++,Math.min(h-d+k/2,h),l),x.insertPointAt(s++,h-d-k,l)):(180!==this.C&&90!==this.C&&this.C,x.insertPointAt(s++,h,l));y=n}if(null===p||b!==J.None||i)if(a=x.getPoint(s-1).x,o=x.getPoint(s-1).y,h=x.getPoint(s).x,l=x.getPoint(s).y,i){var C=this.Rs[v.layer];let t=0;180===this.C||0===this.C?((t=o)>=v.bounds.y&&t<=v.bounds.bottom&&(180===this.C?h>=v.bounds.x:h<=v.bounds.right)&&(e=v.centerX+(180===this.C?-C:C),t=t<v.bounds.y+v.bounds.height/2?v.bounds.y-this.te/2:v.bounds.bottom+this.te/2,x.insertPointAt(s++,e,o),x.insertPointAt(s++,e,t)),x.insertPointAt(s++,h,t)):((t=a)>=v.bounds.x&&t<=v.bounds.right&&(270===this.C?l>=v.bounds.y:l<=v.bounds.bottom)&&(e=v.centerY+(270===this.C?-C:C),t=t<v.bounds.x+v.bounds.width/2?v.bounds.x-this.te/2:v.bounds.right+this.te/2,x.insertPointAt(s++,a,e),x.insertPointAt(s++,t,e)),x.insertPointAt(s++,t,l)),x.insertPointAt(s++,h,l)}else if(t)d=Math.max(10,this.on[v.layer]),c=Math.max(10,this.Rs[v.layer]),180===this.C&&h>=v.bounds.x?(e=v.bounds.x+v.bounds.width,x.setPointAt(s-2,e,o),x.setPointAt(s-1,e+c,o)):90===this.C&&l<=v.bounds.bottom?(e=v.bounds.y,x.setPointAt(s-2,a,e),x.setPointAt(s-1,a,e-d)):270===this.C&&l>=v.bounds.y?(e=v.bounds.y+v.bounds.height,x.setPointAt(s-2,a,e),x.setPointAt(s-1,a,e+c)):0===this.C&&h<=v.bounds.right&&(e=v.bounds.x,x.setPointAt(s-2,e,o),x.setPointAt(s-1,e-d,o));else{d=Math.max(10,this.on[v.layer]),c=Math.max(10,this.Rs[v.layer]);let t=0;180===this.C||0===this.C?((180===this.C?h<=v.bounds.x:h>=v.bounds.right)&&(t=(0===this.C?c:-d)/2),x.insertPointAt(s++,h+t,o)):((270===this.C?l<=v.bounds.y:l>=v.bounds.bottom)&&(t=(90===this.C?c:-d)/2),x.insertPointAt(s++,a,l+t)),x.insertPointAt(s++,h,l)}}else{for(;null!==v&&v!==y;){n=null,r=null;for(var L=v.destinationEdges.iterator;L.next();){var D=L.value;if(D.link===A.link&&(n=D.toVertex,null!==(r=D.fromVertex).node&&(r=null),null===n.node))break}if(null===n)break;n!==y&&(a=x.getPoint(s-1).x,o=x.getPoint(s-1).y,h=n.centerX,l=n.centerY,i?180===this.C||0===this.C?(null!==r?r.centerY:o)!==l&&(u=this.Gt[n.layer]+this.ur.x,s===x.firstPickIndex+1&&(u=0===this.C?Math.max(u,a):Math.min(u,a)),x.insertPointAt(s++,u,o),x.insertPointAt(s++,u,l)):(null!==r?r.centerX:a)!==h&&(u=this.Gt[n.layer]+this.ur.y,s===x.firstPickIndex+1&&(u=90===this.C?Math.max(u,o):Math.min(u,o)),x.insertPointAt(s++,a,u),x.insertPointAt(s++,h,u)):(d=Math.max(10,this.on[n.layer]),c=Math.max(10,this.Rs[n.layer]),t?180===this.C?(x.insertPointAt(s++,h+c+k,l),x.insertPointAt(s++,Math.max(h+c-k/2,h),l),x.insertPointAt(s++,h,l),x.insertPointAt(s++,h,l),x.insertPointAt(s++,Math.min(h-d+k/2,h),l),x.insertPointAt(s++,h-d-k,l)):90===this.C?(x.insertPointAt(s++,h,l-d-k),x.insertPointAt(s++,h,Math.min(l-d+k/2,l)),x.insertPointAt(s++,h,l),x.insertPointAt(s++,h,l),x.insertPointAt(s++,h,Math.max(l+c-k/2,l)),x.insertPointAt(s++,h,l+c+k)):270===this.C?(x.insertPointAt(s++,h,l+c+k),x.insertPointAt(s++,h,Math.max(l+c-k/2,l)),x.insertPointAt(s++,h,l),x.insertPointAt(s++,h,l),x.insertPointAt(s++,h,Math.min(l-d+k/2,l)),x.insertPointAt(s++,h,l-d-k)):(x.insertPointAt(s++,h-d-k,l),x.insertPointAt(s++,Math.min(h-d+k/2,h),l),x.insertPointAt(s++,h,l),x.insertPointAt(s++,h,l),x.insertPointAt(s++,Math.max(h+c-k/2,h),l),x.insertPointAt(s++,h+c+k,l)):180===this.C?(x.insertPointAt(s++,h+c,l),x.insertPointAt(s++,h-d,l)):90===this.C?(x.insertPointAt(s++,h,l-d),x.insertPointAt(s++,h,l+c)):270===this.C?(x.insertPointAt(s++,h,l+c),x.insertPointAt(s++,h,l-d)):(x.insertPointAt(s++,h-d,l),x.insertPointAt(s++,h+c,l)))),v=n}i&&(a=x.getPoint(s-1).x,o=x.getPoint(s-1).y,h=x.getPoint(s).x,l=x.getPoint(s).y,180===this.C||0===this.C?o!==l&&(u=0===this.C?Math.min(Math.max((h+a)/2,this.Gt[y.layer]+this.ur.x),h):Math.max(Math.min((h+a)/2,this.Gt[y.layer]+this.ur.x),h),x.insertPointAt(s++,u,o),x.insertPointAt(s++,u,l)):a!==h&&(u=90===this.C?Math.min(Math.max((l+o)/2,this.Gt[y.layer]+this.ur.y),l):Math.max(Math.min((l+o)/2,this.Gt[y.layer]+this.ur.y),l),x.insertPointAt(s++,a,u),x.insertPointAt(s++,h,u)))}null!==w&&t&&4<=x.pointsCount&&(null!==f&&(S=b===J.None?x.getLinkPointFromPoint(g,f,f.getDocumentPoint(J.Center),x.getPoint(3),!0):x.getPoint(0),b===J.None&&(w=x.getPoint(2),b=x.getPoint(3),90===this.direction||270===this.direction?(x.setPointAt(1,(S.x+w.x)/2,w.y),x.setPointAt(2,b.x,(w.y+b.y)/2)):(x.setPointAt(1,w.x,(S.y+w.y)/2),x.setPointAt(2,(w.x+b.x)/2,b.y))),S.isReal()||S.set(g.actualBounds.center),x.setPointAt(0,S.x,S.y)),null!==p)&&(w=P===J.None?x.getLinkPointFromPoint(m,p,p.getDocumentPoint(J.Center),x.getPoint(x.pointsCount-4),!1):x.getPoint(x.pointsCount-1),P===J.None&&(b=x.getPoint(x.pointsCount-3),P=x.getPoint(x.pointsCount-4),90===this.direction||270===this.direction?(x.setPointAt(x.pointsCount-2,(w.x+b.x)/2,b.y),x.setPointAt(x.pointsCount-2,P.x,(b.y+P.y)/2)):(x.setPointAt(x.pointsCount-2,b.x,(w.y+b.y)/2),x.setPointAt(x.pointsCount-3,(b.x+P.x)/2,P.y))),w.isReal()||w.set(m.actualBounds.center),x.setPointAt(x.pointsCount-1,w.x,w.y)),x.commitRoute(),A.commit()}}}}ZO(){this.Wy=-1,this.Eg=0,this.Fs=0,this.sf=null,this.Bg=null,this.tu=null;for(let t=0;t<this.Xn.length;t++)this.Xn[t]=null}Vh(t){let e;var i=this.yi[t];if(i>=this.Xn.length){var s=[];for(let t=0;t<this.Xn.length;t++)s[t]=this.Xn[t];this.Xn=s}void 0===this.Xn[i]||null===this.Xn[i]?e=[]:(e=this.Xn[i],this.Xn[i]=null);var n=this.tu[t];for(let t=0;t<n.length;t++){var r=n[t];e[r.index]=r}return e}Bh(t,e){this.Xn[this.yi[t]]=e}get layerSpacing(){return this.Ds}set layerSpacing(t){this.Ds!==t&&(Xt.t(t,"number",Ci,"layerSpacing"),0<=t)&&(this.Ds=t,this.invalidateLayout())}get columnSpacing(){return this.te}set columnSpacing(t){this.te!==t&&(Xt.t(t,"number",Ci,"columnSpacing"),0<t)&&(this.te=t,this.invalidateLayout())}get direction(){return this.C}set direction(t){this.C!==t&&(Xt.t(t,"number",Ci,"direction"),0===t||90===t||180===t||270===t?(this.C=t,this.invalidateLayout()):Xt.n("LayeredDigraphLayout.direction must be 0, 90, 180, or 270"))}get cycleRemoveOption(){return this.Jc}set cycleRemoveOption(t){this.Jc!==t&&(Xt.it(t,Si,"LayeredDigraphCycleRemove"),1===t||0===t||2===t)&&(this.Jc=t,this.invalidateLayout())}get layeringOption(){return this.Zc}set layeringOption(t){this.Zc!==t&&(Xt.it(t,ki,"LayeredDigraphLayering"),10===t||11===t||12===t)&&(this.Zc=t,this.invalidateLayout())}get initializeOption(){return this.$c}set initializeOption(t){this.$c!==t&&(Xt.it(t,Mi,"LayeredDigraphInit"),20===t||21===t||22===t)&&(this.$c=t,this.invalidateLayout())}get iterations(){return this.ef}set iterations(t){this.ef!==t&&(Xt.r(t,Li,"iterations"),0<=t)&&(this.ef=t,this.invalidateLayout())}get aggressiveOption(){return this.Qc}set aggressiveOption(t){this.Qc!==t&&(Xt.it(t,Ni,"LayeredDigraphAggressive"),30===t||31===t||32===t)&&(this.Qc=t,this.invalidateLayout())}get packOption(){return this.cr}set packOption(t){this.cr!==t&&(Xt.t(t,"number",Ci,"packOption"),0<=t)&&t<8&&(this.cr=t,this.invalidateLayout())}get packIterations(){return this._c}set packIterations(t){this._c=t}get alignOption(){return this.Yn}set alignOption(t){this.Yn!==t&&(Xt.t(t,"number",Ci,"align"),0<=t)&&t<16&&(this.Yn=t,this.invalidateLayout())}get setsPortSpots(){return this.zn}set setsPortSpots(t){this.zn!==t&&(Xt.t(t,"boolean",Ci,"setsPortSpots"),this.zn=t,this.invalidateLayout())}get maxLayer(){return this.Lt}get maxIndex(){return this.Wy}get maxColumn(){return this.Wt}get minIndexLayer(){return this.Eg}get maxIndexLayer(){return this.Fs}static CycleDepthFirst=0;static CycleGreedy=1;static CycleFromLayers=2;static LayerOptimalLinkLength=10;static LayerLongestPathSink=11;static LayerLongestPathSource=12;static InitDepthFirstOut=20;static InitDepthFirstIn=21;static InitNaive=22;static AggressiveNone=30;static AggressiveLess=31;static AggressiveMore=32;static PackNone=0;static PackExpand=1;static PackStraighten=2;static PackMedian=4;static PackAll=15;static AlignNone=0;static AlignUpperLeft=1;static AlignUpperRight=2;static AlignLowerLeft=4;static AlignLowerRight=8;static AlignAll=15}class Li extends Ue{constructor(t){super(t)}createVertex(){return new Di(this)}createEdge(){return new Ti(this)}}class Di extends We{ir;vo;Vt;ak;fk;ee;iu;Qn;ok;ek;sk;nf;Kn;dD;zh;os;eu;pe;Un;$y=null;Qy=null;_y=null;tw=null;constructor(t){super(t),this.ir=-1,this.vo=-1,this.Vt=-1,this.ak=NaN,this.fk=null,this.ee=!1,this.iu=NaN,this.Qn=NaN,this.ok=0,this.ek=null,this.sk=null}static pD(t,e){return t.index-e.index}getProperSourceEdges(){if(!this._y){var t=[];for(const i of this.Mo){var e=i;e.valid&&t.push(e)}this._y=t}return this._y}getProperDestinationEdges(){if(!this.tw){var t=[];for(const i of this.hr){var e=i;e.valid&&t.push(e)}this.tw=t}return this.tw}getDestinationEdge(t){for(const e of this.getProperDestinationEdges())if(e.toVertex===t)return e;Xt.n("Unable to find destination edge to given vertex")}getProperSourceVertexes(){if(!this.$y){var t=[];for(const i of this.Mo){var e=i;!e.valid||e.fromVertex.layer<=e.toVertex.layer||t.push(e.fromVertex)}t.sort(Di.pD),this.$y=t}return this.$y}getProperDestinationVertexes(){if(!this.Qy){var t=[];for(const i of this.hr){var e=i;!e.valid||e.fromVertex.layer<=e.toVertex.layer||t.push(e.toVertex)}t.sort(Di.pD),this.Qy=t}return this.Qy}addSourceEdge(t){super.addSourceEdge(t),this.$y=null,this._y=null}deleteSourceEdge(t){super.deleteSourceEdge(t),this.$y=null,this._y=null}addDestinationEdge(t){super.addDestinationEdge(t),this.Qy=null,this.tw=null}deleteDestinationEdge(t){super.deleteDestinationEdge(t),this.Qy=null,this.tw=null}get layer(){return this.ir}set layer(t){this.ir!==t&&(Xt.t(t,"number",Di,"layer"),this.ir=t)}get column(){return this.vo}set column(t){this.vo!==t&&(Xt.t(t,"number",Di,"column"),this.vo=t)}get index(){return this.Vt}set index(t){this.Vt!==t&&(Xt.t(t,"number",Di,"index"),this.Vt=t)}get component(){return this.ak}set component(t){this.ak!==t&&(Xt.t(t,"number",Di,"component"),this.ak=t)}get near(){return this.fk}set near(t){this.fk!==t&&(Yt,null!==t&&Xt.s(t,Di,Di,"near"),this.fk=t)}}class Ti extends Ze{ee;ck;uk;dk;gk;mk;pk;constructor(t){super(t),this.ee=!1,this.ck=!1,this.uk=!1,this.dk=NaN,this.gk=NaN,this.mk=0,this.pk=0}get fromVertex(){return this.is}set fromVertex(t){this.is!==t&&(Yt,null!==t&&Xt.s(t,Di,Ti,"fromVertex"),this.is=t)}get toVertex(){return this.es}set toVertex(t){this.es!==t&&(Yt,null!==t&&Xt.s(t,Di,Ti,"toVertex"),this.es=t)}get valid(){return this.ee}set valid(t){this.ee!==t&&(Xt.t(t,"boolean",Ti,"valid"),this.ee=t)}get rev(){return this.ck}set rev(t){this.ck!==t&&(Xt.t(t,"boolean",Ti,"rev"),this.ck=t)}get forest(){return this.uk}set forest(t){this.uk!==t&&(Xt.t(t,"boolean",Ti,"forest"),this.uk=t)}get portFromPos(){return this.dk}set portFromPos(t){this.dk!==t&&(Xt.t(t,"number",Ti,"portFromPos"),this.dk=t)}get portToPos(){return this.gk}set portToPos(t){this.gk!==t&&(Xt.t(t,"number",Ti,"portToPos"),this.gk=t)}get portFromColOffset(){return this.mk}set portFromColOffset(t){this.mk!==t&&(Xt.t(t,"number",Ti,"portFromColOffset"),this.mk=t)}get portToColOffset(){return this.pk}set portToColOffset(t){this.pk!==t&&(Xt.t(t,"number",Ti,"portToColOffset"),this.pk=t)}}(n={})[n.Default=0]="Default",n[n.Destination=1]="Destination",n[n.Source=2]="Source";var Bi=n,Gi=((n={})[n.Forwards=10]="Forwards",n[n.Reverse=11]="Reverse",n[n.Ascending=12]="Ascending",n[n.Descending=13]="Descending",n),Fi=((n={})[n.CenterSubtrees=20]="CenterSubtrees",n[n.CenterChildren=21]="CenterChildren",n[n.Start=22]="Start",n[n.End=23]="End",n[n.Bus=24]="Bus",n[n.BusBranching=25]="BusBranching",n[n.TopLeftBus=26]="TopLeftBus",n[n.BottomRightBus=27]="BottomRightBus",n[n.Custom=28]="Custom",n),Ri=((n={})[n.None=30]="None",n[n.Block=31]="Block",n),Oi=((n={})[n.Layered=40]="Layered",n[n.LastParents=41]="LastParents",n[n.Alternating=42]="Alternating",n[n.RootOnly=43]="RootOnly",n),Ei=((n={})[n.Vertical=50]="Vertical",n[n.Horizontal=51]="Horizontal",n[n.FixedRoots=52]="FixedRoots",n),Hi=((n={})[n.Individual=60]="Individual",n[n.Siblings=61]="Siblings",n[n.Uniform=62]="Uniform",n);class tt extends Qe{Vi;Oi;su;Xg;vN;Ye;vi;Ts;K;U;yk;ms;constructor(t){super(),this.Vi=new C,this.Oi=0,this.ms=1,this.su=40,this.Xg=60,this.vN=[],this.Ye=!0,this.vi=50,this.Ts=new qt(10,10).w();var e=new Ii(this);this.K=new et(e),this.U=new et(e),this.yk=[],t&&Object.assign(this,t)}cloneProtected(t){super.cloneProtected(t),t.Oi=this.Oi,t.su=this.su,t.Xg=this.Xg,t.Ye=this.Ye,t.vi=this.vi,t.Ts.c(this.Ts),t.K.copyInheritedPropertiesFrom(this.K),t.U.copyInheritedPropertiesFrom(this.U)}ci(t){t in Fi?this.alignment=t:t in Ei?this.arrangement=t:t in Ri?this.compaction=t:t in Bi?this.path=t:t in Gi?this.sorting=t:t in Oi?this.treeStyle=t:super.ci(t)}createNetwork(){return new Ii(this)}makeNetwork(t){var e=this.createNetwork(),i=t=>{var e;return t instanceof D?!t.isLinkLabel&&"Comment"!==t.category:t instanceof q&&null!==(e=t.fromNode)&&!e.isLinkLabel&&"Comment"!==e.category&&!(null===(e=t.toNode)||e.isLinkLabel||"Comment"===e.category)};return t instanceof K?(e.addParts(t.nodes,!0,i),e.addParts(t.links,!0,i)):t instanceof j?e.addParts(t.memberParts,!1,i):e.addParts(t.iterator,!1,i),e}doLayout(t){Yt,null===t&&Xt.n("Layout.doLayout(collection) argument must not be null but a Diagram, a Group, or an Iterable of Parts"),null===this.network&&(this.network=this.makeNetwork(t)),52!==this.arrangement&&(this.arrangementOrigin=this.initialOrigin(this.arrangementOrigin));let e=this.diagram;null===e&&t instanceof K&&(e=t),0===this.path&&null!==e?this.ms=e.isTreePathToChildren?1:2:this.ms=0===this.path?1:this.path,0<this.network.vertexes.count&&(this.I3(),this.O3(),this.E3(),this.V3(),this.zN(),this.B3(),this.arrangeTrees(),this.updateParts()),this.network=null,this.Vi=new C,this.isValidLayout=!0}I3(){this.network.deleteSelfEdges();for(var t=this.network.vertexes.iterator;t.next();){var e=t.value;e.initialized=!1,e.level=0,e.parent=null,e.children=[]}if(0<this.Vi.count){for(var i=new C,s=this.Vi.iterator;s.next();){var n,r=s.value;r instanceof D?null!==(n=this.network.findVertex(r))&&i.add(n):r instanceof et&&i.add(r)}this.Vi=i}0===this.Vi.count&&this.findRoots();for(var a=this.Vi.copy().iterator;a.next();){var o=a.value;o.initialized||(o.initialized=!0,this.qN(o))}let h=this.network.vertexes,l;for(;0<(l=this.z3(h)).count;){var u=this.yD(l);null!==u&&this.Vi.add(u),u.initialized=!0,this.qN(u),h=l}}z3(t){for(var e=new C,i=t.iterator;i.next();){var s=i.value;s.initialized||e.add(s)}return e}findRoots(){for(var t=this.network.vertexes,e=t.iterator;e.next();){var i=e.value;switch(this.ms){case 1:0===i.sourceEdges.count&&this.Vi.add(i);break;case 2:0===i.destinationEdges.count&&this.Vi.add(i);break;default:Xt.n("Unhandled path value "+this.ms.toString())}}0===this.Vi.count&&null!==(t=this.yD(t))&&this.Vi.add(t)}yD(t){let e=999999,i=null;for(var s=t.iterator;s.next();){var n=s.value;switch(this.ms){case 1:n.sourceEdges.count<e&&(e=n.sourceEdges.count,i=n);break;case 2:n.destinationEdges.count<e&&(e=n.destinationEdges.count,i=n);break;default:Xt.n("Unhandled path value "+this.ms.toString())}}return i}qN(e){if(null!==e){switch(Yt,Xt.s(e,et,tt,"walkTree:v"),this.ms){case 1:if(0<e.destinationEdges.count){for(var t=new O,i=e.destinationVertexes;i.next();){var s=i.value;this.wD(e,s)&&t.add(s)}0<t.count&&(e.children=t.toArray())}break;case 2:if(0<e.sourceEdges.count){for(var n=new O,r=e.sourceVertexes;r.next();){var a=r.value;this.wD(e,a)&&n.add(a)}0<n.count&&(e.children=n.toArray())}break;default:Xt.n("Unhandled path value"+this.ms.toString())}var o=e.children,h=o.length;for(let t=0;t<h;t++){var l=o[t];l.initialized=!0,l.level=e.level+1,l.parent=e,this.Vi.remove(l)}for(let t=0;t<h;t++){var u=o[t];this.qN(u)}}}wD(t,e){return Yt,Xt.s(t,et,tt,"walkOK:v"),Yt,Xt.s(e,et,tt,"walkOK:c"),!e.initialized||!(this.X3(e,t)||e.level>t.level||(this.Y3(e.parent,e),0))}X3(t,e){if(null===e)return!1;Yt,Xt.s(t,et,tt,"isAncestor:a"),Yt,Xt.s(e,et,tt,"isAncestor:b");let i=e.parent;for(;null!==i&&i!==t;)i=i.parent;return i===t}Y3(t,s){if(null!==t&&null!==s){Yt,Xt.s(t,et,tt,"removeChild:p"),Yt,Xt.s(s,et,tt,"removeChild:c");var n=t.children;let i=0;for(let t=0;t<n.length;t++)n[t]===s&&i++;if(0<i){var r=new Array(n.length-i);let e=0;for(let t=0;t<n.length;t++)n[t]!==s&&(r[e++]=n[t]);t.children=r}}}O3(){for(var t=this.Vi.iterator;t.next();){var e=t.value;e instanceof et&&this.xD(e)}}xD(t){if(null!==t){Yt,Xt.s(t,et,tt,"initializeTree:v"),this.initializeTreeVertexValues(t),25===t.alignment&&this.sortTreeVertexChildren(t);let e=0,i=t.childrenCount,s=0;var n=t.children,r=n.length;for(let t=0;t<r;t++){var a=n[t];this.xD(a),e+=a.descendantCount+1,i=Math.max(i,a.maxChildrenCount),s=Math.max(s,a.maxGenerationCount)}t.descendantCount=e,t.maxChildrenCount=i,t.maxGenerationCount=0<i?s+1:0}}K3(t){switch(Yt,Xt.s(t,et,tt,"mom:v"),this.su){default:case 40:return null!==t.parent?t.parent:this.K;case 43:return null===t.parent?this.K:null===t.parent.parent?this.U:t.parent;case 42:return null!==t.parent?null!==t.parent.parent?t.parent.parent:this.U:this.K;case 41:{let e=!0;if(0===t.childrenCount)e=!1;else{var i=t.children,s=i.length;for(let t=0;t<s;t++)if(0<i[t].childrenCount){e=!1;break}}return e&&null!==t.parent?this.U:null!==t.parent?t.parent:this.K}}}initializeTreeVertexValues(i){Yt,Xt.s(i,et,tt,"initializeTreeVertexValues:v");var t=this.K3(i);if(i.copyInheritedPropertiesFrom(t),null!==i.parent&&25===i.parent.alignment){let t=i.angle;var s=i.parent.children;let e=0;for(;e<s.length&&i!==s[e];)e++;e%2==0?e!==s.length-1&&(t=90===t||180!==t&&270===t?180:270):t=90===t||180!==t&&270===t?0:90,i.angle=t}i.initialized=!0}E3(){for(var t=this.Vi.iterator;t.next();){var e=t.value;e instanceof et&&this.bD(e)}}bD(t){if(null!==t){Yt,Xt.s(t,et,tt,"assignTree:v"),this.assignTreeVertexValues(t);var e=t.children,i=e.length;for(let t=0;t<i;t++){var s=e[t];this.bD(s)}}}assignTreeVertexValues(t){}V3(){for(var t=this.Vi.iterator;t.next();){var e=t.value;e instanceof et&&this.kD(e)}}kD(t){if(null!==t){Yt,Xt.s(t,et,tt,"sortTree:v"),25!==t.alignment&&this.sortTreeVertexChildren(t);var e=t.children,i=e.length;for(let t=0;t<i;t++){var s=e[t];this.kD(s)}}}sortTreeVertexChildren(t){switch(Yt,Xt.s(t,et,tt,"sortTreeVertexChildren:v"),t.sorting){default:case 10:break;case 11:t.children.reverse();break;case 12:t.children.sort(t.comparer);break;case 13:t.children.sort(t.comparer),t.children.reverse()}}zN(){if(this.comments)for(var t=this.network.vertexes.iterator;t.next();){var e=t.value;this.addComments(e)}}addComments(t){Yt,Xt.s(t,et,tt,"addComments:v");var e=t.angle,i=t.parent;let s=0,n,r=!1;null!==i&&(s=i.angle,n=i.alignment,r=this.isBusAlignment(n));var a=90===e||270===e,o=90===s||270===s,h=0===t.childrenCount;let l=0,u=0,d=0;var c=t.commentSpacing;if(null!==t.node)for(var g=t.node.findNodesConnected();g.next();){var m=g.value;"Comment"===m.category&&m.canLayout()&&(null===t.comments&&(t.comments=[]),t.comments.push(m),m.ensureBounds(),m=m.measuredBounds,a&&!h||!r&&!o&&h||r&&o&&h?(l=Math.max(l,m.width),u+=m.height+Math.abs(d)):(l+=m.width+Math.abs(d),u=Math.max(u,m.height)),d=c)}null!==t.comments&&(a&&!h||!r&&!o&&h||r&&o&&h?(l+=Math.abs(t.commentMargin),u=Math.max(0,u-t.height)):(u+=Math.abs(t.commentMargin),l=Math.max(0,l-t.width)),i=Z.H(0,0,t.bounds.width+l,t.bounds.height+u),t.bounds=i,Z.o(i))}isBusAlignment(t){return 24===t||25===t||26===t||27===t}iw(t){return 24===t||25===t}WN(e){Yt,Xt.s(e,et,tt,"isLeftSideBus:v");var i=e.parent;if(null!==i){var t=i.alignment;if(this.isBusAlignment(t)){if(this.iw(t)){var s=i.children;let t=0;for(;t<s.length&&e!==s[t];)t++;return t%2==0}return 26===t}}return!1}layoutComments(n){if(Yt,Xt.s(n,et,tt,"layoutComments:v"),null!==n.comments){var r=n.node.measuredBounds,a=n.parent,o=n.angle;let e=0,t,i=!1;null!==a&&(e=a.angle,t=a.alignment,i=this.isBusAlignment(t));var h=90===o||270===o,l=90===e||270===e,u=0===n.childrenCount,d=this.WN(n);let s=0;var c=n.comments,g=c.length,m=U.a();for(let t=0;t<g;t++){var f=c[t],p=f.measuredBounds;if(h&&!u||!i&&!l&&u||i&&l&&u){if(135<e&&!i||l&&d)if(0<=n.commentMargin){m.e(n.bounds.x-n.commentMargin-p.width,n.bounds.y+s),f.move(m);for(var v=f.findLinksInto();v.next();){var y=v.value;y.fromSpot=J.MiddleLeft,y.toSpot=J.MiddleRight}}else{m.e(n.bounds.x+2*n.focus.x-n.commentMargin,n.bounds.y+s),f.move(m);for(var x=f.findLinksInto();x.next();){var A=x.value;A.fromSpot=J.MiddleRight,A.toSpot=J.MiddleLeft}}else if(0<=n.commentMargin){m.e(n.bounds.x+2*n.focus.x+n.commentMargin,n.bounds.y+s),f.move(m);for(var w=f.findLinksInto();w.next();){var b=w.value;b.fromSpot=J.MiddleRight,b.toSpot=J.MiddleLeft}}else{m.e(n.bounds.x+n.commentMargin-p.width,n.bounds.y+s),f.move(m);for(var P=f.findLinksInto();P.next();){var S=P.value;S.fromSpot=J.MiddleLeft,S.toSpot=J.MiddleRight}}0<=n.commentSpacing?s+=p.height+n.commentSpacing:s+=n.commentSpacing-p.height}else{if(135<e&&!i||!l&&d)if(0<=n.commentMargin){m.e(n.bounds.x+s,n.bounds.y-n.commentMargin-p.height),f.move(m);for(var k=f.findLinksInto();k.next();){var M=k.value;M.fromSpot=J.MiddleTop,M.toSpot=J.MiddleBottom}}else{m.e(n.bounds.x+s,n.bounds.y+2*n.focus.y-n.commentMargin),f.move(m);for(var N=f.findLinksInto();N.next();){var C=N.value;C.fromSpot=J.MiddleBottom,C.toSpot=J.MiddleTop}}else if(0<=n.commentMargin){m.e(n.bounds.x+s,n.bounds.y+2*n.focus.y+n.commentMargin),f.move(m);for(var L=f.findLinksInto();L.next();){var D=L.value;D.fromSpot=J.MiddleBottom,D.toSpot=J.MiddleTop}}else{m.e(n.bounds.x+s,n.bounds.y+n.commentMargin-p.height),f.move(m);for(var T=f.findLinksInto();T.next();){var B=T.value;B.fromSpot=J.MiddleTop,B.toSpot=J.MiddleBottom}}0<=n.commentSpacing?s+=p.width+n.commentSpacing:s+=n.commentSpacing-p.width}}U.o(m);var G=s-n.commentSpacing-(h?r.height:r.width);if(1===this.ms)for(var F=n.destinationEdges;F.next();){var R=F.value.link;null===R||R.isAvoiding||(R.fromEndSegmentLength=0<G?G:NaN)}else for(var O=n.sourceEdges;O.next();){var E=O.value.link;null===E||E.isAvoiding||(E.toEndSegmentLength=0<G?G:NaN)}}}B3(){if(62===this.layerStyle){var s=[];let i=this.network.vertexes.iterator;for(;i.next();){var n=i.value;let t=n.parent;var r=0===(t=null===t?n:t).angle||180===t.angle;let e=s[n.level];void 0===e&&(e=0),s[n.level]=Math.max(e,r?n.width:n.height)}for(let t=0;t<s.length;t++)void 0===s[t]&&(s[t]=0);for(this.vN=s,i=this.network.vertexes.iterator;i.next();){var e=i.value;let t=e.parent;0===(t=null===t?e:t).angle||180===t.angle?(180===t.angle&&(e.focusX+=s[e.level]-e.width),e.width=s[e.level]):(270===t.angle&&(e.focusY+=s[e.level]-e.height),e.height=s[e.level])}}else if(61===this.layerStyle)for(var t=this.network.vertexes.iterator;t.next();){var i=t.value,a=0===i.angle||180===i.angle;let e=-1;for(let t=0;t<i.children.length;t++){var o=i.children[t];e=Math.max(e,a?o.width:o.height)}if(0<=e)for(let t=0;t<i.children.length;t++){var h=i.children[t];a?(180===i.angle&&(h.focusX+=e-h.width),h.width=e):(270===i.angle&&(h.focusY+=e-h.height),h.height=e)}}for(var l=this.Vi.iterator;l.next();){var u=l.value;u instanceof et&&this.layoutTree(u)}}layoutTree(t){if(null!==t){Yt,Xt.s(t,et,tt,"layoutTree:v");var e=t.children,i=e.length;for(let t=0;t<i;t++){var s=e[t];this.layoutTree(s)}30===t.compaction||25===t.alignment?this.SD(t):this.U3(t)}}SD(m){if(Yt,Xt.s(m,et,tt,"layoutTreeNone:v"),0===m.childrenCount){let t=!1,e=0,i;null!==m.parent&&(e=m.parent.angle,i=m.parent.alignment,t=this.isBusAlignment(i));var f=this.WN(m);m.X.e(0,0),m.kt.e(m.width,m.height),void(null===m.parent||null===m.comments||(180!==e&&270!==e||t)&&!f?m.ht.e(0,0):180===e&&!t||(90===e||270===e)&&f?m.ht.e(m.width-2*m.focus.x,0):m.ht.e(0,m.height-2*m.focus.y))}else{var p=this.orthoAngle(m),v=90===p||270===p;let e=0;var y=m.children,x=y.length;for(let t=0;t<x;t++){var A=y[t];e=Math.max(e,v?A.kt.width:A.kt.height)}var w=m.alignment,f=22===w,b=23===w,P=this.isBusAlignment(w),S=Math.max(0,m.breadthLimit),k=this.computeLayerSpacing(m),M=m.nodeSpacing,N=this.computeNodeIndent(m),C=f||b?0:N/2,L=m.rowSpacing;let t=0;(f||b||m.nu||m.ou&&1===m.maxGenerationCount)&&(t=Math.max(0,m.rowIndent));var D,T=m.width,B=m.height;let i=0,s=0,n=0,r=0,a=0,o=0,h=0,l=0,u=0,d=0;if(P&&!this.iw(w)&&135<p&&y.reverse(),this.iw(w))if(1<x)for(let t=0;t<x;t++){var G=y[t],F=G.kt;t%2==0&&t!==x-1?u=Math.max(u,(v?F.width:F.height)+this.computeBusNodeSpacing(G)-M):t%2!=0&&(d=Math.max(d,(v?F.width:F.height)+this.computeBusNodeSpacing(G)-M))}else 1===x&&(u=v?y[0].kt.width:y[0].kt.height);if(P)switch(w){case 24:case 25:let t;t=p<135?this.MD(m,y,u,d,i,s):this.PD(m,y,u,d,i,s),u=t.x,i=t.width,s=t.height;break;case 26:for(let t=0;t<x;t++){var R=y[t],O=R.kt,E=0===h?0:L;v?(R.X.e(e-O.width,a+E),i=Math.max(i,O.width),s=Math.max(s,a+E+O.height),a+=E+O.height):(R.X.e(r+E,e-O.height),i=Math.max(i,r+E+O.width),s=Math.max(s,O.height),r+=E+O.width),h++}break;case 27:for(let t=0;t<x;t++){var H=y[t],I=H.kt,K=0===h?0:L;v?(H.X.e(M/2+m.focus.x,a+K),i=Math.max(i,I.width),s=Math.max(s,a+K+I.height),a+=K+I.height):(H.X.e(r+K,M/2+m.focus.y),i=Math.max(i,r+K+I.width),s=Math.max(s,I.height),r+=K+I.width),h++}}else for(let t=0;t<x;t++){var V,z=y[t],Y=z.kt;v?(0<S&&0<h&&r+M+Y.width>S&&(r<e&&this.of(m,w,e-r,0,l,t-1),o++,h=0,l=t,n=s,r=0,a=135<p?-s-L:s+L),V=0===h?C:M,this.wk(z,0,a),z.X.e(r+V,a),i=Math.max(i,r+V+Y.width),s=Math.max(s,n+(0===o?0:L)+Y.height),r+=V+Y.width):(0<S&&0<h&&a+M+Y.height>S&&(a<e&&this.of(m,w,0,e-a,l,t-1),o++,h=0,l=t,n=i,a=0,r=135<p?-i-L:i+L),V=0===h?C:M,this.wk(z,r,0),z.X.e(r,a+V),s=Math.max(s,a+V+Y.height),i=Math.max(i,n+(0===o?0:L)+Y.width),a+=V+Y.height),h++}0<o&&(v?(s+=Math.max(0,k),r<i&&this.of(m,w,i-r,0,l,x-1),0<t&&(b||this.ru(m,t,0,0,x-1),i+=t)):(i+=Math.max(0,k),a<s&&this.of(m,w,0,s-a,l,x-1),0<t&&(b||this.ru(m,0,t,0,x-1),s+=t)));let c=0,g=0;switch(w){case 20:v?c+=i/2-m.focus.x-N/2:g+=s/2-m.focus.y-N/2;break;default:case 21:0<o?v?c+=i/2-m.focus.x-N/2:g+=s/2-m.focus.y-N/2:v?(X=y[0].X.x+y[0].ht.x,D=y[x-1].X.x+y[x-1].ht.x+2*y[x-1].focus.x,c+=X+(D-X)/2-m.focus.x-N/2):(D=y[0].X.y+y[0].ht.y,X=y[x-1].X.y+y[x-1].ht.y+2*y[x-1].focus.y,g+=D+(X-D)/2-m.focus.y-N/2);break;case 22:v?(c-=N,i+=N):(g-=N,s+=N);break;case 23:v?(c+=i-m.width+N,i+=N):(g+=s-m.height+N,s+=N);break;case 24:case 25:v?c+=1<x?u+M/2-m.focus.x:y[0].focus.x-m.focus.x+y[0].ht.x:g+=1<x?u+M/2-m.focus.y:y[0].focus.y-m.focus.y+y[0].ht.y;break;case 26:v?c+=i+M/2-m.focus.x:g+=s+M/2-m.focus.y;break;case 27:break;case 28:var X=this.customAlignment(m,c,g,i,s);c=X[0],g=X[1],i=X[2],s=X[3]}for(let t=0;t<x;t++){var q=y[t];v?q.X.e(q.X.x+q.ht.x-c,q.X.y+(135<p?(P?-s:-q.kt.height)+q.ht.y-k:B+k+q.ht.y)):q.X.e(q.X.x+(135<p?(P?-i:-q.kt.width)+q.ht.x-k:T+k+q.ht.x),q.X.y+q.ht.y-g)}v?(i=this.jN(m,i,c),c<0&&(c=0),135<p&&(g+=s+k),s=Math.max(Math.max(s,B),s+B+k)):(135<p&&(c+=i+k),i=Math.max(Math.max(i,T),i+T+k),s=this.JN(m,s,g),g<0&&(g=0)),m.ht.e(c,g),m.kt.e(i,s)}}customAlignment(t,e,i,s,n){return[e,i,s,n]}MD(t,n,r,e,a,o){Yt,Xt.s(t,et,tt,"layoutBusChildrenPosDir:v");var h=n.length;if(0!==h)if(1===h)a=(S=n[0]).kt.width,o=S.kt.height;else{var l,u,d,c,g=t.nodeSpacing,m=t.rowSpacing,f=90===this.orthoAngle(t);let e=0,i=0,s=0;for(let t=0;t<h;t++)t%2!=0||1<h&&t===h-1||(u=(l=n[t]).kt,d=0===e?0:m,f?(c=this.computeBusNodeSpacing(l)-g,l.X.e(r-(u.width+c),s+d),a=Math.max(a,u.width+c),o=Math.max(o,s+d+u.height),s+=d+u.height):(c=this.computeBusNodeSpacing(l)-g,l.X.e(i+d,r-(u.height+c)),o=Math.max(o,u.height+c),a=Math.max(a,i+d+u.width),i+=d+u.width),e++);e=0;var p,v,y,x,A,w,b,P,S=i,k=s;s=f?(i=r+g,0):(i=0,r+g);for(let t=0;t<h;t++)t%2!=0&&(v=(p=n[t]).kt,y=0===e?0:m,f?(x=this.computeBusNodeSpacing(p)-g,p.X.e(i+x,s+y),a=Math.max(a,i+v.width+x),o=Math.max(o,s+y+v.height),s+=y+v.height):(x=this.computeBusNodeSpacing(p)-g,p.X.e(i+y,s+x),a=Math.max(a,i+y+v.width),o=Math.max(o,s+v.height+x),i+=y+v.width),e++);1<h&&h%2==1&&(w=(A=n[h-1]).kt,b=this.computeBusLastRowSpacing(A,f?Math.max(Math.abs(k),Math.abs(s)):Math.max(Math.abs(S),Math.abs(i))),f?(A.X.e(r+g/2-A.focus.x-A.ht.x,o+b),P=r+g/2-A.focus.x-A.ht.x,a=Math.max(a,P+w.width),P<0&&(a-=P),o=Math.max(o,Math.max(k,s)+b+w.height),A.X.x<0&&(r=this.xk(t,A.X.x,!1,r,g))):(A.X.e(a+b,r+g/2-A.focus.y-A.ht.y),a=Math.max(a,Math.max(S,i)+b+w.width),P=r+g/2-A.focus.y-A.ht.y,o=Math.max(o,P+w.height),P<0&&(o-=P),A.X.y<0&&(r=this.xk(t,A.X.y,!0,r,g))))}return new Z(r,0,a,o)}PD(t,n,r,e,a,o){Yt,Xt.s(t,et,tt,"layoutBusChildrenNegDir:v");var h=n.length;if(0!==h)if(1===h)a=(S=n[0]).kt.width,o=S.kt.height;else{var l,u,d,c,g=t.nodeSpacing,m=t.rowSpacing,f=270===this.orthoAngle(t);let e=0,i=0,s=0;for(let t=0;t<h;t++)t%2!=0||1<h&&t===h-1||(u=(l=n[t]).kt,d=0===e?0:m,f?(c=this.computeBusNodeSpacing(l)-g,s-=d+u.height,l.X.e(r-(u.width+c),s),a=Math.max(a,u.width+c),o=Math.max(o,Math.abs(s))):(c=this.computeBusNodeSpacing(l)-g,i-=d+u.width,l.X.e(i,r-(u.height+c)),o=Math.max(o,u.height+c),a=Math.max(a,Math.abs(i))),e++);e=0;var p,v,y,x,A,w,b,P,S=i,k=s;s=f?(i=r+g,0):(i=0,r+g);for(let t=0;t<h;t++)t%2!=0&&(v=(p=n[t]).kt,y=0===e?0:m,f?(x=this.computeBusNodeSpacing(p)-g,s-=y+v.height,p.X.e(i+x,s),a=Math.max(a,i+v.width+x),o=Math.max(o,Math.abs(s))):(x=this.computeBusNodeSpacing(p)-g,i-=y+v.width,p.X.e(i,s+x),o=Math.max(o,s+v.height+x),a=Math.max(a,Math.abs(i))),e++);1<h&&h%2==1&&(w=(A=n[h-1]).kt,b=this.computeBusLastRowSpacing(A,f?Math.max(Math.abs(k),Math.abs(s)):Math.max(Math.abs(S),Math.abs(i))),f?(A.X.e(r+g/2-A.focus.x-A.ht.x,-o-w.height-b),P=r+g/2-A.focus.x-A.ht.x,a=Math.max(a,P+w.width),P<0&&(a-=P),o=Math.max(o,Math.abs(Math.min(k,s))+b+w.height),A.X.x<0&&(r=this.xk(t,A.X.x,!1,r,g))):(A.X.e(-a-w.width-b,r+g/2-A.focus.y-A.ht.y),a=Math.max(a,Math.abs(Math.min(S,i))+b+w.width),P=r+g/2-A.focus.y-A.ht.y,o=Math.max(o,P+w.height),P<0&&(o-=P),A.X.y<0&&(r=this.xk(t,A.X.y,!0,r,g))));for(let t=0;t<h;t++){var M=n[t];f?M.X.e(M.X.x,M.X.y+o):M.X.e(M.X.x+a,M.X.y)}}return new Z(r,0,a,o)}computeBusNodeSpacing(t){return Yt,Xt.s(t,et,tt,"fixRelativePostions:child"),null===t.parent?0:t.parent.nodeSpacing}computeBusLastRowSpacing(t,e){return Yt,Xt.s(t,et,tt,"fixRelativePostions:lastchild"),null===t.parent?0:t.parent.rowSpacing}xk(t,e,i,s,n){Yt,Xt.s(t,et,tt,"fixRelativePostions:v");var r=t.children,a=r.length;for(let t=0;t<a;t++)i?r[t].X.e(r[t].X.x,r[t].X.y-e):r[t].X.e(r[t].X.x-e,r[t].X.y);t=r[a-1];return Math.max(s,i?t.ht.y+t.focus.y-n/2:t.ht.x+t.focus.x-n/2)}jN(e,i,s){switch(Yt,Xt.s(e,et,tt,"calculateSubwidth:v"),e.alignment){case 21:case 20:let t=i;return s+e.width>t&&(t=s+e.width),s<0&&(t-=s),t;case 22:return e.width>i?e.width:i;case 23:return 2*e.focus.x>i?e.width:i+e.width-2*e.focus.x;case 24:case 25:var n=Math.min(0,s),r=Math.max(i,s+e.width);return Math.max(e.width,r-n);case 26:return e.width-e.focus.x+e.nodeSpacing/2+i;case 27:return Math.max(e.width,e.focus.x+e.nodeSpacing/2+i);default:return i}}JN(e,i,s){switch(Yt,Xt.s(e,et,tt,"calculateSubheight:v"),e.alignment){case 21:case 20:let t=i;return s+e.height>t&&(t=s+e.height),s<0&&(t-=s),t;case 22:return e.height>i?e.height:i;case 23:return 2*e.focus.y>i?e.height:i+e.height-2*e.focus.y;case 24:case 25:var n=Math.min(0,s),r=Math.max(i,s+e.height);return Math.max(e.height,r-n);case 26:return e.height-e.focus.y+e.nodeSpacing/2+i;case 27:return Math.max(e.height,e.focus.y+e.nodeSpacing/2+i);default:return i}}ZN(t,e,i){switch(Yt,Xt.it(t,Fi,"TreeAlignment"),t){case 20:case 21:e/=2,i/=2;break;case 22:i=e=0;break;case 23:break;default:Xt.n("Unhandled alignment value "+t.toString())}return new U(e,i)}of(t,e,i,s,n,r){Yt,Xt.s(t,et,tt,"shiftRelPosAlign:v"),Yt,Xt.it(e,Fi,"TreeAlignment");e=this.ZN(e,i,s);this.ru(t,e.x,e.y,n,r)}ru(t,e,i,s,n){if(Yt,Xt.s(t,et,tt,"shiftRelPos:v"),0!==e||0!==i){var r=t.children;for(let t=s;t<=n;t++){var a=r[t].X;a.x+=e,a.y+=i}}}wk(t,e,i){Yt,Xt.s(t,et,tt,"recordMidPoints:v"),Xt.t(e,"number",tt,"recordMidPoints:x"),Xt.t(i,"number",tt,"recordMidPoints:y");var s=t.parent;switch(this.ms){case 1:for(var n=t.sourceEdges;n.next();){var r=n.value;r.fromVertex===s&&r.relativePoint.e(e,i)}break;case 2:for(var a=t.destinationEdges;a.next();){var o=a.value;o.toVertex===s&&o.relativePoint.e(e,i)}break;default:Xt.n("Unhandled path value "+this.ms.toString())}}U3(b){if(Yt,Xt.s(b,et,tt,"layoutTreeBlock:v"),0===b.childrenCount){var P=b.parent;let t=!1,e=0,i;null!==P&&(e=P.angle,i=P.alignment,t=this.isBusAlignment(i));P=this.WN(b);b.X.e(0,0),b.kt.e(b.width,b.height),null===b.parent||null===b.comments||(180!==e&&270!==e||t)&&!P?b.ht.e(0,0):180===e&&!t||(90===e||270===e)&&P?b.ht.e(b.width-2*b.focus.x,0):b.ht.e(0,b.height-2*b.focus.y),b.Yg=null,void(b.Kg=null)}else{var S=this.orthoAngle(b),k=90===S||270===S;let i=0;var M=b.children,N=M.length;for(let t=0;t<N;t++){var C=M[t];i=Math.max(i,k?C.kt.width:C.kt.height)}var L=b.alignment,P=22===L,D=23===L,T=this.isBusAlignment(L),B=Math.max(0,b.breadthLimit),G=this.computeLayerSpacing(b),F=b.nodeSpacing,R=this.computeNodeIndent(b),O=b.rowSpacing;let t=0;(P||D||b.nu||b.ou&&1===b.maxGenerationCount)&&(t=Math.max(0,b.rowIndent));var E,H=b.width,I=b.height;let s=0,n=0,r=0,a=null,o=null,h=0,l=0,u=0,d=0,c=0,g=0,m=0,e=0,f=0;if(T&&!this.iw(L)&&135<S&&M.reverse(),this.iw(L))if(1<N)for(let t=0;t<N;t++)t%2==0&&t!==N-1?e=Math.max(e,k?M[t].kt.width:M[t].kt.height):t%2!=0&&(f=Math.max(f,k?M[t].kt.width:M[t].kt.height));else 1===N&&(e=k?M[0].kt.width:M[0].kt.height);if(T){switch(L){case 24:let t;t=S<135?this.MD(b,M,e,f,s,n):this.PD(b,M,e,f,s,n),e=t.x,s=t.width,n=t.height;break;case 26:for(let t=0;t<N;t++){var K=M[t],V=K.kt,z=0===g?0:O;k?(K.X.e(i-V.width,d+z),s=Math.max(s,V.width),n=Math.max(n,d+z+V.height),d+=z+V.height):(K.X.e(u+z,i-V.height),s=Math.max(s,u+z+V.width),n=Math.max(n,V.height),u+=z+V.width),g++}break;case 27:for(let t=0;t<N;t++){var Y=M[t],X=Y.kt,q=0===g?0:O;k?(Y.X.e(F/2+b.focus.x,d+q),s=Math.max(s,X.width),n=Math.max(n,d+q+X.height),d+=q+X.height):(Y.X.e(u+q,F/2+b.focus.y),s=Math.max(s,u+q+X.width),n=Math.max(n,X.height),u+=q+X.width),g++}}a=this.ye(2),o=this.ye(2),k?(a[0].e(0,0),a[1].e(0,n),o[0].e(s,0)):(a[0].e(0,0),a[1].e(s,0),o[0].e(0,n)),o[1].e(s,n)}else for(let e=0;e<N;e++){var j,Q,U=M[e],W=U.kt;if(k){0<B&&0<g&&u+F+W.width>B&&(u<i&&this.of(b,L,i-u,0,m,e-1),c++,g=0,m=e,r=n,u=0,d=135<S?-n-O:n+O),this.wk(U,0,d);let t=0;0===g?(a=U.Yg,o=U.Kg,h=W.width,l=W.height,null!==a&&null!==o&&S===this.orthoAngle(U)||(a=this.ye(2),o=this.ye(2),a[0].e(0,0),a[1].e(0,l),o[0].e(h,0),o[1].e(h,l))):(Q=Xt.ct(),j=this.ND(b,U,a,o,h,l,Q),t=j.x,a=Q[0],o=Q[1],h=j.width,l=j.height,Xt.ot(Q),u<W.width&&t<0&&(this.ru(b,-t,0,m,e-1),this.bk(a,-t,0),this.bk(o,-t,0),t=0)),U.X.e(t,d),s=Math.max(s,h),n=Math.max(n,r+(0===c?0:O)+W.height),u=h}else{0<B&&0<g&&d+F+W.height>B&&(d<i&&this.of(b,L,0,i-d,m,e-1),c++,g=0,m=e,r=s,d=0,u=135<S?-s-O:s+O),this.wk(U,u,0);let t=0;0===g?(a=U.Yg,o=U.Kg,h=W.width,l=W.height,null!==a&&null!==o&&S===this.orthoAngle(U)||(a=this.ye(2),o=this.ye(2),a[0].e(0,0),a[1].e(h,0),o[0].e(0,l),o[1].e(h,l))):(j=Xt.ct(),Q=this.ND(b,U,a,o,h,l,j),t=Q.x,a=j[0],o=j[1],h=Q.width,l=Q.height,Xt.ot(j),d<W.height&&t<0&&(this.ru(b,0,-t,m,e-1),this.bk(a,0,-t),this.bk(o,0,-t),t=0)),U.X.e(u,t),n=Math.max(n,l),s=Math.max(s,r+(0===c?0:O)+W.width),d=l}g++}0<c&&(k?(n+=Math.max(0,G),u<s&&this.of(b,L,s-u,0,m,N-1),0<t&&(D||this.ru(b,t,0,0,N-1),s+=t)):(s+=Math.max(0,G),d<n&&this.of(b,L,0,n-d,m,N-1),0<t&&(D||this.ru(b,0,t,0,N-1),n+=t)));let p=0,v=0;switch(L){case 20:k?p+=s/2-b.focus.x-R/2:v+=n/2-b.focus.y-R/2;break;default:case 21:0<c?k?p+=s/2-b.focus.x-R/2:v+=n/2-b.focus.y-R/2:k?(Z=M[0].X.x+M[0].ht.x,E=M[N-1].X.x+M[N-1].ht.x+2*M[N-1].focus.x,p+=Z+(E-Z)/2-b.focus.x-R/2):(E=M[0].X.y+M[0].ht.y,Z=M[N-1].X.y+M[N-1].ht.y+2*M[N-1].focus.y,v+=E+(Z-E)/2-b.focus.y-R/2);break;case 22:k?(p-=R,s+=R):(v-=R,n+=R);break;case 23:k?(p+=s-b.width+R,s+=R):(v+=n-b.height+R,n+=R);break;case 24:k?p+=1<N?e+F/2-b.focus.x:M[0].focus.x-b.focus.x+M[0].ht.x:v+=1<N?e+F/2-b.focus.y:M[0].focus.y-b.focus.y+M[0].ht.y;break;case 26:k?p+=s+F/2-b.focus.x:v+=n+F/2-b.focus.y;break;case 27:break;case 28:var Z=this.customAlignment(b,p,v,s,n);p=Z[0],v=Z[1],s=Z[2],n=Z[3]}for(let t=0;t<N;t++){var J=M[t];k?J.X.e(J.X.x+J.ht.x-p,J.X.y+(135<S?(T?-n:-J.kt.height)+J.ht.y-G:I+G+J.ht.y)):J.X.e(J.X.x+(135<S?(T?-s:-J.kt.width)+J.ht.x-G:H+G+J.ht.x),J.X.y+J.ht.y-v)}let y=0,x=0;T?k?(s=this.jN(b,s,p),p<0&&(p=0),135<S&&(v+=n+G),n+=I+G,27===L&&(y+=F/2+b.focus.x),x+=I+G):(135<S&&(p+=s+G),s+=H+G,n=this.JN(b,n,v),v<0&&(v=0),27===L&&(x+=F/2+b.focus.y),y+=H+G):k?(null===b.comments?H>s&&(P=this.ZN(L,H-s,0),y=P.x,x=P.y,s=H,p=0):s=this.jN(b,s,p),p<0&&(y-=p,p=0),135<S&&(v+=n+G),n=Math.max(Math.max(n,I),n+I+G),x+=I+G):(135<S&&(p+=s+G),s=Math.max(Math.max(s,H),s+H+G),null===b.comments?I>n&&(D=this.ZN(L,0,I-n),y=D.x,x=D.y,n=I,v=0):n=this.JN(b,n,v),v<0&&(x-=v,v=0),y+=H+G);let A,w;if(0<c)A=this.ye(4),w=this.ye(4),k?(A[2].e(0,I+G),A[3].e(A[2].x,n),w[2].e(s,A[2].y),w[3].e(w[2].x,A[3].y)):(A[2].e(H+G,0),A[3].e(s,A[2].y),w[2].e(A[2].x,n),w[3].e(A[3].x,w[2].y));else{A=this.ye(a.length+2),w=this.ye(o.length+2);for(let t=0;t<a.length;t++){var _=a[t];A[t+2].e(_.x+y,_.y+x)}for(let t=0;t<o.length;t++){var $=o[t];w[t+2].e($.x+y,$.y+x)}}k?(A[0].e(p,0),A[1].e(A[0].x,I),A[2].y<A[1].y&&(A[2].x>A[0].x?A[2].c(A[1]):A[1].c(A[2])),A[3].y<A[2].y&&(A[3].x>A[0].x?A[3].c(A[2]):A[2].c(A[3])),w[0].e(p+H,0),w[1].e(w[0].x,I),w[2].y<w[1].y&&(w[2].x<w[0].x?w[2].c(w[1]):w[1].c(w[2])),w[3].y<w[2].y&&(w[3].x<w[0].x?w[3].c(w[2]):w[2].c(w[3])),A[2].y-=G/2,w[2].y-=G/2):(A[0].e(0,v),A[1].e(H,A[0].y),A[2].x<A[1].x&&(A[2].y>A[0].y?A[2].c(A[1]):A[1].c(A[2])),A[3].x<A[2].x&&(A[3].y>A[0].y?A[3].c(A[2]):A[2].c(A[3])),w[0].e(0,v+I),w[1].e(H,w[0].y),w[2].x<w[1].x&&(w[2].y<w[0].y?w[2].c(w[1]):w[1].c(w[2])),w[3].x<w[2].x&&(w[3].y<w[0].y?w[3].c(w[2]):w[2].c(w[3])),A[2].x-=G/2,w[2].x-=G/2),this.ln(a),this.ln(o),b.Yg=A,b.Kg=w,b.ht.e(p,v),b.kt.e(s,n)}}bk(e,i,s){for(let t=0;t<e.length;t++){var n=e[t];n.x+=i,n.y+=s}}ND(t,e,i,s,n,r,a){Yt,Xt.s(t,et,tt,"mergeFringes:parent"),Yt,Xt.s(e,et,tt,"mergeFringes:child");var o=this.orthoAngle(t),h=90===o||270===o,t=t.nodeSpacing,l=i,u=s,d=n,c=r;let g=e.Yg,m=e.Kg;var f=e.kt,p=h?Math.max(c,f.height):Math.max(d,f.width);return null!==g&&o===this.orthoAngle(e)||(g=this.ye(2),m=this.ye(2),h?(g[0].e(0,0),g[1].e(0,f.height),m[0].e(f.width,0),m[1].e(m[0].x,g[1].y)):(g[0].e(0,0),g[1].e(f.width,0),m[0].e(0,f.height),m[1].e(g[1].x,m[0].y))),h?(o=d-this.G3(u,g,d),o+=t,i=this.H3(l,g,o),s=this.v3(u,m,o),n=Math.max(0,o)+f.width,r=p,this.ln(l),this.ln(g),this.ln(u),this.ln(m),a[0]=i,a[1]=s,new Z(o,0,n,r)):(e=c-this.q3(u,g,c),e+=t,i=this.W3(l,g,e),s=this.j3(u,m,e),n=p,r=Math.max(0,e)+f.height,this.ln(l),this.ln(g),this.ln(u),this.ln(m),a[0]=i,a[1]=s,new Z(e,0,n,r))}W3(t,e,i){if(null===t||t.length<2||null===e||e.length<2)return null;var s=this.ye(t.length+e.length);let n=0,r=0,a=0;for(;r<e.length&&e[r].x<t[0].x;){var o=e[r++];s[a++].e(o.x,o.y+i)}for(;n<t.length;){var h=t[n++];s[a++].e(h.x,h.y)}for(var l=t[t.length-1].x;r<e.length&&e[r].x<=l;)r++;for(;r<e.length&&e[r].x>l;){var u=e[r++];s[a++].e(u.x,u.y+i)}var d=this.ye(a);for(n=0;n<a;n++)d[n].c(s[n]);return this.ln(s),d}H3(t,e,i){if(null===t||t.length<2||null===e||e.length<2)return null;var s=this.ye(t.length+e.length);let n=0,r=0,a=0;for(;r<e.length&&e[r].y<t[0].y;){var o=e[r++];s[a++].e(o.x+i,o.y)}for(;n<t.length;){var h=t[n++];s[a++].e(h.x,h.y)}for(var l=t[t.length-1].y;r<e.length&&e[r].y<=l;)r++;for(;r<e.length&&e[r].y>l;){var u=e[r++];s[a++].e(u.x+i,u.y)}var d=this.ye(a);for(n=0;n<a;n++)d[n].c(s[n]);return this.ln(s),d}j3(t,e,i){if(null===t||t.length<2||null===e||e.length<2)return null;var s=this.ye(t.length+e.length);let n=0,r=0,a=0;for(;n<t.length&&t[n].x<e[0].x;){var o=t[n++];s[a++].e(o.x,o.y)}for(;r<e.length;){var h=e[r++];s[a++].e(h.x,h.y+i)}for(var l=e[e.length-1].x;n<t.length&&t[n].x<=l;)n++;for(;n<t.length&&t[n].x>l;){var u=t[n++];s[a++].e(u.x,u.y)}var d=this.ye(a);for(n=0;n<a;n++)d[n].c(s[n]);return this.ln(s),d}v3(t,e,i){if(null===t||t.length<2||null===e||e.length<2)return null;var s=this.ye(t.length+e.length);let n=0,r=0,a=0;for(;n<t.length&&t[n].y<e[0].y;){var o=t[n++];s[a++].e(o.x,o.y)}for(;r<e.length;){var h=e[r++];s[a++].e(h.x+i,h.y)}for(var l=e[e.length-1].y;n<t.length&&t[n].y<=l;)n++;for(;n<t.length&&t[n].y>l;){var u=t[n++];s[a++].e(u.x,u.y)}var d=this.ye(a);for(n=0;n<a;n++)d[n].c(s[n]);return this.ln(s),d}q3(o,h,l){let u=9999999;if(!(null===o||o.length<2||null===h||h.length<2)){let r=0,a=0;for(;r<o.length&&a<h.length;){var d=o[r],c=h[a],g=c.x,m=c.y;m+=l;let t=d,e=(r+1<o.length&&(t=o[r+1]),c),i=e.x,s=e.y,n=(a+1<h.length&&(e=h[a+1],i=e.x,s=e.y,s+=l),u);d.x===g?n=m-d.y:d.x>g&&d.x<i?n=m+(d.x-g)/(i-g)*(s-m)-d.y:g>d.x&&g<t.x&&(n=m-(d.y+(g-d.x)/(t.x-d.x)*(t.y-d.y))),n<u&&(u=n),t.x<=d.x?r++:(i<=g||(t.x<=i&&r++,i<=t.x))&&a++}}return u}G3(o,h,l){let u=9999999;if(!(null===o||o.length<2||null===h||h.length<2)){let r=0,a=0;for(;r<o.length&&a<h.length;){var d=o[r],c=h[a],g=c.x,m=c.y;g+=l;let t=d,e=(r+1<o.length&&(t=o[r+1]),c),i=e.x,s=e.y,n=(a+1<h.length&&(e=h[a+1],i=e.x,s=e.y,i+=l),u);d.y===m?n=g-d.x:d.y>m&&d.y<s?n=g+(d.y-m)/(s-m)*(i-g)-d.x:m>d.y&&m<t.y&&(n=g-(d.x+(m-d.y)/(t.y-d.y)*(t.x-d.x))),n<u&&(u=n),t.y<=d.y?r++:(s<=m||(t.y<=s&&r++,s<=t.y))&&a++}}return u}ye(e){var t=this.yk[e];if(void 0!==t){t=t.pop();if(void 0!==t)return t}var i=[];for(let t=0;t<e;t++)i[t]=new U;return i}ln(t){var e=t.length;let i=this.yk[e];void 0===i&&(i=[],this.yk[e]=i),i.push(t)}arrangeTrees(){if(52===this.vi)for(var t=this.Vi.iterator;t.next();){var i=t.value;if(i instanceof et){var s=i.node;if(null!==s){s=s.position;let t=s.x,e=s.y;isFinite(t)||(t=0),isFinite(e)||(e=0),this.$N(i,t,e)}}}else{for(var n=[],r=this.Vi.iterator;r.next();){var a=r.value;a instanceof et&&n.push(a)}switch(this.sorting){default:case 10:break;case 11:n.reverse();break;case 12:n.sort(this.comparer);break;case 13:n.sort(this.comparer),n.reverse()}var o=this.arrangementOrigin;let e=o.x,i=o.y;for(let t=0;t<n.length;t++){var h=n[t];50===(this.$N(h,e+h.ht.x,i+h.ht.y),this.vi)?i+=h.kt.height+this.Ts.height:e+=h.kt.width+this.Ts.width}}}$N(t,e,i){if(null!==t){Yt,Xt.s(t,et,tt,"assignAbsolutePositions:v"),t.x=e,t.y=i;var s=t.children,n=s.length;for(let t=0;t<n;t++){var r=s[t];this.$N(r,e+r.X.x,i+r.X.y)}}}commitLayout(){this.qy(),this.commitNodes(),this.HN(),this.isRouting&&this.commitLinks()}commitNodes(){for(var t=this.network.vertexes.iterator;t.next();)t.value.commit();for(t.reset();t.next();){var e=t.value;this.layoutComments(e)}}HN(){if(62===this.layerStyle){var s=this.vN,n=[];let e=null;for(var r=this.network.vertexes.iterator;r.next();){var a=r.value;null===e?e=a.bounds.copy():e.unionRect(a.bounds);let t=n[a.level];t=void 0===t?this.computeLayerSpacing(a):Math.max(t,this.computeLayerSpacing(a)),n[a.level]=t}for(let t=0;t<n.length;t++)void 0===n[t]&&(n[t]=0);let t;t=90===this.angle||270===this.angle?(e.inflate(this.nodeSpacing/2,this.layerSpacing),new U(-this.nodeSpacing/2,-this.layerSpacing/2)):(e.inflate(this.layerSpacing,this.nodeSpacing/2),new U(-this.layerSpacing/2,-this.nodeSpacing/2));var o=[],h=90===this.angle||270===this.angle?e.width:e.height;let i=0;if(180===this.angle||270===this.angle)for(let t=0;t<s.length;t++)i+=s[t]+n[t];for(let t=0;t<s.length;t++){var l=s[t]+n[t];270===this.angle?(i-=l,o.push(new Z(0,i,h,l))):90===this.angle?(o.push(new Z(0,i,h,l)),i+=l):180===this.angle?(i-=l,o.push(new Z(i,0,l,h))):(o.push(new Z(i,0,l,h)),i+=l)}this.commitLayers(o,t)}}commitLayers(t,e){}commitLinks(){for(var t=this.network.edges.iterator;t.next();)t.value.commit()}qy(){for(var t=this.Vi.iterator;t.next();){var e=t.value;e instanceof et&&this.CD(e)}}CD(t){if(null!==t){Yt,Xt.s(t,et,tt,"setPortSpotsTree:v"),this.setPortSpots(t);var e=t.children,i=e.length;for(let t=0;t<i;t++){var s=e[t];this.CD(s)}}}setPortSpots(t){Yt,Xt.s(t,et,tt,"setPortSpots:v");var e=t.alignment;if(this.isBusAlignment(e))this.J3(t,e);else{var i=this.orthoAngle(t);if(1===this.ms)for(var s=t.destinationEdges;s.next();){var n=s.value.link;if(null!==n){if(t.setsPortSpot)if(t.portSpot.isDefault())switch(i){case 0:n.fromSpot=J.MiddleRight;break;case 90:n.fromSpot=J.MiddleBottom;break;case 180:n.fromSpot=J.MiddleLeft;break;default:n.fromSpot=J.MiddleTop}else n.fromSpot=t.portSpot;if(t.setsChildPortSpot)if(t.childPortSpot.isDefault())switch(i){case 0:n.toSpot=J.MiddleLeft;break;case 90:n.toSpot=J.MiddleTop;break;case 180:n.toSpot=J.MiddleRight;break;default:n.toSpot=J.MiddleBottom}else n.toSpot=t.childPortSpot}}else for(var r=t.sourceEdges;r.next();){var a=r.value.link;if(null!==a){if(t.setsPortSpot)if(t.portSpot.isDefault())switch(i){case 0:a.toSpot=J.MiddleRight;break;case 90:a.toSpot=J.MiddleBottom;break;case 180:a.toSpot=J.MiddleLeft;break;default:a.toSpot=J.MiddleTop}else a.toSpot=t.portSpot;if(t.setsChildPortSpot)if(t.childPortSpot.isDefault())switch(i){case 0:a.fromSpot=J.MiddleLeft;break;case 90:a.fromSpot=J.MiddleTop;break;case 180:a.fromSpot=J.MiddleRight;break;default:a.fromSpot=J.MiddleBottom}else a.fromSpot=t.childPortSpot}}}}J3(i,t){Yt,Xt.s(i,et,tt,"setPortSpotsBus:v"),Yt,Xt.it(t,Fi,"TreeAlignment");var s=1===this.ms,n=this.orthoAngle(i);let r;switch(n){case 0:r=J.MiddleRight;break;case 90:r=J.MiddleBottom;break;case 180:r=J.MiddleLeft;break;default:r=J.MiddleTop}var a=i.children,o=a.length;switch(t){case 24:case 25:for(let e=0;e<o;e++){var h=a[e],h=(s?h.sourceEdges:h.destinationEdges).first();if(null!==h){h=h.link;if(null!==h){let t=90===n||270===n?J.MiddleLeft:J.MiddleTop;if(1===o||e===o-1&&o%2==1)switch(n){case 0:t=J.MiddleLeft;break;case 90:t=J.MiddleTop;break;case 180:t=J.MiddleRight;break;default:t=J.MiddleBottom}else e%2==0&&(t=90===n||270===n?J.MiddleRight:J.MiddleBottom);s?(i.setsPortSpot&&(h.fromSpot=r),i.setsChildPortSpot&&(h.toSpot=t)):(i.setsPortSpot&&(h.fromSpot=t),i.setsChildPortSpot&&(h.toSpot=r))}}}break;case 26:for(var e=90===n||270===n?J.MiddleRight:J.MiddleBottom,l=s?i.destinationEdges:i.sourceEdges;l.next();){var u=l.value.link;null!==u&&(s?(i.setsPortSpot&&(u.fromSpot=r),i.setsChildPortSpot&&(u.toSpot=e)):(i.setsPortSpot&&(u.fromSpot=e),i.setsChildPortSpot&&(u.toSpot=r)))}break;case 27:for(var d=90===n||270===n?J.MiddleLeft:J.MiddleTop,c=s?i.destinationEdges:i.sourceEdges;c.next();){var g=c.value.link;null!==g&&(s?(i.setsPortSpot&&(g.fromSpot=r),i.setsChildPortSpot&&(g.toSpot=d)):(i.setsPortSpot&&(g.fromSpot=d),i.setsChildPortSpot&&(g.toSpot=r)))}}}orthoAngle(t){t=t.angle;return t<=45?0:t<=135?90:t<=225?180:t<=315?270:0}computeLayerSpacing(t){Yt,Xt.s(t,et,tt,"computeLayerSpacing:v");var e,i=this.orthoAngle(t),i=90===i||270===i;let s=t.layerSpacing;return 0<t.layerSpacingParentOverlap&&(e=Math.min(1,t.layerSpacingParentOverlap),s-=i?t.height*e:t.width*e),s=s<(i?-t.height:-t.width)?i?-t.height:-t.width:s}computeNodeIndent(t){Yt,Xt.s(t,et,tt,"computeNodeIndent:v");var e,i=this.orthoAngle(t),i=90===i||270===i;let s=t.nodeIndent;return 0<t.nodeIndentPastParent&&(e=Math.min(1,t.nodeIndentPastParent),s+=i?t.width*e:t.height*e),s=Math.max(0,s)}get roots(){return this.Vi}set roots(t){this.Vi!==t&&(Xt.s(t,C,tt,"roots"),this.Vi=t,this.invalidateLayout())}get path(){return this.Oi}set path(t){this.Oi!==t&&(Xt.it(t,Bi,"TreePath"),this.Oi=t,this.invalidateLayout())}get treeStyle(){return this.su}set treeStyle(t){this.su!==t&&(Xt.it(t,Oi,"TreeStyle"),40===t||42===t||41===t||43===t)&&(this.su=t,this.invalidateLayout())}get layerStyle(){return this.Xg}set layerStyle(t){this.Xg!==t&&(Xt.it(t,Hi,"TreeLayerStyle"),60===t||61===t||62===t)&&(this.Xg=t,this.invalidateLayout())}get comments(){return this.Ye}set comments(t){this.Ye!==t&&(Xt.t(t,"boolean",tt,"comments"),this.Ye=t,this.invalidateLayout())}get arrangement(){return this.vi}set arrangement(t){this.vi!==t&&(Xt.it(t,Ei,"TreeArrangement"),50===t||51===t||52===t)&&(this.vi=t,this.invalidateLayout())}get arrangementSpacing(){return this.Ts}set arrangementSpacing(t){Xt.s(t,qt,tt,"arrangementSpacing"),this.Ts.equals(t)||(this.Ts.c(t),this.invalidateLayout())}get rootDefaults(){return this.K}set rootDefaults(t){this.K!==t&&(Xt.s(t,et,tt,"rootDefaults"),this.K=t,this.invalidateLayout())}get alternateDefaults(){return this.U}set alternateDefaults(t){this.U!==t&&(Xt.s(t,et,tt,"alternateDefaults"),this.U=t,this.invalidateLayout())}get sorting(){return this.K.sorting}set sorting(t){this.K.sorting!==t&&(Xt.it(t,Gi,"TreeSorting"),this.K.sorting=t,this.invalidateLayout())}get comparer(){return this.K.comparer}set comparer(t){this.K.comparer!==t&&(Xt.t(t,"function",tt,"comparer"),this.K.comparer=t,this.invalidateLayout())}get angle(){return this.K.angle}set angle(t){this.K.angle!==t&&(Xt.t(t,"number",tt,"angle"),0===t||90===t||180===t||270===t?(this.K.angle=t,this.invalidateLayout()):Xt.n("TreeLayout.angle must be 0, 90, 180, or 270"))}get alignment(){return this.K.alignment}set alignment(t){this.K.alignment!==t&&(Xt.it(t,Fi,"TreeAlignment"),this.K.alignment=t,this.invalidateLayout())}get nodeIndent(){return this.K.nodeIndent}set nodeIndent(t){this.K.nodeIndent!==t&&(Xt.t(t,"number",tt,"nodeIndent"),0<=t)&&(this.K.nodeIndent=t,this.invalidateLayout())}get nodeIndentPastParent(){return this.K.nodeIndentPastParent}set nodeIndentPastParent(t){this.K.nodeIndentPastParent!==t&&(Xt.t(t,"number",tt,"nodeIndentPastParent"),0<=t)&&t<=1&&(this.K.nodeIndentPastParent=t,this.invalidateLayout())}get nodeSpacing(){return this.K.nodeSpacing}set nodeSpacing(t){this.K.nodeSpacing!==t&&(Xt.t(t,"number",tt,"nodeSpacing"),this.K.nodeSpacing=t,this.invalidateLayout())}get layerSpacing(){return this.K.layerSpacing}set layerSpacing(t){this.K.layerSpacing!==t&&(Xt.t(t,"number",tt,"layerSpacing"),this.K.layerSpacing=t,this.invalidateLayout())}get layerSpacingParentOverlap(){return this.K.layerSpacingParentOverlap}set layerSpacingParentOverlap(t){this.K.layerSpacingParentOverlap!==t&&(Xt.t(t,"number",tt,"layerSpacingParentOverlap"),0<=t)&&t<=1&&(this.K.layerSpacingParentOverlap=t,this.invalidateLayout())}get compaction(){return this.K.compaction}set compaction(t){this.K.compaction!==t&&(Xt.it(t,Ri,"TreeCompaction"),30===t||31===t)&&(this.K.compaction=t,this.invalidateLayout())}get breadthLimit(){return this.K.breadthLimit}set breadthLimit(t){this.K.breadthLimit!==t&&(Xt.t(t,"number",tt,"breadthLimit"),0<=t)&&(this.K.breadthLimit=t,this.invalidateLayout())}get rowSpacing(){return this.K.rowSpacing}set rowSpacing(t){this.K.rowSpacing!==t&&(Xt.t(t,"number",tt,"rowSpacing"),this.K.rowSpacing=t,this.invalidateLayout())}get rowIndent(){return this.K.rowIndent}set rowIndent(t){this.K.rowIndent!==t&&(Xt.t(t,"number",tt,"rowIndent"),0<=t)&&(this.K.rowIndent=t,this.invalidateLayout())}get commentSpacing(){return this.K.commentSpacing}set commentSpacing(t){this.K.commentSpacing!==t&&(Xt.t(t,"number",tt,"commentSpacing"),this.K.commentSpacing=t,this.invalidateLayout())}get commentMargin(){return this.K.commentMargin}set commentMargin(t){this.K.commentMargin!==t&&(Xt.t(t,"number",tt,"commentMargin"),this.K.commentMargin=t,this.invalidateLayout())}get setsPortSpot(){return this.K.setsPortSpot}set setsPortSpot(t){this.K.setsPortSpot!==t&&(Xt.t(t,"boolean",tt,"setsPortSpot"),this.K.setsPortSpot=t,this.invalidateLayout())}get portSpot(){return this.K.portSpot}set portSpot(t){Xt.s(t,J,tt,"portSpot"),this.K.portSpot.equals(t)||(this.K.portSpot=t,this.invalidateLayout())}get setsChildPortSpot(){return this.K.setsChildPortSpot}set setsChildPortSpot(t){this.K.setsChildPortSpot!==t&&(Xt.t(t,"boolean",tt,"setsChildPortSpot"),this.K.setsChildPortSpot=t,this.invalidateLayout())}get childPortSpot(){return this.K.childPortSpot}set childPortSpot(t){Xt.s(t,J,tt,"childPortSpot"),this.K.childPortSpot.equals(t)||(this.K.childPortSpot=t,this.invalidateLayout())}get alternateSorting(){return this.U.sorting}set alternateSorting(t){this.U.sorting!==t&&(Xt.it(t,Gi,"TreeSorting"),this.U.sorting=t,this.invalidateLayout())}get alternateComparer(){return this.U.comparer}set alternateComparer(t){this.U.comparer!==t&&(Xt.t(t,"function",tt,"alternateComparer"),this.U.comparer=t,this.invalidateLayout())}get alternateAngle(){return this.U.angle}set alternateAngle(t){this.U.angle!==t&&(Xt.t(t,"number",tt,"alternateAngle"),0===t||90===t||180===t||270===t)&&(this.U.angle=t,this.invalidateLayout())}get alternateAlignment(){return this.U.alignment}set alternateAlignment(t){this.U.alignment!==t&&(Xt.it(t,Fi,"TreeAlignment"),this.U.alignment=t,this.invalidateLayout())}get alternateNodeIndent(){return this.U.nodeIndent}set alternateNodeIndent(t){this.U.nodeIndent!==t&&(Xt.t(t,"number",tt,"alternateNodeIndent"),0<=t)&&(this.U.nodeIndent=t,this.invalidateLayout())}get alternateNodeIndentPastParent(){return this.U.nodeIndentPastParent}set alternateNodeIndentPastParent(t){this.U.nodeIndentPastParent!==t&&(Xt.t(t,"number",tt,"alternateNodeIndentPastParent"),0<=t)&&t<=1&&(this.U.nodeIndentPastParent=t,this.invalidateLayout())}get alternateNodeSpacing(){return this.U.nodeSpacing}set alternateNodeSpacing(t){this.U.nodeSpacing!==t&&(Xt.t(t,"number",tt,"alternateNodeSpacing"),this.U.nodeSpacing=t,this.invalidateLayout())}get alternateLayerSpacing(){return this.U.layerSpacing}set alternateLayerSpacing(t){this.U.layerSpacing!==t&&(Xt.t(t,"number",tt,"alternateLayerSpacing"),this.U.layerSpacing=t,this.invalidateLayout())}get alternateLayerSpacingParentOverlap(){return this.U.layerSpacingParentOverlap}set alternateLayerSpacingParentOverlap(t){this.U.layerSpacingParentOverlap!==t&&(Xt.t(t,"number",tt,"alternateLayerSpacingParentOverlap"),0<=t)&&t<=1&&(this.U.layerSpacingParentOverlap=t,this.invalidateLayout())}get alternateCompaction(){return this.U.compaction}set alternateCompaction(t){this.U.compaction!==t&&(Xt.it(t,Ri,"TreeCompaction"),30===t||31===t)&&(this.U.compaction=t,this.invalidateLayout())}get alternateBreadthLimit(){return this.U.breadthLimit}set alternateBreadthLimit(t){this.U.breadthLimit!==t&&(Xt.t(t,"number",tt,"alternateBreadthLimit"),0<=t)&&(this.U.breadthLimit=t,this.invalidateLayout())}get alternateRowSpacing(){return this.U.rowSpacing}set alternateRowSpacing(t){this.U.rowSpacing!==t&&(Xt.t(t,"number",tt,"alternateRowSpacing"),this.U.rowSpacing=t,this.invalidateLayout())}get alternateRowIndent(){return this.U.rowIndent}set alternateRowIndent(t){this.U.rowIndent!==t&&(Xt.t(t,"number",tt,"alternateRowIndent"),0<=t)&&(this.U.rowIndent=t,this.invalidateLayout())}get alternateCommentSpacing(){return this.U.commentSpacing}set alternateCommentSpacing(t){this.U.commentSpacing!==t&&(Xt.t(t,"number",tt,"alternateCommentSpacing"),this.U.commentSpacing=t,this.invalidateLayout())}get alternateCommentMargin(){return this.U.commentMargin}set alternateCommentMargin(t){this.U.commentMargin!==t&&(Xt.t(t,"number",tt,"alternateCommentMargin"),this.U.commentMargin=t,this.invalidateLayout())}get alternateSetsPortSpot(){return this.U.setsPortSpot}set alternateSetsPortSpot(t){this.U.setsPortSpot!==t&&(Xt.t(t,"boolean",tt,"alternateSetsPortSpot"),this.U.setsPortSpot=t,this.invalidateLayout())}get alternatePortSpot(){return this.U.portSpot}set alternatePortSpot(t){Xt.s(t,J,tt,"alternatePortSpot"),this.U.portSpot.equals(t)||(this.U.portSpot=t,this.invalidateLayout())}get alternateSetsChildPortSpot(){return this.U.setsChildPortSpot}set alternateSetsChildPortSpot(t){this.U.setsChildPortSpot!==t&&(Xt.t(t,"boolean",tt,"alternateSetsChildPortSpot"),this.U.setsChildPortSpot=t,this.invalidateLayout())}get alternateChildPortSpot(){return this.U.childPortSpot}set alternateChildPortSpot(t){Xt.s(t,J,tt,"alternateChildPortSpot"),this.U.childPortSpot.equals(t)||(this.U.childPortSpot=t,this.invalidateLayout())}static PathDefault=0;static PathDestination=1;static PathSource=2;static SortingForwards=10;static SortingReverse=11;static SortingAscending=12;static SortingDescending=13;static AlignmentCenterSubtrees=20;static AlignmentCenterChildren=21;static AlignmentStart=22;static AlignmentEnd=23;static AlignmentBus=24;static AlignmentBusBranching=25;static AlignmentTopLeftBus=26;static AlignmentBottomRightBus=27;static CompactionNone=30;static CompactionBlock=31;static StyleLayered=40;static StyleLastParents=41;static StyleAlternating=42;static StyleRootOnly=43;static ArrangementVertical=50;static ArrangementHorizontal=51;static ArrangementFixedRoots=52;static LayerIndividual=60;static LayerSiblings=61;static LayerUniform=62}class Ii extends Ue{constructor(t){super(t)}createVertex(){return new et(this)}createEdge(){return new Ki(this)}}class et extends We{X;kt;ht;kk;Sk;Mk;Pk;Nk;Ck;Ak;Ye;AD;nu;ou;Yg;Kg;Pe;Ne;qt;fi;ew;sw;nw;Ds;ow;rw;lw;hw;aw;fw;cw;uw;dw;gw;mw;constructor(t){super(t),this.kk=!1,this.Sk=null,this.Mk=[],this.Pk=0,this.Nk=0,this.Ck=0,this.Ak=0,this.Ye=null,this.X=new U(0,0),this.kt=new qt(0,0),this.ht=new U(0,0),this.AD=!1,this.nu=!1,this.ou=!1,this.Yg=null,this.Kg=null,this.Pe=10,this.Ne=We.standardComparer,this.qt=0,this.fi=21,this.ew=0,this.sw=0,this.nw=20,this.Ds=50,this.ow=0,this.rw=31,this.lw=0,this.hw=25,this.aw=10,this.fw=10,this.cw=20,this.uw=!0,this.dw=J.Default,this.gw=!0,this.mw=J.Default}copyInheritedPropertiesFrom(t){null!==t&&(this.Pe=t.sorting,this.Ne=t.comparer,this.qt=t.angle,this.fi=t.alignment,this.ew=t.nodeIndent,this.sw=t.nodeIndentPastParent,this.nw=t.nodeSpacing,this.Ds=t.layerSpacing,this.ow=t.layerSpacingParentOverlap,this.rw=t.compaction,this.lw=t.breadthLimit,this.hw=t.rowSpacing,this.aw=t.rowIndent,this.fw=t.commentSpacing,this.cw=t.commentMargin,this.uw=t.setsPortSpot,this.dw=t.portSpot,this.gw=t.setsChildPortSpot,this.mw=t.childPortSpot)}get initialized(){return this.kk}set initialized(t){this.kk!==t&&(Xt.t(t,"boolean",et,"initialized"),this.kk=t)}get parent(){return this.Sk}set parent(t){this.Sk!==t&&(Yt,null!==t&&Xt.s(t,et,et,"parent"),this.Sk=t)}get children(){return this.Mk}set children(e){if(this.Mk!==e){if(null===e||Array.isArray(e)||Xt.Bi(e,"Array",et,"children:value"),null!==e){var i=e.length;for(let t=0;t<i;t++){var s=e[t];Yt,Xt.s(s,et,et,"children")}}this.Mk=e}}get level(){return this.Pk}set level(t){this.Pk!==t&&(Xt.t(t,"number",et,"level"),this.Pk=t)}get descendantCount(){return this.Nk}set descendantCount(t){this.Nk!==t&&(Xt.t(t,"number",et,"descendantCount"),this.Nk=t)}get maxChildrenCount(){return this.Ck}set maxChildrenCount(t){this.Ck!==t&&(Xt.t(t,"number",et,"maxChildrenCount"),this.Ck=t)}get maxGenerationCount(){return this.Ak}set maxGenerationCount(t){this.Ak!==t&&(Xt.t(t,"number",et,"maxGenerationCount"),this.Ak=t)}get comments(){return this.Ye}set comments(e){if(this.Ye!==e){if(null===e||Array.isArray(e)||Xt.Bi(e,"Array",et,"comments:value"),null!==e){var i=e.length;for(let t=0;t<i;t++){var s=e[t];Yt,Xt.s(s,D,et,"comments")}}this.Ye=e}}get sorting(){return this.Pe}set sorting(t){this.Pe!==t&&(Xt.it(t,Gi,"TreeSorting"),this.Pe=t)}get comparer(){return this.Ne}set comparer(t){this.Ne!==t&&(Xt.t(t,"function",et,"comparer"),this.Ne=t)}get angle(){return this.qt}set angle(t){this.qt!==t&&(Xt.t(t,"number",et,"angle"),this.qt=t)}get alignment(){return this.fi}set alignment(t){this.fi!==t&&(Xt.it(t,Fi,"TreeAlignment"),this.fi=t)}get nodeIndent(){return this.ew}set nodeIndent(t){this.ew!==t&&(Xt.t(t,"number",et,"nodeIndent"),this.ew=t)}get nodeIndentPastParent(){return this.sw}set nodeIndentPastParent(t){this.sw!==t&&(Xt.t(t,"number",et,"nodeIndentPastParent"),this.sw=t)}get nodeSpacing(){return this.nw}set nodeSpacing(t){this.nw!==t&&(Xt.t(t,"number",et,"nodeSpacing"),this.nw=t)}get layerSpacing(){return this.Ds}set layerSpacing(t){this.Ds!==t&&(Xt.t(t,"number",et,"layerSpacing"),this.Ds=t)}get layerSpacingParentOverlap(){return this.ow}set layerSpacingParentOverlap(t){this.ow!==t&&(Xt.t(t,"number",et,"layerSpacingParentOverlap"),this.ow=t)}get compaction(){return this.rw}set compaction(t){this.rw!==t&&(Xt.it(t,Ri,"TreeCompaction"),this.rw=t)}get breadthLimit(){return this.lw}set breadthLimit(t){this.lw!==t&&(Xt.t(t,"number",et,"breadthLimit"),this.lw=t)}get rowSpacing(){return this.hw}set rowSpacing(t){this.hw!==t&&(Xt.t(t,"number",et,"rowSpacing"),this.hw=t)}get rowIndent(){return this.aw}set rowIndent(t){this.aw!==t&&(Xt.t(t,"number",et,"rowIndent"),this.aw=t)}get commentSpacing(){return this.fw}set commentSpacing(t){this.fw!==t&&(Xt.t(t,"number",et,"commentSpacing"),this.fw=t)}get commentMargin(){return this.cw}set commentMargin(t){this.cw!==t&&(Xt.t(t,"number",et,"commentMargin"),this.cw=t)}get setsPortSpot(){return this.uw}set setsPortSpot(t){this.uw!==t&&(Xt.t(t,"boolean",et,"setsPortSpot"),this.uw=t)}get portSpot(){return this.dw}set portSpot(t){Xt.s(t,J,et,"portSpot"),this.dw.equals(t)||(this.dw=t)}get setsChildPortSpot(){return this.gw}set setsChildPortSpot(t){this.gw!==t&&(Xt.t(t,"boolean",et,"setsChildPortSpot"),this.gw=t)}get childPortSpot(){return this.mw}set childPortSpot(t){Xt.s(t,J,et,"childPortSpot"),this.mw.equals(t)||(this.mw=t)}get childrenCount(){return this.children.length}get relativePosition(){return this.X}set relativePosition(t){this.X.set(t)}get subtreeSize(){return this.kt}set subtreeSize(t){this.kt.set(t)}get subtreeOffset(){return this.ht}set subtreeOffset(t){this.ht.set(t)}}class Ki extends Ze{Lk;constructor(t){super(t),this.Lk=new U(0,0)}commit(){var r=this.link;if(null!==r&&!r.isAvoiding){var a=this.network.layout;let n=null,t=null;switch(a.ms){case 1:n=this.fromVertex,t=this.toVertex;break;case 2:n=this.toVertex,t=this.fromVertex;break;default:Xt.n("Unhandled path value "+a.ms.toString())}if(null!==n&&null!==t){var o=this.Lk;if(0!==o.x||0!==o.y||n.AD){var h=n.bounds,l=a.orthoAngle(n),u=a.computeLayerSpacing(n),d=n.rowSpacing,c=(r.updateRoute(),9===r.curve),g=r.isOrthogonal;let t=0,e,i;if(r.startRoute(),g||c){for(t=2;4<r.pointsCount;)r.removePoint(2);e=r.getPoint(1),i=r.getPoint(2)}else{for(t=1;3<r.pointsCount;)r.removePoint(1);e=r.getPoint(0),i=r.getPoint(r.pointsCount-1)}var m=r.getPoint(r.pointsCount-1);let s=0;0===l?(23===n.alignment?(s=h.bottom+o.y,0===o.y&&e.y>m.y+n.rowIndent&&(s=Math.min(s,Math.max(e.y,s-a.computeNodeIndent(n))))):22===n.alignment?(s=h.top+o.y,0===o.y&&e.y<m.y-n.rowIndent&&(s=Math.max(s,Math.min(e.y,s+a.computeNodeIndent(n))))):s=n.nu||n.ou&&1===n.maxGenerationCount?h.top-n.ht.y+o.y:h.y+h.height/2+o.y,c?(r.insertPointAt(t,e.x,s),t++,r.insertPointAt(t,h.right+u,s),t++,r.insertPointAt(t,h.right+u+(o.x-d)/3,s),t++,r.insertPointAt(t,h.right+u+2*(o.x-d)/3,s),t++,r.insertPointAt(t,h.right+u+(o.x-d),s),t++,r.insertPointAt(t,i.x,s),t++):(g&&(r.insertPointAt(t,h.right+u/2,e.y),t++),r.insertPointAt(t,h.right+u/2,s),t++,r.insertPointAt(t,h.right+u+o.x-(g?d/2:d),s),t++,g&&(r.insertPointAt(t,r.getPoint(t-1).x,i.y),t++))):90===l?(23===n.alignment?(s=h.right+o.x,0===o.x&&e.x>m.x+n.rowIndent&&(s=Math.min(s,Math.max(e.x,s-a.computeNodeIndent(n))))):22===n.alignment?(s=h.left+o.x,0===o.x&&e.x<m.x-n.rowIndent&&(s=Math.max(s,Math.min(e.x,s+a.computeNodeIndent(n))))):s=n.nu||n.ou&&1===n.maxGenerationCount?h.left-n.ht.x+o.x:h.x+h.width/2+o.x,c?(r.insertPointAt(t,s,e.y),t++,r.insertPointAt(t,s,h.bottom+u),t++,r.insertPointAt(t,s,h.bottom+u+(o.y-d)/3),t++,r.insertPointAt(t,s,h.bottom+u+2*(o.y-d)/3),t++,r.insertPointAt(t,s,h.bottom+u+(o.y-d)),t++,r.insertPointAt(t,s,i.y),t++):(g&&(r.insertPointAt(t,e.x,h.bottom+u/2),t++),r.insertPointAt(t,s,h.bottom+u/2),t++,r.insertPointAt(t,s,h.bottom+u+o.y-(g?d/2:d)),t++,g&&(r.insertPointAt(t,i.x,r.getPoint(t-1).y),t++))):180===l?(23===n.alignment?(s=h.bottom+o.y,0===o.y&&e.y>m.y+n.rowIndent&&(s=Math.min(s,Math.max(e.y,s-a.computeNodeIndent(n))))):22===n.alignment?(s=h.top+o.y,0===o.y&&e.y<m.y-n.rowIndent&&(s=Math.max(s,Math.min(e.y,s+a.computeNodeIndent(n))))):s=n.nu||n.ou&&1===n.maxGenerationCount?h.top-n.ht.y+o.y:h.y+h.height/2+o.y,c?(r.insertPointAt(t,e.x,s),t++,r.insertPointAt(t,h.left-u,s),t++,r.insertPointAt(t,h.left-u+(o.x+d)/3,s),t++,r.insertPointAt(t,h.left-u+2*(o.x+d)/3,s),t++,r.insertPointAt(t,h.left-u+(o.x+d),s),t++,r.insertPointAt(t,i.x,s),t++):(g&&(r.insertPointAt(t,h.left-u/2,e.y),t++),r.insertPointAt(t,h.left-u/2,s),t++,r.insertPointAt(t,h.left-u+o.x+(g?d/2:d),s),t++,g&&(r.insertPointAt(t,r.getPoint(t-1).x,i.y),t++))):270===l?(23===n.alignment?(s=h.right+o.x,0===o.x&&e.x>m.x+n.rowIndent&&(s=Math.min(s,Math.max(e.x,s-a.computeNodeIndent(n))))):22===n.alignment?(s=h.left+o.x,0===o.x&&e.x<m.x-n.rowIndent&&(s=Math.max(s,Math.min(e.x,s+a.computeNodeIndent(n))))):s=n.nu||n.ou&&1===n.maxGenerationCount?h.left-n.ht.x+o.x:h.x+h.width/2+o.x,c?(r.insertPointAt(t,s,e.y),t++,r.insertPointAt(t,s,h.top-u),t++,r.insertPointAt(t,s,h.top-u+(o.y+d)/3),t++,r.insertPointAt(t,s,h.top-u+2*(o.y+d)/3),t++,r.insertPointAt(t,s,h.top-u+(o.y+d)),t++,r.insertPointAt(t,s,i.y),t++):(g&&(r.insertPointAt(t,e.x,h.top-u/2),t++),r.insertPointAt(t,s,h.top-u/2),t++,r.insertPointAt(t,s,h.top-u+o.y+(g?d/2:d)),t++,g&&(r.insertPointAt(t,i.x,r.getPoint(t-1).y),t++))):Xt.n("Invalid angle "+l),r.commitRoute()}else this.Z3(n,t)}}}Z3(t,e){Yt,Xt.s(t,et,Ki,"adjustRouteForAngleChange:parent"),Yt,Xt.s(e,et,Ki,"adjustRouteForAngleChange:child");var i,s,n,r,a=this.link,o=this.network.layout,h=o.orthoAngle(t);h===o.orthoAngle(e)||(i=o.computeLayerSpacing(t),t=t.bounds,e=e.bounds,0===h&&e.left-t.right<i+1)||90===h&&e.top-t.bottom<i+1||180===h&&t.left-e.right<i+1||270===h&&t.top-e.bottom<i+1||(a.updateRoute(),e=9===a.curve,s=a.isOrthogonal,r=this.fromVertex,o=o.isBusAlignment(r.alignment),a.startRoute(),0===h?(r=t.right+i/2,e?4===a.pointsCount&&(n=a.getPoint(3).y,a.setPointAt(1,r-20,a.getPoint(1).y),a.insertPointAt(2,r-20,n),a.insertPointAt(3,r,n),a.insertPointAt(4,r+20,n),a.setPointAt(5,a.getPoint(5).x,n)):s?o?a.setPointAt(3,a.getPoint(2).x,a.getPoint(4).y):6===a.pointsCount&&(a.setPointAt(2,r,a.getPoint(2).y),a.setPointAt(3,r,a.getPoint(3).y)):4===a.pointsCount?a.insertPointAt(2,r,a.getPoint(2).y):3===a.pointsCount?a.setPointAt(1,r,a.getPoint(2).y):2===a.pointsCount&&a.insertPointAt(1,r,a.getPoint(1).y)):90===h?(n=t.bottom+i/2,e?4===a.pointsCount&&(r=a.getPoint(3).x,a.setPointAt(1,a.getPoint(1).x,n-20),a.insertPointAt(2,r,n-20),a.insertPointAt(3,r,n),a.insertPointAt(4,r,n+20),a.setPointAt(5,r,a.getPoint(5).y)):s?o?a.setPointAt(3,a.getPoint(2).x,a.getPoint(4).y):6===a.pointsCount&&(a.setPointAt(2,a.getPoint(2).x,n),a.setPointAt(3,a.getPoint(3).x,n)):4===a.pointsCount?a.insertPointAt(2,a.getPoint(2).x,n):3===a.pointsCount?a.setPointAt(1,a.getPoint(2).x,n):2===a.pointsCount&&a.insertPointAt(1,a.getPoint(1).x,n)):180===h?(r=t.left-i/2,e?4===a.pointsCount&&(n=a.getPoint(3).y,a.setPointAt(1,20+r,a.getPoint(1).y),a.insertPointAt(2,20+r,n),a.insertPointAt(3,r,n),a.insertPointAt(4,r-20,n),a.setPointAt(5,a.getPoint(5).x,n)):s?o?a.setPointAt(3,a.getPoint(2).x,a.getPoint(4).y):6===a.pointsCount&&(a.setPointAt(2,r,a.getPoint(2).y),a.setPointAt(3,r,a.getPoint(3).y)):4===a.pointsCount?a.insertPointAt(2,r,a.getPoint(2).y):3===a.pointsCount?a.setPointAt(1,r,a.getPoint(2).y):2===a.pointsCount&&a.insertPointAt(1,r,a.getPoint(1).y)):270===h&&(n=t.top-i/2,e?4===a.pointsCount&&(r=a.getPoint(3).x,a.setPointAt(1,a.getPoint(1).x,20+n),a.insertPointAt(2,r,20+n),a.insertPointAt(3,r,n),a.insertPointAt(4,r,n-20),a.setPointAt(5,r,a.getPoint(5).y)):s?o?a.setPointAt(3,a.getPoint(2).x,a.getPoint(4).y):6===a.pointsCount&&(a.setPointAt(2,a.getPoint(2).x,n),a.setPointAt(3,a.getPoint(3).x,n)):4===a.pointsCount?a.insertPointAt(2,a.getPoint(2).x,n):3===a.pointsCount?a.setPointAt(1,a.getPoint(2).x,n):2===a.pointsCount&&a.insertPointAt(1,a.getPoint(1).x,n)),a.commitRoute())}get fromVertex(){return this.is}set fromVertex(t){this.is!==t&&(Yt,null!==t&&Xt.s(t,et,Ki,"fromVertex"),this.is=t)}get toVertex(){return this.es}set toVertex(t){this.es!==t&&(Yt,null!==t&&Xt.s(t,et,Ki,"toVertex"),this.es=t)}get relativePoint(){return this.Lk}set relativePoint(t){this.Lk.set(t)}}class Vi{constructor(){}static Light={colors:{text:"#0a0a0a",comment:"#ca8a04",link:"#0a0a0a",group:"#a3a3a344",outline:"#a3a3a3",selection:"#0ea5e9",div:"#fff",gridMinor:"#e5e5e5",gridMajor:"#a3a3a3",overviewBox:"#c026d3",tempLink:"#2563eb",tempPort:"#c026d3",adornmentFill:"#0ea5e9",adornmentStroke:"#1e40af",dragSelect:"#c026d3"},fonts:{normal:"10pt sans-serif",bold:"bold 12pt sans-serif"},numbers:{group:1,selection:3},margins:{group:new E(5)},arrowheads:{toArrow:"Standard"}};static Dark={colors:{text:"#f5f5f5",comment:"#facc15",link:"#f5f5f5",group:"#a3a3a388",outline:"#a3a3a3",selection:"#38bdf8",div:"#171717",gridMinor:"#262626",gridMajor:"#404040",overviewBox:"#e879f9",tempLink:"#60a5fa",tempPort:"#e879f9",adornmentFill:"#38bdf8",adornmentStroke:"#2563eb",dragSelect:"#e879f9"},fonts:{normal:"10pt sans-serif",bold:"bold 12pt sans-serif"},numbers:{group:1,selection:3},margins:{group:new E(5)},arrowheads:{toArrow:"Standard"}}}class zi{as=new Set;lu=new L;Tk="light";Dk="light";Fk=!1;Ug="light";LD=t=>{t=t.matches?"dark":"light";t!==this.Ug&&(this.Ug=t,"system"===this.Dk)&&this.pw()};constructor(t){t&&Object.assign(this,t),t?.themeMap||(this.lu.set("light",{colors:{...Vi.Light.colors},fonts:{...Vi.Light.fonts},numbers:{...Vi.Light.numbers},margins:{...Vi.Light.margins},arrowheads:{...Vi.Light.arrowheads}}),this.lu.set("dark",{colors:{...Vi.Dark.colors},fonts:{...Vi.Dark.fonts},numbers:{...Vi.Dark.numbers},margins:{...Vi.Dark.margins},arrowheads:{...Vi.Dark.arrowheads}})),v.matchMedia&&(this.Ug=v.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")}get themeMap(){return this.lu}set themeMap(t){this.lu!==t&&(this.lu=t,this.pw())}get defaultTheme(){return this.Tk}set defaultTheme(t){this.Tk!==t&&(Xt.t(t,"string",zi,"defaultTheme"),this.Tk=t,this.pw())}get currentTheme(){return this.Dk}set currentTheme(t){this.Dk!==t&&(Xt.t(t,"string",zi,"currentTheme"),this.Dk=t,this.pw())}get changesDivBackground(){return this.Fk}set changesDivBackground(t){if(this.Fk!==t&&(this.Fk=t))for(const e of this.as)e.setDivBackground(this.findValue("div","","fill")),e.V("ThemeChanged",this)}get preferredColorScheme(){return this.Ug}addDiagram(t){return this.as.add(t),this.QN(t),this}removeDiagram(t){return this.as.delete(t),this.QN(t),this}qF(){0===this.as.size&&v.matchMedia&&v.matchMedia("(prefers-color-scheme: dark)")?.addEventListener("change",this.LD)}WF(){0===this.as.size&&v.matchMedia&&v.matchMedia("(prefers-color-scheme: dark)")?.removeEventListener("change",this.LD)}set(t,e){"system"===(t=""===t?this.Tk:t)&&(t=this.Ug);let i=this.lu.get(t);return i=i?this.TD(i,e):e,this.lu.set(t,i),this.pw(),this}findValue(t,e,i){return this.getValue(this.findTheme(this.currentTheme),t,e,i)||this.getValue(this.findTheme(this.defaultTheme),t,e,i)}getValue(t,e,i,n){if(t){null==i&&(i="");let s=t;const a=t=>{if(void 0!==s&&""!==t){if("number"==typeof t||!Array.isArray(t)&&!t.includes("."))return s[t];var e=Array.isArray(t)?t:t.split(".");for(let t=0;t<e.length;t++){var i=e[t];if(""!==i&&void 0===(s=s[i]))return}return s}},o=()=>{if(""===i||void 0!==(s=a(i)))return s=Array.isArray(s)&&"number"==typeof e?s[e%s.length]:a(e)};if(void 0===(s=o())&&"string"==typeof n&&0<n.length){var r=t.targetPropertyMap?.get(n);if(s=r||(r=zi.$3.get(n))?t[r]:t.colors,void 0!==(s=o()));}return s}}findTheme(t){return this.themeMap.get("system"===t?this.Ug:t)}QN(t){var e=t.skipsUndoManager;t.skipsUndoManager=!0,t.updateAllThemeBindings(),this.Fk&&t.setDivBackground(this.findValue("div","","fill")),t.skipsUndoManager=e,t.V("ThemeChanged",this)}pw(){for(const t of this.as)this.QN(t)}TD(t,e){for(const i in e)if(Xt.yw(e,i))try{e[i].constructor===Object?t[i]=this.TD(t[i]??{},e[i]):t[i]=e[i]}catch{delete t[i]}return t}static $3=new Map([["background","colors"],["defaultColumnSeparatorStroke","colors"],["defaultRowSeparatorStroke","colors"],["shadowColor","colors"],["fill","colors"],["stroke","colors"],["font","fonts"],["angle","numbers"],["fromEndSegmentLength","numbers"],["fromShortLength","numbers"],["height","numbers"],["opacity","numbers"],["scale","numbers"],["toEndSegmentLength","numbers"],["toShortLength","numbers"],["width","numbers"],["defaultColumnSeparatorStrokeWidth","numbers"],["defaultRowSeparatorStrokeWidth","numbers"],["shadowBlur","numbers"],["corner","numbers"],["curviness","numbers"],["smoothness","numbers"],["parameter1","numbers"],["parameter2","numbers"],["strokeWidth","numbers"],["strokeDashOffset","numbers"],["maxLines","numbers"],["spacingAbove","numbers"],["spacingBelow","numbers"],["position","points"],["shadowOffset","points"],["desiredSize","sizes"],["maxSize","sizes"],["minSize","sizes"],["margin","margins"],["defaultSeparatorPadding","margins"],["padding","margins"],["alignment","spots"],["alignmentFocus","spots"],["fromSpot","spots"],["toSpot","spots"],["defaultAlignment","spots"],["spot1","spots"],["spot2","spots"],["verticalAlignment","spots"],["imageAlignment","spots"],["fromArrow","arrowheads"],["toArrow","arrowheads"]])}class Yi{Tt;b;Xi;xl;constructor(){this.b=K.Pm(),this.Tt="",this.Xi=!0,this.xl=!0}get name(){return this.Tt}set name(t){this.Tt=t}get isEnabled(){return this.Xi}set isEnabled(t){this.Xi=t}get isRealtime(){return this.xl}set isRealtime(t){this.xl=t}get diagram(){return this.b}set diagram(t){this.b!==t&&((this.b=t).Al=!0,t.requestUpdate())}invalidateRouter(){null!==this.b&&(this.b.Al=!0,this.b.requestUpdate())}canRoute(t){var e;return!(!this.isEnabled||(e=this.diagram)&&(!this.isRealtime&&e.Mu||e.animationManager.isTicking))}routeLinks(t,e){}toString(){return""!==this.name?this.name+" Router":Xt.an(this.constructor)}}class Xi extends Yi{constructor(t){super(),this.name="AvoidsNodes",t&&Object.assign(this,t)}routeLinks(t,e){for(var i=e instanceof K?null:e,s=t.iterator;s.next();){var n,r,a,o,h,l=s.value;!l.isAvoiding||e&&l.containingGroup!==i||null===l.toNode||null===l.fromNode||l.pointsCount<4||(l.startRoute(),h=l.pointsCount,n=l.getPoint(1),r=l.getPoint(h-2),(a=l.fromNode.actualBounds.copy()).inflate(q.Xa,q.Xa),a.unionPoint(l.getPoint(0)),(o=l.toNode.actualBounds.copy()).inflate(q.Xa,q.Xa),o.unionPoint(l.getPoint(h-1)),h=l.diagram.getPositions(!0,l.containingGroup,null),this.Q3(l,a,o,h)&&this._3(l,n,l.lN,r,l.hN,a,o),l.commitRoute())}}Q3(e,t,i,s){var n=e.diagram,r=e.pointsCount;if(null===n||e.fromNode===e.toNode||e.layer.isTemporary||t.containsPoint(e.getPoint(r-1))&&!e.toNode.isMemberOf(e.fromNode)||i.containsPoint(e.getPoint(0))&&!e.fromNode.isMemberOf(e.toNode)||!e.isOrthogonal)return!1;if(17===e.segmentIndex)return!0;n=e.getPoint(1),t=e.getPoint(r-2),i=e.getPoint(2);if(!s.isUnoccupied(Math.min(n.x,i.x),Math.min(n.y,i.y),Math.abs(n.x-i.x),Math.abs(n.y-i.y)))return!0;for(let t=2;t<r-3;t++){var a=e.getPoint(t),o=e.getPoint(t+1);if(!s.isUnoccupied(Math.min(a.x,o.x),Math.min(a.y,o.y),Math.abs(a.x-o.x),Math.abs(a.y-o.y)))return!0}n=e.getPoint(r-3);return!s.isUnoccupied(Math.min(n.x,t.x),Math.min(n.y,t.y),Math.abs(n.x-t.x),Math.abs(n.y-t.y))}_3(t,e,i,s,n,r,a){var o=t.diagram,h=o.getPositions(!0,t.containingGroup,null),l=e,u=s;let d=null,c=null;o.isVirtualized&&(o=h.bounds.copy(),g=t.getPoint(2),f=t.getPoint(t.pointsCount-3),o.inflate(-h.cellWidth,-h.cellHeight),m=U.a(),h.Wd(e.x,e.y)||(I.Ml(o.x,o.y,o.x+o.width,o.y+o.height,e.x,e.y,g.x,g.y,m)?(d=e=m.copy(),i=m.directionPoint(g)):I.Ml(o.x,o.y,o.x+o.width,o.y+o.height,g.x,g.y,f.x,f.y,m)?(d=e=m.copy(),i=m.directionPoint(f)):I.Ml(o.x,o.y,o.x+o.width,o.y+o.height,f.x,f.y,s.x,s.y,m)&&(d=e=m.copy(),i=m.directionPoint(s))),h.Wd(s.x,s.y)||(I.Ml(o.x,o.y,o.x+o.width,o.y+o.height,s.x,s.y,f.x,f.y,m)?(c=s=m.copy(),n=f.directionPoint(m)):I.Ml(o.x,o.y,o.x+o.width,o.y+o.height,f.x,f.y,g.x,g.y,m)?(c=s=m.copy(),n=g.directionPoint(m)):I.Ml(o.x,o.y,o.x+o.width,o.y+o.height,g.x,g.y,e.x,e.y,m)&&(c=s=m.copy(),n=e.directionPoint(m))),U.o(m));var g,m,f=r.copy().unionRect(a);f.inflate(h.cellWidth*h.Jf,h.cellHeight*h.Jf),h.fT(e,i,s,n,f,!0);let p=h._i(s.x,s.y);!h.Cy&&p>=Ve.qd&&(h.GA(),f.inflate(h.cellWidth*h.zP,h.cellHeight*h.XP),h.fT(e,i,s,n,f,!1),p=h._i(s.x,s.y)),!h.Cy&&p<Ve.qd&&!h.pO(s.x,s.y)&&(t.points.removeRange(2,t.pointsCount-3),this.vd(t,h,s.x,s.y,n,!0),o=t.getPoint(2),t.pointsCount<4?(0===i||180===i?(o.x=e.x,o.y=s.y):(o.x=s.x,o.y=e.y),t.setPointAt(2,o.x,o.y),t.insertPointAt(3,o.x,o.y)):(g=t.getPoint(3),0===i||180===i?I.p(o.x,g.x)?(m=0===i?Math.max(o.x,e.x):Math.min(o.x,e.x),t.setPointAt(2,m,e.y),t.setPointAt(3,m,g.y)):I.p(o.y,g.y)?(Math.abs(e.y-o.y)<=h.cellHeight/2&&(t.setPointAt(2,o.x,e.y),t.setPointAt(3,g.x,e.y)),t.insertPointAt(2,o.x,e.y)):t.setPointAt(2,e.x,o.y):90!==i&&270!==i||(I.p(o.y,g.y)?(r=90===i?Math.max(o.y,e.y):Math.min(o.y,e.y),t.setPointAt(2,e.x,r),t.setPointAt(3,g.x,r)):I.p(o.x,g.x)?(Math.abs(e.x-o.x)<=h.cellWidth/2&&(t.setPointAt(2,e.x,o.y),t.setPointAt(3,e.x,g.y)),t.insertPointAt(2,e.x,o.y)):t.setPointAt(2,o.x,e.y))),null!==d&&(a=t.getPoint(1),f=t.getPoint(2),a.x!==f.x&&a.y!==f.y?0===i||180===i?t.insertPointAt(2,a.x,f.y):t.insertPointAt(2,f.x,a.y):0===i||180===i?t.insertPointAt(2,l.x,d.y):t.insertPointAt(2,d.x,l.y)),null!==c)&&(0===n||180===n?t.insertPointAt(t.pointsCount-2,u.x,c.y):t.insertPointAt(t.pointsCount-2,c.x,u.y))}vd(s,n,t,e,r,i){var a=n.cellWidth,o=n.cellHeight;let h=n._i(t,e),l=t,u=e,d=l,c=u;for(0===r?d+=a:90===r?c+=o:180===r?d-=a:c-=o,s.cN&&h>Ve.xo&&n._i(d,c)!==h-1&&(n._i(l-a,u)===h-1?(r=180,d=l-a,c=u):n._i(l+a,u)===h-1?(r=0,d=l+a,c=u):n._i(l,u-o)===h-1?(r=270,d=l,c=u-o):n._i(l,u+o)===h-1&&(r=90,d=l,c=u+o));h>Ve.xo&&n._i(d,c)===h-1;)l=d,u=c,0===r?d+=a:90===r?c+=o:180===r?d-=a:c-=o,--h;if(i?h>Ve.xo&&(180===r||0===r?l=Math.floor(l/a)*a+a/2:90!==r&&270!==r||(u=Math.floor(u/o)*o+o/2)):(l=Math.floor(l/a)*a+a/2,u=Math.floor(u/o)*o+o/2),h>Ve.xo){let i=r,t=l,e=u;if(0===r?(i=90,e+=o):90===r?(i=180,t-=a):180===r?(i=270,e-=o):270===r&&(i=0,t+=a),n._i(t,e)===h-1)this.vd(s,n,t,e,i,!1);else{let t=l,e=u;0===r?(i=270,e-=o):90===r?(i=0,t+=a):180===r?(i=90,e+=o):270===r&&(i=180,t-=a),n._i(t,e)===h-1&&this.vd(s,n,t,e,i,!1)}}s.insertPointAt(s.pointsCount-2,l,u)}}st.prototype.initializeStandardTools=function(){this.ii("Action",new ct,this.mouseDownTools),this.ii("Relinking",new ot,this.mouseDownTools),this.ii("LinkReshaping",new ht,this.mouseDownTools),this.ii("Rotating",new ut,this.mouseDownTools),this.ii("Resizing",new lt,this.mouseDownTools),this.ii("Linking",new at,this.mouseMoveTools),this.ii("Dragging",new d,this.mouseMoveTools),this.ii("DragSelecting",new mt,this.mouseMoveTools),this.ii("Panning",new ft,this.mouseMoveTools),this.ii("ContextMenu",new yt,this.mouseUpTools),this.ii("TextEditing",new bt,this.mouseUpTools),this.ii("ClickCreating",new gt,this.mouseUpTools),this.ii("ClickSelecting",new dt,this.mouseUpTools)},K.xP("GraphLinksModel",ii),K.xP("TreeModel",si);var n=v.go,r={get version(){return K.version},Group:j,List:O,Set:C,Map:L,Point:U,Size:qt,Rect:Z,Margin:E,Spot:J,Geometry:W,PathFigure:k,PathSegment:b,InputEvent:N,DiagramEvent:B,ChangedEvent:F,Model:x,GraphLinksModel:oi,TreeModel:hi,Binding:ri,ThemeBinding:ai,Transaction:R,UndoManager:Q,CommandHandler:Kt,Tool:_,DraggingTool:d,DraggingInfo:Ft,DraggingOptions:Ot,LinkingBaseTool:nt,LinkingTool:at,RelinkingTool:ot,LinkReshapingTool:ht,ResizingTool:lt,RotatingTool:ut,ClickSelectingTool:dt,ActionTool:ct,ClickCreatingTool:gt,HTMLInfo:pt,ContextMenuTool:yt,DragSelectingTool:mt,PanningTool:ft,TextEditingTool:bt,ToolManager:st,Animation:kt,AnimationManager:St,AnimationTrigger:Ct,Layer:Lt,Diagram:K,Palette:Et,Overview:Ht,Brush:m,GraphObject:y,Panel:jt,RowColumnDefinition:we,Shape:V,TextBlock:z,Picture:Le,Part:Y,Adornment:X,Node:D,Link:q,Placeholder:je,Layout:Qe,LayoutNetwork:Ue,LayoutVertex:We,LayoutEdge:Ze,GridLayout:ti,PanelLayout:se,CircularLayout:gi,CircularNetwork:fi,CircularVertex:pi,CircularEdge:vi,ForceDirectedLayout:yi,ForceDirectedNetwork:xi,ForceDirectedVertex:Ai,ForceDirectedEdge:wi,LayeredDigraphLayout:Ci,LayeredDigraphNetwork:Li,LayeredDigraphVertex:Di,LayeredDigraphEdge:Ti,TreeLayout:tt,TreeNetwork:Ii,TreeVertex:et,TreeEdge:Ki,Themes:Vi,ThemeManager:zi,Router:Yi,AnimationStyle:Pt,AutoScale:Dt,CycleMode:Tt,Flip:Qt,TextFormat:ke,ImageStretch:Ce,LayoutConditions:r,LinkAdjusting:Ee,Curve:Ie,Routing:He,Orientation:zt,TextOverflow:Se,PortSpreading:Re,ScrollMode:Bt,CollapsePolicy:e,Sizing:Ae,TriggerStart:Nt,Stretch:Vt,ViewboxStretch:pe,Wrap:Pe,BrushType:ee,ColorSpace:i,GeometryStretch:S,GeometryType:P,SegmentType:M,BindingMode:ni,ChangeType:G,CircularArrangement:li,CircularDirection:ui,CircularNodeDiameterFormula:ci,CircularSorting:di,GridAlignment:Je,GridArrangement:_e,GridSorting:$e,LayeredDigraphAggressive:Ni,LayeredDigraphAlign:Pi,LayeredDigraphCycleRemove:Si,LayeredDigraphInit:Mi,LayeredDigraphLayering:ki,LayeredDigraphPack:s,TreeAlignment:Fi,TreeArrangement:Ei,TreeCompaction:Ri,TreeLayerStyle:Hi,TreePath:Bi,TreeSorting:Gi,TreeStyle:Oi,GestureMode:it,LinkingDirection:rt,ReshapingBehavior:t,TextEditingAccept:xt,TextEditingStarting:At,TextEditingState:wt,WheelMode:$};"object"==typeof n&&n.version&&Xt.ft("WARNING: a `go` object on the root object is already defined.  "+("Debug"in n?"debug ":"")+"version: "+n.version+", replaced with version: "+r.version),K.prototype.go=r,((v.go=r).Debug=Yt).attachReadonlyWarnings(r)}(),"function"==typeof define&&define.amd&&define(("undefined"!=typeof global?global:self).go),"undefined"!=typeof module&&"object"==typeof module.exports&&(module.exports=("undefined"!=typeof global?global:self).go),go);class TopLeftBorderRadius extends bino.Shape{constructor(){super(),this._figure="TopLeftBorderRadius"}makeGeometry(){var t=new bino.Geometry,e=new bino.PathFigure(0,0,!0);return e.add(new bino.PathSegment(bino.PathSegment.Line,0,6)),e.add(new bino.PathSegment(bino.PathSegment.Arc,180,90,6,6,6,6)),t.add(e),t}}bino.Shape.defineFigureGenerator("TopLeftBorderRadius",t=>{return(new TopLeftBorderRadius).makeGeometry()});class BottomLeftBorderRadius extends bino.Shape{constructor(){super(),this._figure="BottomLeftBorderRadius"}makeGeometry(){var t=new bino.Geometry,e=new bino.PathFigure(0,0,!0);return e.add(new bino.PathSegment(bino.PathSegment.Arc,180,-90,6,0,6,6)),e.add(new bino.PathSegment(bino.PathSegment.Line,0,6)),t.add(e),t}}bino.Shape.defineFigureGenerator("BottomLeftBorderRadius",t=>{return(new BottomLeftBorderRadius).makeGeometry()});var $=bino.GraphObject.make;const LIGHT_MARKERS={apparel:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#FE6F00"><path d="m220.78-481.3-22.48 12.39q-17.39 6.87-36.78 1.74t-29.65-23.65L43.39-649.48q-10.83-19.09-5.41-39.89 5.41-20.8 24.5-31.63l242.43-138.22h78.48q15.22 0 25.52 10.31 10.31 10.3 10.31 25.52V-800q0 25.65 17.56 43.22 17.57 17.56 43.22 17.56t43.22-17.56q17.56-17.57 17.56-43.22v-23.39q0-15.22 10.31-25.52 10.3-10.31 25.52-10.31h78.48L897.52-721q19.09 10.83 24.5 31.63 5.42 20.8-5.41 39.89l-88.48 158.66q-9.69 17.39-28.87 22.86-19.17 5.48-37.56-1.39l-22.48-11.52V-160q0 24.35-18 41.78-18 17.44-42.35 17.44H280q-24.35 0-41.78-17.44-17.44-17.43-17.44-41.78v-321.3Zm106-178.09v452.61h306.44v-452.61l127.95 70.26 38.05-66.04-161.83-92.66q-17.26 49.87-59.32 82.24Q536-633.22 480-633.22q-56 0-98.07-32.37-42.06-32.37-59.32-82.24l-161.83 92.66 38.05 66.04 127.95-70.26ZM480-477.3Z"/></svg>',beautician:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#EA1A68"><path d="M651.3-17.39q-18.69 0-32.17-13.48t-13.48-32.17q0-19.26 13.48-32.46t32.17-13.2h103.05v-40H651.3q-18.69 0-32.17-13.47-13.48-13.48-13.48-32.18 0-19.26 13.48-32.45Q632.61-240 651.3-240h103.05v-40H651.3q-18.69 0-32.17-13.48t-13.48-32.17q0-19.26 13.48-32.46 13.48-13.19 32.17-13.19h103.05v-40H651.3q-18.69 0-32.17-13.48t-13.48-32.18q0-19.26 13.48-32.45 13.48-13.2 32.17-13.2h103.05v-40H651.3q-18.69 0-32.17-13.48t-13.48-32.17q0-19.26 13.48-32.46 13.48-13.19 32.17-13.19h103.05v-40H651.3q-18.69 0-32.17-13.48t-13.48-32.18q0-19.26 13.48-32.45 13.48-13.2 32.17-13.2h154.35q35.83 0 60.74 24.91 24.91 24.92 24.91 60.74v576.53q0 35.26-24.91 60.45-24.91 25.2-60.74 25.2H651.3ZM320-380.35q59.78 0 102.54-60.76 42.76-60.76 42.76-144.54T422.54-730.2Q379.78-790.96 320-790.96q-59.78 0-102.54 60.76-42.76 60.77-42.76 144.55t42.76 144.54q42.76 60.76 102.54 60.76Zm0 362.96q-54.78 0-88.89-40.3Q197-98 204-151.09l17.13-148.34q-68-35.83-110.22-112.74Q68.7-489.09 68.7-585.65q0-130.09 73.39-220.7 73.39-90.61 177.91-90.61t177.91 90.61q73.39 90.61 73.39 220.7 0 96.56-42.21 173.48-42.22 76.91-110.22 112.74L436-150.52q7 53.09-27.67 93.11Q373.65-17.39 320-17.39Z"/></svg>',beer:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#BD5C17"><path d="M321.7-206.78h258.52v-379.09H508.7q-21.79 0-39.22 12.31-17.44 12.3-43 42.13-21.13 25.39-47.35 47.19-26.22 21.81-57.43 31.68v245.78Zm-106.01 0v-249.61q-51.43-15.7-83.17-60.24-31.74-44.54-31.74-102.24 0-59.22 33.61-104.17Q168-768 219.96-788.52q24.13-48.57 70.47-79.13 46.35-30.57 103.92-30.57 34.43 0 64.08 11.44 29.66 11.43 54.66 31.43 8.87-2 16.74-2.93 7.87-.94 17.17-.94 72.78 0 125.15 52.94 52.37 52.93 52.37 127.41 0 18.61-3.52 34.93-3.52 16.33-10.56 32.07h43.34q43.18 0 74.31 30.85 31.13 30.85 31.13 74.59v194.78q0 43.74-30.85 74.58-30.85 30.85-74.59 30.85h-67.56q0 43.74-30.85 74.59t-74.59 30.85H321.7q-44.31 0-75.16-30.85-30.85-30.85-30.85-75.15Zm-8.91-412.09q0 27.35 18.13 46.61Q243.04-553 268.7-553q28.6 0 49.41-17.04 20.8-17.05 47.06-45.87 32.35-34.92 63.29-55.44 30.93-20.52 80.24-20.52H614q-2.26-25.09-22.09-43.22-19.82-18.13-44.91-18.13-21.61 0-36.91 5.37-15.31 5.37-21.53 9.33l-37.21-31.65q-9.31-7.87-23.42-14.96-14.1-7.09-34.15-7.09-26.91 0-48.32 14.74-21.42 14.74-33.72 40.35l-15.7 34.52L255-688.22q-21.61 7.44-34.91 27.09-13.31 19.65-13.31 42.26Zm479.44 307.22h67v-194.78h-67v194.78ZM321.7-206.78h258.52H321.7Z"/></svg>',buysell:'<svg xmlns="http://www.w3.org/2000/svg" height="48" viewBox="0 96 960 960" width="48"><path fill="#333333" d="M486.559 758Q527 758 551 740.031t24-47.628q0-31.295-22.5-52.349Q530 619 473 595q-69-26-102-57.448-33-31.447-33-83.339 0-43.942 28-76.578Q394 345 448 337v-14q0-13.2 8.857-22.1 8.857-8.9 23-8.9h1Q495 292 504 300.9t9 22.1v13.176q32 5.824 56.5 19.741Q594 369.833 611 398q7 10.389 2 22.694Q608 433 595.593 437 585 441 573 438.5T553 426q-15-17-33.872-25.5t-41.093-8.5Q443 392 423 408.304q-20 16.303-20 41.647 0 30.951 24.5 50T508.212 543q71.055 28 101.421 63.259Q640 641.518 640 692.028 640 720 630.5 741t-26.286 36q-16.785 15-39.862 24.208Q541.275 810.417 511 814v16q0 13.2-8.857 22.1-8.857 8.9-23 8.9t-23.643-9.4q-9.5-9.4-9.5-22.6v-17q-35-8-63.614-30.218Q353.771 759.564 332 721q-5-11 .296-21.403 5.297-10.403 17.667-15.597Q360 681 371 685.5q11 4.5 18 15.5 14 28 39.935 42.5Q454.87 758 486.559 758ZM479 1035q-110 0-213-62.5T100 830v89q0 16.325-11.564 27.662Q76.87 958 60.21 958q-16.235 0-27.723-11.338Q21 935.325 21 919V734q0-19.45 12.987-32.725Q46.975 688 66 688h185q16.75 0 28.375 12.064Q291 712.129 291 727.789q0 16.236-11.625 27.724Q267.75 767 251 767h-97q50 71 141 129.5T478.6 955Q622 955 730 859.5T857 620q1-16 13.053-27 12.052-11 29.122-11 14.825 0 27.325 9.375T937 616q-8.741 90.267-47.87 167.134Q850 860 787.871 915.683q-62.129 55.683-141.5 87.497Q567 1035 479 1035Zm1-838q-143 0-251 95.5T104 532q-2.497 15.429-14.48 26.714Q77.537 570 60.56 570q-15.487 0-27.523-11.833Q21 546.333 24 530q6-87 46-162t100-130q60-55 140.653-88 80.653-33 169.847-33Q591 117 695 179.5T860 322v-89q0-18.45 10.982-29.225 10.983-10.775 29-10.775Q917 193 928.5 203.775T940 233v185q0 19.025-13.275 32.013Q913.45 463 894 463H709q-16.325 0-27.662-11.772-11.338-11.772-11.338-27Q670 408 681.338 396q11.337-12 27.662-12h98q-54-74-146-130.5T480 197Z"/></svg>',cattle:'<svg xmlns="http://www.w3.org/2000/svg" height="56" width="56" viewBox="0 0 24 24"><path fill="#BD5C17" d="M10.5,18A0.5,0.5 0 0,1 11,18.5A0.5,0.5 0 0,1 10.5,19A0.5,0.5 0 0,1 10,18.5A0.5,0.5 0 0,1 10.5,18M13.5,18A0.5,0.5 0 0,1 14,18.5A0.5,0.5 0 0,1 13.5,19A0.5,0.5 0 0,1 13,18.5A0.5,0.5 0 0,1 13.5,18M10,11A1,1 0 0,1 11,12A1,1 0 0,1 10,13A1,1 0 0,1 9,12A1,1 0 0,1 10,11M14,11A1,1 0 0,1 15,12A1,1 0 0,1 14,13A1,1 0 0,1 13,12A1,1 0 0,1 14,11M18,18C18,20.21 15.31,22 12,22C8.69,22 6,20.21 6,18C6,17.1 6.45,16.27 7.2,15.6C6.45,14.6 6,13.35 6,12L6.12,10.78C5.58,10.93 4.93,10.93 4.4,10.78C3.38,10.5 1.84,9.35 2.07,8.55C2.3,7.75 4.21,7.6 5.23,7.9C5.82,8.07 6.45,8.5 6.82,8.96L7.39,8.15C6.79,7.05 7,4 10,3L9.91,3.14V3.14C9.63,3.58 8.91,4.97 9.67,6.47C10.39,6.17 11.17,6 12,6C12.83,6 13.61,6.17 14.33,6.47C15.09,4.97 14.37,3.58 14.09,3.14L14,3C17,4 17.21,7.05 16.61,8.15L17.18,8.96C17.55,8.5 18.18,8.07 18.77,7.9C19.79,7.6 21.7,7.75 21.93,8.55C22.16,9.35 20.62,10.5 19.6,10.78C19.07,10.93 18.42,10.93 17.88,10.78L18,12C18,13.35 17.55,14.6 16.8,15.6C17.55,16.27 18,17.1 18,18M12,16C9.79,16 8,16.9 8,18C8,19.1 9.79,20 12,20C14.21,20 16,19.1 16,18C16,16.9 14.21,16 12,16M12,14C13.12,14 14.17,14.21 15.07,14.56C15.65,13.87 16,13 16,12A4,4 0 0,0 12,8A4,4 0 0,0 8,12C8,13 8.35,13.87 8.93,14.56C9.83,14.21 10.88,14 12,14M14.09,3.14V3.14Z" /></svg>',church:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#333333"><path d="M67-151.52v-171.04q0-31.92 16.96-57.92 16.95-26 46.3-38.82L227-462.52v-63.04q0-30.35 15.96-55.64 15.95-25.28 42.74-39.1L427-690.96v-60.56h-27q-22.09 0-37.54-15.46Q347-782.43 347-804.52t15.46-37.55q15.45-15.45 37.54-15.45h27v-27q0-22.09 15.46-37.55 15.45-15.45 37.54-15.45t37.54 15.45Q533-906.61 533-884.52v27h27q22.09 0 37.54 15.45Q613-826.61 613-804.52q0 22.09-15.46 37.54-15.45 15.46-37.54 15.46h-27v60.56l141.3 70.66q26.79 13.82 42.74 39.1Q733-555.91 733-525.56v63.04l96.74 43.22q29.35 12.82 46.3 38.82 16.96 26 16.96 57.92v171.04q0 44.3-30.85 75.15Q831.3-45.52 787-45.52H568.48q-22.09 0-37.55-15.46-15.45-15.45-15.45-37.54V-214q0-14.74-10.37-25.11T480-249.48q-14.74 0-25.11 10.37T444.52-214v115.48q0 22.09-15.45 37.54-15.46 15.46-37.55 15.46H173q-44.3 0-75.15-30.85Q67-107.22 67-151.52Zm106 0h165.52V-216q0-58.91 41.5-100.91t99.98-42q58.48 0 99.98 42 41.5 42 41.5 100.91v64.48H787v-175.04l-160-72v-134.57l-147-74.65-147 74.65v134.57l-160 72v175.04Zm307-250.96q25 0 42.5-17.5t17.5-42.5q0-25-17.5-42.5t-42.5-17.5q-25 0-42.5 17.5t-17.5 42.5q0 25 17.5 42.5t42.5 17.5Zm0 22.83Z"/></svg>',computer:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#333333"><path d="M67-92.3q-18.92 0-31.72-12.8-12.8-12.8-12.8-31.72 0-18.69 12.8-31.32 12.8-12.64 31.72-12.64h826q18.92 0 31.72 12.64 12.8 12.64 12.8 31.33 0 18.68-12.8 31.59Q911.92-92.3 893-92.3H67Zm99.78-128.48q-44.3 0-75.15-30.85-30.85-30.85-30.85-75.15v-426.44q0-44.3 30.85-75.15 30.85-30.85 75.15-30.85h626.44q44.3 0 75.15 30.85 30.85 30.85 30.85 75.15v426.44q0 44.3-30.85 75.15-30.85 30.85-75.15 30.85H166.78Zm0-106h626.44v-426.44H166.78v426.44Zm0 0v-426.44 426.44Z"/></svg>',dna:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#9831CF"><path d="M187-80q0-138.43 56.02-225.78T398.22-480q-99.18-86.87-155.2-174.22Q187-741.57 187-880v-10q0-22.09 15.46-37.54Q217.91-943 240-943t37.54 15.46Q293-912.09 293-890v10q0 4.78.22 8.91t.65 8.48h372.26q.43-4.35.65-8.48.22-4.13.22-8.91v-10q0-22.09 15.46-37.54Q697.91-943 720-943t37.54 15.46Q773-912.09 773-890v10q0 138.43-56.02 225.78T561.78-480q99.18 86.87 155.2 174.22Q773-218.43 773-80v10q0 22.09-15.46 37.54Q742.09-17 720-17t-37.54-15.46Q667-47.91 667-70v-10q0-4.78-.22-8.91t-.65-8.48H293.87q-.43 4.35-.65 8.48Q293-84.78 293-80v10q0 22.09-15.46 37.54Q262.09-17 240-17t-37.54-15.46Q187-47.91 187-70v-10Zm147.61-630.52h290.78q8.48-13.92 14.59-27.55 6.11-13.63 11.28-29.84H308.74q5.17 15.78 11.28 29.63 6.11 13.84 14.59 27.76ZM480-548.96q20-17 38.43-33.43 18.44-16.44 34.87-33.44H406.7q16.43 17 34.87 33.44Q460-565.96 480-548.96Zm-73.3 204.79h146.6q-16.43-17-34.87-33.44Q500-394.04 480-411.04q-20 17-38.43 33.43-18.44 16.44-34.87 33.44Zm-97.96 152.08h342.52q-5.17-15.78-11.28-29.63-6.11-13.84-14.59-27.76H334.61q-8.48 13.92-14.59 27.55-6.11 13.63-11.28 29.84Z"/></svg>',farming:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#259F31"><path d="M480-109.83q-20.96 0-35.57-14.6-14.6-14.61-14.6-35.57v-267.7q-63.44-1.69-121.87-27.04-58.44-25.35-103.44-70.35-46.64-46.57-71.51-107.62-24.88-61.06-24.88-127.29v-38.3q0-22.09 15.46-37.55 15.45-15.45 37.54-15.45h38.3q65.21 0 126.28 25.38 61.06 25.38 107.64 72.01 28.17 28.17 48.11 62.06 19.93 33.89 32.06 71.94 2.65-3.63 5.82-7 3.17-3.37 6.88-7 46.57-46.63 107.62-72.01 61.06-25.38 127.29-25.38h38.3q22.09 0 37.55 15.45 15.46 15.46 15.46 37.55v38.3q0 66.23-25.39 127.29-25.38 61.05-72.01 107.62-45 45-103.21 69.85-58.22 24.85-121.66 26.54V-160q0 20.96-14.6 35.57-14.61 14.6-35.57 14.6Zm-49.61-419.78q0-38.96-17.65-79.63-17.65-40.67-50.52-73.54-31.18-31.18-70.44-48.55-39.26-17.37-82.74-19.06 1.7 44.04 18.57 83.52t48.04 70.65q31.18 31.18 70.94 48.05 39.76 16.87 83.8 18.56Zm100.35 120.57q38.96 0 79.63-17.16 40.67-17.15 73.54-50.02 31.18-31.17 48.55-70.65 17.37-39.48 19.06-83.52-44.04 1.69-83.52 19.06-39.48 17.37-70.65 48.55-31.18 31.17-48.05 70.71-16.86 39.55-18.56 83.03Zm0 0ZM430.39-529.61Z"/></svg>',"female-twin":'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#EA1A68"><path d="m442.96-634.78 0-0t1 0 0 0-37.32-15.95Zm-372 512.09q-22.09 0-37.55-15.46-15.45-15.46-15.45-37.54v-120q0-39.09 27.45-66.05 27.46-26.96 65.55-26.96h134.39q21.69 0 37.71 8.31 16.03 8.3 25.9 23.61 30.13 41.82 74.89 64.95Q428.61-268.7 480-268.7q51.83 0 96.87-23.13 45.04-23.13 74.74-64.95 10.74-15.31 26.54-23.61 15.81-8.31 36.5-8.31h134.96q39.09 0 66.04 26.96 26.96 26.96 26.96 66.05v120q0 22.08-15.46 37.54-15.45 15.46-37.54 15.46h-200q-22.09 0-37.54-15.46-15.46-15.46-15.46-37.54v-43.09q-35 21.61-74.65 33.19Q522.3-174 480-174q-41.3 0-81.17-11.8-39.87-11.81-74.87-33.42v43.53q0 22.08-15.46 37.54t-37.54 15.46h-200ZM160-451.3q-52.26 0-88.96-36.7-36.69-36.7-36.69-88.96 0-52.69 36.69-89.17 36.7-36.48 88.96-36.48 52.7 0 89.17 36.48 36.48 36.48 36.48 89.17 0 52.26-36.48 88.96-36.47 36.7-89.17 36.7Zm640 0q-52.26 0-88.96-36.7-36.69-36.7-36.69-88.96 0-52.69 36.69-89.17 36.7-36.48 88.96-36.48 52.7 0 89.17 36.48 36.48 36.48 36.48 89.17 0 52.26-36.48 88.96-36.47 36.7-89.17 36.7Z"/></svg>',government:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#333333"><path d="M182.48-322.83V-505.3q0-20.4 14.32-34.44 14.33-14.04 34.72-14.04t34.44 14.04Q280-525.7 280-505.3v183.04q0 20.39-14.04 34.43-14.05 14.05-34.44 14.05-20.39 0-34.72-14.33-14.32-14.32-14.32-34.72Zm249.04.57V-505.3q0-20.4 14.04-34.44 14.05-14.04 34.44-14.04 20.39 0 34.44 14.04 14.04 14.04 14.04 34.44v183.04q0 20.39-14.04 34.43-14.05 14.05-34.44 14.05-20.39 0-34.44-14.05-14.04-14.04-14.04-34.43ZM113.78-105.3q-22.08 0-37.54-15.46T60.78-158.3q0-22.09 15.46-37.55 15.46-15.45 37.54-15.45h732.44q22.08 0 37.54 15.45 15.46 15.46 15.46 37.55 0 22.08-15.46 37.54t-37.54 15.46H113.78ZM680-322.83V-505.3q0-20.4 14.33-34.44 14.32-14.04 34.71-14.04 20.4 0 34.44 14.04t14.04 34.44v183.04q0 20.39-14.04 34.43-14.04 14.05-34.44 14.05-20.39 0-34.71-14.33Q680-302.43 680-322.83Zm163.96-293.99H110.35q-20.65 0-35.11-14.46t-14.46-35.11v-31.04q0-14.4 7.48-26.07t19.87-18.37l344.57-172q22.08-11.39 47.3-11.39t47.3 11.39l341.44 170.43q14.39 6.7 22.43 20.37 8.05 13.68 8.05 29.77v20.65q0 23.22-16.02 39.52-16.03 16.31-39.24 16.31ZM287.39-722.83h385.22-385.22Zm0 0h385.22L480-818.13l-192.61 95.3Z"/></svg>',housewife:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#EA1A68"><path d="M144.74-217.52v-269l-28.13 21.95q-16.26 12.27-36.5 9.98-20.24-2.28-32.5-18.82-12.26-16.55-9.42-36.22 2.85-19.67 18.68-31.94l87.87-68v-82.87q0-20.6 14.32-34.54 14.33-13.93 36.42-13.93 19.88 0 33.33 13.45t13.45 33.33v10l172.91-131.31q28.88-22.08 64.31-22.08 35.43 0 64.22 22.08L902-541.57q16.03 12.29 18.49 31.95 2.47 19.66-9.79 35.92-12.16 16.03-31.6 18.5-19.45 2.46-35.27-9.8l-29.7-21.52v269q0 44.3-30.85 75.15-30.85 30.85-75.15 30.85H250.74q-44.31 0-75.15-30.85-30.85-30.85-30.85-75.15Zm97.52 9.04H428.7V-320q0-20.6 14.32-34.54 14.33-13.94 34.72-13.94t34.43 13.94q14.05 13.94 14.05 34.54v111.52h190.95v-352.27L479.43-741.83 242.26-560.75v352.27Zm0 0H717.17 242.26Zm-36.48-572.43q-26.39 0-41.15-21.55-14.76-21.54-3.2-44.37 20.4-38.04 55.53-61.04t78.3-23q13.61 0 25.98-6.35 12.37-6.35 19.07-18.61 7.26-12.39 19.43-20.22 12.17-7.82 26.57-7.82 26.59 0 40.47 21.54 13.87 21.54 1.74 44.94-19.82 38.04-55.27 60.76t-77.99 22.72q-13.61 0-25.98 6.41-12.37 6.41-19.06 19.11-7.26 12.39-18.65 19.93-11.4 7.55-25.79 7.55Z"/></svg>',intelligence:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#4285F4"><path d="M479.13-335.04q70 0 119-45t49-109q0-57-36.5-96.5t-88.5-39.5q-47 0-79.5 30t-32.5 74q0 18.8 7.07 37.12 7.06 18.31 21.93 32.88 16.57 14 32.57 11.5t26-13.5q10-11 11.21-26.79 1.22-15.78-12.78-28.21-2.57-2-4.28-5-1.72-3-1.72-7 0-11 9-17.5t23-6.5q20 0 33 16.5t13 39.5q0 31-25.5 52.5t-62.5 21.5q-47 0-79.5-38t-32.5-93q0-19 4.5-37t13.5-34q8-15 8-31.5t-12-28.5q-12-12-29-11.5t-26 14.5q-20 28-30 60t-10 67q0 88 56 149.5t136 61.5Zm-256.09 90.39q-56.43-54.26-88.21-126.02-31.79-71.76-31.79-149.33 0-157.07 109.9-267.01 109.89-109.95 266.89-109.95 130.82 0 231.84 77.18 101.03 77.17 131.72 200.82l53.13 210.09q6.7 25.22-9.16 45.52-15.85 20.31-42.27 20.31h-68.13v94q0 44.3-30.85 75.15-30.85 30.85-75.15 30.85h-54v27q0 22.08-15.46 37.54t-37.54 15.46q-22.09 0-37.55-15.46-15.45-15.46-15.45-37.54v-80q0-22.09 15.45-37.55 15.46-15.45 37.55-15.45h107v-147q0-22.09 15.45-37.55 15.46-15.45 37.55-15.45h52.74l-35.18-143.7q-23-87.04-95.74-142.63-72.74-55.59-165.78-55.59-112.25 0-191.6 78.37-79.36 78.36-79.36 190.59 0 57.74 23.66 110.61 23.65 52.87 67.52 92.61l28.82 26.82v175.92q0 22.08-15.45 37.54-15.46 15.46-37.55 15.46-22.08 0-37.54-15.46t-15.46-37.54v-128.61ZM492.87-427Z"/></svg>',investigate:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#333333"><path d="M375.48-307q-114.09 0-193.55-79.46-79.45-79.45-79.45-193.54 0-114.09 79.45-193.54Q261.39-853 375.48-853q114.09 0 193.54 79.46 79.46 79.45 79.46 193.54 0 45.13-12.87 83.28T601-429.7l219.48 220.05q14.96 15.52 14.96 37.32 0 21.81-15.53 36.77-14.95 14.95-37.04 14.95t-37.04-14.95L526.91-354.48q-29.43 21.74-68.15 34.61Q420.04-307 375.48-307Zm0-106q69.91 0 118.45-48.54 48.55-48.55 48.55-118.46t-48.55-118.46Q445.39-747 375.48-747t-118.46 48.54Q208.48-649.91 208.48-580t48.54 118.46Q305.57-413 375.48-413Z"/></svg>',"male-twin":'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#4285F4"><path d="m442.96-634.78 0-0t1 0 0 0-37.32-15.95Zm-372 512.09q-22.09 0-37.55-15.46-15.45-15.46-15.45-37.54v-120q0-39.09 27.45-66.05 27.46-26.96 65.55-26.96h134.39q21.69 0 37.71 8.31 16.03 8.3 25.9 23.61 30.13 41.82 74.89 64.95Q428.61-268.7 480-268.7q51.83 0 96.87-23.13 45.04-23.13 74.74-64.95 10.74-15.31 26.54-23.61 15.81-8.31 36.5-8.31h134.96q39.09 0 66.04 26.96 26.96 26.96 26.96 66.05v120q0 22.08-15.46 37.54-15.45 15.46-37.54 15.46h-200q-22.09 0-37.54-15.46-15.46-15.46-15.46-37.54v-43.09q-35 21.61-74.65 33.19Q522.3-174 480-174q-41.3 0-81.17-11.8-39.87-11.81-74.87-33.42v43.53q0 22.08-15.46 37.54t-37.54 15.46h-200ZM160-451.3q-52.26 0-88.96-36.7-36.69-36.7-36.69-88.96 0-52.69 36.69-89.17 36.7-36.48 88.96-36.48 52.7 0 89.17 36.48 36.48 36.48 36.48 89.17 0 52.26-36.48 88.96-36.47 36.7-89.17 36.7Zm640 0q-52.26 0-88.96-36.7-36.69-36.7-36.69-88.96 0-52.69 36.69-89.17 36.7-36.48 88.96-36.48 52.7 0 89.17 36.48 36.48 36.48 36.48 89.17 0 52.26-36.48 88.96-36.47 36.7-89.17 36.7Z"/></svg>',manager:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#333333"><path d="M697.52-348.7q-47.08 0-80.04-32.95-32.96-32.96-32.96-80.05 0-47.08 32.96-80.04 32.96-32.96 80.04-32.96 47.09 0 80.05 32.96 32.95 32.96 32.95 80.04 0 47.09-32.95 80.05-32.96 32.95-80.05 32.95Zm-213 164.53v-16q0-27.76 14.48-51.47 14.48-23.71 40.87-34.97 37.13-16.13 77.18-23.35 40.04-7.21 80.6-7.21 40.57 0 80.2 7.21 39.63 7.22 76.76 23.35 26.39 11.26 41.15 34.97 14.76 23.71 14.76 51.47v16q0 22.08-15.45 37.54-15.46 15.46-37.55 15.46h-320q-22.08 0-37.54-15.46t-15.46-37.54ZM388.7-489.61q-74.48 0-126.85-52.37-52.37-52.37-52.37-126.85 0-74.48 52.37-126.56 52.37-52.09 126.85-52.09 74.47 0 126.84 52.09 52.37 52.08 52.37 126.56t-52.37 126.85q-52.37 52.37-126.84 52.37Zm0-179.22ZM49.48-263.52q0-39.28 20.11-72.21 20.1-32.92 54.63-50.18 62.26-31.13 128.8-47.42 66.55-16.28 135.68-16.28 38.39 0 76.21 6.28 37.83 6.29 75.09 15.42-22.09 22.08-44.74 45.02-22.65 22.93-44.74 45.02-15.74-3.3-30.91-4.52-15.18-1.22-30.91-1.22-55.74 0-109.55 13.15-53.8 13.16-103.67 37.46-9.44 5-14.72 13.47-5.28 8.48-5.28 18.83v23.53h249.04v51.71q0 17.24 6.98 31.14 6.98 13.89 18.24 23.15H155.48q-44.31 0-75.16-30.85-30.84-30.85-30.84-75.15v-26.35Zm355.04 26.35Zm-15.84-358.44q30.19 0 51.71-21.5t21.52-51.7q0-30.19-21.5-51.43t-51.69-21.24q-30.2 0-51.72 21.34t-21.52 51.31q0 30.2 21.5 51.71t51.7 21.51Z"/></svg>',manufacturing:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#FE6F00"><path d="M168.48-62.48q-44.31 0-75.15-30.85-30.85-30.84-30.85-75.15v-333.87q0-31.84 17.52-58.38 17.52-26.53 47.3-39.36l183.48-77.95q23.96-9.7 45.35 4.13 21.39 13.82 21.39 39.78v8.69l126.91-51.21q26.22-10.83 49.66 4.84 23.43 15.68 23.43 44.03v50.26h320v409.04q0 44.31-30.85 75.15-30.84 30.85-75.15 30.85H168.48Zm0-106h623.04v-302.9H475.48V-549l-200 80v-79.13l-107 46.78v332.87ZM431.52-240h96.96v-160h-96.96v160Zm-169.04 0H360v-160h-97.52v160ZM600-240h97.52v-160H600v160Zm297.52-337.52H677.74l34.3-269.18q2.57-19.52 17.27-32.91Q744-893 764.04-893h44.92q19.52 0 34.66 13.07 15.15 13.07 17.9 32.67l36 269.74ZM168.48-168.48h623.04-623.04Z"/></svg>',military:'<svg xmlns="http://www.w3.org/2000/svg" height="52px" viewBox="0 -960 960 960" width="52px" fill="#E99E0E"><path d="m480-157.61-82.48 62.22q-15.39 11.83-31.35.78-15.95-11.04-9.82-29.56l31.82-102.74-81.48-58.22q-15.95-11.39-9.82-29.63Q303-333 322.09-333h100.3l28-90.52-139.17-82.65q-20.95-12.86-32.58-33.89Q267-561.09 267-587.48v-221q0-44.3 30.85-75.15 30.85-30.85 75.15-30.85h214q44.3 0 75.15 30.85Q693-852.78 693-808.48v221q0 26.39-11.64 47.42-11.63 21.03-32.58 33.89l-139.17 82.65 28 90.52h100.3q19.09 0 25.22 18.24 6.13 18.24-9.82 29.63l-81.48 58.22 31.82 102.74q6.13 18.52-9.82 29.56-15.96 11.05-31.35-.78L480-157.61ZM364.52-817.52v228.34L440-544v-273.52h-75.48Zm230.96 0H520V-544l75.48-45.18v-228.34ZM480-669.04Zm-40-12Zm80 0Z"/></svg>',police:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#4285F4"><path d="M480-170.22q93.04-33.39 156.63-118.5 63.59-85.11 74.59-191.28H480v-307.09l-233.22 87.18V-498q0 8.13 2 18H480v309.78Zm0 104.31q-8.7 0-16.96-1.28-8.26-1.29-16.52-3.85-138.96-46.13-222.35-173.85Q140.78-372.61 140.78-516v-183.91q0-33.48 19.02-60.26 19.03-26.79 49.94-38.61l233.22-87.18q17.95-6.69 37.04-6.69t37.04 6.69l233.22 87.18q30.91 11.82 49.94 38.61 19.02 26.78 19.02 60.26V-516q0 143.39-83.39 271.11-83.39 127.72-222.35 173.85-8.26 2.56-16.52 3.85-8.26 1.28-16.96 1.28Z"/></svg>',prelations:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#E99E0E"><path d="M473.3-160q4 0 7.72-1.43 3.72-1.44 6.85-4.57l325.17-325.17q13.7-13.7 20.61-31.53 6.92-17.82 6.92-36.78 0-19.62-6.92-37.39-6.91-17.78-20.61-31.04L663.96-777q-12.13-12.57-27.59-17.78-15.46-5.22-32.51-5.22-15.99 0-31.84 5.22-15.85 5.21-27.28 15.52l-5.91 6.48 69.47 69.91q17.83 17.39 26.24 38.5 8.42 21.11 8.42 45.63 0 48.78-33.59 82.37T527-502.78q-23.96 0-45.57-8.41-21.6-8.42-39-25.81l-73.3-72.87-162 161.44q-3 3.12-4.5 6.76-1.5 3.64-1.5 7.8 0 8 5.86 13.94 5.86 5.93 13.67 5.93 3.91 0 8.13-2 4.23-2 6.34-4l100.65-100.09q11-11 27.5-11.5t28.5 11.5q11 11 11 28t-11 28L292.13-364q-3 3-4.5 7.07-1.5 4.06-1.5 8.06 0 8 5.44 13.44Q297-330 305-330q4 0 8.28-2 4.29-2 6.85-4l98.96-98.52q11-11 27.78-11.22 16.78-.22 28.22 11.22 11 11 11 28t-11 28l-99.66 100.09q-2.43 2-4.21 6.18-1.79 4.19-1.79 8.38 0 7.77 5.86 13.6 5.86 5.84 13.67 5.84 3.91 0 7.61-1.5t6.86-4.5l100.09-99.66q11-11 27.78-11.21 16.79-.22 28.22 11.21 11 11 11 28t-11 28L459.43-194q-3 3-4.5 7.07-1.5 4.06-1.5 8.06 0 8 5.94 13.44Q465.3-160 473.3-160Zm-.43 97.52q-40.39 0-72.28-25.06-31.89-25.07-40.29-64.33-31.74-6.13-55.02-29.69-23.28-23.57-29.41-55.31-31.17-6.69-53.96-29.63-22.78-22.93-29.48-53.67-38.56-7.83-63.97-39.79-25.42-31.95-25.42-73.91 0-22.83 8.82-44.4 8.81-21.58 25.27-37.9l156.91-156.92Q324.96-704 368.91-704q43.96 0 74.87 30.91L510.87-606q3.13 3.57 7.13 5.35 4 1.78 8.57 1.78 8.27 0 13.78-5.37 5.52-5.37 5.52-14.16 0-3.9-1.78-8.75-1.79-4.85-4.82-6.87L394.61-778.7q-10.44-11.43-26.94-16.37-16.5-4.93-34.71-4.93-17.83 0-33.4 4.93-15.56 4.94-26.9 16.23L139.48-645.17q-10.05 10.04-15.2 25.93-5.15 15.89-3.85 30.93.74 20.4-12.37 35.37-13.1 14.98-33.5 15.85-20.39.87-35.37-12.59-14.97-13.45-15.84-33.84-2.61-36.31 9.17-70.26 11.78-33.96 38.1-60.37l132.51-132.98q25.69-25.26 60.28-37.83 34.59-12.56 69.55-12.56 36.65 0 70.39 12.56 33.74 12.57 58.43 36.13l6.48 5.92 5.91-5.92q24.57-22.43 59.07-35.56 34.5-13.13 70.76-13.13 34.96 0 69.26 13.69 34.31 13.7 59.57 38.96L886-692.26q25.26 25.26 38.39 61.19 13.13 35.94 13.13 72.31 0 36.37-13.98 72.93-13.97 36.57-40.37 62.96L556.3-97q-16.82 16.83-38.15 25.67-21.32 8.85-45.28 8.85ZM355.09-653.57Z"/></svg>',retail:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#EA1A68"><path d="M205.52-94q-44.3 0-75.15-30.85Q99.52-155.7 99.52-200v-311.78q-23.56-25.52-34.09-61.35-10.52-35.83 1.48-75.96l42-136q9.7-31.65 35.29-52.89 25.58-21.24 58.8-21.24h556q33.22 0 58.59 20.46 25.37 20.46 35.5 53.67l42 136q12 39 1.19 73.55-10.8 34.54-33.8 60.93V-200q0 44.3-30.85 75.15Q800.78-94 756.48-94H205.52ZM569-566.78q23.61 0 35.91-15.96 12.31-15.96 9.31-36.13l-21.44-134.35h-65V-612q0 18.74 12.02 31.98 12.03 13.24 29.2 13.24Zm-180 0q19.61 0 32.41-13.24 12.81-13.24 12.81-31.98v-141.22h-65l-21.44 134.35q-3.43 20.04 8.52 36.07 11.96 16.02 32.7 16.02Zm-178 0q15.74 0 27.26-11.87 11.52-11.87 13.96-28.48l20.87-146.09h-65L169.78-624.3q-5.43 18.3 4.81 37.91 10.24 19.61 36.41 19.61Zm540 0q26.17 0 36.63-19.61t4.59-37.91l-40.31-128.92h-63l20.87 146.09q2.44 16.61 13.96 28.48 11.52 11.87 27.26 11.87ZM205.52-200h550.96v-262.22q-2.74.87-3.68 1.16-.93.28-1.8.28-23.04 0-44.67-7.59-21.63-7.59-43.33-25.32-19.13 15.73-42.13 24.32-23 8.59-47.87 8.59-25.87 0-49.37-8.59-23.5-8.59-42.63-24.32-18.13 15.73-40.63 24.32-22.5 8.59-47.37 8.59-27.3 0-51.09-8.59-23.78-8.59-42.91-24.32-23.26 18.73-45.17 25.82-21.92 7.09-42.83 7.09-.87 0-2.24-.28-1.37-.29-3.24-1.16V-200Zm550.96 0H205.52 756.48Z"/></svg>',sales:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#E99E0E"><path d="M868.44-372.48 587.52-91.56q-15.55 15.39-34.99 23.08-19.44 7.7-39.53 7.7t-39.53-7.7q-19.44-7.69-34.99-23.08L91.7-438.35q-14.4-14.39-22.66-33.62-8.26-19.24-8.26-40.46v-281.35q0-43.49 30.97-74.47 30.98-30.97 74.47-30.97h281.35q20.91 0 40.52 8.2 19.61 8.19 34 23.15l346.35 346.22q15.95 15.95 23.43 35.48 7.48 19.52 7.48 39.55 0 20.03-7.48 39.39t-23.43 34.75ZM513-166.78l279.78-279.79L446-793.22H166.78v279.79L513-166.78Zm-247.41-468.7q24.5 0 41.71-17.15 17.22-17.15 17.22-41.65T307.37-736q-17.15-17.22-41.65-17.22T224-736.07q-17.22 17.15-17.22 41.66 0 24.5 17.15 41.71 17.15 17.22 41.66 17.22ZM480-480Z"/></svg>',seaman:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#333333"><path d="M480-62.48q-71.74 0-139.13-23.69-67.39-23.7-119.11-65.37-51.72-41.68-83.24-98.61Q107-307.09 107-373v-75.48q0-16.52 14.39-23.93 14.39-7.42 27.78 2.84l101.74 75.35q19.09 14.39 20.87 38.83 1.79 24.43-15.17 41.39l-22.22 22.22q27.87 44.78 80.7 76.69 52.82 31.92 111.91 41.92v-324.79h-67q-22.09 0-37.54-15.45Q307-528.87 307-550.96q0-22.08 15.46-37.54 15.45-15.46 37.54-15.46h67v-34.56q-40.09-16.96-64.28-51.98-24.2-35.02-24.2-77.98 0-59.04 41.22-100.54 41.22-41.5 100.26-41.5 59.04 0 100.26 41.5 41.22 41.5 41.22 100.54 0 42.96-24.2 77.98-24.19 35.02-64.28 51.98v34.56h67q22.09 0 37.54 15.46Q653-573.04 653-550.96q0 22.09-15.46 37.55-15.45 15.45-37.54 15.45h-67v324.79q59.09-10 111.91-41.92 52.83-31.91 80.7-76.69L703.39-314q-16.96-16.96-15.17-41.39 1.78-24.44 20.87-38.83l101.74-75.35q13.39-10.26 27.78-2.84Q853-465 853-448.48V-373q0 65.91-31.52 122.85-31.52 56.93-83.24 98.61-51.72 41.67-119.11 65.37Q551.74-62.48 480-62.48ZM480-733q15.3 0 25.39-10.09 10.09-10.08 10.09-25.39 0-15.3-10.09-25.67-10.09-10.37-25.39-10.37t-25.39 10.37q-10.09 10.37-10.09 25.67 0 15.31 10.09 25.39Q464.7-733 480-733Z"/></svg>',software:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#333333"><path d="m203.17-479.57 145.96 145.96q15.52 15.52 15.24 37.33-.28 21.8-15.8 37.32-15.53 15.53-37.05 15.24-21.52-.28-37.04-15.24l-184-183.43q-7.7-7.7-11.61-17.52-3.91-9.83-3.91-20.09t3.91-20.09q3.91-9.82 11.61-17.52l184-184q15.95-15.96 37.54-15.96t37.55 15.96q15.95 15.96 15.95 37.83 0 21.87-15.95 37.82l-146.4 146.39Zm553.66-.86L610.87-626.39q-15.52-15.52-15.24-37.33.28-21.8 15.8-37.32 15.53-15.53 37.05-15.24 21.52.28 37.04 15.24l184 183.43q7.7 7.7 11.61 17.52 3.91 9.83 3.91 20.09t-3.91 20.09q-3.91 9.82-11.61 17.52l-184 184q-15.95 15.96-37.32 15.74-21.37-.22-37.33-16.18-15.96-15.95-15.96-37.82t15.96-37.83l145.96-145.95Z"/></svg>',train:'<svg xmlns="http://www.w3.org/2000/svg" height="48px" viewBox="0 -960 960 960" width="48px" fill="#333333"><path d="M140.78-348.48V-720q0-60.23 30.61-96.03 30.61-35.8 79-53.99 48.39-18.2 109-23.7t120.61-5.5q66 0 127.33 5.5 61.32 5.5 108.5 23.7 47.17 18.19 75.28 53.99T819.22-720v371.52q0 69.74-46.72 119.57-46.72 49.82-114.2 53.22l20 20q19.83 19.82 9.42 45-10.42 25.17-38.79 25.17-8.28 0-15.63-3.07-7.34-3.06-13.47-8.63L542.48-174H417.52l-77.35 76.78q-6.13 5.57-13.54 8.63-7.42 3.07-15.41 3.07-27.52 0-38.44-25.17-10.91-25.18 8.92-45l20-20q-67.48-3.4-114.2-53.22-46.72-49.83-46.72-119.57ZM480-793.22q-106 0-155 12.5t-67 27.5h441.22q-15-17-61.11-28.5T480-793.22Zm-233.22 240H440v-120H246.78v120Zm397.39 80H246.78h466.44-69.05Zm-124.17-80h193.22v-120H520v120ZM343.39-316.61q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17Zm273.22 0q26 0 43-17t17-43q0-26-17-43t-43-17q-26 0-43 17t-17 43q0 26 17 43t43 17ZM315.83-280h328.34q29.39 0 49.22-19.4t19.83-49.08v-124.74H246.78v124.74q0 29.68 19.83 49.08t49.22 19.4ZM480-753.22H699.22 258h222Z"/></svg>'},DARK_MARKERS={apparel:LIGHT_MARKERS.apparel,beautician:LIGHT_MARKERS.beautician,housewife:LIGHT_MARKERS.housewife,retail:LIGHT_MARKERS.retail,"male-twin":LIGHT_MARKERS["male-twin"],"female-twin":LIGHT_MARKERS["female-twin"],train:LIGHT_MARKERS.train.replace("#333333","#EAEAEA"),beer:LIGHT_MARKERS.beer.replace("#BD5C17","#D7AD8F"),buysell:LIGHT_MARKERS.buysell.replace("#333333","#EAEAEA"),cattle:LIGHT_MARKERS.cattle.replace("#BD5C17","#D7AD8F"),church:LIGHT_MARKERS.church.replace("#333333","#EAEAEA"),dna:LIGHT_MARKERS.dna.replace("#9831CF","#B73DF9"),intelligence:LIGHT_MARKERS.intelligence.replace("#4285F4","#4B8FFF"),farming:LIGHT_MARKERS.farming.replace("#259F31","#28BC36"),government:LIGHT_MARKERS.government.replace("#333333","#EAEAEA"),investigate:LIGHT_MARKERS.investigate.replace("#333333","#EAEAEA"),manufacturing:LIGHT_MARKERS.manufacturing,military:LIGHT_MARKERS.military.replace("#E99E0E","#FFB11B"),police:LIGHT_MARKERS.police.replace("#4285F4","#4B8FFF"),sales:LIGHT_MARKERS.sales.replace("#E99E0E","#FFB11B"),prelations:LIGHT_MARKERS.prelations.replace("#E99E0E","#FFB11B"),seaman:LIGHT_MARKERS.seaman.replace("#333333","#EAEAEA"),computer:LIGHT_MARKERS.computer.replace("#333333","#FFFFFF"),software:LIGHT_MARKERS.software.replace("#333333","#FFFFFF"),manager:LIGHT_MARKERS.manager.replace("#333333","#FFFFFF")};let MARKERS={};for(const[zK1,AK1]of Object.entries(isDark?DARK_MARKERS:LIGHT_MARKERS))MARKERS[zK1]="data:image/svg+xml;base64,"+btoa(AK1);for(var TREE_DATA=[{key:"TEMP-000",prefix:"",firstName:"Yosef Lue",middleName:"Adanza",lastName:"Argabioso",suffix:"",gender:"M",birthDate:"2024-12-16",deathDate:null,marriageDate:null,deathAge:null,living:!0,hasDNA:!1,hasImage:!1,birthPlace:null,deathPlace:null,livingPlace:null,marriagePlace:null,height:0,width:0},{key:"GQX8-CQP",child:"TEMP-000",prefix:"",firstName:"Arbyn",middleName:"Acosta",lastName:"Argabioso",suffix:"",gender:"M",birthDate:"1995-04-19",deathDate:null,marriageDate:null,deathAge:null,living:!0,hasDNA:!0,hasImage:!0,birthPlace:"Santa Cruz, Manila, PHL",deathPlace:null,livingPlace:"Metro Manila, PHL",marriagePlace:null,marker:"computer",marker3:"software"},{key:"GQJK-L51",child:"GQX8-CQP",prefix:"",firstName:"Rolando",middleName:"Saplala",lastName:"Argabioso",suffix:"",gender:"M",birthDate:"1965-10-09",deathDate:null,marriageDate:"2002-04-26",deathAge:null,living:!0,hasDNA:!0,hasImage:!0,birthPlace:"Poblacion, Caloocan, PHL",deathPlace:null,livingPlace:"Metro Manila, PHL",marriagePlace:"Diliman, Quezon City, PHL",marker:"intelligence",marker3:"government"},{key:"GQJK-LCT",child:"GQJK-L51",prefix:"",firstName:"Marcial",middleName:"Mia",lastName:"Argabioso",suffix:"",gender:"M",birthDate:"1932-10-13",deathDate:"2020-02-27",marriageDate:"1963-01-23",deathAge:null,living:!1,hasDNA:!1,hasImage:!0,birthPlace:"Majayjay, Laguna, PHL",deathPlace:"Quezon City, PHL",livingPlace:null,marriagePlace:"Luisiana, Laguna, PHL",marker:"beer",marker2:"farming"},{key:"GHBZ-TM4",child:"GQJK-LCT",prefix:"",firstName:"Eusebio",middleName:"Lopecillo",lastName:"Argabioso",suffix:"",gender:"M",birthDate:"about 1895",deathDate:"1972-10-27",marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:"Majayjay, Laguna, PHL",deathPlace:"Majayjay, Laguna, PHL",livingPlace:null,marriagePlace:null,marker:"farming"},{key:"GHB8-RCH",child:"GHBZ-TM4",prefix:"",firstName:"Estebana",middleName:"",lastName:"Lopecillo",suffix:"",gender:"F",birthDate:"about 1861",deathDate:"1951-08-30",marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:"Majayjay, Laguna, PHL",deathPlace:"Majayjay, Laguna, PHL",livingPlace:null,marriagePlace:null},{key:"G2HQ-YQS",child:"GHB8-RCH",prefix:"",firstName:"Simplicio",middleName:"",lastName:"Lopecillo",suffix:"",gender:"M",birthDate:null,deathDate:null,marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:null,deathPlace:null,livingPlace:null,marriagePlace:null},{key:"G2H7-Q75",child:"GHB8-RCH",prefix:"",firstName:"Gregoria",middleName:"",lastName:"Villarubin",suffix:"",gender:"F",birthDate:null,deathDate:null,marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:null,deathPlace:null,livingPlace:null,marriagePlace:null},{key:"GHBZ-P5Q",child:"GQJK-LCT",prefix:"",firstName:"Francisca",middleName:"",lastName:"Mia",suffix:"",gender:"F",birthDate:"before 1910",deathDate:"after 1936-10-13",marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:null,deathPlace:null,livingPlace:null,marriagePlace:null},{key:"GHBZ-YVX",child:"GQJK-L51",prefix:"",firstName:"Lydia",middleName:"Perez",lastName:"Saplala",suffix:"",gender:"F",birthDate:"1944-11-24",deathDate:null,marriageDate:"1963-01-23",deathAge:null,living:!0,hasDNA:!0,hasImage:!0,birthPlace:"Lubao, Pampanga, PHL",deathPlace:null,livingPlace:"Metro Manila, PHL",marriagePlace:"Luisiana, Laguna, PHL",marker:"retail",marker3:"sales"},{key:"GHB8-7T6",child:"GHBZ-YVX",prefix:"",firstName:"Fernando",middleName:"Sison",lastName:"Saplala",suffix:"",gender:"M",birthDate:"1916-05-30",deathDate:"1993-05-03",marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!0,birthPlace:"Lubao, Pampanga, PHL",deathPlace:"Caloocan, PHL",livingPlace:null,marriagePlace:null,marker:"military"},{key:"GNNH-JLM",child:"GHB8-7T6",prefix:"",firstName:"Estanislao",middleName:"",lastName:"Saplala",suffix:"",gender:"M",birthDate:null,deathDate:null,marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:null,deathPlace:null,livingPlace:null,marriagePlace:null},{key:"GJJX-1SG",child:"GHB8-7T6",prefix:"",firstName:"Adela",middleName:"",lastName:"Sison",suffix:"",gender:"F",birthDate:null,deathDate:null,marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:null,deathPlace:null,livingPlace:null,marriagePlace:null},{key:"GHB8-GZL",child:"GHBZ-YVX",prefix:"",firstName:"Lucina",middleName:"Gutierrez",lastName:"Perez",suffix:"",gender:"F",birthDate:"1919-11-16",deathDate:"1986-10-02",marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!0,birthPlace:"Orani, Bataan, PHL",deathPlace:"Dinalupihan, Bataan, PHL",livingPlace:null,marriagePlace:null,marker:"housewife"},{key:"GHB8-M8D",child:"GHB8-GZL",prefix:"",firstName:"Victor",middleName:"",lastName:"Perez",suffix:"",gender:"M",birthDate:null,deathDate:null,marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:null,deathPlace:null,livingPlace:null,marriagePlace:null},{key:"GHB8-M86",child:"GHB8-GZL",prefix:"",firstName:"Genoveba",middleName:"",lastName:"Gutierrez",suffix:"",gender:"F",birthDate:null,deathDate:null,marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:null,deathPlace:null,livingPlace:null,marriagePlace:null},{key:"GQJK-G8W",child:"GQX8-CQP",prefix:"",firstName:"Corazon",middleName:"Maramba",lastName:"Acosta",suffix:"",gender:"F",birthDate:"1971-03-10",deathDate:"2018-05-25",marriageDate:"2003-02-03",deathAge:null,living:!1,hasDNA:!1,hasImage:!0,birthPlace:"Sampaloc, Manila, PHL",deathPlace:"Santa Cruz, Laguna, PHL",livingPlace:null,marriagePlace:"Pasig City, PHL",marker:"housewife"},{key:"GHBD-7M4",child:"GQJK-G8W",prefix:"",firstName:"Manuel",middleName:"San Agustin",lastName:"Acosta",suffix:"Jr.",gender:"M",birthDate:"1948-07-06",deathDate:"1979-06-07",marriageDate:"1966-03-26",deathAge:null,living:!1,hasDNA:!1,hasImage:!0,birthPlace:"España, Manila, PHL",deathPlace:"Pasadena, California, USA",livingPlace:null,marriagePlace:"Santa Cruz, Manila, PHL",marker:"male-twin",marker2:"seaman",marker3:"beer"},{key:"GHBD-9L6",child:"GHBD-7M4",prefix:"",firstName:"Manuel",middleName:"Bongco",lastName:"Acosta",suffix:"Sr.",gender:"M",birthDate:"1913-11-10",deathDate:"1994-11-20",marriageDate:"1951-03-05",deathAge:null,living:!1,hasDNA:!1,hasImage:!0,birthPlace:"Orani, Bataan, PHL",deathPlace:"San Dimas, California, USA",livingPlace:null,marriagePlace:"Tondo, Manila, PHL",marker:"police",marker2:"investigate"},{key:"GHB8-SQN",child:"GHBD-9L6",prefix:"",firstName:"Ligorio",middleName:"",lastName:"Acosta",suffix:"",gender:"M",birthDate:"about 1871",deathDate:"1948-07-07",marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:"Orani, Bataan, PHL",deathPlace:"Santa Cruz, Manila, PHL",livingPlace:null,marriagePlace:null},{key:"GHB8-5K8",child:"GHBD-9L6",prefix:"",firstName:"Maximiana",middleName:"",lastName:"Bongco",suffix:"",gender:"F",birthDate:null,deathDate:"after 1951-03-05",marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:"PHL",deathPlace:null,livingPlace:null,marriagePlace:null},{key:"GHB8-DXY",child:"GHBD-7M4",prefix:"",firstName:"Natividad",middleName:"",lastName:"San Agustin",suffix:"",gender:"F",birthDate:"1925-12-21",deathDate:"2008-10-09",marriageDate:"1951-03-05",deathAge:null,living:!1,hasDNA:!1,hasImage:!0,birthPlace:"Ermita, Manila, PHL",deathPlace:"San Dimas, California, USA",livingPlace:null,marriagePlace:"Tondo, Manila, PHL",marker:"housewife"},{key:"GHB8-LCC",child:"GHB8-DXY",prefix:"",firstName:"Vicente",middleName:"",lastName:"San Agustin",suffix:"",gender:"M",birthDate:null,deathDate:null,marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:null,deathPlace:null,livingPlace:null,marriagePlace:null},{key:"GHB8-H7K",child:"GHB8-DXY",prefix:"",firstName:"Nena",middleName:"",lastName:"",suffix:"",gender:"F",birthDate:null,deathDate:null,marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:null,deathPlace:null,livingPlace:null,marriagePlace:null},{key:"GHB8-J1B",child:"GQJK-G8W",prefix:"",firstName:"Catalina",middleName:"Dumantay",lastName:"Maramba",suffix:"",gender:"F",birthDate:"1943-01-28",deathDate:"1974-08-10",marriageDate:"1966-03-26",deathAge:null,living:!1,hasDNA:!1,hasImage:!0,birthPlace:"Sta. Barbara, Pangasinan, PHL",deathPlace:"Sangandaan, Caloocan, PHL",livingPlace:null,marriagePlace:"Santa Cruz, Manila, PHL",marker:"housewife"},{key:"GHB8-GB6",child:"GHB8-J1B",prefix:"",firstName:"Sotero",middleName:"Reyes",lastName:"Maramba",suffix:"Sr.",gender:"M",birthDate:"1903-04-22",deathDate:"1969-12-12",marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!0,birthPlace:"Sta. Barbara, Pangasinan, PHL",deathPlace:"Sangandaan, Caloocan, PHL",livingPlace:null,marriagePlace:null,marker:"police",marker2:"train"},{key:"LLQS-641",child:"GHB8-GB6",prefix:"Don",firstName:"Miguel",middleName:"Bautista",lastName:"Maramba",suffix:"",gender:"M",birthDate:"about 1858",deathDate:"after 1902-06",marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:"Sta. Barbara, Pangasinan, PHL",deathPlace:"Sta. Barbara, Pangasinan, PHL",livingPlace:null,marriagePlace:null,marker:"government"},{key:"LLQS-6YC",child:"LLQS-641",prefix:"",firstName:"Guillermo",middleName:"Bautista",lastName:"Maramba",suffix:"",gender:"M",birthDate:"from 1800 to 1858",deathDate:null,marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:null,deathPlace:"Sta. Barbara, Pangasinan, PHL",livingPlace:null,marriagePlace:null,marker:"sales",marker2:"cattle"},{key:"L281-614",child:"LLQS-641",prefix:"",firstName:"Maria",middleName:"Garcia",lastName:"Bautista",suffix:"",gender:"F",birthDate:"from 1800 to 1858",deathDate:null,marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:null,deathPlace:"Sta. Barbara, Pangasinan, PHL",livingPlace:null,marriagePlace:null},{key:"GC7T-H59",child:"L281-614",prefix:"Don",firstName:"Agustin",middleName:"",lastName:"Bautista",suffix:"",gender:"M",birthDate:"from 1735 to 1853",deathDate:"after 1881",marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:null,deathPlace:null,livingPlace:null,marriagePlace:null,marker:"government"},{key:"GC7T-1PK",child:"L281-614",prefix:"Doña",firstName:"Felipa",middleName:"",lastName:"Garcia",suffix:"",gender:"F",birthDate:null,deathDate:null,marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:null,deathPlace:null,livingPlace:null,marriagePlace:null},{key:"LLQS-6F1",child:"GHB8-GB6",prefix:"",firstName:"Mercedes",middleName:"Novilla",lastName:"Reyes",suffix:"",gender:"F",birthDate:null,deathDate:null,marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:null,deathPlace:null,livingPlace:null,marriagePlace:null},{key:"G7C3-B6P",child:"LLQS-6F1",prefix:"",firstName:"Gregorio",middleName:"",lastName:"Reyes",suffix:"",gender:"M",birthDate:null,deathDate:null,marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:null,deathPlace:null,livingPlace:null,marriagePlace:null},{key:"G7C3-J9S",child:"LLQS-6F1",prefix:"",firstName:"Leocadia",middleName:"",lastName:"Novilla",suffix:"",gender:"F",birthDate:null,deathDate:null,marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:null,deathPlace:null,livingPlace:null,marriagePlace:null},{key:"GHBD-9LY",child:"GHB8-J1B",prefix:"",firstName:"Cresencia",middleName:"",lastName:"Dumantay",suffix:"",gender:"F",birthDate:"1918-04-19",deathDate:"1990-04-16",marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!0,birthPlace:"PHL",deathPlace:"Sangandaan, Caloocan, PHL",livingPlace:null,marriagePlace:null,marker:"apparel",marker2:"sales"},{key:"TEMP-001",child:"GHBD-9LY",prefix:"",firstName:"Unknown",middleName:"",lastName:"name",suffix:"",gender:"F",birthDate:"before 1908",deathDate:"after 1918-04-19",marriageDate:null,deathAge:"50+",living:!1,hasDNA:!1,hasImage:!0,birthPlace:"PHL",deathPlace:"PHL",livingPlace:null,marriagePlace:null},{key:"GHB5-TWN",child:"TEMP-000",prefix:"",firstName:"Mitchie",middleName:"Ajesta",lastName:"Adanza",suffix:"",gender:"F",birthDate:"1994-12-16",deathDate:null,marriageDate:null,deathAge:null,living:!0,hasDNA:!0,hasImage:!0,birthPlace:"Santa Cruz, Manila, PHL",deathPlace:null,livingPlace:"Metro Manila, PHL",marriagePlace:null,marker:"prelations"},{key:"GHB5-XTZ",child:"GHB5-TWN",prefix:"",firstName:"Darne",middleName:"Elican",lastName:"Adanza",suffix:"",gender:"M",birthDate:"1964-06-22",deathDate:null,marriageDate:"1994-01-25",deathAge:null,living:!0,hasDNA:!1,hasImage:!0,birthPlace:"Balingasag, Misamis Or., PHL",deathPlace:null,livingPlace:"Metro Manila, PHL",marriagePlace:"Sta. Maria, Bulacan, PHL",marker:"manufacturing",marker2:"prelations"},{key:"GH12-SVQ",child:"GHB5-XTZ",prefix:"",firstName:"Nestor",middleName:"Ladera",lastName:"Adanza",suffix:"",gender:"M",birthDate:"1938-02-26",deathDate:"2018-09-28",marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!0,birthPlace:"Balingasag, Misamis Oriental, PHL",deathPlace:"Balingasag, Misamis Oriental, PHL",livingPlace:null,marriagePlace:null,marker:"farming"},{key:"GH12-DRN",child:"GH12-SVQ",prefix:"",firstName:"Felomino",middleName:"R",lastName:"Adanza",suffix:"",gender:"M",birthDate:"about 1901",deathDate:"1990-11-03",marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!0,birthPlace:"Dumaguete, Negros Oriental, PHL",deathPlace:"Balingasag, Misamis Oriental, PHL",livingPlace:null,marriagePlace:null,marker:"farming"},{key:"GH12-3GN",child:"GH12-SVQ",prefix:"",firstName:"Consuelo",middleName:"",lastName:"Ladera",suffix:"",gender:"F",birthDate:null,deathDate:"after 1990-11-03",marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!0,birthPlace:"PHL",deathPlace:"PHL",livingPlace:null,marriagePlace:null},{key:"GH12-9F6",child:"GHB5-XTZ",prefix:"",firstName:"Rufa",middleName:"Acerto",lastName:"Elican",suffix:"",gender:"F",birthDate:"1939-11-28",deathDate:"2015-04-02",marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!0,birthPlace:"Balingasag, Misamis Oriental, PHL",deathPlace:"Balingasag, Misamis Oriental, PHL",livingPlace:null,marriagePlace:null,marker:"farming"},{key:"GH12-9JZ",child:"GH12-9F6",prefix:"",firstName:"Cecilio",middleName:"",lastName:"Elican",suffix:"",gender:"M",birthDate:null,deathDate:null,marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:null,deathPlace:null,livingPlace:null,marriagePlace:null,marker:"military"},{key:"GH12-35H",child:"GH12-9F6",prefix:"",firstName:"Jovita",middleName:"",lastName:"Acerto",suffix:"",gender:"F",birthDate:null,deathDate:null,marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:null,deathPlace:null,livingPlace:null,marriagePlace:null},{key:"GHBR-FK3",child:"GHB5-TWN",prefix:"",firstName:"Mylen",middleName:"Vergara",lastName:"Ajesta",suffix:"",gender:"F",birthDate:"1974-04-13",deathDate:null,marriageDate:"1994-01-25",deathAge:null,living:!0,hasDNA:!1,hasImage:!0,birthPlace:"Sinamongan, Pilar, Capiz, PHL",deathPlace:null,livingPlace:"Manama, BHR",marriagePlace:"Sta. Maria, Bulacan, PHL",marker:"beautician",marker3:"manager",marker2:"prelations"},{key:"GH12-Z3C",child:"GHBR-FK3",prefix:"",firstName:"Napoleon Crispolon",middleName:"Badoles",lastName:"Ajesta",suffix:"",gender:"M",birthDate:"before 1968",deathDate:"after 1980-02-26",marriageDate:"1962-08-05",deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:"Binaobawan, Pilar, Capiz, PHL",deathPlace:"PHL",livingPlace:null,marriagePlace:"Pilar, Capiza, PHL"},{key:"GH12-XX4",child:"GH12-Z3C",prefix:"",firstName:"Emmanuel",middleName:"",lastName:"Ajesta",suffix:"",gender:"M",birthDate:"around 1903",deathDate:"after 1922-02-15",marriageDate:"1922-02-15",deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:"Pilar, Capiz, PHL",deathPlace:null,livingPlace:null,marriagePlace:"Pontevedra, Capiz, PHL"},{key:"GKBR-M9Y",child:"GH12-XX4",prefix:"",firstName:"Eustaquio",middleName:"",lastName:"Ajesta",suffix:"",gender:"M",birthDate:null,deathDate:null,marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:null,deathPlace:null,livingPlace:null,marriagePlace:null},{key:"GKBR-7P7",child:"GH12-XX4",prefix:"",firstName:"Florencia",middleName:"",lastName:"Bermúdez",suffix:"",gender:"F",birthDate:null,deathDate:null,marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:null,deathPlace:null,livingPlace:null,marriagePlace:null},{key:"GH12-HQN",child:"GH12-Z3C",prefix:"",firstName:"Ursula",middleName:"",lastName:"Badoles",suffix:"",gender:"F",birthDate:"around 1904",deathDate:"after 1922-02-15",marriageDate:"1922-02-15",deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:null,deathPlace:null,livingPlace:null,marriagePlace:"Pontevedra, Capiz, PHL"},{key:"GKBT-9GD",child:"GH12-HQN",prefix:"",firstName:"Pedro Benjamin",middleName:"",lastName:"Badoles",suffix:"",gender:"M",birthDate:null,deathDate:null,marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:null,deathPlace:null,livingPlace:null,marriagePlace:null},{key:"K2GJ-YY3",child:"GH12-HQN",prefix:"",firstName:"Leoncia",middleName:"",lastName:"Villanes",suffix:"",gender:"F",birthDate:"about 1852",deathDate:"1922-01-08",marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:"Panay, Capiz, PHL",deathPlace:"Panay, Capiz, PHL",livingPlace:null,marriagePlace:null},{key:"GH12-W17",child:"GHBR-FK3",prefix:"",firstName:"Zelma",middleName:"Borja",lastName:"Vergara",suffix:"",gender:"F",birthDate:"1941-07-08",deathDate:"2020-02-16",marriageDate:"1962-08-05",deathAge:null,living:!1,hasDNA:!1,hasImage:!0,birthPlace:"Dulangan, Pilar, Capiz, PHL",deathPlace:"Santa Maria, Bulacan, PHL",livingPlace:null,marriagePlace:"Pilar, Capiza, PHL",marker:"farming"},{key:"GH12-6YL",child:"GH12-W17",prefix:"",firstName:"Benigno",middleName:"",lastName:"Vergara",suffix:"",gender:"M",birthDate:null,deathDate:null,marriageDate:null,deathAge:null,living:!1,hasDNA:!1,hasImage:!1,birthPlace:null,deathPlace:null,livingPlace:null,marriagePlace:null},{key:"GH12-DD8",child:"GH12-W17",prefix:"",firstName:"Enoria",middleName:"",lastName:"Borja",suffix:"",gender:"F",birthDate:null,deathDate:"after 1997-12-16",marriageDate:null,deathAge:"90+",living:!1,hasDNA:!1,hasImage:!1,birthPlace:null,deathPlace:null,livingPlace:null,marriagePlace:null}],i=TREE_DATA.length-1;0<=i;i--)TREE_DATA[i].parent=TREE_DATA[i].child;function convertCountryCode(t){var e;return null==t?t:(e={USA:"United States of America",PHL:"Philippines",BHR:"Bahrain"},1===(t=t.split(",").map(t=>t.trim())).length&&e[t[0]]?e[t[0]]:(2===t.length&&e[t[1]]&&(t[1]=e[t[1]]),t.join(", ")))}for(const[i,FK1]of Object.entries(TREE_DATA))if(null!=FK1.firstName){let e=FK1.middleName.trim().split(" "),s="";if(""!=e[0])for(let t=0;t<e.length;t++)s+=e[t][0]+". ";let t="",n="",r=(void 0!==FK1.prefix&&""!=FK1.prefix&&(t=FK1.prefix+" "),void 0!==FK1.suffix&&""!=FK1.suffix&&(n=" "+FK1.suffix),FK1.firstName);TREE_DATA[i].fullName=t+r+" "+s+FK1.lastName+n,TREE_DATA[i].birthPlace=convertCountryCode(FK1.birthPlace),TREE_DATA[i].deathPlace=convertCountryCode(FK1.deathPlace),TREE_DATA[i].livingPlace=convertCountryCode(FK1.livingPlace),FK1.living&&(TREE_DATA[i].deathPlace=FK1.livingPlace)}var childToParents={};TREE_DATA.forEach(t=>{t.child&&(childToParents[t.child]?childToParents[t.child].push(t.key):childToParents[t.child]=[t.key])}),TREE_DATA.forEach(e=>{e.partner=null,e.child&&1<childToParents[e.child].length&&(e.partner=childToParents[e.child].find(t=>t!==e.key))});const SOURCES={"Present and Direct Interactions":["TEMP-000:GHB5-TWN:parentChild","TEMP-000:GQX8-CQP:parentChild","GHB5-TWN:GQX8-CQP:partner","GHB5-TWN:firstName","GHB5-TWN:gender","GHB5-TWN:lastName","GHB5-TWN:middleName","GQX8-CQP:birthDate","GQX8-CQP:firstName","GQX8-CQP:gender","GQX8-CQP:lastName","GQX8-CQP:middleName","GQJK-LCT:deathPlace","GQX8-CQP:marker","GQJK-G8W:marker","GQJK-L51:marker","GHBZ-YVX:marker","GHB5-XTZ:marker","GHBR-FK3:marker","GHBR-FK3:marker2","GH12-W17:deathDate","GH12-W17:deathPlace","GH12-W17:living"],"SENTIMENTS OF LIVING RELATIVES":["GHBZ-TM4:birthPlace","GHB8-RCH:birthPlace","GHBD-7M4:marker2","GHB8-J1B:deathDate","GH12-SVQ:firstName","GH12-SVQ:lastName","GH12-SVQ:birthPlace","GHBZ-P5Q:living","GHBZ-P5Q:deathDate","GHB8-7T6:middleName","GHB8-7T6:birthDate","GHB8-7T6:birthPlace","GHB8-7T6:deathDate","GHB8-7T6:deathPlace","GHB8-7T6:living","GHB8-7T6:marker","GHB8-GZL:middleName","GHB8-GZL:lastName","GHB8-GZL:birthDate","GHB8-GZL:birthPlace","GHB8-GZL:deathDate","GHB8-GZL:deathPlace","GHB8-GZL:living","GNNH-JLM:firstName","GNNH-JLM:lastName","GNNH-JLM:gender","GNNH-JLM:GHB8-7T6:parentChild","GJJX-1SG:firstName","GJJX-1SG:lastName","GJJX-1SG:gender","GJJX-1SG:GHB8-7T6:parentChild","GNNH-JLM:GJJX-1SG:partner","GHB8-M8D:firstName","GHB8-M8D:lastName","GHB8-M8D:gender","GHB8-M8D:GHB8-GZL:parentChild","GHB8-M86:firstName","GHB8-M86:lastName","GHB8-M86:gender","GHB8-M86:GHB8-GZL:parentChild","GHB8-M8D:GHB8-M86:partner","GH12-DRN:firstName","GH12-DRN:lastName","GH12-DRN:birthPlace","GH12-3GN:firstName","GH12-3GN:lastName","GH12-9JZ:firstName","GH12-9JZ:lastName","GH12-35H:firstName","GH12-35H:lastName","GH12-XX4:firstName","GH12-XX4:lastName","GH12-HQN:firstName","GH12-HQN:lastName","GH12-6YL:firstName","GH12-6YL:lastName","GH12-DD8:firstName","GH12-DD8:lastName","GH12-Z3C:living","GHBD-9LY:birthPlace","GHBD-9LY:marker","LLQS-641:firstName","LLQS-641:GHB8-GB6:parentChild","TEMP-001:GHBD-9LY:parentChild"],"Existance of same-name son":["GHBD-9L6:suffix","GHB8-GB6:suffix"],"Existance of same-name father":["GHBD-7M4:suffix"],"PROBABLY NOT LIVING ANYMORE":["GHBZ-TM4:living","GHB8-RCH:living","G2HQ-YQS:living","G2H7-Q75:living","GNNH-JLM:living","GJJX-1SG:living","GHB8-M8D:living","GHB8-M86:living","GHB8-SQN:living","GHB8-5K8:living","GHB8-LCC:living","GHB8-H7K:living","LLQS-641:living","LLQS-6YC:living","L281-614:living","GC7T-H59:living","GC7T-1PK:living","LLQS-6F1:living","G7C3-B6P:living","G7C3-J9S:living","TEMP-001:living","GKBR-M9Y:living","GKBR-7P7:living","GKBT-9GD:living","K2GJ-YY3:living"],"https://drive.google.com/file/d/1B1umw_xm5i-AmNp9YzshX2DebSAhj3cz/view":["GQX8-CQP:birthPlace","GQX8-CQP:firstName","GQX8-CQP:middleName","GQX8-CQP:gender","GQX8-CQP:birthDate","GQJK-G8W:GQX8-CQP:parentChild","GQJK-G8W:gender","GQJK-G8W:firstName","GQJK-G8W:middleName","GQJK-G8W:lastName","GQJK-G8W:marker","GQJK-L51:GQX8-CQP:parentChild","GQJK-L51:gender","GQJK-L51:firstName","GQJK-L51:middleName","GQJK-L51:lastName","GQJK-L51:GQJK-G8W:partner"],"https://drive.google.com/file/d/1nJVXB-p0ZM0OUXsXK4TyI7JRwvbDln53/view":["GQX8-CQP:firstName","GQX8-CQP:middleName","GQX8-CQP:lastName","GQX8-CQP:birthDate","GQJK-G8W:GQX8-CQP:parentChild","GQJK-G8W:gender","GQJK-G8W:firstName","GQJK-G8W:lastName","GQJK-G8W:birthPlace","GQJK-L51:GQX8-CQP:parentChild","GQJK-L51:gender","GQJK-L51:firstName","GQJK-L51:lastName","GQJK-L51:birthPlace","GQJK-L51:GQJK-G8W:partner"],"https://www.facebook.com/arbyn.argabioso/posts/pfbid02U3X7BU11Lb41vrbLQKrAyGe8oCEvd8SSqbY8rcCZ2MEQzcb3BUQJWL8UPhF1ZttYl":["GQX8-CQP:GHB5-TWN:partner"],"https://www.youtube.com/watch?v=LNkv-M1TMtg":["GQX8-CQP:GHB5-TWN:partner"],"https://drive.google.com/file/d/1degLEAa8cBBxJrRsWwz0t6wHh9vs29cH/view":["GQJK-L51:birthPlace","GQJK-L51:firstName","GQJK-L51:middleName","GQJK-L51:lastName","GQJK-L51:gender","GQJK-L51:birthDate","GQJK-LCT:GQJK-L51:parentChild","GQJK-LCT:gender","GQJK-LCT:firstName","GQJK-LCT:middleName","GQJK-LCT:lastName","GQJK-LCT:birthPlace","GHBZ-YVX:GQJK-L51:parentChild","GHBZ-YVX:gender","GHBZ-YVX:firstName","GHBZ-YVX:middleName","GHBZ-YVX:lastName","GHBZ-YVX:birthPlace","GQJK-LCT:GHBZ-YVX:partner","GQJK-LCT:marriageDate","GQJK-LCT:marriagePlace","GHBZ-YVX:marriageDate","GHBZ-YVX:marriagePlace"],"https://drive.google.com/file/d/1kMHiW0mbPuPGyGOBm08qY6yWgvnHd82K/view":["GQJK-L51:gender","GQJK-L51:firstName","GQJK-L51:middleName","GQJK-L51:lastName","GQJK-L51:birthDate","GQJK-L51:birthPlace","GQJK-LCT:GQJK-L51:parentChild","GQJK-LCT:gender","GQJK-LCT:firstName","GQJK-LCT:middleName","GQJK-LCT:lastName","GHBZ-YVX:GQJK-L51:parentChild","GHBZ-YVX:gender","GHBZ-YVX:firstName","GHBZ-YVX:middleName","GHBZ-YVX:lastName","GQJK-LCT:GHBZ-YVX:partner","GQJK-L51:marriagePlace","GQJK-L51:marriageDate"],"https://drive.google.com/file/d/1Zw8fzrh9ELRvIx1W7ncqT010edcT6hpK/view":["GQJK-L51:marker","GQJK-L51:firstName","GQJK-L51:lastName"],"https://drive.google.com/file/d/1C2TFs8kVvf6lWq-ANjEEG165f7bWUZCs/view?side=argabioso":["GQJK-LCT:GHBZ-YVX:partner","GQJK-LCT:marriagePlace","GQJK-LCT:gender","GQJK-LCT:firstName","GQJK-LCT:lastName","GHBZ-TM4:GQJK-LCT:parentChild","GHBZ-TM4:gender","GHBZ-TM4:firstName","GHBZ-TM4:lastName","GHBZ-P5Q:GQJK-LCT:parentChild","GHBZ-P5Q:gender","GHBZ-P5Q:firstName","GHBZ-P5Q:lastName","GHBZ-TM4:GHBZ-P5Q:partner","GQJK-LCT:marriageDate"],"https://drive.google.com/file/d/1tu21m1RMRjiTwPfzp1VrFENbPUhLsEKq/view":["GQJK-LCT:firstName","GQJK-LCT:lastName","GHBZ-TM4:firstName","GHBZ-TM4:lastName"],"https://drive.google.com/file/d/1x1M6Z1asZU99nMTdtKYdfDxY_w_s2Gnc/view":["GQJK-LCT:living","GQJK-LCT:firstName","GQJK-LCT:middleName","GQJK-LCT:lastName","GQJK-LCT:birthDate","GQJK-LCT:deathDate","GQJK-LCT:gender"],"https://drive.google.com/file/d/1SQy34nGR1Z5-AqNSZDInfkewArzP_xqp/view":["GHBZ-TM4:living","GHBZ-TM4:deathPlace","GHBZ-TM4:firstName","GHBZ-TM4:middleName","GHBZ-TM4:lastName","GHBZ-TM4:deathDate","GHBZ-TM4:gender","GHBZ-P5Q:living","GHBZ-TM4:birthDate","GHBZ-TM4:marker","GHBZ-TM4:birthPlace","GHB8-RCH:GHBZ-TM4:parentChild","GHB8-RCH:gender","GHB8-RCH:firstName","GHB8-RCH:lastName"],"https://drive.google.com/file/d/1yf_M5CJgnXsHGFvFmF5Uzfp4YrsAnfUY/view":["GHB8-RCH:living","GHB8-RCH:deathPlace","GHB8-RCH:firstName","GHB8-RCH:lastName","GHB8-RCH:gender","GHB8-RCH:deathDate","GHB8-RCH:birthDate","GHB8-RCH:birthPlace"],"https://www.familysearch.org/ark:/61903/1:1:66XW-VQRT":["G2HQ-YQS:GHB8-RCH:parentChild","G2HQ-YQS:firstName","G2HQ-YQS:lastName","G2HQ-YQS:gender","G2H7-Q75:GHB8-RCH:parentChild","G2H7-Q75:firstName","G2H7-Q75:lastName","G2H7-Q75:gender","G2HQ-YQS:G2H7-Q75:partner"],"https://www.familysearch.org/ark:/61903/1:1:66X6-LG3J":["G2HQ-YQS:GHB8-RCH:parentChild","G2HQ-YQS:firstName","G2HQ-YQS:lastName","G2HQ-YQS:gender","G2H7-Q75:GHB8-RCH:parentChild","G2H7-Q75:firstName","G2H7-Q75:lastName","G2H7-Q75:gender","G2HQ-YQS:G2H7-Q75:partner"],"https://drive.google.com/file/d/1Yy9S1Y4NOilHHulCeejkeeY1BUbzgRyn/view":["GHBZ-YVX:firstName","GHBZ-YVX:middleName","GHBZ-YVX:lastName","GHBZ-YVX:gender","GHBZ-YVX:birthDate","GHBZ-YVX:birthPlace","GHBZ-YVX:living","GHB8-GZL:GHBZ-YVX:parentChild","GHB8-GZL:gender","GHB8-GZL:firstName","GHB8-GZL:middleName","GHB8-GZL:lastName","GHB8-GZL:marker","GHB8-7T6:GHBZ-YVX:parentChild","GHB8-7T6:gender","GHB8-7T6:firstName","GHB8-7T6:middleName","GHB8-7T6:lastName","GHB8-7T6:marker","GHB8-7T6:GHB8-GZL:partner","GQJK-LCT:GHBZ-YVX:partner"],"https://drive.google.com/file/d/1C2TFs8kVvf6lWq-ANjEEG165f7bWUZCs/view?side=saplala":["GQJK-LCT:GHBZ-YVX:partner","GHBZ-YVX:marriagePlace","GHBZ-YVX:gender","GHBZ-YVX:firstName","GHBZ-YVX:lastName","GHB8-7T6:GHBZ-YVX:parentChild","GHB8-7T6:gender","GHB8-7T6:firstName","GHB8-7T6:lastName","GHB8-GZL:GHBZ-YVX:parentChild","GHB8-GZL:gender","GHB8-GZL:firstName","GHB8-GZL:lastName","GHB8-7T6:GHB8-GZL:partner","GHBZ-YVX:marriageDate"],"https://drive.google.com/file/d/1Db5lGDp-mhJH7LAXnuijFXBc1c1vA07j/view":["GQJK-G8W:birthPlace","GQJK-G8W:firstName","GQJK-G8W:middleName","GQJK-G8W:lastName","GQJK-G8W:birthDate","GHBD-7M4:GQJK-G8W:parentChild","GHBD-7M4:firstName","GHBD-7M4:middleName","GHBD-7M4:lastName","GHBD-7M4:birthPlace","GHBD-7M4:marker2","GHB8-J1B:GQJK-G8W:parentChild","GHB8-J1B:firstName","GHB8-J1B:middleName","GHB8-J1B:lastName","GHBD-7M4:GHB8-J1B:partner","GHBD-7M4:marriageDate","GHBD-7M4:marriagePlace","GHB8-J1B:marriageDate","GHB8-J1B:marriagePlace"],"https://drive.google.com/file/d/1yqWECbcDTyhFig6IiK_AqPwXfL7gk0e0/view":["GQJK-G8W:firstName","GQJK-G8W:lastName","GQJK-G8W:birthDate","GHBD-7M4:GQJK-G8W:parentChild","GHBD-7M4:gender","GHBD-7M4:firstName","GHBD-7M4:lastName","GHBD-7M4:birthPlace","GHB8-J1B:GQJK-G8W:parentChild","GHB8-J1B:gender","GHB8-J1B:firstName","GHB8-J1B:lastName","GHB8-J1B:birthPlace"],"https://drive.google.com/file/d/17vMMCyBJ2qOyjFYCtb7UWkIJrRymiz8_/view":["GQJK-G8W:gender","GQJK-G8W:firstName","GQJK-G8W:middleName","GQJK-G8W:lastName","GQJK-G8W:birthPlace","GHBD-7M4:GQJK-G8W:parentChild","GHBD-7M4:gender","GHBD-7M4:firstName","GHBD-7M4:lastName","GHB8-J1B:GQJK-G8W:parentChild","GHB8-J1B:gender","GHB8-J1B:firstName","GHB8-J1B:lastName","GHBD-7M4:GHB8-J1B:partner","GQJK-G8W:marriagePlace","GQJK-G8W:marriageDate"],"https://drive.google.com/file/d/1JArFl6_m-kuvyPf-LqDLU3_SapZzCvkt/view":["GQJK-G8W:living","GQJK-G8W:firstName","GQJK-G8W:lastName","GQJK-G8W:gender","GQJK-G8W:deathDate","GQJK-G8W:birthDate","GQJK-G8W:deathPlace"],"https://drive.google.com/file/d/1sIWWgh8zfcIYtQfk2rIm4iW97sGzgK-x/view":["GQJK-G8W:living","GQJK-G8W:firstName","GQJK-G8W:middleName","GQJK-G8W:lastName","GQJK-G8W:birthDate","GQJK-G8W:deathDate"],"https://drive.google.com/file/d/1_3rvIfv82-KWjBsaZawQV4lMFUYSB_NK/view?side=acosta":["GHBD-7M4:GHB8-J1B:partner","GHBD-7M4:marriagePlace","GHBD-7M4:gender","GHBD-7M4:firstName","GHBD-7M4:lastName","GHBD-7M4:suffix","GHBD-9L6:GHBD-7M4:parentChild","GHBD-9L6:gender","GHBD-9L6:firstName","GHBD-9L6:lastName","GHB8-DXY:GHBD-7M4:parentChild","GHB8-DXY:gender","GHB8-DXY:firstName","GHB8-DXY:lastName","GHBD-9L6:GHB8-DXY:partner","GHBD-7M4:marriageDate"],"https://drive.google.com/file/d/1zjeJs9azWMLnnEjulRpAnBi8Vno4H_9U/view?side=acosta":["GHBD-7M4:marriagePlace","GHBD-7M4:marriageDate","GHBD-7M4:firstName","GHBD-7M4:middleName","GHBD-7M4:lastName"],"https://drive.google.com/file/d/194CO9-EnmMLwhHPGe0qTO1d3G7HGtTZl/view":["GHBD-7M4:living","GHBD-7M4:firstName","GHBD-7M4:middleName","GHBD-7M4:lastName","GHBD-7M4:suffix","GHBD-7M4:birthDate","GHBD-7M4:birthPlace","GHBD-7M4:deathDate","GHBD-7M4:deathPlace","GHBD-9L6:GHBD-7M4:parentChild","GHBD-9L6:firstName","GHBD-9L6:lastName","GHBD-9L6:gender","GHBD-9L6:birthPlace","GHB8-DXY:GHBD-7M4:parentChild","GHB8-DXY:firstName","GHB8-DXY:gender","GHB8-DXY:birthPlace","GHBD-9L6:GHB8-DXY:partner"],"https://drive.google.com/file/d/1Yclt46UY9IV4Pp4xyfuZitegj4B5iXN7/view":["GHBD-7M4:living","GHBD-7M4:firstName","GHBD-7M4:middleName","GHBD-7M4:lastName","GHBD-7M4:deathDate","GHBD-7M4:deathPlace","GHBD-7M4:birthDate","GHBD-7M4:birthPlace"],"https://drive.google.com/file/d/1L4zy5f_l9gYFBQQ68WdVFLDunwFoKgru/view?side=acosta":["GHBD-9L6:GHB8-DXY:partner","GHBD-9L6:gender","GHBD-9L6:firstName","GHBD-9L6:middleName","GHBD-9L6:lastName","GHB8-SQN:GHBD-9L6:parentChild","GHB8-SQN:gender","GHB8-SQN:firstName","GHB8-SQN:lastName","GHB8-5K8:GHBD-9L6:parentChild","GHB8-5K8:gender","GHB8-5K8:firstName","GHB8-5K8:lastName","GHB8-SQN:GHB8-5K8:partner","GHBD-9L6:marriagePlace","GHBD-9L6:marriageDate"],"https://drive.google.com/file/d/16SOA-h6729Zochb7g906v_LH7Mej7dn6/view?side=acosta":["GHBD-9L6:GHB8-DXY:partner","GHBD-9L6:firstName","GHBD-9L6:middleName","GHBD-9L6:lastName","GHBD-9L6:GHBD-7M4:parentChild","GHB8-DXY:GHBD-7M4:parentChild","GHBD-7M4:firstName","GHBD-7M4:birthDate","GHBD-7M4:marker"],"https://drive.google.com/file/d/1JuyRHuSaar2p3RM0nUjWX-KPMAGjk2FK/view":["GHBD-9L6:living","GHBD-9L6:firstName","GHBD-9L6:middleName","GHBD-9L6:lastName","GHBD-9L6:birthDate","GHBD-9L6:gender","GHBD-9L6:deathDate","GHBD-9L6:birthPlace","GHBD-9L6:marker","GHBD-9L6:marker2","GHB8-DXY:GHBD-9L6:partner","GHB8-DXY:gender","GHB8-DXY:firstName","GHB8-DXY:lastName","GHB8-SQN:GHBD-9L6:parentChild","GHB8-SQN:gender","GHB8-SQN:lastName","GHB8-SQN:birthPlace","GHB8-5K8:GHBD-9L6:parentChild","GHB8-5K8:gender","GHB8-5K8:lastName","GHB8-5K8:birthPlace","GHB8-SQN:GHB8-5K8:partner","GHBD-9L6:deathPlace"],"https://drive.google.com/file/d/1MIuMf7Q89LU89gmeNNZlH8lgKeMUR_yU/view":["GHB8-SQN:living","GHB8-SQN:firstName","GHB8-SQN:lastName","GHB8-SQN:gender","GHB8-SQN:deathDate","GHB8-SQN:birthDate","GHB8-SQN:deathPlace","GHB8-5K8:firstName","GHB8-5K8:lastName","GHBD-9L6:firstName","GHBD-9L6:middleName","GHBD-9L6:lastName"],"https://drive.google.com/file/d/1AL6hsO1Snvv-_aOovfP88-w0oxPjQs4i/view":["GHB8-SQN:living","GHB8-SQN:deathPlace","GHB8-SQN:firstName","GHB8-SQN:lastName","GHB8-SQN:birthDate","GHB8-SQN:gender","GHB8-SQN:deathDate","GHB8-SQN:birthPlace","GHB8-DXY:firstName","GHB8-DXY:lastName"],"https://drive.google.com/file/d/1L4zy5f_l9gYFBQQ68WdVFLDunwFoKgru/view?side=san+agustin":["GHBD-9L6:GHB8-DXY:partner","GHB8-DXY:gender","GHB8-DXY:firstName","GHB8-DXY:lastName","GHB8-LCC:GHB8-DXY:parentChild","GHB8-LCC:gender","GHB8-LCC:firstName","GHB8-LCC:lastName","GHB8-H7K:GHB8-DXY:parentChild","GHB8-H7K:gender","GHB8-H7K:firstName","GHB8-LCC:GHB8-H7K:partner","GHB8-DXY:marriagePlace","GHB8-DXY:marriageDate"],"https://drive.google.com/file/d/19m_AfnmTfHEdEy_IsgSWB9g1tREZnoJp/view":["GHB8-DXY:living","GHB8-DXY:firstName","GHB8-DXY:lastName","GHB8-DXY:birthDate","GHB8-DXY:deathDate","GHB8-DXY:deathPlace"],"https://drive.google.com/file/d/10Z0kurjxNy0s7M0um4w5SxFMAFWA8Ivm/view":["GHB8-DXY:living","GHB8-DXY:firstName","GHB8-DXY:GHBD-9L6:partner","GHB8-DXY:birthDate","GHB8-DXY:deathDate"],"https://drive.google.com/file/d/1gKlJX95oRihP2yIJ9ukp-0gFKWAAGiIL/view":["GHB8-J1B:firstName","GHB8-J1B:lastName","GHB8-J1B:gender","GHB8-J1B:birthDate","GHB8-GB6:GHB8-J1B:parentChild","GHB8-GB6:gender","GHB8-GB6:firstName","GHB8-GB6:lastName","GHBD-9LY:GHB8-J1B:parentChild","GHBD-9LY:gender","GHBD-9LY:firstName","GHBD-9LY:lastName","GHB8-GB6:GHBD-9LY:partner"],"https://drive.google.com/file/d/1_3rvIfv82-KWjBsaZawQV4lMFUYSB_NK/view?side=maramba":["GHBD-7M4:GHB8-J1B:partner","GHB8-J1B:marriagePlace","GHB8-J1B:gender","GHB8-J1B:firstName","GHB8-J1B:middleName","GHB8-J1B:lastName","GHB8-GB6:GHB8-J1B:parentChild","GHB8-GB6:gender","GHB8-GB6:firstName","GHB8-GB6:lastName","GHBD-9LY:GHB8-J1B:parentChild","GHBD-9LY:gender","GHBD-9LY:firstName","GHBD-9LY:lastName","GHB8-GB6:GHBD-9LY:partner","GHB8-J1B:marriageDate"],"https://drive.google.com/file/d/1zjeJs9azWMLnnEjulRpAnBi8Vno4H_9U/view?side=maramba":["GHB8-J1B:marriagePlace","GHB8-J1B:marriageDate","GHB8-J1B:firstName","GHB8-J1B:middleName","GHB8-J1B:lastName"],"https://drive.google.com/file/d/1AeoNewX7fEeAaihfBI3Tz6kNA9ia0m-D/view":["GHB8-J1B:deathPlace","GHB8-GB6:deathPlace","GHBD-9LY:deathPlace","GHB8-J1B:living","GHB8-J1B:firstName","GHB8-GB6:living","GHB8-GB6:firstName","GHB8-GB6:middleName","GHB8-GB6:lastName","GHB8-GB6:suffix","GHB8-GB6:birthDate","GHB8-GB6:deathDate","GHBD-9LY:living","GHBD-9LY:firstName","GHBD-9LY:lastName","GHBD-9LY:birthDate","GHBD-9LY:deathDate"],"https://drive.google.com/file/d/15o0fdYYMYTzXQ3ikiMCOqy-YlfAND76C/view":["GHB8-GB6:firstName","GHB8-GB6:lastName","GHB8-GB6:marker","GHB8-GB6:marker2"],"https://drive.google.com/file/d/1jorhb44fg6jrJcUDctHNB2BhVGUwDki7/view":[],"https://drive.google.com/file/d/1Pn6Xvn7ucwnzTgNTcFBsQq9hzAnARp51/view":["GHB8-GB6:living","GHB8-GB6:firstName","GHB8-GB6:lastName","GHB8-GB6:deathDate","GHB8-GB6:gender","GHB8-GB6:birthDate","GHB8-GB6:marker2","GHB8-GB6:birthPlace","GHBD-9LY:GHB8-GB6:partner","GHBD-9LY:gender","GHBD-9LY:firstName","GHBD-9LY:lastName"],"https://drive.google.com/file/d/1PGx6mKequtCtKWRjEAdJ999OX78Rgmvq/view":["LLQS-641:firstName","LLQS-641:middleName","LLQS-641:lastName","LLQS-641:gender","LLQS-641:birthDate","LLQS-6YC:LLQS-641:parentChild","LLQS-6YC:firstName","LLQS-6YC:middleName","LLQS-6YC:lastName","L281-614:LLQS-641:parentChild","L281-614:firstName","L281-614:middleName","L281-614:lastName","LLQS-6YC:L281-614:partner","LLQS-6F1:LLQS-641:partner","LLQS-6F1:gender","LLQS-6F1:firstName","LLQS-6F1:lastName","LLQS-641:GHB8-GB6:parentChild","GHB8-GB6:firstName","GHB8-GB6:lastName"],"https://drive.google.com/file/d/1CNF4lEbL4vfjbhMnTOEk02KFDhaO-Xwa/view":["LLQS-641:prefix","LLQS-641:firstName","LLQS-641:lastName","LLQS-6YC:LLQS-641:parentChild","L281-614:LLQS-641:parentChild"],"https://drive.google.com/file/d/1Ik8lFHm_F4-FaKOs4qL4CNiq-Il2WfLR/view":["LLQS-641:firstName","LLQS-641:lastName","LLQS-641:marker"],"https://drive.google.com/file/d/1cIXCw6wvKrPjzTYfpAfS3ri_Ms8ihSAS/view":["LLQS-6YC:gender","LLQS-6YC:birthDate"],"https://drive.google.com/file/d/1dDJs3rrAsbMSo_qp6my6J-wxE676FMEa/view":["LLQS-6YC:gender","LLQS-6YC:firstName","LLQS-6YC:lastName","LLQS-6YC:marker","LLQS-6YC:marker2","LLQS-6YC:deathPlace","L281-614:firstName","L281-614:lastName","L281-614:gender","L281-614:deathPlace","GC7T-H59:L281-614:parentChild","GC7T-H59:firstName","GC7T-H59:lastName","GC7T-1PK:L281-614:parentChild","GC7T-1PK:firstName","GC7T-1PK:lastName","GC7T-H59:GC7T-1PK:partner"],"https://drive.google.com/file/d/1eURb38MuWvI0RVG9IaHxEzs-rOt0vBgb/view":["L281-614:gender","L281-614:birthDate","GC7T-H59:L281-614:parentChild","GC7T-H59:gender","GC7T-H59:firstName","GC7T-H59:lastName","GC7T-1PK:L281-614:parentChild","GC7T-1PK:gender","GC7T-1PK:firstName","GC7T-1PK:lastName","GC7T-H59:GC7T-1PK:partner"],"https://drive.google.com/file/d/1fU_c4Ew4h9R85zZLDe5QQR-R2DDHT1Mq/view":["GC7T-H59:birthDate"],"https://drive.google.com/file/d/1ReDCDspaaaXQ4JoLgYcEznm-bGxhzc54/view":["GC7T-H59:firstName","GC7T-H59:lastName","GC7T-H59:gender","GC7T-H59:prefix","GC7T-H59:marker","GC7T-H59:deathDate"],"https://drive.google.com/file/d/19s_gdN98AQ1sZ5lhqSf8GrpJJIpFhsdf/view":["GHB5-TWN:birthPlace","GHB5-TWN:firstName","GHB5-TWN:middleName","GHB5-TWN:lastName","GHB5-TWN:gender","GHB5-TWN:birthDate","GHB5-XTZ:GHB5-TWN:parentChild","GHB5-XTZ:gender","GHB5-XTZ:firstName","GHB5-XTZ:middleName","GHB5-XTZ:lastName","GHBR-FK3:GHB5-TWN:parentChild","GHBR-FK3:gender","GHBR-FK3:firstName","GHBR-FK3:middleName","GHBR-FK3:lastName","GHBR-FK3:marker","GHB5-XTZ:GHBR-FK3:partner","GHB5-XTZ:marriageDate","GHBR-FK3:marriageDate"],"https://drive.google.com/file/d/1jYZqUHatNlvgDuyFw7jxSwgZsE6jy_9V/view":["GHB5-XTZ:firstName","GHB5-XTZ:middleName","GHB5-XTZ:lastName","GHB5-XTZ:gender","GHB5-XTZ:birthDate","GHB5-XTZ:birthPlace","GH12-9F6:GHB5-XTZ:parentChild","GH12-9F6:gender","GH12-9F6:firstName","GH12-9F6:lastName","GH12-SVQ:GHB5-XTZ:parentChild","GH12-SVQ:gender","GH12-SVQ:firstName","GH12-SVQ:lastName","GH12-9F6:GH12-SVQ:partner"],"https://drive.google.com/file/d/1rVr3RKFXqxPfw--yVwacLYGwyQFf6LzQ/view?side=adanza":["GHB5-XTZ:GHBR-FK3:partner","GHB5-XTZ:gender","GHB5-XTZ:firstName","GHB5-XTZ:lastName","GHB5-XTZ:birthPlace","GH12-SVQ:GHB5-XTZ:parentChild","GH12-SVQ:gender","GH12-SVQ:firstName","GH12-SVQ:lastName","GH12-9F6:GHB5-XTZ:parentChild","GH12-9F6:gender","GH12-9F6:firstName","GH12-9F6:lastName","GH12-9F6:GH12-SVQ:partner","GHB5-XTZ:marriagePlace","GHB5-XTZ:marriageDate"],"https://drive.google.com/file/d/1peIClAbyWzZV_kWcxPKAVBPDnVqFXG2Q/view":["GH12-SVQ:living","GH12-SVQ:firstName","GH12-SVQ:middleName","GH12-SVQ:lastName","GH12-SVQ:gender","GH12-SVQ:deathDate","GH12-SVQ:birthDate","GH12-SVQ:deathPlace","GH12-SVQ:marker","GH12-DRN:GH12-SVQ:parentChild","GH12-DRN:gender","GH12-DRN:firstName","GH12-DRN:lastName","GH12-3GN:GH12-SVQ:parentChild","GH12-3GN:gender","GH12-3GN:firstName","GH12-3GN:lastName"],"https://drive.google.com/file/d/1BK3uw-U_2ONst68_V7wUXFQWzzlu0pFc/view":["GH12-DRN:living","GH12-DRN:firstName","GH12-DRN:middleName","GH12-DRN:lastName","GH12-DRN:gender","GH12-DRN:birthDate","GH12-DRN:marker","GH12-DRN:deathDate","GH12-DRN:deathPlace","GH12-3GN:GH12-DRN:partner","GH12-3GN:gender","GH12-3GN:firstName","GH12-3GN:lastName","GH12-3GN:deathDate","GH12-DRN:GH12-SVQ:parentChild","GH12-SVQ:firstName","GH12-SVQ:lastName"],"https://drive.google.com/file/d/1J6wUo6AwrS5aO9LJWbh8CUReaRTkUEFF/view":["GHBR-FK3:firstName","GHBR-FK3:middleName","GHBR-FK3:lastName","GHBR-FK3:gender","GHBR-FK3:birthDate","GHBR-FK3:birthPlace","GH12-Z3C:GHBR-FK3:parentChild","GH12-Z3C:gender","GH12-Z3C:firstName","GH12-Z3C:lastName","GH12-W17:GHBR-FK3:parentChild","GH12-W17:gender","GH12-W17:firstName","GH12-W17:lastName","GH12-Z3C:GH12-W17:partner"],"https://drive.google.com/file/d/18MFv7G6xKBJj9M4ewH8a3GgcpFW4VSht/view":["GHBR-FK3:birthPlace","GHBR-FK3:firstName","GHBR-FK3:middleName","GHBR-FK3:lastName","GHBR-FK3:gender","GHBR-FK3:birthDate","GH12-Z3C:GHBR-FK3:parentChild","GH12-Z3C:gender","GH12-Z3C:firstName","GH12-Z3C:middleName","GH12-Z3C:lastName","GH12-W17:GHBR-FK3:parentChild","GH12-W17:gender","GH12-W17:firstName","GH12-W17:middleName","GH12-W17:lastName","GH12-Z3C:GH12-W17:partner","GH12-Z3C:marriageDate","GH12-W17:marriageDate"],"https://drive.google.com/file/d/1rVr3RKFXqxPfw--yVwacLYGwyQFf6LzQ/view?side=ajesta":["GHB5-XTZ:GHBR-FK3:partner","GHBR-FK3:gender","GHBR-FK3:firstName","GHBR-FK3:lastName","GHBR-FK3:birthPlace","GH12-Z3C:GHBR-FK3:parentChild","GH12-Z3C:gender","GH12-Z3C:firstName","GH12-Z3C:lastName","GH12-W17:GHBR-FK3:parentChild","GH12-W17:gender","GH12-W17:firstName","GH12-W17:lastName","GH12-W17:GH12-Z3C:partner","GHBR-FK3:marriagePlace","GHBR-FK3:marriageDate"],"https://drive.google.com/file/d/1u-7tnWjKdZ5-GrdLKuKi-NOAVvty25Qo/view":["GHBD-9L6:gender","GHBD-9L6:firstName","GHBD-9L6:lastName","GHBD-9L6:birthPlace","GHBD-9L6:marker2","GHB8-DXY:gender","GHB8-DXY:firstName","GHB8-DXY:lastName","GHB8-DXY:birthPlace","GHB8-DXY:marker","GHBD-9L6:GHB8-DXY:partner"],"https://drive.google.com/file/d/1g_6PxiUEuhW_jvUU3p8TySDi9u-7hlwG/view":["GNNH-JLM:firstName","GNNH-JLM:lastName","GNNH-JLM:gender","GJJX-1SG:firstName","GJJX-1SG:lastName","GJJX-1SG:gender","GNNH-JLM:GJJX-1SG:partner"],"https://drive.google.com/file/d/1n_6mEB9oGikZeRXw71-_buL1cIoT8X9p/view":["GHB8-GB6:gender","GHB8-GB6:firstName","GHB8-GB6:middleName","GHB8-GB6:lastName","GHBD-9LY:gender","GHBD-9LY:firstName","GHBD-9LY:lastName","GHB8-GB6:GHBD-9LY:partner"],"https://drive.google.com/file/d/1EZnFrq2uHZVgfDSItdUrxBqy7Wzkto7o/view":["LLQS-641:LLQS-6F1:partner","LLQS-641:firstName","LLQS-641:lastName","LLQS-641:gender","LLQS-6F1:firstName","LLQS-6F1:lastName","LLQS-6F1:gender","L281-614:LLQS-641:parentChild","L281-614:firstName","L281-614:lastName","L281-614:gender","G7C3-B6P:LLQS-6F1:parentChild","G7C3-B6P:firstName","G7C3-B6P:gender","G7C3-J9S:LLQS-6F1:parentChild","G7C3-J9S:firstName","G7C3-J9S:lastName","G7C3-J9S:gender","G7C3-B6P:G7C3-J9S:partner"],"https://www.familysearch.org/ark:/61903/1:1:HBP6-8VZM":["GHB8-M8D:firstName","GHB8-M8D:lastName","GHB8-M8D:gender","GHB8-M86:firstName","GHB8-M86:lastName","GHB8-M86:gender","GHB8-M8D:GHB8-M86:partner"],"https://www.familysearch.org/ark:/61903/1:1:6JG6-3YRH":["GH12-XX4:firstName","GH12-XX4:gender","GH12-HQN:firstName","GH12-HQN:lastName","GH12-HQN:gender","GKBR-M9Y:firstName","GKBR-M9Y:lastName","GKBR-7P7:firstName","GKBR-7P7:lastName","GKBR-7P7:gender","GKBT-9GD:firstName","GKBT-9GD:lastName","K2GJ-YY3:firstName","K2GJ-YY3:lastName","K2GJ-YY3:gender","GH12-XX4:GH12-HQN:partner","GKBT-9GD:GH12-HQN:parentChild","GKBR-M9Y:GH12-XX4:parentChild"],"https://www.familysearch.org/ark:/61903/1:1:HBBS-S7W2":["GHBZ-TM4:firstName","GHBZ-TM4:lastName","GHBZ-TM4:gender","GHBZ-P5Q:firstName","GHBZ-P5Q:lastName","GHBZ-P5Q:gender","GHBZ-TM4:GHBZ-P5Q:partner"],"https://drive.google.com/file/d/13-RZPCmG9h3jLf4L-8yMIl7Fi-jdiAbg/view":["GHBD-7M4:birthDate","GHBD-7M4:birthPlace"]};var isChecking=isDebugging||"true"==window.location.get("check"),KEYS_IN_SOURCE="";for(const[PK1,QK1]of Object.entries(SOURCES))KEYS_IN_SOURCE+=QK1.toString();var KEYS_IN_SENTIMENT_SOURCE="";for(const[i,RK1]of Object.entries(SOURCES["SENTIMENTS OF LIVING RELATIVES"]))KEYS_IN_SENTIMENT_SOURCE+=RK1.toString();function isEmpty(t){return null==t||""===t.trim()}function checkPerPerson(s){let n=0,r=0,a=0;var o,h,l=[],u=["key","hasDNA","parent","fullName"];s.living&&(u.push("deathDate"),u.push("deathPlace"),u.push("deathAge"),u.push("livingPlace"),r+=4,a+=4),s.living||(u.push("livingPlace"),r+=1,a+=1),null===s.deathAge&&(u.push("deathAge"),r+=1,a+=1),isEmpty(s.marriageDate)&&u.push("marriageDate"),isEmpty(s.marriagePlace)&&u.push("marriagePlace"),isEmpty(s.twin)&&u.push("twin"),isEmpty(s.middleName)&&u.push("middleName"),isEmpty(s.marker)&&u.push("marker"),isEmpty(s.prefix)&&u.push("prefix"),isEmpty(s.suffix)&&u.push("suffix"),isEmpty(s.partner)&&u.push("partner"),s.living&&u.push("living"),s.hasImage||u.push("hasImage");for([o,h]of Object.entries(s)){let t=s.key+":"+o,e=null,i=("child"==o&&(t=`${h}:${s.key}:parentChild`,e=`${s.key}:${h}:parentChild`),"partner"==o&&(t=`${h}:${s.key}:partner`,e=`${s.key}:${h}:partner`),0);"hasImage"==o&&(i+=1),i=(i+=KEYS_IN_SOURCE.occurrences(t))+KEYS_IN_SOURCE.occurrences(e);var d=String(h),c=(isEmpty(d)&&0!=i&&(n+=1,console.invalid("Found source for empty field: "+(t||e))),d.includes("before")||d.includes("after")||d.includes("about")||d.includes("from"));c&&0!=i&&(n+=1,console.warning(`Found source for estimated field: ${t||e}. Value: `+d)),u.includes(o)||(r+=i,a+=1,i<=0?l.push(o):1<i&&(a+=i-1))}return[r,n,a,l,KEYS_IN_SENTIMENT_SOURCE.occurrences(s.key)]}function isUniqueObjectArray(e,i){var s=new Set;for(let t=0;t<e.length;t++){if(s.has(e[t][i]))return console.invalid("Found duplicate source: "+e[t][i]),!1;s.add(e[t][i])}return!0}function isUniqueStringArray(e){var i=new Set;for(let t=0;t<e.length;t++){if(i.has(e[t]))return!1;i.add(e[t])}return!0}function checkSources(){console.group("Verifying family tree dataset ..."),isUniqueObjectArray(TREE_DATA,"key")?console.valid("All the people in the dataset are unique"):console.invalid("Dataset contains duplicate people");let t=!1;for(var[e,i]of Object.entries(SOURCES))t=(oldDuplicateSource=t)||!isUniqueStringArray(i),!oldDuplicateSource&&t&&console.invalid("Found duplicate source: "+e);t?console.invalid("Dataset contains duplicate sources"):console.valid("All the source in the dataset are unique"),areUniqueSources(SOURCES);let s=0;var n,r,a,o,h,l,u,d,c,g,m,f=[],p=[],v=[],y=[];for([n,r]of Object.entries(TREE_DATA))void 0===r.fullName?(r.verificationBgColor="#"+BG_COLORS[0],r.verificationFgColor="#"+FG_COLORS[0]):([a,o,h,l,u]=checkPerPerson(r),s+=o,h<=a&&y.push(r.fullName),a<=0?(r.verificationBgColor="#"+BG_COLORS[0],r.verificationFgColor="#"+FG_COLORS[0],v.push(r.fullName)):(r.sourceCount=a,r.expectedSourceCount=h,r.unverifiedAttributes=l,r.sourcePercentage=a/h,r.sentimentSourceCount=u,r.verificationBgColor="#"+BG_COLORS[colorScaler(a/h*100)],r.verificationFgColor="#"+FG_COLORS[colorScaler(a/h*100)],f.push(r)));console.valid(`${String(y.length).padStart(2,"0")} / ${TREE_DATA.length} people have complete sources`),f.sort((t,e)=>e.sourcePercentage-t.sourcePercentage);for([d,c]of Object.entries(f)){var x=c.sourceCount,A=c.expectedSourceCount,w=c.unverifiedAttributes,b=""+String(x).padStart(2,"0"),P=""+String(A).padStart(2,"0");if(A<=x)p.push(c.fullName),console.valid(b+` / ${P} checks passed for `+c.fullName);else if(0<x){p.push(c.fullName),console.dynamicGroup(b+` / ${P} checks passed for `+c.fullName,x,A);for(var[S,k]of Object.entries(w))console.log("No source given for %c"+k,"font-weight: 700;");console.groupEnd()}}0<v.length&&console.invalidGroup(`${v.length} / ${TREE_DATA.length} people have no documented sources`);for([g,m]of Object.entries(v))console.log("%c"+m,"font-weight: 700;");0!=s&&console.warning("Dataset contains sources for empty/estimated data fields"),console.groupEnd(),console.groupEnd()}function areUniqueSources(t){var e,i,s,n,r={};for(e in t)e.includes("side=")&&(s=e.indexOf("side=")+5,i=e.substring(0,s),s=e.substring(s),i in r?r[i].push(s):r[i]=[s]);for(n in r)1==new Set(t[n]).size&&console.invalid("Source might contain duplicate sides: "+n)}function useNonePhoto(t){return!t.hasImage&&!t.living&&null==t.birthDate&&null==t.deathDate&&null==t.birthPlace&&null==t.deathPlace}function calculateAdjustedHeight(t){if(t.useNonePhoto)return ui.measure.node.height-45;let e=ui.measure.node.height;return null==t.birthPlace&&(e-=15),null==t.deathPlace&&(e-=15),e}isChecking&&checkSources();for(i=TREE_DATA.length-1;0<=i;i--){let t=TREE_DATA[i];TREE_DATA[i].useNonePhoto=useNonePhoto(t),TREE_DATA[i].height=calculateAdjustedHeight(t)}let template={};function calculatePhotoScale(t){return t.useNonePhoto?1:null==t.birthPlace&&null==t.deathPlace?t.hasImage?.08830769625:.35:null==t.birthPlace&&null!=t.deathPlace||null!=t.birthPlace&&null==t.deathPlace?t.hasImage?.11858461775:.47:null!=t.birthPlace&&null!=t.deathPlace?t.hasImage?.13119999999:.52:1}function marginConditions(t){return"computer"===t||"software"===t?new bino.Margin(2,0,0,2):"prelations"===t?new bino.Margin(3,0,0,2):"intelligence"===t?new bino.Margin(1.95,0,0,1.85):"military"===t?new bino.Margin(2,0,0,1):"housewife"===t?new bino.Margin(2,0,0,1.95):"farming"===t?new bino.Margin(2.25,0,0,1.95):"male-twin"===t||"female-twin"===t?new bino.Margin(0,0,0,2):"train"===t?new bino.Margin(3,0,0,2):"cattle"===t?new bino.Margin(-.25,0,0,.75):"sales"===t?new bino.Margin(3,0,0,2.5):new bino.Margin(2,0,0,2)}function getLifeSpan(t,e){if(t.useNonePhoto)return"";var{living:i,birthDate:s,deathDate:n}=t,r=calculateAge(s,n);let a=r;var e=formatDate(s,e),o=formatDate(n);return e||o?e?o?(n.includes("after")?a=s.includes("after")?"~"+r:(s.includes("before")||s.includes("about"),r+"+"):n.includes("before")?a=s.includes("after")?r+"-":s.includes("before")?"~"+r:(s.includes("about"),r+"-"):n.includes("about")?a="~"+r:s.includes("after")?a=r+"-":s.includes("before")?a=r+"+":s.includes("about")&&(a="~"+r),t.deathAge&&(a=t.deathAge),String(a).includes("NaN")?e+" — "+o:""+e+` — ${o} (${a})`):(t.deathAge&&(a=t.deathAge),String(a).includes("NaN")?e+" — "+(i?"Living":"Deceased"):e+" — "+(i?"Living":"Deceased")+(i?` (${a})`:"")):" — "+o:i?"Living":"Deceased"}function formatDate(t,e){if(!t)return null;if(t.includes("from ")&&t.includes(" to "))return t;let[i,s]=t.includes(" ")?t.split(" "):["",t],[n,r,a]=s.split("-",3);return""!=i&&(i+=" "),r&&!e?((a=void 0===a?"":a+" ").startsWith("0")&&(a=a.slice(1)),""+i+a+["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][parseInt(r,10)-1]+" "+n):""+i+n}function calculateAge(t,e){e=e?new Date(e):new Date,t=new Date(t);let i=e.getFullYear()-t.getFullYear();var s=e.getMonth()-t.getMonth();return(s<0||0==s&&e.getDate()<t.getDate())&&i--,i}template.Node=function(){return $(bino.Shape,{figure:"RoundedRectangle",fill:ui.color.node.background,stroke:null,strokeWidth:0},new bino.Binding("desiredSize","",function(t){return new bino.Size(ui.measure.node.width,t.height)}))},template.TopLeftBorderRadius=function(){return $(bino.Shape,"TopLeftBorderRadius",{fill:ui.color.background,stroke:null,margin:new bino.Margin(0,0,0,0),strokeWidth:0})},template.BottomLeftBorderRadius=function(){return $(bino.Shape,"BottomLeftBorderRadius",{fill:ui.color.background,stroke:null,strokeWidth:0},new bino.Binding("margin","",function(t){return new bino.Margin(t.height-5.8,0,0,0)}))},template.CheckFill=function(){return isChecking?$(bino.Panel,new bino.Binding("visible","",function(t){return isChecking}),$(bino.Shape,{figure:"Rectangle",stroke:null,strokeWidth:0,opacity:.7,margin:new bino.Margin(.2,0,0,.2)},new bino.Binding("visible","",function(t){return isChecking}),new bino.Binding("desiredSize","",function(t){return new bino.Size(ui.measure.node.height+ui.measure.genderBand.width-.8-.4,t.height-.4)}),new bino.Binding("fill","",function(t){return t.verificationBgColor})),$(bino.TextBlock,{font:`700 ${.92*ui.font.size.name}px Google Sans, sans-serif`,height:ui.font.size.name+2,textAlign:"center",opacity:.55},new bino.Binding("visible","",function(t){return isChecking}),new bino.Binding("width","",function(t){return ui.measure.node.height+ui.measure.genderBand.width-.8-.4}),new bino.Binding("stroke","",function(t){return"#111111"}),new bino.Binding("margin","",function(t){return new bino.Margin(t.height/2-11,0,0,0)}),new bino.Binding("text","",function(t){var e=""+t.sourceCount,i=""+t.expectedSourceCount;if("undefined"==e)return"";let s="";return(s=0<t.sentimentSourceCount?t.sentimentSourceCount+" / ":s)+e+" / "+i})),$(bino.TextBlock,{font:'700 8px "Google Sans Text", sans-serif',height:ui.font.size.details+2,textAlign:"center",opacity:.6},new bino.Binding("visible","",function(t){return isChecking}),new bino.Binding("margin","",function(t){return new bino.Margin(t.height/2+4,0,0,0)}),new bino.Binding("width","",function(t){return ui.measure.node.height+ui.measure.genderBand.width-.8-.4}),new bino.Binding("stroke","",function(t){return"#111111"}),new bino.Binding("text","",function(t){return void 0===t.sourceCount?"":"CHECKS PASSED"}))):$(bino.Panel,new bino.Binding("visible","",function(t){return!1}))},template.Link=function(){return $(bino.Link,{selectable:!1,routing:bino.Link.Orthogonal},$(bino.Shape,{strokeWidth:1,stroke:ui.color.link}))},template.Photo=function(){return $(bino.Panel,"Spot",{isClipping:!0,margin:new bino.Margin(.2,0,0,.2)},$(bino.Shape,"Rectangle",{width:ui.measure.node.height-.4,strokeWidth:0},new bino.Binding("height","",function(t){return t.height-.4})),$(bino.Picture,{margin:new bino.Margin(.2,0,0,.2)},new bino.Binding("imageStretch","",function(t){return t.useNonePhoto?bino.GraphObject.Fill:bino.GraphObject.UniformToFill}),new bino.Binding("scale","",function(t){return calculatePhotoScale(t)}),new bino.Binding("source","",function(t){return t.useNonePhoto?ui.photo.none:t.hasImage?"images/people/"+t.key+".lossy.webp":"M"==t.gender.toUpperCase()?ui.photo.male:ui.photo.female})))},template.GenderBand=function(){return $(bino.Shape,{margin:new bino.Margin(0,0,0,ui.measure.node.height-1),figure:"Rectangle",stroke:null,strokeWidth:0},new bino.Binding("desiredSize","",function(t){return new bino.Size(ui.measure.genderBand.width,t.height)}),new bino.Binding("fill","",function(t){return"M"==t.gender.toUpperCase()?ui.color.male:ui.color.female}))},template.DNAMarker=function(){return $(bino.Panel,new bino.Binding("margin","",function(t){var e=ui.measure.marker.margin;return new bino.Margin(e,0,0,ui.measure.node.width-(ui.measure.marker.width+ui.measure.marker.margin))}),new bino.Binding("visible","",function(t){return void 0!==t.hasDNA&&t.hasDNA}),$(bino.Shape,{figure:"Circle",stroke:null,width:ui.measure.marker.width},new bino.Binding("fill","",function(t){return ui.color.marker.background.dna})),$(bino.Picture,{scale:ui.measure.marker.scale},new bino.Binding("source","",function(t){return void 0===t.hasDNA?"":MARKERS.dna}),new bino.Binding("margin","",function(t){return new bino.Margin(2,0,0,2)})))},template.FirstMarker=function(){return $(bino.Panel,new bino.Binding("margin","",function(t){let e=ui.measure.marker.margin+(ui.measure.marker.width+ui.measure.marker.margin)-3;return t.hasDNA||(e=ui.measure.marker.margin),new bino.Margin(e,0,0,ui.measure.node.width-(ui.measure.marker.width+ui.measure.marker.margin))}),new bino.Binding("visible","",function(t){return void 0!==t.marker}),$(bino.Shape,{figure:"Circle",stroke:null,width:ui.measure.marker.width},new bino.Binding("fill","",function(t){return void 0!==ui.color.marker.background[t.marker]?ui.color.marker.background[t.marker]:ui.color.marker.background.default})),$(bino.Picture,{scale:ui.measure.marker.scale},new bino.Binding("source","",function(t){return void 0===t.marker?"":MARKERS[t.marker]}),new bino.Binding("margin","",function(t){return marginConditions(t.marker)})))},template.SecondMarker=function(){return $(bino.Panel,new bino.Binding("margin","",function(t){var e=ui.measure.marker.margin+(ui.measure.marker.width+ui.measure.marker.margin)-3;return new bino.Margin(e,0,0,ui.measure.node.width-(ui.measure.marker.width+ui.measure.marker.margin))}),new bino.Binding("visible","",function(t){return void 0!==t.marker2&&!t.hasDNA}),$(bino.Shape,{figure:"Circle",stroke:null,width:ui.measure.marker.width},new bino.Binding("fill","",function(t){return void 0!==ui.color.marker.background[t.marker2]?ui.color.marker.background[t.marker2]:ui.color.marker.background.default})),$(bino.Picture,{scale:ui.measure.marker.scale},new bino.Binding("source","",function(t){return void 0===t.marker2?"":MARKERS[t.marker2]}),new bino.Binding("margin","",function(t){return marginConditions(t.marker2)})))},template.ThirdMarker=function(){return $(bino.Panel,new bino.Binding("margin","",function(t){var e=ui.measure.marker.margin+2*(ui.measure.marker.width+ui.measure.marker.margin-3);return new bino.Margin(e,0,0,ui.measure.node.width-(ui.measure.marker.width+ui.measure.marker.margin))}),new bino.Binding("visible","",function(t){return void 0!==t.marker3}),$(bino.Shape,{figure:"Circle",stroke:null,width:ui.measure.marker.width},new bino.Binding("fill","",function(t){return void 0!==ui.color.marker.background[t.marker3]?ui.color.marker.background[t.marker3]:ui.color.marker.background.default})),$(bino.Picture,{scale:ui.measure.marker.scale},new bino.Binding("source","",function(t){return void 0===t.marker3?"":MARKERS[t.marker3]}),new bino.Binding("margin","",function(t){return marginConditions(t.marker3)})))},template.Name=function(){return $(bino.TextBlock,{font:`700 ${ui.font.size.name}px Google Sans, sans-serif`,height:ui.font.size.name+2},new bino.Binding("width","",function(t){return ui.measure.node.width-93}),new bino.Binding("margin","",function(t){return new bino.Margin(ui.measure.node.padding,0,0,ui.measure.node.height+ui.font.size.details)}),new bino.Binding("stroke","",function(t){return(t.firstName.includes("known")?ui.color.node.nameless:ui.color.node).name}),new bino.Binding("text","",function(t){return t.fullName}))},template.Lifespan=function(){return $(bino.TextBlock,{font:`400 ${ui.font.size.details}px "Google Sans Text", sans-serif`,height:ui.font.size.details+2},new bino.Binding("width","",function(t){return ui.measure.node.width-94}),new bino.Binding("margin","",function(t){return new bino.Margin(24+parseInt(ui.measure.node.padding/2),0,0,ui.measure.node.height+ui.font.size.details)}),new bino.Binding("stroke","",function(t){return(t.firstName.includes("nknown")?ui.color.node.nameless:ui.color.node).details}),new bino.Binding("text","",function(t){return t.living?getLifeSpan(t,isPrivate):getLifeSpan(t)}))},template.BirthDeathPlace1=function(){return $(bino.Panel,$(bino.TextBlock,{font:`400 ${ui.font.size.details}px "Google Sans Text", sans-serif`,height:ui.font.size.details+2},new bino.Binding("width","",function(t){return ui.measure.node.width-94-15}),new bino.Binding("margin","",function(t){return new bino.Margin(39+parseInt(ui.measure.node.padding/2),0,0,ui.measure.node.height+ui.font.size.details+15)}),new bino.Binding("stroke","",function(t){return(t.firstName.includes("nknown")?ui.color.node.nameless:ui.color.node).details}),new bino.Binding("text","",function(t){return null==t.birthPlace&&null==t.deathPlace?"":null!=t.birthPlace?"    "+t.birthPlace:null!=t.deathPlace?"    "+t.deathPlace:void 0})),$(bino.TextBlock,{font:`700 ${ui.font.size.details}px Google Sans, sans-serif`,height:ui.font.size.details+2},new bino.Binding("width","",function(t){return ui.measure.node.width-94}),new bino.Binding("margin","",function(t){return new bino.Margin(39+parseInt(ui.measure.node.padding/2),0,0,ui.measure.node.height+ui.font.size.details)}),new bino.Binding("stroke","",function(t){return(t.firstName.includes("nknown")?ui.color.node.nameless:ui.color.node).details}),new bino.Binding("text","",function(t){return null==t.birthPlace&&null==t.deathPlace?"":null!=t.birthPlace?"B:":null!=t.deathPlace?"D:":void 0})))},template.BirthDeathPlace2=function(){return $(bino.Panel,$(bino.TextBlock,{font:`400 ${ui.font.size.details}px "Google Sans Text", sans-serif`,height:ui.font.size.details+2},new bino.Binding("width","",function(t){return ui.measure.node.width-94-15}),new bino.Binding("margin","",function(t){return new bino.Margin(54.5+parseInt(ui.measure.node.padding/2),0,0,ui.measure.node.height+ui.font.size.details+15)}),new bino.Binding("stroke","",function(t){return(t.firstName.includes("nknown")?ui.color.node.nameless:ui.color.node).details}),new bino.Binding("text","",function(t){return null==t.deathPlace||null==t.birthPlace?"":(t.living,"    "+t.deathPlace)})),$(bino.TextBlock,{font:`700 ${ui.font.size.details}px Google Sans, sans-serif`,height:ui.font.size.details+2},new bino.Binding("width","",function(t){return ui.measure.node.width-94}),new bino.Binding("margin","",function(t){return new bino.Margin(54.5+parseInt(ui.measure.node.padding/2),0,0,ui.measure.node.height+ui.font.size.details)}),new bino.Binding("stroke","",function(t){return(t.firstName.includes("nknown")?ui.color.node.nameless:ui.color.node).details}),new bino.Binding("text","",function(t){return null==t.deathPlace||null==t.birthPlace?"":t.living?"L:":"D:"})))};var tree=$(bino.Diagram,"tree",{isReadOnly:!0,padding:ui.measure.padding,scale:ui.scale,layout:$(bino.TreeLayout,{angle:0,layerSpacing:Math.max(parseInt(4*ui.measure.node.margin),20),nodeSpacing:ui.measure.node.margin}),hasHorizontalScrollbar:!1,hasVerticalScrollbar:!1,allowHorizontalScroll:!0,allowSelect:!1,allowVerticalScroll:!0,allowZoom:!0});tree.nodeTemplate=$(bino.Node,{selectable:!1},new bino.Binding("height","height"),new bino.Binding("width","width"),template.Node(),template.Photo(),template.Name(),template.Lifespan(),template.BirthDeathPlace1(),template.BirthDeathPlace2(),template.DNAMarker(),template.FirstMarker(),template.SecondMarker(),template.ThirdMarker(),template.GenderBand(),template.CheckFill(),template.TopLeftBorderRadius(),template.BottomLeftBorderRadius()),tree.linkTemplate=template.Link();let model=$(bino.TreeModel);model.nodeDataArray=TREE_DATA,tree.model=model,document.querySelector("footer").classList.remove("hidden");