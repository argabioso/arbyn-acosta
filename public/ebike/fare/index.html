<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>eBike Fare Calculator</title>

  <link rel="stylesheet" href="css/normalize.css">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

</head>

<body>
  <h1>eBike Fare Calculator</h1>
  <button id="startStopButton">Start/Stop Tracking</button>

  <div id="map" style="width: 600px; height: 400px;"></div>
  <p id="hmmm"></p>
  <script>
    document.addEventListener("DOMContentLoaded", (event) => {
    // Get the dimensions
    let viewableWidth = (window.innerWidth - 15);
    let viewableHeight = (window.innerHeight - 122);

    // Select the element you want to resize
    let myElement = document.getElementById('map');

    // Set the dimensions to the element
    myElement.style.width = viewableWidth + 'px';
    myElement.style.height = viewableHeight + 'px';

    window.addEventListener('resize', function() {
        myElement.style.width = (window.innerWidth - 15) + 'px';
        myElement.style.height = (window.innerHeight - 122) + 'px';
    });

    const map = L.map('map').setView([14.599732043846203, 120.98514882838623], 17);

    const tiles = L.tileLayer('http://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {
      maxZoom: 19,
      subdomains:['mt0','mt1','mt2','mt3'],
      attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    }).addTo(map);
      let watchID;
      let positionOptions = {
          enableHighAccuracy: true, // Uses GPS if available
          timeout: 5000, // Milliseconds to wait before timeout if no position is received
          maximumAge: 0 // Set to 0 to ensure the device doesn't return a cached position
      };

      let allPositions = [];

      let currentLatitude = null;
      let currentLongitude = null;

      let isTracking = false;
      let startPosition = null;
      let endPosition = null;

      let startMarker = null;
      let stopMarker = null;

      document.getElementById('startStopButton').addEventListener('click', function() {
          if (!isTracking) {
              startTracking();
          } else {
              stopTracking();
              calculateFare();
          }
      });

      function startTracking() {
          if (navigator.geolocation) {
              watchID = navigator.geolocation.watchPosition(positionUpdate, positionError, positionOptions);
              isTracking = true;
          } else {
              console.log("Geolocation is not supported by this browser.");
          }
      }

      function positionUpdate(position) {
          currentLatitude = position.coords.latitude;
          currentLongitude = position.coords.longitude;

          let coords = [currentLatitude, currentLongitude];

          if (startPosition === null) {
              startPosition = coords;
              startMarker = L.marker(startPosition).addTo(map);
          }

          allPositions.push(coords);
          map.setView(coords);

          // Update the position on your map or perform your calculations here

          console.log("Latitude: " + currentLatitude + ", Longitude: " + currentLongitude);
      }

      function positionError(error) {
          console.warn('ERROR(' + error.code + '): ' + error.message);
      }

      function stopTracking() {
          isTracking = false;
          if (navigator.geolocation) {
              navigator.geolocation.clearWatch(watchID);
              stopPosition = [currentLatitude, currentLongitude];

              startMarker = L.marker(stopPosition).addTo(map);
              map.setView(stopPosition);
              console.log("Latitude: " + currentLatitude + ", Longitude: " + currentLongitude);
          }
      }

      function calculateFare() {
          // Calculate distance between startPosition and endPosition
          // Apply fare calculation logic
          // Display fare in an alert or on the page
          document.getElementById('hmmm').innerText = allPositions;
          alert(allPositions);
      }
    });
  </script>
</body>

</html>